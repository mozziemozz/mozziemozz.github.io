<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Entra ID on HEUSSER.PRO</title>
        <link>https://heusser.pro/categories/entra-id/</link>
        <description>Recent content in Entra ID on HEUSSER.PRO</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Thu, 05 Dec 2024 15:17:25 +0000</lastBuildDate><atom:link href="https://heusser.pro/categories/entra-id/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>Understanding Microsoft Entra ID App Registrations, Enterprise Apps and Service Principals</title>
        <link>https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/</link>
        <pubDate>Thu, 05 Dec 2024 15:17:25 +0000</pubDate>
        
        <guid>https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/</guid>
        <description>&lt;h2 id=&#34;intro&#34;&gt;Intro
&lt;/h2&gt;&lt;p&gt;I once read a joke on X which I just vaguely remembered. Somebody was looking for a job in IT and the person hiring was like:&lt;/p&gt;
&lt;blockquote&gt;
    &lt;p&gt;&lt;em&gt;If you can tell me the difference between an Entra app registration and an enterprise app, I&amp;rsquo;ll hire you.&lt;/em&gt;&lt;/p&gt;&lt;span class=&#34;cite&#34;&gt;&lt;span&gt;― &lt;/span&gt;&lt;span&gt;Some guy on X&lt;/span&gt;&lt;cite&gt;&lt;/cite&gt;&lt;/span&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/cover.png&#34;
	width=&#34;726&#34;
	height=&#34;669&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/cover_hu_79cae35b24a4d528.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/cover_hu_b8a8b0395ae5c27c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;108&#34;
		data-flex-basis=&#34;260px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If you&amp;rsquo;re a seasoned developer, you might already know all of this but if you&amp;rsquo;re a systems administrator coming from a more traditional world, like I am, much of the stuff I&amp;rsquo;m covering today might be new, confusing, overwhelming or all the above to you. But rest assured, I didn&amp;rsquo;t fully understand it either until today.&lt;/p&gt;
&lt;p&gt;I want to highlight that identity isn&amp;rsquo;t my primary focus, but it was still very important to me to understand all aspects of Entra applications. Most of the blog posts that already exist about Entra applications are written by professional developers and just assume that you&amp;rsquo;re already familiar with certain things. That&amp;rsquo;s what I&amp;rsquo;m trying to do differently with this article.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;ll give you an example. Let&amp;rsquo;s say you need to change the usage location of an Entra ID user, and you want to do it with PowerShell. A couple of years ago, you could just install the AzureAD PowerShell module, log in with your account and get it done by running &lt;code&gt;Set-AzureADUser -ObjectId user@domain.com -UsageLocation CH&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;In today&amp;rsquo;s world you need to connect to Microsoft Graph using the Microsoft Graph PowerShell SDK (Microsoft.Graph.* PowerShell modules) and you need to make sure that the appropriate permissions have been granted to the enterprise app before you can do that, even if the account you&amp;rsquo;re using to sign in already has the permissions to do the same action in the Entra Admin Center.&lt;/p&gt;
&lt;p&gt;In this particular example, I&amp;rsquo;m talking about what&amp;rsquo;s referred to as an enterprise app or an enterprise application. The name of the official enterprise app that&amp;rsquo;s used to access your tenant when using the Graph PowerShell modules is &lt;strong&gt;Microsoft Graph Command Line Tools&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image_hu_96263d9e9aee30a.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image_hu_b23b3e1ed1942567.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Microsoft Graph Command Line Tools Enterprise Application&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;You can see that it says &lt;strong&gt;Enterprise Application&lt;/strong&gt; below the name in the screenshot above. However, when you search for its Application ID, it lists the name under &lt;strong&gt;Enterprise Applications&lt;/strong&gt;, but it also says &lt;strong&gt;Service Principal&lt;/strong&gt; next to it.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-1.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-1_hu_a7d43b28fd91fa6.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-1_hu_eda6b27c5396877a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Application ID search results&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Because this app is owned and published by Microsoft, there&amp;rsquo;s no app registration for it in your tenant. You can only see the enterprise app. Only Microsoft can see the app registration in the tenant in which they registered the app (created the app registration).&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s recap this quickly. Microsoft created an app registration for the Microsoft Graph Command Line Tools and published it. Any Entra ID admin can now add this app to their tenant as an enterprise app and use it to connect to Microsoft Graph via PowerShell.&lt;/p&gt;
&lt;p&gt;So, when I use &lt;code&gt;Connect-MgGraph&lt;/code&gt; and don&amp;rsquo;t specify my own Client Id, I&amp;rsquo;m automatically signing in to Microsoft&amp;rsquo;s enterprise app.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-3.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-3_hu_ba3d95f260795a3c.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-3_hu_7cfa598ab939230e.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Partial output of Get-MgContext&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;whats-the-difference-between-an-enterprise-app-and-a-service-principal&#34;&gt;What&amp;rsquo;s the difference between an enterprise app and a service principal?
&lt;/h2&gt;&lt;p&gt;They are the same thing. Enterprise apps are just what they are called in the Entra Admin Center but they&amp;rsquo;re essentially service principals. The naming and UI elements here are very confusing. We already saw that searching for the app id in Entra Admin Center will say Service Principal next to the app but throughout this article, I&amp;rsquo;m going to show you more proof why every enterprise app is a service principal.&lt;/p&gt;
&lt;p&gt;What&amp;rsquo;s a service principal then?&lt;/p&gt;
&lt;p&gt;A service principal is always linked to an application (registration) either in your tenant or in another tenant. They inherit and share some of their properties, like the app id from their linked application. In essence, a service principal is an instance, or a child object, if you will, of a global application registered in Entra ID but it&amp;rsquo;s unique to your tenant. Even if another tenant owns the app, service principals will allow you to manage how and by which users the app will be used.&lt;/p&gt;
&lt;p&gt;If you search for &lt;code&gt;Service Principal&lt;/code&gt; in the global Entra Admin Center search box it will list &lt;strong&gt;Enterprise applications&lt;/strong&gt; as the top result.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-4.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-4_hu_c5e5a15bfee28006.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-4_hu_8fb91e57aab5e3f4.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Entra Admin Center search results&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;whats-the-difference-between-the-application-id-and-the-object-id-of-an-enterprise-app&#34;&gt;What&amp;rsquo;s the difference between the application ID and the Object ID of an Enterprise App?
&lt;/h3&gt;&lt;p&gt;These are the descriptions when you click on the little (i) icons on an enterprise app in Entra Admin Center:&lt;/p&gt;
&lt;h4 id=&#34;application-id&#34;&gt;Application ID
&lt;/h4&gt;&lt;blockquote&gt;
    &lt;p&gt;This is the unique application ID of this application in your directory. You can use this application ID if you ever need help from Microsoft Support, or if you want to perform operations against this specific instance of the application using Microsoft Graph or PowerShell APIs.&lt;/p&gt;&lt;span class=&#34;cite&#34;&gt;&lt;span&gt;― &lt;/span&gt;&lt;span&gt;Entra Admin Center&lt;/span&gt;&lt;cite&gt;&lt;/cite&gt;&lt;/span&gt;&lt;/blockquote&gt;
&lt;p&gt;The application id is the same in all tenants where the enterprise app has been added to.&lt;/p&gt;
&lt;h4 id=&#34;object-id&#34;&gt;Object ID
&lt;/h4&gt;&lt;blockquote&gt;
    &lt;p&gt;This is the unique ID of the service principal object associated with this application. This ID can be useful when performing management operations against this application using PowerShell or other programmatic interfaces.&lt;/p&gt;&lt;span class=&#34;cite&#34;&gt;&lt;span&gt;― &lt;/span&gt;&lt;span&gt;Entra Admin Center&lt;/span&gt;&lt;cite&gt;&lt;/cite&gt;&lt;/span&gt;&lt;/blockquote&gt;
&lt;p&gt;The object id is unique in every tenant to which the enterprise app has been added to. If an enterprise app is deleted and later added again, the object id will also change. The application id on the other hand is the same in every tenant because it&amp;rsquo;s derived of the application id of the registered app for which the service principal was created.&lt;/p&gt;
&lt;h3 id=&#34;adding-an-enterprise-app-to-your-tenant&#34;&gt;Adding an Enterprise App to Your Tenant
&lt;/h3&gt;&lt;p&gt;Providers/publishers of enterprise apps will typically give you a link which you have to open in order to grant admin consent on behalf of your organization. Granting admin consent will add the enterprise app to your tenant and requires global administrator rights.&lt;/p&gt;
&lt;p&gt;In the case of the Microsoft Graph Command Line Tools, the enterprise app can be added simply by running &lt;code&gt;Connect-MgGraph&lt;/code&gt;. This will open the browser and ask you for your consent.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-6.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-6_hu_cb95241fa5bb298a.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-6_hu_d06298f67c7aa572.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Grant admin consent to add the enterprise app&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;ve just added the Microsoft Graph Command Line Tools enterprise app to a tenant where it didn&amp;rsquo;t exist before. If I check the audit log of the enterprise app, I can clearly see that there&amp;rsquo;s been an action for &lt;strong&gt;Add service principal&lt;/strong&gt; even though the portal is calling it an enterprise application.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-7.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-7_hu_1c541fef0100fa4f.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-7_hu_632cb95c0d77d8c0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Enterprise application audit log&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-8.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-8_hu_3352a86bb5b65a88.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-8_hu_a4093eb35702e4bb.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Add service principal audit log details&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Since it&amp;rsquo;s obvious that the same thing is sometimes called an enterprise app but sometimes it&amp;rsquo;s also called a service principal, I&amp;rsquo;ll try my best to stick to whatever the screenshots or code examples are calling it at the time. So, if the screenshot/code example is saying enterprise app, I&amp;rsquo;ll call it an enterprise app. If it&amp;rsquo;s saying service principal, I&amp;rsquo;m referring to it as a service principal as well.&lt;/p&gt;
&lt;h2 id=&#34;im-a-sys-admin-why-should-i-care-about-all-of-this&#34;&gt;I&amp;rsquo;m a Sys Admin, why should I care about all of this?
&lt;/h2&gt;&lt;p&gt;Let&amp;rsquo;s quickly go back to the example I used in the intro of this post. Let&amp;rsquo;s assume that all you want to do is to use PowerShell to change the usage location of a user. Why should you care about all of this? Why do you need an app for this? And what even is an app in this context? Is it an enterprise app or an app registration?&lt;/p&gt;
&lt;p&gt;If you use the official Microsoft Graph Command Line Tools enterprise app, which you are when you run &lt;code&gt;Connect-MgGraph&lt;/code&gt; without specifying your own &lt;code&gt;-ClientId&lt;/code&gt; then you don&amp;rsquo;t need to worry about all this too much. All you need to do is to ask somebody with global admin permissions to add the enterprise app to your tenant and consent to the &lt;code&gt;User.Write.All&lt;/code&gt; permission. That is, if you don&amp;rsquo;t have global admin rights yourself.&lt;/p&gt;
&lt;p&gt;I purposely chose the Microsoft Graph Command Line Tools enterprise app for this example because a lot of Sys Admins will need that to do their job. The thing with PowerShell scripts is that there won&amp;rsquo;t always be something that&amp;rsquo;s graspable, something that can be referred to as an app. A script is not really an app, but it still needs an Entra application to sign into Microsoft Graph to do whatever it needs to do.&lt;/p&gt;
&lt;p&gt;This is different from when we look at a &lt;em&gt;real&lt;/em&gt;, graspable app like Zoom for example. In that case, we have the Zoom app (the Zoom client installed on a device). But we&amp;rsquo;ll also need to grant permissions the Zoom enterprise app to read/write the signed in user&amp;rsquo;s calendar information if users want to link their Exchange calendar to Zoom.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-10.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-10_hu_569c1f1df82738c5.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-10_hu_a42209a2fc4066e7.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Example: Zoom enterprise app&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The Zoom app and the Zoom enterprise app are definitely not the same thing even though both are called an app. Assigning the enterprise app to users won&amp;rsquo;t install Zoom on their devices. That&amp;rsquo;s what Intune is for.&lt;/p&gt;
&lt;p&gt;So, as a Sys Admin, you might not be developing the next Zoom app that will be used by millions of people in thousands of Entra ID tenants, but you simply want to create a PowerShell script that changes the usage location of an Entra ID user.&lt;/p&gt;
&lt;p&gt;The Microsoft Graph Command Line Tools enterprise app can only exist once in each tenant so if the entire IT staff of a company is using the same app to manage Entra ID, consented permissions can accumulate and spiral out of control rather quickly. There is a good article about that from Tony Redmond over at &lt;a class=&#34;link&#34; href=&#34;https://practical365.com/connect-microsoft-graph-powershell-sdk/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Practical 365&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If you want to avoid that, then you&amp;rsquo;ll need to create your own app to connect to Graph. This is where you&amp;rsquo;ll have to deal with app registrations.&lt;/p&gt;
&lt;h2 id=&#34;what-are-app-registrations&#34;&gt;What Are App Registrations?
&lt;/h2&gt;&lt;p&gt;Adding an enterprise app is only possible when an app registration already exists either in your own tenant or in an external one.&lt;/p&gt;
&lt;p&gt;When I go to enterprise apps in Entra Admin Center and click on &lt;strong&gt;Create your own application&lt;/strong&gt; and then select &lt;strong&gt;Register an application to integrate with Microsoft Entra ID (App you&amp;rsquo;re developing)&lt;/strong&gt; and click &lt;strong&gt;Create&lt;/strong&gt; nothing happens just yet. Instead, I&amp;rsquo;m redirected to the &lt;strong&gt;App registrations&lt;/strong&gt; page.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-11.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-11_hu_c9861e2986b0040e.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-11_hu_3530a8176326e3d9.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Trying to create a new enterprise app…&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-9.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-9_hu_6f8fe73ad55f4294.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-9_hu_f9ed2205ba4ca686.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;…will take you to App registrations&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;This means that there is no such thing as an enterprise app without an existing app registration. Not even in PowerShell. I&amp;rsquo;ll talk more about this later.&lt;/p&gt;
&lt;p&gt;The Entra Admin Center specifically says &lt;strong&gt;App you&amp;rsquo;re developing&lt;/strong&gt; but it could also be &lt;em&gt;just&lt;/em&gt; a script that you&amp;rsquo;re developing.&lt;/p&gt;
&lt;h3 id=&#34;create-an-app-registration&#34;&gt;Create an App Registration
&lt;/h3&gt;&lt;h4 id=&#34;in-entra-admin-center&#34;&gt;In Entra Admin Center
&lt;/h4&gt;&lt;p&gt;App registrations can be found in the Entra Portal under &lt;code&gt;Identity\Applications\App registrations&lt;/code&gt;. Enterprise applications are also found in the same menu, which is another reason why it&amp;rsquo;s so hard to differentiate between the two. As you can see in the screenshot below, there is no app registration for &lt;strong&gt;Microsoft Graph Command Line Tools&lt;/strong&gt; in my tenant even though I&amp;rsquo;ve added the enterprise app before.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-12.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-12_hu_215a71c17754e958.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-12_hu_9717079fced8f001.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;App registrations in Microsoft Entra Admin Center&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;An app registration is essentially exactly what the name says. It simply registers an app in Entra ID. When you create a new app registration, you&amp;rsquo;re basically just telling Entra ID that this app now exists but you can&amp;rsquo;t really do anything with the app registration alone.&lt;/p&gt;
&lt;p&gt;An Entra app can be registered to be added to either a single tenant (the tenant in which you register it), Multitenant (any Entra ID tenant) or Multitenant + personal Microsoft Accounts which are used for sign-ins with Microsoft 365 Family/Outlook.com/Skype/Xbox etc.&lt;/p&gt;
&lt;p&gt;If you want to use this app to connect to Graph PowerShell in a script and you only need to manage your own tenant, making it available in your tenant only is the choice to go with. If you were in fact developing the next Zoom, you should choose to make it multi-tenant.&lt;/p&gt;
&lt;p&gt;Here I&amp;rsquo;m creating a new single-tenant app registration called &lt;strong&gt;Graph PowerShell Demo (Created in Portal)&lt;/strong&gt;. If you want to sign into your app in Graph PowerShell, you also need to set the &lt;strong&gt;Redirect URI&lt;/strong&gt; to &lt;strong&gt;Public client/native (mobile &amp;amp; desktop)&lt;/strong&gt; and configure &lt;code&gt;http://localhost&lt;/code&gt; as the redirect URI.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-13.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-13_hu_c11a9b2d342776d3.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-13_hu_de77d22d1a62c0ad.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Register a new application&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;This is what you&amp;rsquo;ll see after the app registration has been created.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-16.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-16_hu_7af48fd2ed59da16.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-16_hu_5f8e08a3a6017951.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;App registration after it’s been created in the portal&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;A very important part which is not often mentioned is that when you register a new app in the portal, an enterprise app (service principal) is automatically created for it as well.&lt;/p&gt;
&lt;p&gt;When I search for the &lt;strong&gt;application (client) ID&lt;/strong&gt; of the newly created app in Entra ID, two objects are returned. An app registration (application) and an enterprise application (service principal).&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-14.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-14_hu_db88a2ac764698c2.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-14_hu_543d45edae755870.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;App registration and enterprise application in search results&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;We can also see this very clearly in the audit log. First the application (app registration) is added and immediately after that, the service principal (enterprise app) is added as well.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-15.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-15_hu_fa3b13b0b2763fc8.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-15_hu_642beffd97ca7fd3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Audit log after creating a new app registration in the portal&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;In the details for the &lt;strong&gt;Add application&lt;/strong&gt; activity the modified properties include a property named &lt;strong&gt;ServicePrincipalLockConfiguration&lt;/strong&gt; which is a Json object and includes &lt;code&gt;&amp;quot;IsEnabled&amp;quot;: &amp;quot;true&amp;quot;&lt;/code&gt;. I &lt;em&gt;think&lt;/em&gt; that this is the part where the Entra Admin Center tells the provisioning backend to create a service principal for the app registration as well.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-18.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-18_hu_bbf1282aac997bde.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-18_hu_2ac4f322832ae06.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Add application log details&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;For the &lt;strong&gt;Add service principal&lt;/strong&gt; activity we can see that the modified properties include the &lt;strong&gt;Application (client) ID&lt;/strong&gt; as value for the &lt;strong&gt;ServicePrincipalName&lt;/strong&gt; and &lt;strong&gt;TargetId.ServicePrincipalNames&lt;/strong&gt; properties.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-17.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-17_hu_24aa6a2fade84e52.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-17_hu_28f1008dec6d6558.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Add service principal log details&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;in-powershell&#34;&gt;In PowerShell
&lt;/h4&gt;&lt;p&gt;To register a new app in PowerShell you have two options. You can either use the recently &lt;a class=&#34;link&#34; href=&#34;https://techcommunity.microsoft.com/t5/microsoft-entra-blog/introducing-the-microsoft-entra-powershell-module/ba-p/4173546/page/2&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;announced&lt;/a&gt; &lt;strong&gt;Microsoft.Graph.Entra&lt;/strong&gt; module which is still in preview at the time of writing, or you can use the Cmdlet which is part of the &lt;strong&gt;Microsoft.Graph.Applications&lt;/strong&gt; module.&lt;/p&gt;
&lt;h5 id=&#34;with-entra-powershell-module&#34;&gt;With Entra PowerShell Module
&lt;/h5&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.entra/new-entraapplication?view=entra-powershell&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Docs&lt;/a&gt; for &lt;code&gt;New-EntraApplication&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-PowerShell&#34; data-lang=&#34;PowerShell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Connect-Entra&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Scopes&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Application.ReadWrite.All&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$appName&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Graph PowerShell Demo (Created with Entra PS)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$newApp&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;New-EntraApplication&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-DisplayName&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$appName&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h5 id=&#34;with-microsoft-graph-powershell&#34;&gt;With Microsoft Graph PowerShell
&lt;/h5&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.applications/new-mgapplication?view=graph-powershell-1.0&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Docs&lt;/a&gt; for &lt;code&gt;New-MgApplication&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-PowerShell&#34; data-lang=&#34;PowerShell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Connect-MgGraph&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Scopes&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Application.ReadWrite.All&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$appName&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Graph PowerShell Demo (Created with Graph PS)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$newApp&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;New-MgApplication&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-DisplayName&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$appName&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Both Cmdlets are called &lt;code&gt;New-*Application&lt;/code&gt; but in the portal this action is called &lt;strong&gt;Register an application&lt;/strong&gt;. The menu which lists applications in the portal is called &lt;strong&gt;App registrations&lt;/strong&gt; but in PowerShell we use &lt;code&gt;Get-EntraApplication&lt;/code&gt; or &lt;code&gt;Get-MgApplication&lt;/code&gt; to retrieve registered apps.&lt;/p&gt;
&lt;p&gt;As if this wasn&amp;rsquo;t confusing enough already, we now have to understand that what is presented to us as an &lt;strong&gt;app registration&lt;/strong&gt; in the portal is sometimes also called &lt;em&gt;just&lt;/em&gt; an &lt;strong&gt;application&lt;/strong&gt;. When you create a new app registration, you&amp;rsquo;re creating a new application by registering it. The portal takes the verb &lt;strong&gt;registering&lt;/strong&gt; and converts it into a noun by calling it an &lt;strong&gt;app registration&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;The outcome of both the above examples is exactly the same. For the sake of simplicity, I&amp;rsquo;m only going to focus on &lt;strong&gt;Graph PowerShell Demo (Created with Entra PS)&lt;/strong&gt; in this section.&lt;/p&gt;
&lt;p&gt;As you can see below, when the app is created through PowerShell, no enterprise app is created automatically. Only the application is created (registered).&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-19.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-19_hu_d3baf158c8ac2a9c.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-19_hu_896013b4b3edeef8.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;The enterprise app/service principal is missing&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;We have the audit log to back this up. It&amp;rsquo;s only showing an &lt;strong&gt;Add application&lt;/strong&gt; action.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-20.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-20_hu_906f42a891559c3c.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-20_hu_ea3130e717c2acea.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Audit log is only showing add application&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;h6 id=&#34;add-a-service-principal-with-powershell&#34;&gt;Add a Service Principal with PowerShell
&lt;/h6&gt;&lt;p&gt;When you view the &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/powershell/entra-powershell/manage-apps?view=entra-powershell&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;documentation&lt;/a&gt; for managing applications using the Entra PowerShell module, it becomes clear that registering an application and adding a service principal are two separate actions requiring different Cmdelts. There is absolutely no reference at all about enterprise apps on that Microsoft Learn page. They only talk about service principals.&lt;/p&gt;
&lt;p&gt;To add a service principal for an app you registered using &lt;code&gt;New-EntraApplication&lt;/code&gt; you&amp;rsquo;ll need to run this code to add a service principal for it:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-EntraServicePrincipal&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-AppId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$newApp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;AppId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;After this, you&amp;rsquo;ll see an app registration and an enterprise app when you search for the app id in the Entra Admin Center.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-21.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-21_hu_c3d1b401cf387193.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-21_hu_c30cbf154c3f2931.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Enterprise app created with PowerShell&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I told you earlier that you cannot create an enterprise app/service principal if no app has been registered for it before.&lt;/p&gt;
&lt;p&gt;I tried to create a new service principal without specifying an app id anyway and I was immediately prompted for an AppId.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-23.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-23_hu_1828a45eddccfe0.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-23_hu_2f985137096462cc.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Prompt for required parameter -AppId&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;As expected, the &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.entra/new-entraserviceprincipal?view=entra-powershell#-appid&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;documentation&lt;/a&gt; for &lt;code&gt;NewEntraServicePrincipal&lt;/code&gt; lists the &lt;code&gt;-AppId&lt;/code&gt; parameter as required. Funny enough, the &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.applications/new-mgserviceprincipal?view=graph-powershell-1.0#-appid&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;docs&lt;/a&gt; for &lt;code&gt;New-MgServicePrincipal&lt;/code&gt; say it&amp;rsquo;s not required but that&amp;rsquo;s definitely not the case.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-24.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-24_hu_31de6e487d1e4b3.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-24_hu_1d1f9deb719a739.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Error details of New-MgServicePrincipal without -AppId&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;connect-to-graph-powershell-using-your-own-app&#34;&gt;Connect to Graph PowerShell Using Your Own App
&lt;/h2&gt;&lt;p&gt;Now that I have an app registration and a service principal, I can use the application id to sign into Graph PowerShell.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-PowerShell&#34; data-lang=&#34;PowerShell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$tenantId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;4bffbf87-53a0-4fce-b58b-4179cb3a3b7d&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$appId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;90b85c34-0c3f-4d69-9668-ea74f20e5d62&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Connect-MgGraph&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-NoWelcome&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-TenantId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$tenantId&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ClientId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$appId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;If I&amp;rsquo;m doing this for the first time, I&amp;rsquo;m prompted for admin consent. Note that you&amp;rsquo;ll need to specify the redirect URI either when creating the app registration through PowerShell or you&amp;rsquo;ll have to do it manually in the portal afterwards. Otherwise, this won&amp;rsquo;t work.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-26.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-26_hu_b4ac1020c17096f1.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-26_hu_5e0075b5da97ff3b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Admin consent request&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Now you can see that I&amp;rsquo;m signed in using my own app and I&amp;rsquo;m not using the &lt;strong&gt;Microsoft Graph Command Line Tools&lt;/strong&gt; app anymore.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-98.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-98_hu_fa8a8a9961191ac3.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-98_hu_c28c6f1e8c1b446b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Partial output of Get-MgContext&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;When I finally try to update a user&amp;rsquo;s usage location with an account that has global admin rights, I still get an error message because of insufficient privileges. This is because the &lt;strong&gt;User.ReadWrite.All&lt;/strong&gt; permission is not part of the &lt;strong&gt;Scopes&lt;/strong&gt; yet. I&amp;rsquo;ll show you how to add that later on.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-27.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-27_hu_7d658d3680f5fd30.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-27_hu_e37d8416fb4eab8c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Insufficient privileges&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;what-if-there-is-no-enterprise-appservice-principal-yet&#34;&gt;What if there is no Enterprise App/Service Principal Yet?
&lt;/h3&gt;&lt;p&gt;When you&amp;rsquo;re automating the registering of an app through a script, there&amp;rsquo;s no reason why you wouldn&amp;rsquo;t also create the service principal through the same PowerShell script but since this is a deep dive, I&amp;rsquo;m going to show you an alternative way anyway.&lt;/p&gt;
&lt;p&gt;If an app registration is only telling Entra ID that an app exists, and no service principal exists for the app registration, will I still be able to sing in and use it?&lt;/p&gt;
&lt;p&gt;The answer to this question is yes and no. Technically, you cannot use only an app registration to sign into the app. However, when you connect to Microsoft Graph and specify the &lt;code&gt;-ClientId&lt;/code&gt; of an app registration that does not have a service principal yet, one is automatically created after you&amp;rsquo;ve granted admin consent.&lt;/p&gt;
&lt;p&gt;Since I&amp;rsquo;ve already added a service principal for &lt;strong&gt;Graph PowerShell Demo (Created with Entra PS)&lt;/strong&gt; with PowerShell, I&amp;rsquo;m going to demo this using the app called &lt;strong&gt;Graph PowerShell Demo (Created with Graph PS)&lt;/strong&gt; which I&amp;rsquo;ve created with &lt;code&gt;New-MgApplication&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This app currently only has an app registration but no enterprise app/service principal.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-25.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-25_hu_ca50d1bd6c25ee20.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-25_hu_cb683a4629c8efbe.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Graph PowerShell Demo (Created with Graph PS)&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I did however add &lt;code&gt;http://localhost&lt;/code&gt; as a redirect URI in the app registration through the portal after I&amp;rsquo;ve created the app with PowerShell.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-28.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-28_hu_68d327a8bf66cb0c.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-28_hu_def9a61d9e1119ce.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Authentication page of the app registration&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Now watch what happens when I sign into the app through &lt;code&gt;Connect-MgGraph&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;First of all, I need to grant consent for this app as well.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-30.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-30_hu_ecd8c5a1b1f2a855.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-30_hu_fb959ef2b554cb81.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Admin consent request&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;After granting the consent I&amp;rsquo;m in.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-29.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-29_hu_82dc275bc51301b6.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-29_hu_40de374f4ef6863b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Partial output of Get-MgContext&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;But how is that possible when there&amp;rsquo;s no service principal for this app registration yet? Well, this also triggered the creation of a new service principal, just like signing into Graph PowerShell using the Microsoft Graph Command Line Tools did.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-31.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-31_hu_a2d7a65f77fa279b.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-31_hu_9c211b345a72ba1b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;The enterprise app/service principal was created after consent was granted.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;And of course, this can also be seen in the audit log.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-35.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-35_hu_efe324c066177228.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-35_hu_859424e52c9cb847.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Audit log actions after signing into the app for the first time&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;quickly-switch-between-an-app-registration-and-its-service-principal&#34;&gt;Quickly Switch Between an App Registration and It&amp;rsquo;s Service Principal
&lt;/h3&gt;&lt;p&gt;When you&amp;rsquo;re managing apps and frequently need to switch between configuring the app registration and it&amp;rsquo;s enterprise app, the quickest way to do so is to open the &lt;strong&gt;API permissions&lt;/strong&gt; menu on the app registration or the &lt;strong&gt;Permissions&lt;/strong&gt; menu on the enterprise app.&lt;/p&gt;
&lt;p&gt;When you&amp;rsquo;re viewing an app registration, there&amp;rsquo;s a link called &lt;strong&gt;Enterprise applications&lt;/strong&gt; at the bottom of the browser window which will take you directly to the enterprise app of this app registration.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-32.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-32_hu_261a2eaf1a1e39a2.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-32_hu_73164bc3fbe3935e.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;API permissions in an app registration&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;To get from an enterprise to its app registration (if it was registered in your tenant) you can click on the &lt;strong&gt;Application registration&lt;/strong&gt; link in the middle of the browser window.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-33.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-33_hu_b15133ba8a7b1cf5.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-33_hu_3620e6a76e2ba28d.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Permissions in enterprise app&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Obviously, this part is missing from an enterprise app for which no app registration exists in your tenant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-34.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-34_hu_a2c39101c81fa360.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-34_hu_9f19262d3c0773d4.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Example: Microsoft Graph Command Line Tools&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;quick-recap&#34;&gt;Quick Recap
&lt;/h2&gt;&lt;p&gt;If you&amp;rsquo;re still with me, I&amp;rsquo;d like to recap and elaborate on a couple of things. App registrations register an app in the Microsoft Entra Eco System. An application (client) ID of an app registration is unique across all Entra ID tenants. That&amp;rsquo;s documented &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/powershell/entra-powershell/manage-apps?view=entra-powershell#register-an-application&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;. Therefore, an app registration can only exist in &lt;strong&gt;one&lt;/strong&gt; tenant.&lt;/p&gt;
&lt;p&gt;An enterprise app is the same thing as a service principal. The Entra Admin center and other UI elements typically use the term enterprise application but Graph PowerShell and audit logs typically use the term service principal for them.&lt;/p&gt;
&lt;p&gt;Enterprise apps can be added and exist in any tenant. If you register a new app in the Entra Admin Center, you&amp;rsquo;ll see both an app registration and an enterprise app for it in your tenant. Because they&amp;rsquo;re directly linked to each other, they always share the same display name and application id.&lt;/p&gt;
&lt;p&gt;If you&amp;rsquo;re adding an enterprise app from a vendor, you won&amp;rsquo;t see an app registration in your tenant because the app was registered as a multi-tenant app in a different tenant.&lt;/p&gt;
&lt;p&gt;When you create an app registration in the portal, a service principal is automatically added as well. When you create a new app registration through PowerShell you have to manually create a service principal for it.&lt;/p&gt;
&lt;p&gt;App registrations are also called &lt;em&gt;just&lt;/em&gt; applications and until a service principal is created for them, they don&amp;rsquo;t really do anything except telling Entra ID that the app exists and specifying what permissions should be requested when an enterprise app for the app registration is added. When signing into your app, the service principal is used.&lt;/p&gt;
&lt;h2 id=&#34;renaming-apps&#34;&gt;Renaming Apps
&lt;/h2&gt;&lt;p&gt;Entra Admin Center will allow you to rename app registrations and enterprise apps. When you rename either one of them, the other one is automatically updated as well.&lt;/p&gt;
&lt;p&gt;I first changed the name of the enterprise app by adding &lt;code&gt; - Enterprise App&lt;/code&gt; to it, hoping this would result in different names to better distinguish between the app registration and the enterprise app. But this is not the case. In the audit log I can now see that both the service principal and the app registration were updated.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-36.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-36_hu_889865e684c75d92.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-36_hu_d0a28be6fd7a5051.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Service principal rename audit log&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-37.png&#34;
	width=&#34;2324&#34;
	height=&#34;1550&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-37_hu_6f097f80794cf86c.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-37_hu_ea167b8db9da76b0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;App registration rename audit log&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;149&#34;
		data-flex-basis=&#34;359px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s the same case the other way around. When you change the name of an app registration, the enterprise app is renamed as well.&lt;/p&gt;
&lt;p&gt;What about renaming a multi-tenant enterprise app? If I&amp;rsquo;m not the owner of the app/if the app hasn&amp;rsquo;t been registered in my tenant, it&amp;rsquo;s not possible to rename an enterprise app. Here&amp;rsquo;s the example of the Microsoft Graph Command Line Tools enterprise app again to demonstrate this.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-38.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-38_hu_24f935ac95f9d9af.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-38_hu_63935db3bda7a281.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;The name is greyed out&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;blockquote&gt;
    &lt;p&gt;​Some of the displayed properties that are not editable are managed on the application registration in the application&amp;rsquo;s home tenant.&lt;/p&gt;&lt;span class=&#34;cite&#34;&gt;&lt;span&gt;― &lt;/span&gt;&lt;span&gt;Entra Admin Center&lt;/span&gt;&lt;cite&gt;&lt;/cite&gt;&lt;/span&gt;&lt;/blockquote&gt;
&lt;p&gt;To show you what happens to enterprise apps in other tenants, when you&amp;rsquo;re the owner of a multi-tenant app and you&amp;rsquo;re renaming the app registration, I must first create one.&lt;/p&gt;
&lt;h2 id=&#34;creating-a-multi-tenant-app&#34;&gt;Creating a Multi-Tenant App
&lt;/h2&gt;&lt;p&gt;As I&amp;rsquo;ve briefly explained before, the reason why you&amp;rsquo;d want to register a multi-tenant app is if you&amp;rsquo;re developing an app which will need to access data from customer tenants through Microsoft Graph. This could also be something much simpler though. For example, it could be a reporting solution which will access and process Teams call records from customer tenants.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s good practice to register multi-tenant apps in dedicated tenants. If you&amp;rsquo;re planning to develop an app which needs a registered Entra application, don&amp;rsquo;t create it in your main tenant you need for your internal day to day operations. Instead, create a dedicated service tenant which is only used to administer the resources needed for the app/service you&amp;rsquo;re developing/providing.&lt;/p&gt;
&lt;p&gt;For this article, I&amp;rsquo;ll call the tenant in which I register the multi-tenant app the &lt;strong&gt;Service Tenant&lt;/strong&gt;. After all, the call records I want to access are in my lab tenant and I want to show you how data in my lab tenant can be accessed from another tenant. So, if I registered the multi-tenant app in my lab tenant, I&amp;rsquo;d need another lab tenant with actual data in it. For this part, I&amp;rsquo;m going to call my lab tenant the &lt;strong&gt;Customer Tenant&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Note: Although the icons are very small, you can see which tenant I&amp;rsquo;m currently in by looking at the Edge profile icon (top left) or the user account icon (top right) in the screenshots.&lt;/p&gt;
&lt;p&gt;This time, I&amp;rsquo;m creating a new app registration for a multi-tenant app and I&amp;rsquo;m doing this in the service tenant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-40.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-40_hu_2a90c588eaf15222.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-40_hu_b9f3055fca9ecb93.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Register a new multi-tenant application&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Because I used the portal to do this, this creates an app registration and an enterprise app in the service tenant.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;ve added a couple of delegated permissions to this app now, but I didn&amp;rsquo;t grant admin consent in the service tenant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-39.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-39_hu_9c966924aa0c7a09.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-39_hu_2a808d44aa3b42e.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Delegated permissions of multi-tenant app registration&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;adding-multi-tenant-app-to-another-tenant&#34;&gt;Adding Multi-Tenant App to Another Tenant
&lt;/h3&gt;&lt;p&gt;To add the multi-tenant app to my customer tenant, I&amp;rsquo;m simply connecting to Microsoft Graph PowerShell using it&amp;rsquo;s app id and the tenant id of the customer tenant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-41.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-41_hu_52a552f9ee79b34c.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-41_hu_c9c7df7107e2e36a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Connect-MgGraph to add multi-tenant app&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Of course, I&amp;rsquo;ll have to grant consent for this as well.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-42.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-42_hu_c07f4cfd494fe628.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-42_hu_8a2aad0a2ed0b785.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Consent request dialog&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;After granting admin consent, the enterprise app has been added to my customer tenant, even though the app registration was created in the service tenant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-43.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-43_hu_824f7396f79a2656.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-43_hu_d8f1652ed6156fe3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Enterprise app of multi-tenant app registration&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;In &lt;strong&gt;Permissions&lt;/strong&gt; I can see that the enterprise app has the same permissions that were configured on the app registration in the service tenant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-44.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-44_hu_3f0dca0048b1883b.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-44_hu_9404b5a8e9aa69a0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Multi-tenant enterprise app permissions&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;renaming-a-multi-tenant-app&#34;&gt;Renaming a Multi-Tenant App
&lt;/h3&gt;&lt;p&gt;Now that I have a multi-tenant app, let&amp;rsquo;s revisit what happens when it&amp;rsquo;s renamed.&lt;/p&gt;
&lt;p&gt;In the service tenant, I&amp;rsquo;ve now renamed the app from &lt;strong&gt;Graph PowerShell (Multi-Tenant)&lt;/strong&gt; to &lt;strong&gt;Graph PowerShell (Multi-Tenant) V2&lt;/strong&gt;. In my customer tenant, the name of the enterprise app/service principal was not updated, however, the name of the app was updated under properties.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-45.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-45_hu_29cb25b9bb5004c4.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-45_hu_fce38b4071d43049.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Updated name in properties&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;When I check the Microsoft Graph context after signing in, I can also see the new app name. The tenant id is the one from my customer tenant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-46.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-46_hu_792005a3f4ce36e8.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-46_hu_cfc76d8c856a4973.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Partial output of Get-MgContext&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;This is a great example to show that the app name and the app id of the enterprise app are in fact linked to the app registration of the service tenant but since the enterprise app is a unique instance with its own object id only present in the customer tenant, the enterprise app&amp;rsquo;s display name was not updated.&lt;/p&gt;
&lt;h2 id=&#34;am-i-using-the-service-principal-or-the-app-registration-to-sign-in&#34;&gt;Am I using the Service Principal or the App registration to Sign In?
&lt;/h2&gt;&lt;p&gt;Wait, didn&amp;rsquo;t I say before that the service principal and not the app registration is used to sign into an app? So why does it show the new name of the app and not the unchanged name of the service principal in Microsoft Graph context?&lt;/p&gt;
&lt;p&gt;This is very confusing indeed. But looking at this from a multi-tenant perspective should help clear things up. In the customer tenant, there is no app registration, only a service principal. How would I be able to sign into the customer tenant using the app registration, if it doesn&amp;rsquo;t exist in the customer tenant? It&amp;rsquo;s just not possible.&lt;/p&gt;
&lt;p&gt;But let&amp;rsquo;s compare the app registration and the enterprise app in the service tenant again. By the way, here you can see that both the app registration and the enterprise app were renamed, just like when I renamed the single tenant app in my customer tenant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-47.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-47_hu_593ae52e9782ac69.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-47_hu_fde595bccf18bbbe.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;App registration&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-48.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-48_hu_5669ba721e059c69.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-48_hu_301e530ac8e7dde0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Enterprise app&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Notice how there is no &lt;strong&gt;Activity&lt;/strong&gt; section on the left navigation pane for the app registration. &lt;strong&gt;Sign-in logs&lt;/strong&gt; are only available for the enterprise app. This is another fact which proves that the service principal is used for signing in.&lt;/p&gt;
&lt;p&gt;Since I&amp;rsquo;ve never signed in to the app in the service tenant, the sign-in logs are empty there.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-49.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-49_hu_8c63fe561363e94b.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-49_hu_dea45fded1d7468f.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Empty sign-in logs in service tenant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;In the customer tenant, the sign-in logs show two sign ins because I signed in again, after I changed the name of the app registration in the service tenant. The name of the enterprise app now says &lt;strong&gt;Graph PowerShell (Multi-Tenant) V2&lt;/strong&gt; because I&amp;rsquo;ve deleted the enterprise app and added it again, to test if it would be added with the new name. Since the log filter is set to &lt;strong&gt;application&lt;/strong&gt; it will show sign in logs from both the old and the new service principal but in this particular example, the name of the application changed to &lt;strong&gt;V2&lt;/strong&gt; without deleting and adding the app again.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-51.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-51_hu_1e9bccadd22969e5.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-51_hu_770f9af13ed7db15.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Sign-in logs in the customer tenant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;As I&amp;rsquo;ve said before, the service principal object is created in the customer tenant, when the multi-tenant app is added. Therefore, the name of the service principal does not update when the app registration is renamed in the service (home) tenant but the name of the app that&amp;rsquo;s linked to this service principal does update in all tenants.&lt;/p&gt;
&lt;p&gt;If the enterprise app is deleted from the customer tenant and added again, the enterprise app/service principal will be created with the new name of the app registration.&lt;/p&gt;
&lt;p&gt;If you pay attention to the sign in logs of the enterprise app/service principal, you can see that that it filters for &lt;strong&gt;Application contains&lt;/strong&gt; and it&amp;rsquo;s using the app id and not the object id of the service principal as value. I couldn&amp;rsquo;t find any reference of the service principal&amp;rsquo;s object id in the sign-in logs. The key is that the service principal is linked to the app registration by its application id. I &lt;em&gt;think&lt;/em&gt; this is how Entra knows which service principal needs to be used.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s turn to Microsoft Graph to see if I can find more information. To get the properties of the service principal, I need to specify the object id of the service principal because the app registration does not exist in the customer tenant.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mgServicePrincipal&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-MgServicePrincipal&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ServicePrincipalId&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;e66c003a-c7e0-46c0-906a-4e30e0d85ab4&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mgServicePrincipal&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Format-List&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;princ&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;audience&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-50.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-50_hu_f24c758f762b1827.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-50_hu_6d2a3d9fca9598c1.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Partial output of Get-MgServicePrincipal&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;There are a couple of things to unwrap here. First of all, the &lt;strong&gt;AppOwnerOrganizationId&lt;/strong&gt; includes the tenant id of the service tenant (tenant in which the application was registered). The &lt;strong&gt;Id&lt;/strong&gt; of the service principal is what&amp;rsquo;s listed in Entra Admin Center as &lt;strong&gt;Object Id&lt;/strong&gt;. I should probably mention again that I deleted the enterprise app and added it again, that&amp;rsquo;s why both names are the same now.&lt;/p&gt;
&lt;p&gt;Both the &lt;strong&gt;AppId&lt;/strong&gt; and the &lt;strong&gt;ServicePrincipalNames&lt;/strong&gt; are set to the app id of the app registration in the service tenant. The portal doesn&amp;rsquo;t show you this, but I &lt;em&gt;think&lt;/em&gt; that&amp;rsquo;s why you only see the app id but never the object id of the service principal.&lt;/p&gt;
&lt;p&gt;I wouldn&amp;rsquo;t be me if I didn&amp;rsquo;t rename the app registration in the service tenant to &lt;strong&gt;Graph PowerShell (Multi-Tenant) V3&lt;/strong&gt; again after discovering this.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-52.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-52_hu_28f4809ec777a0ee.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-52_hu_d47ce6b5ca690.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;AppDisplayName and DisplayName are now different&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;This tells us that the &lt;strong&gt;AppDisplayName&lt;/strong&gt; is the display name of the app registration which comes from the service (home) tenant. The &lt;strong&gt;DisplayName&lt;/strong&gt; is the name of the enterprise app/service principal display name specific to the customer tenant.&lt;/p&gt;
&lt;p&gt;In conclusion, you&amp;rsquo;re using the application to sign in, but you&amp;rsquo;ll need a service principal for the app to do so.&lt;/p&gt;
&lt;h2 id=&#34;control-who-can-sign-into-your-app&#34;&gt;Control Who Can Sign Into Your App
&lt;/h2&gt;&lt;p&gt;Further proof that enterprise apps/service principals are used when signing in is that you define who can use/access your app on the enterprise app configuration page and not on the app registration. If you want to limit who can sign into your app, you need to enable &lt;strong&gt;Assignment required?&lt;/strong&gt; and set this to &lt;strong&gt;Yes&lt;/strong&gt; on the enterprise app&amp;rsquo;s &lt;strong&gt;Properties&lt;/strong&gt;. In the screenshot below, I&amp;rsquo;m modifying the properties of the multi-tenant enterprise app which I&amp;rsquo;ve previously added to my customer tenant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-54.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-54_hu_a8f562b04dfa30cc.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-54_hu_85e7fc7395ada832.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Set assignment required to yes&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Under &lt;strong&gt;Users and groups&lt;/strong&gt; I can now define which users and/or groups are allowed to sign into the app.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-53.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-53_hu_f6b395e4790d5acc.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-53_hu_893a4327184b59d1.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Users and groups configuration of enterprise app&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;When I try to sign in with a user which isn&amp;rsquo;t allowed under &lt;strong&gt;Users and groups&lt;/strong&gt; I get an error message.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-55.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-55_hu_fb852084957fbeb3.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-55_hu_4d85cc8e465eb6c0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Error message when user doesn’t have the enterprise app assigned&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If assignment required? is enabled, not even global admins can sign in, if they&amp;rsquo;re not explicitly allowed.&lt;/p&gt;
&lt;h2 id=&#34;permissions-on-applications&#34;&gt;Permissions on Applications
&lt;/h2&gt;&lt;p&gt;As you may have noticed, there are permissions in both app registrations and enterprise apps. But what do they do?&lt;/p&gt;
&lt;h3 id=&#34;delegated-vs-application-permissions&#34;&gt;Delegated vs Application Permissions
&lt;/h3&gt;&lt;p&gt;First, you need to understand the difference between delegated and application permissions. Delegated permissions require a signed in user and requests are made as the signed in user but the app which is used to connect to Graph has to have the appropriate delegated permissions.&lt;/p&gt;
&lt;p&gt;For example, if you want to change the usage location of an Entra ID user via Graph PowerShell, your account needs to have the &lt;strong&gt;User Administrator&lt;/strong&gt; role assigned and the app which you are using to connect to Graph needs to have the delegated permission &lt;strong&gt;User.Write.All&lt;/strong&gt; configured and consented.&lt;/p&gt;
&lt;p&gt;Just because your account can perform an action in the Entra Admin Center, it doesn&amp;rsquo;t mean that you&amp;rsquo;ll also be able to perform the same action in Graph PowerShell unless the delegated permission has been specifically configured on the app that you&amp;rsquo;re using to connect to Graph. Configuring something in the portal doesn&amp;rsquo;t require explicit permissions in addition to having an Entra Admin role assigned. But doing the same action through the Graph API requires an explicit permission on the app you want to use.&lt;/p&gt;
&lt;p&gt;You should always follow the &lt;strong&gt;least&lt;/strong&gt; &lt;strong&gt;privilege&lt;/strong&gt; principle and only configure the permission that are actually needed. This &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/graph/permissions-reference&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;link&lt;/a&gt; is a good reference to learn what each permission does. I also highly recommend checking all your existing applications which can access Graph via PowerShell and make sure that only admin users are allowed to sign into the apps.&lt;/p&gt;
&lt;p&gt;Application permissions mean that an app will be able to perform actions without a signed in user. In this case, the action is performed as the app itself. You&amp;rsquo;ll need either a client secret or a certificate for that.&lt;/p&gt;
&lt;h2 id=&#34;add-permissions-to-applications&#34;&gt;Add Permissions to Applications
&lt;/h2&gt;&lt;p&gt;Let&amp;rsquo;s look at different examples/scenarios.&lt;/p&gt;
&lt;h3 id=&#34;you-own-the-app-registration&#34;&gt;You own the App Registration
&lt;/h3&gt;&lt;p&gt;In this example, I&amp;rsquo;m using the &lt;strong&gt;Graph PowerShell Demo (Created in Portal)&lt;/strong&gt; app which was created in the customer tenant again. When the app registration is created through the portal, the delegated permission &lt;strong&gt;User.Read&lt;/strong&gt; is added as a &lt;strong&gt;configured&lt;/strong&gt; permission by default. Admin consent has not been granted yet and I&amp;rsquo;ve never signed into this app before. Thus, the permissions of the enterprise app are empty.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-56.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-56_hu_a43f4a693c647559.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-56_hu_3439b3849a9b8f81.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Configured permissions of app registration&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-57.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-57_hu_740d4126d8a1b982.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-57_hu_178e51d088955217.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Permissions of enterprise app&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;When I click &lt;strong&gt;Grant admin consent&lt;/strong&gt; on the enterprise app, a new browser window opens and asks me to consent to the permissions which are configured in the app registration. Signing into this app through Graph PowerShell for the first time would have the same effect.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-58.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-58_hu_7ee771578e0b00e5.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-58_hu_11d0ea7a7b7333ad.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Admin consent request&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Let me add a new configured permission on the app registration.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-59.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-59_hu_b0fd00e22ffb5d2b.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-59_hu_d7ec25a1d79496a3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;User.Read.All added to configured permissions of app registration&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I have not yet consented &lt;strong&gt;User.Read.All&lt;/strong&gt;, that&amp;rsquo;s why it&amp;rsquo;s showing as &lt;strong&gt;Not granted&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;When I sign into Graph PowerShell using the app id of this app, the scope is not added to the session.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-60.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-60_hu_5a5267369e8e7ec2.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-60_hu_1d94417ae47e224.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;User.Read.All scope is missing&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I can grant admin consent for the added permission on the app registration from the portal.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-61.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-61_hu_5c8ffa19a1b31018.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-61_hu_c9a7b4d0f4571f1a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Grant admin consent on app registration&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;When I connect to Graph again and check the context again, I can now see the &lt;strong&gt;User.Read.All&lt;/strong&gt; scope.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-62.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-62_hu_b4c8cc061dd0341b.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-62_hu_f20d5b718cb96c9a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Available scopes/permissions&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The configured permissions of an app registration tell the enterprise app what permissions should be requested during the consent process.&lt;/p&gt;
&lt;blockquote&gt;
    &lt;p&gt;Applications are authorized to call APIs when they are granted permissions by users/admins as part of the consent process. The list of configured permissions should include all the permissions the application needs.&lt;/p&gt;&lt;span class=&#34;cite&#34;&gt;&lt;span&gt;― &lt;/span&gt;&lt;span&gt;Entra Admin Center&lt;/span&gt;&lt;cite&gt;&lt;/cite&gt;&lt;/span&gt;&lt;/blockquote&gt;
&lt;p&gt;When I check the permissions of the enterprise app, I can see that the &lt;strong&gt;User.Read.All&lt;/strong&gt; permission was also added to the enterprise app.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-63.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-63_hu_5f808091225125d5.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-63_hu_62b54b3ed17240ed.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Added permission on enterprise app&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;add-a-permission-without-adding-it-configured-permissions-first&#34;&gt;Add a permission without adding it configured permissions first
&lt;/h4&gt;&lt;p&gt;Although this isn&amp;rsquo;t following best practice, it&amp;rsquo;s also possible to add new permissions to the enterprise app without adding them to the app registration&amp;rsquo;s configured permissions first. To do so, I&amp;rsquo;m simply adding the scopes I want when I&amp;rsquo;m connecting to Graph PowerShell.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Connect-MgGraph&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-NoWelcome&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-TenantId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$tenantId&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ClientId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$appId&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Scopes&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Group.Read.All&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Guess what happens now? Yep, I&amp;rsquo;m prompted to consent again.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-64.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-64_hu_5cc9a2f57533d25b.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-64_hu_f319f20f87fb86a3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;New consent request dialog&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;When I check the permissions of the enterprise app, I can see that the &lt;strong&gt;Group.Read.All&lt;/strong&gt; permission was added to it.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-65.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-65_hu_cc90cb38e541b92b.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-65_hu_35d308fe4889a75a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Enterprise app permissions&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;However, when I go back to the app registration, the freshly consented permission shows up under &lt;strong&gt;Other permissions granted&lt;/strong&gt; and not under &lt;strong&gt;Configured permissions&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-66.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-66_hu_ff95f616ff886e2e.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-66_hu_d4eb8854c3d51f10.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;App registration permissions&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Entra Admin Center says the following about this:&lt;/p&gt;
&lt;blockquote&gt;
    &lt;p&gt;These permissions have been granted for NoCapTech but aren&amp;rsquo;t in the configured permissions list. If your application requires these permissions, you should consider adding them to the configured permissions list.&lt;/p&gt;&lt;span class=&#34;cite&#34;&gt;&lt;span&gt;― &lt;/span&gt;&lt;span&gt;Entra Admin Center&lt;/span&gt;&lt;cite&gt;&lt;/cite&gt;&lt;/span&gt;&lt;/blockquote&gt;
&lt;p&gt;If a permission is required for your app, you can use the three dots to add other permissions to the app&amp;rsquo;s configured permissions.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-99.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-99_hu_650dd29f15fa4f68.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-99_hu_42814f299ecb514a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Add other permissions to configured permissions of app registration&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;remove-permissions&#34;&gt;Remove Permissions
&lt;/h3&gt;&lt;p&gt;Let&amp;rsquo;s not forget that we&amp;rsquo;re still on a mission to change a user&amp;rsquo;s usage location using PowerShell. The &lt;strong&gt;Users.Read.All&lt;/strong&gt; permission won&amp;rsquo;t help us here because it doesn&amp;rsquo;t include &lt;strong&gt;write&lt;/strong&gt; permission. Let&amp;rsquo;s remove that one and add &lt;strong&gt;Users.Write.All&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;I can either remove a permission or only revoke its admin consent. In this case I want to remove it entirely, so I must first remove it and then revoke the admin consent.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-100.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-100_hu_fd1c44287fb94cf2.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-100_hu_eaac84311b700301.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Remove permission from app registration&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-101.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-101_hu_90173876dfe440ad.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-101_hu_652de3aada54597b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Revoke admin consent for permission&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Now I&amp;rsquo;m going to add the &lt;strong&gt;Users.ReadWrite.All&lt;/strong&gt; permission and grant admin consent for it.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-102.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-102_hu_def984ec1abd2f3d.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-102_hu_55b7bc7c7602f6ac.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Add permission&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-103.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-103_hu_251cb4c768598e95.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-103_hu_78546bb6a60a02f5.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Grant admin consent&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Because I&amp;rsquo;ve added this permission to the configured permissions, the next time I&amp;rsquo;m signing into Graph PowerShell using this app id, the permission will be available by default.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-104.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-104_hu_12ca02eb2c4a365e.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-104_hu_848fe65ccd2e7fb6.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Partial output of Get-MgContext&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;This means that I&amp;rsquo;m now finally able to update a user&amp;rsquo;s usage location using PowerShell.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-105.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-105_hu_6833fdbb91afcb83.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-105_hu_f4f0e8537ddf677a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;No more error messages!&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;In case you were wondering, this doesn&amp;rsquo;t work if the signed in user doesn&amp;rsquo;t have the &lt;strong&gt;User Administrator&lt;/strong&gt; (or higher permissions) assigned to them. Just because a delegated permission like &lt;strong&gt;User.Write.All&lt;/strong&gt; has been configured and consented on an Entra application, it doesn&amp;rsquo;t mean that any user which is allowed to sign into Graph PowerShell will be able to perform write actions on users.&lt;/p&gt;
&lt;p&gt;Because I didn&amp;rsquo;t set &lt;strong&gt;Assignment required?&lt;/strong&gt; to &lt;strong&gt;Yes&lt;/strong&gt;, any user (including non-admin users) in the customer tenant can now sign into Graph PowerShell but they can&amp;rsquo;t use all the consented scopes/permissions.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-124.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-124_hu_8f8930fa591021c5.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-124_hu_745bfb4800b1fafa.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Error message when the signed in user doesn’t have admin permissions&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;you-do-not-own-the-app-registration&#34;&gt;You do not own the App registration
&lt;/h3&gt;&lt;p&gt;In this example, I&amp;rsquo;m using the &lt;strong&gt;Graph PowerShell (Multi-Tenant)&lt;/strong&gt; from the service tenant. Note: I&amp;rsquo;ve re-created this app in the service tenant and named it &lt;strong&gt;V4&lt;/strong&gt; so Ids in screenshots are now different.&lt;/p&gt;
&lt;p&gt;Here are the configured permissions of the service tenant&amp;rsquo;s app registration and the customer tenant&amp;rsquo;s enterprise app in comparison. I&amp;rsquo;m not sure why &lt;strong&gt;email&lt;/strong&gt; hasn&amp;rsquo;t been added to enterprise app. It might be because it&amp;rsquo;s already part of one of the other permissions.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-67.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-67_hu_b01f1dea9ad0bcb3.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-67_hu_76b3fcdbe5094853.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;App registration permissions in service tenant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-68.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-68_hu_4a45b084a71cbf9f.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-68_hu_77475a7028e2fe85.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Enterprise app permissions in customer tenant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Interestingly enough, &lt;strong&gt;email&lt;/strong&gt; appears in the Graph context.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-69.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-69_hu_5de02b571f68fd5.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-69_hu_136115ed6adc8dd.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Output of Graph context&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Because the app registration in the service tenant has configured permissions, they&amp;rsquo;re automatically requested during the consent process when the app is added as an enterprise app to the customer tenant.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s start playing around by adding a new delegated permission to the enterprise app in the customer tenant. For this, I&amp;rsquo;m signing into Graph again by specifying the customer tenant id and the app id of the multi-tenant app that is registered in the service tenant and I&amp;rsquo;m adding &lt;code&gt;-Scopes &amp;quot;User.Read.All&amp;quot;&lt;/code&gt; to &lt;code&gt;Connect-MgGraph&lt;/code&gt;. Because this is a new permission, I have to grant consent for it.&lt;/p&gt;
&lt;p&gt;As expected, the &lt;strong&gt;User.Read.All&lt;/strong&gt; permission is now listed on the enterprise app in the customer tenant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-70.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-70_hu_6700d66ae453c256.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-70_hu_724cd26fd372a28.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Enterprise app permissions&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;This permission has not been added to &lt;strong&gt;Other permissions granted&lt;/strong&gt; in the app registration of the service tenant like it was the case when both the app registration and the enterprise app were available in the same tenant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-71.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-71_hu_42959b0f1324e5ba.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-71_hu_2098b25c50f99762.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Permissions on app registration in service tenant remain unchanged&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;This actually makes a lot of sense. Imagine how many permissions would be here if this was the Microsoft Graph Command Line Tools in Microsoft&amp;rsquo;s service tenant.&lt;/p&gt;
&lt;h3 id=&#34;quick-recap-1&#34;&gt;Quick Recap
&lt;/h3&gt;&lt;p&gt;This means that the owner/publisher of the app registration defines what permissions are needed for their app by adding the required permissions as configured permissions. Whatever permissions are configured on the app registration will be the permissions for which the enterprise app will request consent for. Basically, the configured permissions are the minimal permissions required but if you want, you can still add more permissions to your enterprise app because that is specific to your tenant.&lt;/p&gt;
&lt;p&gt;Another interesting discovery is that the service tenant doesn&amp;rsquo;t actually need to have admin consent granted for the permissions on the app registration or on the enterprise app. When the enterprise app is added to the customer tenant, the consent is granted for this tenant only.&lt;/p&gt;
&lt;p&gt;Admin consent in the service tenant would only be required if the publisher of the app needed to access information in their own service tenant through their own app.&lt;/p&gt;
&lt;p&gt;When I was researching this topic, I briefly panicked and thought that all permissions which are added to the enterprise app/service principal would automatically allow the owner of the app to use these permissions. That would be especially problematic for application permissions. But as I&amp;rsquo;ve just proven, that&amp;rsquo;s not the case. The owner of the app can only use what they&amp;rsquo;ve added under &lt;strong&gt;configured permissions&lt;/strong&gt;. They won&amp;rsquo;t even see what other delegated permissions you&amp;rsquo;ve added to your own enterprise app.&lt;/p&gt;
&lt;h4 id=&#34;delegated-permissions&#34;&gt;Delegated Permissions
&lt;/h4&gt;&lt;p&gt;With delegated permissions, a signed-in user is required. Now what does that mean exactly? When we&amp;rsquo;re talking about using Microsoft Graph PowerShell, this is pretty clear. When you run &lt;code&gt;Connect-MgGraph&lt;/code&gt; you&amp;rsquo;re prompted to sign using your username, password and hopefully MFA.&lt;/p&gt;
&lt;p&gt;After signing in, the PowerShell session will have an access token which includes information about your user account and the app id that you used to sign in.&lt;/p&gt;
&lt;p&gt;This is great for managing Entra ID users and Microsoft 365 services with PowerShell on the fly, like changing the usage location of a user. What delegated permissions are not great for is trying to use them in PowerShell scripts which should run autonomously. If a script is running on some server or in an Azure automation account, there&amp;rsquo;s no way that you&amp;rsquo;ll securely get a token for another user. In that case, you&amp;rsquo;ll want to use application permissions.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s examine another example of delegated permissions using Zoom as a &lt;em&gt;real&lt;/em&gt; app example again. The difference between Zoom and a PowerShell script is that you&amp;rsquo;re signed into Zoom using Entra SSO, so Zoom knows your Entra identity, and it also knows that the signed in user is allowed to read/write the calendar. Unlike a PowerShell script, the Zoom app is something that is continuously running on a user&amp;rsquo;s machine, and there&amp;rsquo;s a server piece to it.&lt;/p&gt;
&lt;p&gt;When you&amp;rsquo;re launching the app, you&amp;rsquo;re authenticating yourself to Zoom and that&amp;rsquo;s when Zoom acquires the token which allows it to read/write your calendar. Therefore, Zoom can&amp;rsquo;t access your calendar when the app is not running or when you&amp;rsquo;re not signed in.&lt;/p&gt;
&lt;h5 id=&#34;microsoft-authentication-library-msal&#34;&gt;Microsoft Authentication Library (MSAL)
&lt;/h5&gt;&lt;p&gt;Then there&amp;rsquo;s the &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/entra/identity-platform/msal-overview&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MSAL&lt;/a&gt; which is available as a PowerShell module (MSAL.PS). In theory, it could be used in a script but if you&amp;rsquo;re not a developer (like I&amp;rsquo;m not) then this will be a whole new rabbit hole to go down. Anyway, even if you were using the MSAL authentication library in a PowerShell script, it would still require the user&amp;rsquo;s credentials which must be passed in an interactive log in flow in order to acquire a token which could then be used inside the script.&lt;/p&gt;
&lt;p&gt;In other words, delegated permissions which typically end in &lt;code&gt;*Read|Write.All&lt;/code&gt; are most commonly used by IT admins when they sign into Microsoft Graph PowerShell interactively by providing their admin credentials. Delegated permissions which do not end in &lt;code&gt;*.All&lt;/code&gt; usually allow an app to only read/write information of the signed in user. They&amp;rsquo;re commonly used by apps like Zoom to access relevant data like a user&amp;rsquo;s calendar.&lt;/p&gt;
&lt;h4 id=&#34;application-permissions&#34;&gt;Application Permissions
&lt;/h4&gt;&lt;p&gt;Application permissions are used if an app or a script needs access to Entra ID resources without a signed in user. Let&amp;rsquo;s just say you have a script which runs daily and checks if all the usage location is matching the country property for all Entra ID users. If that script were to use delegated permissions, somebody would need to manually run it every day because the script would prompt for admin credentials in a browser pop-up every time. Such a script will need to utilize application permissions to run in a truly automated way.&lt;/p&gt;
&lt;p&gt;To be able to use application permissions, you need a client secret or a certificate and these can only be created on the app registration. That means that if a multi-tenant app were to require application permissions, they would need to be part of the app registration&amp;rsquo;s configured permissions and you would be prompted to grant consent when you&amp;rsquo;re adding the enterprise app.&lt;/p&gt;
&lt;p&gt;If you own the app registration yourself, you can add new application permissions to the app registration yourself, but you can&amp;rsquo;t add them directly to the enterprise app, like you can with delegated permissions.&lt;/p&gt;
&lt;h2 id=&#34;application-permissions--app-only-authentication&#34;&gt;Application Permissions / App Only Authentication
&lt;/h2&gt;&lt;h3 id=&#34;accessing-graph-as-application-from-the-service-tenant&#34;&gt;Accessing Graph as application from the Service Tenant
&lt;/h3&gt;&lt;p&gt;I&amp;rsquo;m still using &lt;strong&gt;Graph PowerShell (Multi-Tenant) V4&lt;/strong&gt; as an example. This time, I&amp;rsquo;m going to add a new application permission to the app registration in the service tenant. For this example, I&amp;rsquo;m going to add &lt;strong&gt;CallRecords.Read.All&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-72.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-72_hu_26b44d6c7718dd24.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-72_hu_726b7c5872ea3d63.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Add application permissions&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CallRecords.Read.All&lt;/strong&gt; is now added as &lt;strong&gt;application&lt;/strong&gt; permission in &lt;strong&gt;configured permissions&lt;/strong&gt;. Note that admin consent hasn&amp;rsquo;t been granted for the service tenant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-73.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-73_hu_8f8a3b7a68a2d6c.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-73_hu_3bc2c09749d3e10f.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Configured permissions of app registration in service tenant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Because this is an application permission, I can&amp;rsquo;t simply run &lt;code&gt;Connect-MgGraph&lt;/code&gt; and add &lt;code&gt;-Scopes &amp;quot;CallRecords.Read.All&lt;/code&gt;. &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/graph/permissions-reference#callrecordsreadall&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;This permission&lt;/a&gt; doesn&amp;rsquo;t even exist as a delegated permission.&lt;/p&gt;
&lt;p&gt;Additionally, adding &lt;code&gt;-Scopes&lt;/code&gt; is not supported when &lt;code&gt;-ClientSecretCredential&lt;/code&gt; is also specified.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-107.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-107_hu_ef6460e5a0eba62.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-107_hu_213b3147102182ec.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Invalid parameter combination error&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;To add the application permission, I need to get a hold of the admin consent link. Normally, when you add an enterprise app, you don&amp;rsquo;t need to manually copy and paste a link. This process is usually neatly integrated into the UI of apps that request permission to access your data through Microsoft Graph.&lt;/p&gt;
&lt;p&gt;As an example, this is the web page that lets me connect Zoom to my Microsoft 365 calendar. As you can see, there is a nice little &lt;strong&gt;Authorize&lt;/strong&gt; button directly embedded in the Zoom admin portal.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-74.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-74_hu_e03aeaf58d87205f.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-74_hu_efa921ae79e60549.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Zoom authorization UI/UX example&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;When I click &lt;strong&gt;Authorize&lt;/strong&gt; the admin consent dialog is opened in the browser.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-75.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-75_hu_8ff1e7786020d778.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-75_hu_58b3652e24fed9cf.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Zoom admin consent example&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Granting the consent will add the enterprise app. While I&amp;rsquo;m at it, let&amp;rsquo;s check out the permissions which were added for Zoom.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-76.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-76_hu_5792c9ff59d02eaa.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-76_hu_68f5713a45bb1856.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Zoom enterprise app permissions&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Since these are all delegated permissions, it means that the Zoom app can only access my calendar and contacts when I&amp;rsquo;m signed into the Zoom app. But the consent flow is the same for both application and delegated permissions.&lt;/p&gt;
&lt;h4 id=&#34;get-admin-consent-url&#34;&gt;Get Admin Consent URL
&lt;/h4&gt;&lt;p&gt;With the above example, I just wanted to show you what adding an enterprise app usually looks like. I&amp;rsquo;m not sure if there&amp;rsquo;s a better way to obtain the consent link to implement it in your own app but for now, what I&amp;rsquo;m showing you will have to do.&lt;/p&gt;
&lt;p&gt;From the enterprise app in the service tenant, I can click &lt;strong&gt;Grant admin consent&lt;/strong&gt; which will open a new browser window. This only works from the enterprise app. If you clicked grant admin consent on the app registration, the grant consent button will open on the same page, and you won&amp;rsquo;t be able to copy the URL.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-77.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-77_hu_9c09585a62def349.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-77_hu_7f529ea8663c01e9.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Grant admin consent button&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-108.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-108_hu_38e9b0775f2eee19.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-108_hu_4a02a988d453217e.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;New browser window with admin consent URL&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The new browser window will allow me to copy the URL which will look something like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;https://login.microsoftonline.com/536f948a-babb-4048-836d-717833aa0da5/adminConsent?client_id=c199b3df-a49b-4739-b314-c2ee50e6c0bc&amp;amp;redirect_uri=https://entra.microsoft.com/TokenAuthorize
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;The first GUID after &lt;strong&gt;login.microsoftonline.com&lt;/strong&gt; is the tenant id of the service tenant. Now I can either replace it with a specific tenant id or just replace it with &lt;code&gt;common&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;https://login.microsoftonline.com/common/adminConsent?client_id=c199b3df-a49b-4739-b314-c2ee50e6c0bc&amp;amp;redirect_uri=https://entra.microsoft.com/TokenAuthorize
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;When I open this link and sign in with the global admin of the customer tenant, I can see the name of the app and that it&amp;rsquo;s requesting the &lt;strong&gt;Read all call records&lt;/strong&gt; permission.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-109.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-109_hu_9d3d319f2a8bad9.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-109_hu_a6dcb2c51caf540a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Admin consent request for Read all call records&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Unfortunately, application permissions are not labeled explicitly as such which makes it hard to understand what permissions are really requested unless the vendor of the enterprise app includes this info in their documentation. An easy way to figure it out is to search for the permission title or the description in the &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/graph/permissions-reference#callrecordsreadall&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;permission reference&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Back in Entra Admin Center, I can now see that the &lt;strong&gt;CallRecords.Read.All&lt;/strong&gt; permission has been added to my enterprise app.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-78.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-78_hu_4191d42244df55a6.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-78_hu_853f07bc488bea75.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Enterprise app permissions before granting consent&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-79.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-79_hu_fb0ed3dedb631de4.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-79_hu_bf7bb37654771b1c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Enterprise app permissions after granting permissions&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Just to emphasize on this again, I did not grant admin consent to the configured permissions on the app registration in the service tenant. Remember that consent is always tenant specific.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-80.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-80_hu_46c77f31596e5a2c.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-80_hu_fb1eeb4bfcb475f3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;App registration permissions in service tenant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;create-a-secret&#34;&gt;Create a Secret
&lt;/h3&gt;&lt;p&gt;An application can access Graph without a signed in user either through a certificate or a client secret. I&amp;rsquo;m only going to focus on client secrets today.&lt;/p&gt;
&lt;p&gt;On the app registration in the service tenant, I&amp;rsquo;m creating a new client secret.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-81.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-81_hu_80e1778cb6d50704.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-81_hu_8a991ed9c0f7392c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Add a client secret&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Important: the secret is only shown once. As soon as you navigate away from this page, you won&amp;rsquo;t be able to access it again. When you do this, you&amp;rsquo;ll see your client secret. It&amp;rsquo;s only showing a bunch of asterisks for me because I&amp;rsquo;m using the &lt;a class=&#34;link&#34; href=&#34;https://github.com/microsoft/cloudcloak&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Cloud Cloak&lt;/a&gt; extension for Microsoft Edge.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-83.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-83_hu_34076d0105e6dda5.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-83_hu_818454b745a80e8b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Added client secret&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Using the code below, I (or rather the service tenant) can now sign into the customer tenant using the enterprise app/service principal of the customer tenant and the client secret from the service tenant.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s important to understand that I now gave another tenant permission to read all call records in my (customer) tenant without a signed in user of my (customer) tenant.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$tenantId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;4bffbf87-53a0-4fce-b58b-4179cb3a3b7d&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$appId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;c199b3df-a49b-4739-b314-c2ee50e6c0bc&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$appSecret&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Read-Host&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-AsSecureString&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;****************************************&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$clientSecretCredential&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Management&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Automation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PSCredential&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$appId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$appSecret&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Connect-MgGraph&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ClientSecretCredential&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$clientSecretCredential&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-TenantId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$tenantId&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-NoWelcome&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-82.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-82_hu_34670cc3595451de.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-82_hu_b82f8279b60d9dd2.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Connecting to Graph PowerShell with app only authentication&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s check the Graph context.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-84.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-84_hu_bacbabb7ee1a0d5d.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-84_hu_7ba4db2b2ab44ec4.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Output of Mg-Context&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The only scope that&amp;rsquo;s currently available is &lt;strong&gt;CallRecords.Read.All&lt;/strong&gt; because that&amp;rsquo;s the only application permission. All the other ones are delegated permissions so they&amp;rsquo;re not available in this session. AuthType is now &lt;strong&gt;AppOnly&lt;/strong&gt; and we&amp;rsquo;re still using the &lt;strong&gt;Graph PowerShell (Multi-Tenant) V4&lt;/strong&gt; app with the client secret from the service tenant.&lt;/p&gt;
&lt;p&gt;Finally, let&amp;rsquo;s see if I can use the app to retrieve a call record from the customer tenant with app only authentication as the service tenant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-85.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-85_hu_cf2f40e9f4f339ac.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-85_hu_c025040d7c178572.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Getting a call record with app only permission as the service tenant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Yep, it&amp;rsquo;s working. It took quite a while for the sign-in logs to appear, but I can now see a logged sign in for the service principal in the customer tenant. In the details, I can see the name of the application and the service principal. I can also see the &lt;strong&gt;Application ID&lt;/strong&gt; which is the app id of the app registration in the service tenant and of course, also the app id of the enterprise app/service principal in the customer tenant. The &lt;strong&gt;Client credential type&lt;/strong&gt; is now &lt;strong&gt;Client secret&lt;/strong&gt;. And finally, the &lt;strong&gt;Service principal ID&lt;/strong&gt; is the &lt;strong&gt;Object Id&lt;/strong&gt; of the enterprise app/service principal in the customer tenant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-86.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-86_hu_143d4ee9e573057a.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-86_hu_cfb61eef857605b6.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Service principal sign in logs in customer tenant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-87.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-87_hu_56b048d64874e1de.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-87_hu_4c5d7c7466767480.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Sign in details&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Out of curiosity, I checked the sign in logs in the service tenant as well. I want to point out that the enterprise app in the service tenant is still untouched and does not have any consented permissions. Nevertheless, the sign-in logs of the service tenant still log the sign-in activity, even when the sign in happened in the customer tenant. It also lists the &lt;strong&gt;Service principal ID&lt;/strong&gt; of the customer tenant even though that object id doesn&amp;rsquo;t exist in the service tenant. There is no reference of the customer tenant id, though.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-88.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-88_hu_cd2fda8d4c6a0827.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-88_hu_358babf75a7d3fe4.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Enterprise app permissions in service tenant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-89.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-89_hu_3937f686c2cf9ab5.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-89_hu_9839f0a2816271f1.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Sign-in log details from service tenant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;When application permissions are used in multi-tenant apps, only the owner/publisher of the app registration will be able to use the application permissions, because you don&amp;rsquo;t have access to the secret and you can&amp;rsquo;t create one for yourself either because you don&amp;rsquo;t have access to the app registration.&lt;/p&gt;
&lt;h3 id=&#34;accessing-graph-as-app-from-your-own-tenant&#34;&gt;Accessing Graph as App from your Own Tenant
&lt;/h3&gt;&lt;p&gt;If you want to use Graph PowerShell with application permission (without a signed in user) in your own tenant, the process is exactly the same as I&amp;rsquo;ve just shown you for a multi-tenant scenario.&lt;/p&gt;
&lt;p&gt;You just need to create your own app registration, assign the required permissions and create a client secret or a certificate for the app. In that case, you&amp;rsquo;ll obviously have to grant admin consent because you want to access Graph as an app in your own tenant.&lt;/p&gt;
&lt;h3 id=&#34;accessing-graph-as-app-using-your-own-app-registration-from-a-3rd-party-app&#34;&gt;Accessing Graph as App using your own App Registration from a 3rd Party App
&lt;/h3&gt;&lt;p&gt;What I described in &lt;a class=&#34;link&#34; href=&#34;#accessing-graph-as-application-from-the-service-tenant&#34; &gt;Accessing Graph as application from the Service Tenant&lt;/a&gt; would allow the service tenant to read call records of all tenants that have consented to their app. Another scenario you might encounter is that a vendor of a software/service asks you to create your own app registration but share/configure your secret in their service.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;ll use Bitwarden, which is my favorite password manager, as an example for this. Bitwarden allows an organization to sync their Entra ID users to Bitwarden so that you can then specify which of your Entra users will be able to use Bitwarden from their admin portal.&lt;/p&gt;
&lt;p&gt;This is a perfect example of why an app would need &lt;strong&gt;Users.Read.All&lt;/strong&gt; and &lt;strong&gt;Groups.Read.All&lt;/strong&gt; application permissions.&lt;/p&gt;
&lt;p&gt;Bitwarden doesn&amp;rsquo;t actually provide their own enterprise app which can be added to your tenant. Instead, their documentation states that you as the customer have to create your own app registration and which delegated and application permissions you need to add to it.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-106.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-106_hu_998d5b39fd55356d.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-106_hu_c0041cfe3618c18b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Required delegated and app permissions for Bitwarden Directory Connector&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Further down the line, their documentation explains that you need to create a client secret. Once you have everything, namely the tenant id, the app id and the client secret, you need to add them to their &lt;strong&gt;Directory Connector&lt;/strong&gt; app.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-110.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-110_hu_2deb8254c23266dc.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-110_hu_af249a0cf305b053.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Bitwarden documentation on how to connect Directory Connector to your Entra app&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I don&amp;rsquo;t know all the details about this Bitwarden Directory Connector but to put it simply, adding your tenant id, app id and client secret to it, will allow the Directory Connector to read all your Entra users and sync them to the Bitwarden admin portal.&lt;/p&gt;
&lt;p&gt;By doing it like this, Bitwarden delegates the management of the app registration to the customer and they&amp;rsquo;re also making sure that the data in your tenant can only be accessed by your app secret/your own instance of Directory Connector.&lt;/p&gt;
&lt;h2 id=&#34;deleting-apps&#34;&gt;Deleting Apps
&lt;/h2&gt;&lt;p&gt;Lastly, after all this testing, it&amp;rsquo;s time to clean up my lab. Let&amp;rsquo;s see what happens when enterprise apps and app registrations are deleted.&lt;/p&gt;
&lt;h3 id=&#34;deleting-an-enterprise-app&#34;&gt;Deleting an Enterprise App
&lt;/h3&gt;&lt;h4 id=&#34;you-do-not-own-the-app-registration-1&#34;&gt;You Do Not Own the App Registration
&lt;/h4&gt;&lt;p&gt;Since enterprise apps are always tenant specific, deleting an enterprise app will only delete it from your tenant. This has no impact on other tenants. Enterprise applications can be deleted from the &lt;strong&gt;Properties&lt;/strong&gt; menu.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-90.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-90_hu_a681cf6335edfd3c.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-90_hu_3c18b1f8aa6539fb.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Properties of multi-tenant enterprise app in customer tenant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If you delete an enterprise app by accident, you can easily add it again by granting consent again. Depending on the app and the required permissions, you can do this by signing into Graph PowerShell or by using the admin consent link again. Because enterprise apps can&amp;rsquo;t be restored, adding one again will generate a new object id for the enterprise app/service principal.&lt;/p&gt;
&lt;h4 id=&#34;your-own-enterprise-applications&#34;&gt;Your Own Enterprise Applications
&lt;/h4&gt;&lt;p&gt;If you delete an enterprise application for which you own the app registration and both are in the same tenant, deleting the enterprise app won&amp;rsquo;t delete the app registration as well. However, deleting the enterprise app will remove previously consented permissions on the app registration too.&lt;/p&gt;
&lt;p&gt;Here, I&amp;rsquo;m deleting the enterprise app called &lt;strong&gt;Graph PowerShell Demo (Created in Portal)&lt;/strong&gt;. Deleting an enterprise app will result in revoking all admin consents, including configured permissions.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-91.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-91_hu_e421691dcfa8b48f.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-91_hu_4fda3211bd0da3c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;App registration permissions before the enterprise app was deleted&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-92.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-92_hu_c6e0580ad1c8f922.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-92_hu_a2225e9186288c92.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;App registration permissions after the enterprise app was deleted&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If you delete the enterprise app by accident, you can create a new one by granting admin consent on the app registration again. Keep in mind that the new enterprise app will have a different &lt;strong&gt;Object ID&lt;/strong&gt;. The &lt;strong&gt;Application ID&lt;/strong&gt; stays the same, as it&amp;rsquo;s the one of the app registration anyway.&lt;/p&gt;
&lt;h3 id=&#34;deleting-an-app-registration&#34;&gt;Deleting an App Registration
&lt;/h3&gt;&lt;p&gt;When you&amp;rsquo;re deleting app registrations you need to be much more careful.&lt;/p&gt;
&lt;h3 id=&#34;your-own-single-tenant-app-registrations&#34;&gt;Your Own Single-Tenant App Registrations
&lt;/h3&gt;&lt;p&gt;If you delete an app registration for which an enterprise app exists in the same tenant as well, both objects will be deleted.&lt;/p&gt;
&lt;p&gt;App registrations can be deleted from the &lt;strong&gt;Overview&lt;/strong&gt; page.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-93.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-93_hu_7d189012460e6345.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-93_hu_e619223ae10605f8.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Delete app registration&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;a-multi-tenant-app-registration-which-you-own&#34;&gt;A Multi-Tenant App registration which you own
&lt;/h3&gt;&lt;p&gt;If you&amp;rsquo;re the publisher/owner of a multi-tenant app registration and you delete the app registration from your service tenant, both the app registration and the enterprise app/service principal will be deleted from the service tenant. &lt;strong&gt;The enterprise app won&amp;rsquo;t be deleted from customer tenants but customers will no longer be able to sing in and use the app!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Let me share a great real life example with you. Until September 9th 2024, the PnP.PowerShell team has provided a multi-tenant app which could be used to sign into the PnP Management Shell. They &lt;a class=&#34;link&#34; href=&#34;https://pnp.github.io/blog/post/changes-pnp-management-shell-registration/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;announced&lt;/a&gt; that the app will be deleted on that day. As a result, any tenant that had added this app as an enterprise app to their tenant can no longer use it. Instead, admins need to &lt;a class=&#34;link&#34; href=&#34;https://pnp.github.io/powershell/articles/registerapplication&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;create their own app&lt;/a&gt; to access the PnP Management Shell.&lt;/p&gt;
&lt;p&gt;If the app registration is deleted in its home tenant by the app publisher/owner, it&amp;rsquo;s best to remove the enterprise app from your own tenant as well.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s get back to my lab. I&amp;rsquo;ve now deleted the app registration for &lt;strong&gt;Graph PowerShell (Multi-Tenant) V4&lt;/strong&gt; from the service tenant.&lt;/p&gt;
&lt;p&gt;As expected, after deleting the app registration from the service tenant, it&amp;rsquo;s not possible to sign into the enterprise app in the customer tenant anymore, even though the enterprise app still exists and the permissions of the enterprise app remain unchanged.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-97.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-97_hu_dc56bb54438ff4a5.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-97_hu_75ea54c7f0106496.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Error message when app registration was deleted in service (home) tenant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-95.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-95_hu_54a299d9f641936b.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-95_hu_8f82bb347cd131a7.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Permissions of enterprise app in customer tenant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;restoring-app-registrations&#34;&gt;Restoring App Registrations
&lt;/h2&gt;&lt;p&gt;Unlike enterprise apps/service principals, app registrations can be restored for up to 30 days. If an app registration was deleted by accident, you can restore it from &lt;strong&gt;Deleted applications&lt;/strong&gt; in the &lt;strong&gt;App registrations&lt;/strong&gt; menu.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-96.png&#34;
	width=&#34;2322&#34;
	height=&#34;1548&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-96_hu_bcd2af6a91f63a2f.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-96_hu_6dc5c190e47fa686.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Restoring deleted app registration in service tenant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;360px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;This will restore the enterprise app in the home tenant as well. In my case, both the consented permissions for the enterprise app and the app registration were restored as well. I did restore it right after deleting it though. The results might be different, if more time passes between deletion and restore.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s get to the million dollar question. Is there any action to be taken in the customer tenant after an app registration was deleted and restored from the service tenant?&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-94.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-94_hu_76037a741d2d7135.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-94_hu_e7e5c53760327774.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Successful sign in after the app registration was restored in the service tenant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;In my case, signing in to Graph PowerShell worked again just a few seconds after the app registration was restored in the service tenant. Again, this might differ if the time difference between deletion and restore is bigger.&lt;/p&gt;
&lt;h2 id=&#34;other-types-of-service-principals&#34;&gt;Other Types of Service Principals
&lt;/h2&gt;&lt;p&gt;So far, we&amp;rsquo;ve learned that every enterprise application is also a service principal. But is every service principal also an enterprise application? Not quite. If you navigate to the &lt;strong&gt;Enterprise applications&lt;/strong&gt; page in Entra Admin Center, you&amp;rsquo;ll notice that the filter is automatically set to &lt;code&gt;Application type == Enterprise Application&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-111.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-111_hu_f01b25551ad3a315.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-111_hu_bc5cbffa2b8f1590.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Enterprise applications view&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;That means that the portal will only show enterprise apps which have explicitly been added by an admin (or a user if not blocked) to your tenant.&lt;/p&gt;
&lt;p&gt;To block users from adding enterprise apps to your tenant, go to &lt;strong&gt;Enterprise applications&lt;/strong&gt; in Entra Admin Center and then click on &lt;strong&gt;Consent and permissions&lt;/strong&gt; on the left navigation pane.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-127.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-127_hu_1940e9f95f974fe4.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-127_hu_ef0581bf83859541.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Consent and permissions&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-125.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-125_hu_a580fa4e39248152.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-125_hu_fdeb6c264ed4203.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Do not allow user consent&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;However, there are also different types of service principals which are also part of the enterprise applications menu, but not included with the default filter.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-112.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-112_hu_145da1f6f0ff5fe3.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-112_hu_687bf9a9e5e31c9a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Service principal types&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;microsoft-applications&#34;&gt;Microsoft Applications
&lt;/h3&gt;&lt;p&gt;Microsoft applications are apps owned by Microsoft and they mostly include apps which allow Entra ID users to access various systems and services within Azure and Microsoft 365. My lab tenant currently lists 585 Microsoft apps. That is way too much to go into detail for all of them but let&amp;rsquo;s look at the example of the &lt;strong&gt;Microsoft Graph&lt;/strong&gt;. This is the actual Graph API and not the Microsoft Graph Command Line Tools enterprise app.&lt;/p&gt;
&lt;p&gt;There&amp;rsquo;s also an Application and an Object ID for &lt;strong&gt;Microsoft Graph&lt;/strong&gt;. Unlike Enterprise apps, Microsoft apps can&amp;rsquo;t be deleted and various properties such as &lt;strong&gt;Assignment required?&lt;/strong&gt; are not available. Searching for the app id will list it as enterprise application/service principal as well.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-113.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-113_hu_a9c2a50737576bc1.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-113_hu_68227a671e37993c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Microsoft Graph (Microsoft application)&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-114.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-114_hu_960b61b75b114531.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-114_hu_14f22a4dcfd8bc63.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Entra Admin Center search result&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;A list of the most commonly used app ids for Microsoft applications can be found &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/troubleshoot/azure/entra/entra-id/governance/verify-first-party-apps-sign-in#application-ids-of-commonly-used-microsoft-applications&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The actual Graph application doesn&amp;rsquo;t have or needs any permissions consented.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-115.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-115_hu_91f8cd0633aa1414.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-115_hu_ab48430fb025f226.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Microsoft Graph (Microsoft application) permissions&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If I go back and look at the sign-in logs of when I signed into Graph PowerShell using my &lt;strong&gt;Graph PowerShell Demo (Created in Portal)&lt;/strong&gt; app, I can see that the &lt;strong&gt;Resource ID&lt;/strong&gt; lists the app id of the Microsoft Graph Microsoft app (&lt;code&gt;00000003-0000-0000-c000-000000000000&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-116.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-116_hu_305ba3679e782be2.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-116_hu_f1da9fbfd2d4c738.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Sign in logs of Graph PowerShell&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I think it&amp;rsquo;s worth pointing out that the service principal is called &lt;strong&gt;GraphAggregatorService&lt;/strong&gt; but the app itself is called &lt;strong&gt;Microsoft Graph&lt;/strong&gt;.&lt;/p&gt;
&lt;h3 id=&#34;managed-identities&#34;&gt;Managed Identities
&lt;/h3&gt;&lt;p&gt;Managed identities are service principals which are tied to specific Azure resources like an automation account or a function app etc.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-117.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-117_hu_b98cb78c80c4fb89.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-117_hu_da37e42659eb4c43.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Managed identity service principals&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;This is an Azure resource of an automation account, for which I&amp;rsquo;ve configured a system assigned managed identity. If you look closely, you can see that the &lt;strong&gt;Object (principal) ID&lt;/strong&gt; is the same as the &lt;strong&gt;Object ID&lt;/strong&gt; of the service principal in the screenshot above.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-122.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-122_hu_5b905972a5d51c63.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-122_hu_4294595f68e093fa.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Managed identity on Azure resource&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;blockquote&gt;
    &lt;p&gt;Once the system assigned managed identity is enabled, this resource will be registered with Microsoft Entra ID. After being registered, you can control its access to other services like storage accounts.&lt;/p&gt;&lt;span class=&#34;cite&#34;&gt;&lt;span&gt;― &lt;/span&gt;&lt;span&gt;Azure Portal&lt;/span&gt;&lt;cite&gt;&lt;/cite&gt;&lt;/span&gt;&lt;/blockquote&gt;
&lt;p&gt;Managed identities do not have an app registration exposed to your tenant but when you enable one for an Azure resource, an app will be registered somewhere in Entra ID (where only Microsoft can see it) and a service principal will be created in your tenant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-119.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-119_hu_de05de1e02e3abbe.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-119_hu_7219e77f78f4552a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Entra Admin Center search results for managed identity object id&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Managed identities are primarily used to grant access to Azure resources, therefore the permissions of the enterprise app are usually empty.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-120.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-120_hu_5054b92080796a3f.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-120_hu_f03ff98a6299069d.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Permissions of managed identity service principal&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;However, it is possible to assign administrative roles to service principals of managed identities or grant them access to Azure resources other than the one for which the managed identity was created for.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-121.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-121_hu_79587a7db2ceb9f5.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-121_hu_bc6ac56ae471c790.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Admin role assignment for service principal (managed identity)&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;A managed identity can only be used by the Azure resource for which it was created for. So, if you create a managed identity for an Azure automation account, only the automation account, or resources within said automation account, for example a runbook will be able to sign in using that managed identity. The managed identity cannot be used in any other way. It&amp;rsquo;s also not possible to create a client secret or a certificate for a managed identity because as the name suggests, Microsoft is doing everything in the background for you.&lt;/p&gt;
&lt;p&gt;To connect to Azure using a managed identity in an Azure runbook, all you need is this code:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Connect to Azure environment&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Connect-AzAccount&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Identity&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-TenantId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$tenantId&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Service principals of managed identities cannot be deleted from enterprise applications.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-118.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-118_hu_a3c6082f218d9dda.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-118_hu_c01b6d7e0dbac6aa.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Managed identity service principal properties&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Instead, the managed identity must be disabled on the page of the Azure resource for which it was created.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-123.png&#34;
	width=&#34;2322&#34;
	height=&#34;1459&#34;
	srcset=&#34;https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-123_hu_ca29fd7676cddaa4.png 480w, https://heusser.pro/p/whats-the-difference-between-an-entra-id-app-registration-and-an-enterprise-app-4yyib4g1sk5a/image-123_hu_c275f3f873f5d540.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Disable managed identity from Azure resource configuration&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;381px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;Summary
&lt;/h2&gt;&lt;p&gt;This is without a doubt the longest blog post I&amp;rsquo;ve ever written. But sometimes, when I&amp;rsquo;m writing about complex topics there is just no other way to do this. I&amp;rsquo;m aware that I&amp;rsquo;ve repeated myself a couple of times in this blog post, but I wanted to make sure that it&amp;rsquo;s clear at all times if I&amp;rsquo;m speaking about an app registration or an enterprise app and in which tenant the afore mentioned object lives.&lt;/p&gt;
&lt;p&gt;I also want to clarify that I&amp;rsquo;ve never developed or worked on an enterprise grade application or anything like that. That&amp;rsquo;s also why this blog post doesn&amp;rsquo;t go into the details like token configuration, exposing APIs etc.&lt;/p&gt;
&lt;p&gt;As a Sys Admin, you&amp;rsquo;re going to have to deal with Entra applications sooner or later. Whether you like it or not. It sure does complicate a lot of things that were easier a couple of years ago, like using the AzureAD PowerShell module and not having to deal with Graph permissions for example. But I believe that it&amp;rsquo;s a necessity for every IT Pro to learn how things work in the new world. It&amp;rsquo;s important to understand what an app registration and what an enterprise app is and what each of them does.&lt;/p&gt;
&lt;p&gt;I actually wrote about a third of this blog twice. The first time I started it was a hot mess and there was no clear common thread to follow. In my first attempt, I tried to sort everything into sections, like creating an app registration and then I had subsections for each possibility like single- and multi-tenant but it just didn&amp;rsquo;t make much sense to talk about registering multi-tenant apps, when I hadn&amp;rsquo;t even explained what a multi-tenant app is or in which scenarios they&amp;rsquo;re used.&lt;/p&gt;
&lt;p&gt;Then I started from scratch again and I tried really hard two write a story that unfolds naturally. I started with things you might already know and introduced new stuff that builds on previously mentioned details in each topic.&lt;/p&gt;
&lt;p&gt;Let us reminisce one last time what Entra applications are and what the key differences between app registrations and enterprise apps are.&lt;/p&gt;
&lt;p&gt;An Entra application in general is referring to what&amp;rsquo;s used when certain resources like the Graph API are accessed in Entra ID. Access to resources can either use delegated permissions, where a signed in user is required or they can use application permissions, where either a client secret or a certificate instead of a signed in user is required. An application can have any combination of delegated and application permissions.&lt;/p&gt;
&lt;p&gt;An Entra application is not like a traditional application. When we hear the word application or app, most people will think about an app that can be installed on a device or accessed through a web browser. The purpose of an Entra application is to allow &lt;em&gt;actual&lt;/em&gt; apps, like for example the Zoom client to access resources like your calendar in Entra ID/Graph. Any Entra application must be registered in an Entra ID tenant before it can be used in applications or scripts that are built by developers.&lt;/p&gt;
&lt;p&gt;An app registration is essentially the same thing as an application. The process of creating a new application is called registering an app and that&amp;rsquo;s why the Entra Admin Center typically calls them app registrations. In PowerShell or Entra ID logs, app registrations are always called applications.&lt;/p&gt;
&lt;p&gt;In theory, an app registration can exist without an enterprise app, but an enterprise app can&amp;rsquo;t exist without an app registration. The registered application for an enterprise app can either be in the same tenant or it can be homed in a different tenant.&lt;/p&gt;
&lt;p&gt;When you&amp;rsquo;re building an internal application, the app registration is usually homed in your own tenant. When you&amp;rsquo;re purchasing, using or building a SaaS app, the app registration usually lives in a service tenant.&lt;/p&gt;
&lt;p&gt;When an app is registered, a globally unique (across all Entra ID tenants) application id is assigned by Entra ID, and an app can be registered as a single- or a multi-tenant app. Single-tenant apps can only be used by your organization. Multi-tenant apps can be added to and used by any tenant, if admin consent for the app is granted.&lt;/p&gt;
&lt;p&gt;Enterprise apps are the same thing as service principals but not all service principal types are also called enterprise apps. Microsoft applications and managed identities are the exception to this. The Entra Admin Center refers to service principals as enterprise applications in most UI elements but logs in Entra ID or PowerShell Cmdlets and object properties typically refer to them as service principals.&lt;/p&gt;
&lt;p&gt;Service principals allow you or a publisher of a multi-tenant app to access resources in your tenant. The permission model is very granular and almost any action requires an explicitly granted admin consent before an app is allowed to perform any actions. This also applies when using delegated permissions and means that you won&amp;rsquo;t be able to perform an action against the Microsoft Graph API before admin consent has been granted, even if your account has the required admin roles assigned and you&amp;rsquo;re able to perform the same action in the portal.&lt;/p&gt;
&lt;p&gt;To use app only authentication a client secret or a certificate is needed, and they must be configured on the app registration, even though the service principal is used for the actual sign in process.&lt;/p&gt;
&lt;p&gt;In conclusion, an Entra application is a combination of both an app registration and an enterprise app. You can&amp;rsquo;t have an enterprise app without a registered app, and you can&amp;rsquo;t use an application to sign into a resource, such as Microsoft Graph without also having an enterprise app/service principal for it.&lt;/p&gt;
&lt;p&gt;I hope that this explanation makes sense to you. I certainly learned a lot in the days I dedicated my time to writing this blog post. If you too understand the difference between app registrations and enterprise apps now, feel free to buy me a &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/support-me&#34; &gt;coffee&lt;/a&gt;. 😊&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Microsoft Graph: How To Filter Users by Phone Number</title>
        <link>https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/</link>
        <pubDate>Thu, 04 Jul 2024 20:20:00 +0000</pubDate>
        
        <guid>https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/</guid>
        <description>&lt;p&gt;Sometimes, something simple as writing a filter query to search for Entra ID users which have a specific phone number can take way longer than we would like. Instead of making you search through numerous Stack Overflow posts or ask ChatGPT on how to do it, I decided to write this short blog post which will give you everything you need to quickly find Entra ID users which have a specific phone number.&lt;/p&gt;
&lt;h2 id=&#34;number-types&#34;&gt;Number Types
&lt;/h2&gt;&lt;p&gt;The most common numbers in Entra ID are &lt;strong&gt;Mobile phone&lt;/strong&gt; and &lt;strong&gt;Business Phone&lt;/strong&gt;. While the Entra ID admin portal displays &lt;code&gt;Business phone&lt;/code&gt; in singular, the property is actually called &lt;code&gt;businessPhones&lt;/code&gt; and is a string collection.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image.png&#34;
	width=&#34;1793&#34;
	height=&#34;693&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image_hu_49c2b27357730239.png 480w, https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image_hu_361eb514353b3b4f.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Phone numbers in Entra ID&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;258&#34;
		data-flex-basis=&#34;620px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;filter-queries&#34;&gt;Filter Queries
&lt;/h2&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/graph/api/resources/user?view=graph-rest-1.0#properties&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;This&lt;/a&gt; page tells us which conditions are supported for which user properties. I wasn&amp;rsquo;t able to get this to work using &lt;code&gt;Get-MgUser -Filter &amp;quot;Filter Query&amp;quot;&lt;/code&gt; since an API request using an advanced filter query will require a special header. Not long ago, I wrote about the &lt;code&gt;Invoke-MgGraphRequest&lt;/code&gt; &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/microsoft-graph-get-an-access-token-from-an-established-powershell-session-zv37e1xmxr86&#34; &gt;Cmdlet&lt;/a&gt; and how that can be used to call the Graph REST API directly using the session token from &lt;code&gt;Connect-MgGraph&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;To make it work, you&amp;rsquo;ll need to create a header with &lt;strong&gt;ConsistencyLevel&lt;/strong&gt;: &lt;code&gt;eventual&lt;/code&gt; which is then added to the Graph Request.&lt;/p&gt;
&lt;p&gt;Since this is a web request, you&amp;rsquo;ll also need to url encode the &lt;code&gt;+&lt;/code&gt; character. A simple &lt;strong&gt;replace&lt;/strong&gt; with &lt;code&gt;%2B&lt;/code&gt; will do the trick here. It&amp;rsquo;s important to note that this will only work if the phone number is stored on the Entra user exactly the same as what&amp;rsquo;s in the filter query. For example, it won&amp;rsquo;t work if the phone number is stored without spaces in Entra but you&amp;rsquo;re querying it with spaces. If your phone numbers in Entra are a mess, I recommend to take a look at &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/prettify-and-sync-teams-phone-numbers-to-azure-ad-e973755f83d5&#34; &gt;this&lt;/a&gt; blog post. This will show you how you can format all phone numbers in the same, and most importantly in the correct way.&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s how to create the header.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$header&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ConsistencyLevel&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;eventual&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;powershell-example&#34;&gt;PowerShell Example
&lt;/h3&gt;&lt;p&gt;Here is an example script which contains all possible filter conditions for both mobile and business phone numbers. The important thing here is that the custom header is included and that the &lt;strong&gt;Uri&lt;/strong&gt; includes the &lt;strong&gt;Count&lt;/strong&gt; variable. Note that the &lt;code&gt;businessPhones&lt;/code&gt; property does not support the &lt;code&gt;in&lt;/code&gt; condition.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Connect-MgGraph&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mobileNumber&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;+41 79 456 78 90&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$businessNumber&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;+41 43 123 45 67&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mobileNumberUrlSafe&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$mobileNumber&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Replace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;+&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;%2B&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$businessNumberUrlSafe&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$businessNumber&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Replace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;+&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;%2B&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$header&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ConsistencyLevel&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;eventual&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Filter users by mobile phone number exact match (equals)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mgUserMatchesMobilePhone&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-MgGraphRequest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/users?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;filter=mobilePhone eq &amp;#39;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$mobileNumberUrlSafe&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#39;&amp;amp;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;count=true&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Filter users by business phone number exact match (equals)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mgUserMatchesBusinessPhone&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-MgGraphRequest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/users?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;filter=businessPhones/any(p:p eq &amp;#39;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$businessNumberUrlSafe&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#39;)&amp;amp;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;count=true&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Filter users by mobile phone number not equals&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mgUserMatchesMobilePhone&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-MgGraphRequest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/users?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;filter=mobilePhone ne &amp;#39;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$mobileNumberUrlSafe&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#39;&amp;amp;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;count=true&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Filter users by business phone number not equals&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mgUserMatchesBusinessPhone&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-MgGraphRequest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/users?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;filter=not businessPhones/any(p:p eq &amp;#39;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$businessNumberUrlSafe&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#39;)&amp;amp;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;count=true&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Filter users by mobile phone number starts with&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mgUserMatchesMobilePhone&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-MgGraphRequest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/users?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;filter=startsWith(mobilePhone, &amp;#39;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$mobileNumberUrlSafe&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#39;)&amp;amp;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;count=true&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Filter users by business phone number starts with&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mgUserMatchesBusinessPhone&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-MgGraphRequest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/users?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;filter=businessPhones/any(p:startswith(p,&amp;#39;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$businessNumberUrlSafe&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#39;))&amp;amp;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;count=true&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Filter users by mobile phone number greater or equal&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mgUserMatchesMobilePhone&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-MgGraphRequest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/users?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;filter=mobilePhone ge &amp;#39;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$mobileNumberUrlSafe&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#39;&amp;amp;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;count=true&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Filter users by business phone number greater or equal&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mgUserMatchesBusinessPhone&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-MgGraphRequest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/users?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;filter=businessPhones/any(p:p ge &amp;#39;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$businessNumberUrlSafe&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#39;)&amp;amp;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;count=true&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Filter users by mobile phone number less or equal&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mgUserMatchesMobilePhone&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-MgGraphRequest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/users?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;filter=mobilePhone le &amp;#39;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$mobileNumberUrlSafe&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#39;&amp;amp;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;count=true&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Filter users by business phone number less or equal&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mgUserMatchesBusinessPhone&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-MgGraphRequest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/users?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;filter=businessPhones/any(p:p le &amp;#39;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$businessNumberUrlSafe&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#39;)&amp;amp;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;count=true&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Filter users by mobile phone number in&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mobileNumberUrlSafe2&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;+41 79 456 78 91&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Replace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;+&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;%2B&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mgUserMatchesMobilePhone&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-MgGraphRequest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/users?&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;filter=mobilePhone in [&amp;#39;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$mobileNumberUrlSafe&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$mobileNumberUrlSafe2&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#39;]&amp;amp;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;count=true&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id=&#34;example-output&#34;&gt;Example Output
&lt;/h4&gt;&lt;p&gt;What&amp;rsquo;s a little weird is that PowerShell outputs an array with name/value pairs instead of a PS custom object.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-1.png&#34;
	width=&#34;1644&#34;
	height=&#34;899&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-1_hu_92ff7fde5abe850d.png 480w, https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-1_hu_84381021b589bf20.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Output from Invoke-MgGraphRequest&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;182&#34;
		data-flex-basis=&#34;438px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;While it&amp;rsquo;s possible to access properties directly, it doesn&amp;rsquo;t work in &lt;code&gt;Format-Table&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-4.png&#34;
	width=&#34;1644&#34;
	height=&#34;262&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-4_hu_ca1b433299048a88.png 480w, https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-4_hu_bb9630fd73059695.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Format-Table does not work with specific properties&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;627&#34;
		data-flex-basis=&#34;1505px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;A simple trick to convert the &lt;strong&gt;array&lt;/strong&gt; returned by Graph into a &lt;strong&gt;PS custom object&lt;/strong&gt; I often use is to convert it &lt;strong&gt;to&lt;/strong&gt; Json and than convert it &lt;strong&gt;from&lt;/strong&gt; Json straight away again.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mgUserMatchesMobilePhone&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$mgUserMatchesMobilePhone&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ConvertTo-Json&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ConvertFrom-Json&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Obviously, you can do the same for the &lt;code&gt;$mgUserMatchesBusinessPhone&lt;/code&gt; variable. That will store and display the values as a proper PowerShell object.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-3.png&#34;
	width=&#34;1644&#34;
	height=&#34;899&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-3_hu_aa05bebc5e432893.png 480w, https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-3_hu_f4a255960b2ec256.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;There are no name/value pairs anymore.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;182&#34;
		data-flex-basis=&#34;438px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Now you can work with the &lt;code&gt;$mgUserMatchesMobilePhone&lt;/code&gt;and &lt;code&gt;$mgUserMatchesBusinessPhone&lt;/code&gt; as expected and do anything you want with them.&lt;/p&gt;
&lt;h3 id=&#34;bonus-tip-power-automate&#34;&gt;Bonus Tip (Power Automate)
&lt;/h3&gt;&lt;p&gt;The standard action &lt;strong&gt;Search for users (V2)&lt;/strong&gt; from the &lt;strong&gt;Office 365 Users&lt;/strong&gt; connector doesn&amp;rsquo;t support to filter for phone numbers of any type.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-2.png&#34;
	width=&#34;1507&#34;
	height=&#34;262&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-2_hu_4de9e5b2909fb265.png 480w, https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-2_hu_e5c8b0d94d0e16f7.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Supported filters for Office 365 Users&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;575&#34;
		data-flex-basis=&#34;1380px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Luckily, there&amp;rsquo;s also a an action called &lt;strong&gt;Send an HTTP request&lt;/strong&gt; within the &lt;strong&gt;Office 365 Users&lt;/strong&gt; connector. This will allow you to make the same kinds of advanced requests to the Graph API as I&amp;rsquo;ve shown above with PowerShell.&lt;/p&gt;
&lt;p&gt;Below is an example of a simple Power Automate Flow that can also filter for Entra ID users by phone number. What&amp;rsquo;s important is that you also need to add the &lt;strong&gt;ConsistencyLevel&lt;/strong&gt; header and that you must remove all occurrences of the escape character &lt;code&gt;`&lt;/code&gt; from the Uri. Since Power Automate does not use &lt;code&gt;$&lt;/code&gt; to define variables, the escape character is not needed/supported here. The &lt;code&gt;&amp;amp;$count=true&lt;/code&gt; also needs to be included at the end of the Uri.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-5.png&#34;
	width=&#34;938&#34;
	height=&#34;1296&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-5_hu_15810a0c6ec70930.png 480w, https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-5_hu_2571de27c697ea1d.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Power Automate Flow to filter for users by phone number&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;72&#34;
		data-flex-basis=&#34;173px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Since this is just an example, the phone number used as the filter is simply stored in &lt;strong&gt;Compose Phone Number&lt;/strong&gt; action. The next action, &lt;strong&gt;Compose Phone Number URL Safe&lt;/strong&gt; will replace the &lt;code&gt;+&lt;/code&gt; with &lt;code&gt;%2B&lt;/code&gt; using an expression.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;replace(outputs(&amp;#39;Compose_Phone_Number&amp;#39;), &amp;#39;+&amp;#39;, &amp;#39;%2B&amp;#39;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;To extract the Display Name of the result, I&amp;rsquo;m using another compose action with the following expression.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;outputs(&amp;#39;Send_an_HTTP_request&amp;#39;)?[&amp;#39;body&amp;#39;]?[&amp;#39;value&amp;#39;][0][&amp;#39;displayName&amp;#39;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id=&#34;example-output-1&#34;&gt;Example Output
&lt;/h4&gt;&lt;p&gt;If there is a user match for the phone number, Graph will return a nice Json response to Power Automate.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-6.png&#34;
	width=&#34;960&#34;
	height=&#34;1138&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-6_hu_28f9711ae8084ce3.png 480w, https://heusser.pro/p/microsoft-graph-how-to-filter-users-by-phone-number-b659lvqwir32/image-6_hu_370e74537fcbb3f8.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Output from Microsoft Graph within Power Automate&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;84&#34;
		data-flex-basis=&#34;202px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;summary--download&#34;&gt;Summary &amp;amp; Download
&lt;/h2&gt;&lt;p&gt;I hope that these examples help you with whatever you&amp;rsquo;re trying to achieve. I&amp;rsquo;m certainly going to use this blog post as a cheat sheet for myself in the future. You can also download the entire script from my &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation/blob/main/Scripts/MicrosoftGraph/EntraID/FilterGraphUsersByPhoneNumber.ps1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;GitHub&lt;/a&gt; profile.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Microsoft Graph: Get an Access Token from a PowerShell Session</title>
        <link>https://heusser.pro/p/microsoft-graph-get-an-access-token-from-an-established-powershell-session-zv37e1xmxr86/</link>
        <pubDate>Wed, 05 Jun 2024 19:24:44 +0000</pubDate>
        
        <guid>https://heusser.pro/p/microsoft-graph-get-an-access-token-from-an-established-powershell-session-zv37e1xmxr86/</guid>
        <description>&lt;p&gt;Authentication with the Microsoft Graph PowerShell SDK is pretty easy. All you have to do to establish a session is to run &lt;code&gt;Connect-MgGraph&lt;/code&gt;. After that, you can use all Cmdlets for which you&amp;rsquo;ve installed the necessary modules. It&amp;rsquo;s no secret that not all Cmdlets are as well documented as the REST API itself and in rare cases, the PowerShell Cmdlets might even have some limitations compared to their REST counterparts. In such cases, you can usually just use the universal &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.authentication/invoke-mggraphrequest?view=graph-powershell-1.0&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;Invoke-MgGraphRequest&lt;/code&gt;&lt;/a&gt; Cmdlet without providing your own access token. This Cmdlet will use the same authentication like any other &lt;strong&gt;&lt;code&gt;Mg*&lt;/code&gt;&lt;/strong&gt; Cmdlet.&lt;/p&gt;
&lt;p&gt;This is how Microsoft describes the &lt;code&gt;Invoke-MgGraphRequest&lt;/code&gt; Cmdlet on Microsoft Learn:&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Invoke-MgGraphRequest issues REST API requests to the Graph API. It works for any Graph API if you know the REST URI, method, and optional body parameter. This command is especially useful for accessing APIs for which there isn&amp;rsquo;t an equivalent cmdlet yet.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Note that there is also an alias called &lt;code&gt;Invoke-GraphRequest&lt;/code&gt; for this Cmdlet. A perfect example of where you would need &lt;code&gt;Invoke-MgGraphRequest&lt;/code&gt; is uploading a small file to SharePoint. I recently published a script example making use of this method &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/powershell-script-example-upload-small-files-via-microsoft-graph-z45tbunyoa85&#34; &gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;what-is-mgcontext&#34;&gt;What is MgContext?
&lt;/h2&gt;&lt;p&gt;By running &lt;code&gt;Get-MgContext&lt;/code&gt; you can get some information about the current session. Unfortunately, this doesn&amp;rsquo;t reveal any kind of tokens used for requests to the Graph API. Then again, this is most likely by design, because tokens should always be handled with care.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-graph-get-an-access-token-from-an-established-powershell-session-zv37e1xmxr86/image.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-graph-get-an-access-token-from-an-established-powershell-session-zv37e1xmxr86/image_hu_47ba1663556a2ad5.png 480w, https://heusser.pro/p/microsoft-graph-get-an-access-token-from-an-established-powershell-session-zv37e1xmxr86/image_hu_fa5f3458713001be.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Output of Get-MgContext&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;what-if-you-need-a-token-anyway&#34;&gt;What if you need a token anyway?
&lt;/h2&gt;&lt;p&gt;One option is to provide a client Id and a client secret and make a request to &lt;strong&gt;&lt;a class=&#34;link&#34; href=&#34;https://login.microsoftonline.com/%7bYour&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://login.microsoftonline.com/{Your&lt;/a&gt; Tenant Name}/oauth2/v2.0/token&lt;/strong&gt;. If I want to do that, I always come back to this blog post on &lt;a class=&#34;link&#34; href=&#34;https://adamtheautomator.com/powershell-graph-api/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;adamtheautomator.com&lt;/a&gt;. But when I do that, I also want to call the REST API directly for all requests that the script I&amp;rsquo;m working on is doing. In my case, I &lt;strong&gt;want&lt;/strong&gt; to use the SDK and only &lt;strong&gt;need&lt;/strong&gt; to call the API directly for one specific request.&lt;/p&gt;
&lt;p&gt;I recently was working on something where neither the &lt;code&gt;Get-Mg*&lt;/code&gt; nor the &lt;code&gt;Invoke-MgGraphRequest&lt;/code&gt; were working. I wanted to fetch a profile picture of an Entra ID user but wanted to keep the image in memory and not save it to disk. Both the Cmdlets, &lt;code&gt;Get-MgUserPhotoContent&lt;/code&gt; and &lt;code&gt;Invoke-MgGraphRequest&lt;/code&gt; expected a value for an output file though. I know I could have just used a temporary file but if I had given up this easily, I wouldn&amp;rsquo;t have discovered how to get an access token from a Microsoft Graph PowerShell session.&lt;/p&gt;
&lt;p&gt;When I was testing the &lt;code&gt;Invoke-MgGraphRequest&lt;/code&gt; Cmdlet, I noticed that there were different accepted values for the parameter &lt;code&gt;-OutputType&lt;/code&gt;. One of the accepted values is &lt;strong&gt;HttpResponseMessage&lt;/strong&gt; and if you select this, Graph will return the access token in the HTTP response.&lt;/p&gt;
&lt;p&gt;This is the Graph URI/endpoint that I was using:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$mgRequest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-MgGraphRequest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/users/&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$userId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/photo/&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;value&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;image/jpeg&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-OutputType&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HttpResponseMessage&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-graph-get-an-access-token-from-an-established-powershell-session-zv37e1xmxr86/image-1.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-graph-get-an-access-token-from-an-established-powershell-session-zv37e1xmxr86/image-1_hu_de24c5ca676d4f59.png 480w, https://heusser.pro/p/microsoft-graph-get-an-access-token-from-an-established-powershell-session-zv37e1xmxr86/image-1_hu_bc7d332996866ea2.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Graph access token retrieved using Invoke-MgGraphRequest&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;To access the token directly, you can use: &lt;code&gt;$mgRequest.RequestMessage.Headers.Authorization.Parameter&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-graph-get-an-access-token-from-an-established-powershell-session-zv37e1xmxr86/image-2.png&#34;
	width=&#34;1734&#34;
	height=&#34;957&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-graph-get-an-access-token-from-an-established-powershell-session-zv37e1xmxr86/image-2_hu_65217b8859c27daf.png 480w, https://heusser.pro/p/microsoft-graph-get-an-access-token-from-an-established-powershell-session-zv37e1xmxr86/image-2_hu_7ed5f848593d0277.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;The access token is now stored in a variable&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If you want to build your own Authorization header to call the API directly without first requesting a dedicated token from &lt;strong&gt;&lt;a class=&#34;link&#34; href=&#34;https://login.microsoftonline.com&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://login.microsoftonline.com&lt;/a&gt;&lt;/strong&gt; you can use this code:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$authHeader&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Authorization&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$mgRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;RequestMessage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Authorization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Scheme&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$mgRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;RequestMessage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Headers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Authorization&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Parameter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$profilePhoto&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-WebRequest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/users/&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$userId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/photo/&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;value&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$authHeader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Content&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;This allowed me to retrieve the profile photo as a byte array without saving it to disk first.&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;Summary
&lt;/h2&gt;&lt;p&gt;This is a very niche use case but I&amp;rsquo;m glad that I discovered how to get an access token from an already authenticated Microsoft Graph PowerShell session. I&amp;rsquo;m sure that this will come in handy again some day and I hope that it will come in handy for you some day as well. I also published the entire example script including helpful comments in one of my GitHub &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation/blob/main/Scripts/MicrosoftGraph/Authentication/Get-AccessTokenFromEstablishedMgSession.ps1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;repositories&lt;/a&gt;.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Everything You Ever Wanted to Know About Creating Teams and Microsoft 365 Groups</title>
        <link>https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/</link>
        <pubDate>Mon, 07 Aug 2023 13:10:37 +0000</pubDate>
        
        <guid>https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/</guid>
        <description>&lt;p&gt;Did you know that you can create new Microsoft 365 Group in &lt;strong&gt;six&lt;/strong&gt; and a new Microsoft Teams Team in &lt;strong&gt;four&lt;/strong&gt; different places? And I’m not even counting PowerShell…&lt;/p&gt;
&lt;p&gt;Today, I’m going to show you the differences in default settings when a Group/Team is created from a different place and what impact it could have.&lt;/p&gt;
&lt;p&gt;Let’s start with all the different admin portals and clients a Microsoft 365 Group can be created in.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Entra ID Admin Center&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;M365 Admin Center&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Exchange Admin Center&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Teams Admin Center&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;SharePoint Admin Center&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Teams Client&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The bold ones are the ones where we can also create a Team alongside the Group.&lt;/p&gt;
&lt;p&gt;As we all know, every Team includes a “surrounding” Microsoft 365 Group to manage access to the Team. &lt;strong&gt;You can have a Microsoft 365 Group without a Team, but you can’t have a Team without an associated Microsoft 365 Group.&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;entra-id-admincenter&#34;&gt;Entra ID Admin Center
&lt;/h4&gt;&lt;p&gt;If you create a new M365 Group in Entra ID, you won’t have the option to add a Team to the group during the creation process. The only reason why you’d want to use Entra ID to add an M365 Group with a Team is if you want to use a dynamic group. Entra ID is the only GUI where you can create dynamic M365 Groups. Also, you can’t configure the group’s visibility upon creation of the group. It has to be manually changed in M365 Admin Center after the group has been created in Entra ID.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Ks0QQyarwoK0HLpIQYw.png&#34;
	width=&#34;1036&#34;
	height=&#34;1091&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Ks0QQyarwoK0HLpIQYw_hu_d962ad55756d05b3.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Ks0QQyarwoK0HLpIQYw_hu_b2fb96e287c964.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;94&#34;
		data-flex-basis=&#34;227px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;m365-admincenter&#34;&gt;M365 Admin Center
&lt;/h4&gt;&lt;p&gt;If you create the M365 Group from the M365 Admin Center, the group’s visibility will default to &lt;strong&gt;PUBLIC,&lt;/strong&gt; and you’ll need to provide the group’s email address manually. The checkbox for &lt;strong&gt;Create a team for this group&lt;/strong&gt; is enabled by default.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1OLo4fcAatonsKKHC8fCIA.png&#34;
	width=&#34;1134&#34;
	height=&#34;909&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1OLo4fcAatonsKKHC8fCIA_hu_8cc38413ff5be589.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1OLo4fcAatonsKKHC8fCIA_hu_ce119eda9ca6a18b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;124&#34;
		data-flex-basis=&#34;299px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;exchange-admincenter&#34;&gt;Exchange Admin Center
&lt;/h4&gt;&lt;p&gt;Creating the group from the Exchange Online Admin Center does essentially the same thing as creating it from the M365 Admin Center. The only difference is that you’ll be able to create a &lt;strong&gt;Dynamic distribution&lt;/strong&gt; group from Exchange. This option is not available in M365 Admin. However, M365 Admin Center allows you to create &lt;strong&gt;Security&lt;/strong&gt; groups while the Exchange Admin Center won’t.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1yv8Aumuzx6q5H4zhrbRkqg.png&#34;
	width=&#34;1139&#34;
	height=&#34;836&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1yv8Aumuzx6q5H4zhrbRkqg_hu_64f748114f4e8014.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1yv8Aumuzx6q5H4zhrbRkqg_hu_383489b8075d91e2.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;136&#34;
		data-flex-basis=&#34;326px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;teams-admincenter&#34;&gt;Teams Admin Center
&lt;/h4&gt;&lt;p&gt;In Teams Admin Center, the default visibility/privacy is set to &lt;strong&gt;Private&lt;/strong&gt;. Like in Entra ID, the email address of the M365 Group is also created for you with no option to change it during the creation process.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1FZlDNoVcf0Axd57QQFeyw.png&#34;
	width=&#34;523&#34;
	height=&#34;697&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1FZlDNoVcf0Axd57QQFeyw_hu_95e84aa1697be1ae.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1FZlDNoVcf0Axd57QQFeyw_hu_d940cc467cba6615.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;75&#34;
		data-flex-basis=&#34;180px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;sharepoint-admincenter&#34;&gt;SharePoint Admin Center
&lt;/h4&gt;&lt;p&gt;When you create a new Team Site in SharePoint Admin Center, a new Microsoft 365 Group is created as well. The group’s email address is set automatically and the default option for the visibility is private. In this case, you can adjust the group’s email address, if you want to.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1IfhZCo2ZFn01uwgpBqepw.png&#34;
	width=&#34;1331&#34;
	height=&#34;1486&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1IfhZCo2ZFn01uwgpBqepw_hu_5372a793fb4474f7.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1IfhZCo2ZFn01uwgpBqepw_hu_d167427cb6fae478.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;89&#34;
		data-flex-basis=&#34;214px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Creating the group from SharePoint Admin Center does not create a Team automatically. A Team can be added to the group in the Microsoft 365 Admin Center after the Team Site has been created.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1kE1YtLVIL7lk8iKSDJWngg.png&#34;
	width=&#34;1334&#34;
	height=&#34;459&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1kE1YtLVIL7lk8iKSDJWngg_hu_a70cc96bdef490c5.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1kE1YtLVIL7lk8iKSDJWngg_hu_b20dbe5a9804d62b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;290&#34;
		data-flex-basis=&#34;697px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;teams-client&#34;&gt;Teams Client
&lt;/h4&gt;&lt;p&gt;In Teams Client, things look a little bit different. First, you need to decide whether you want to start from scratch or from another group or team. There are also some basic templates available.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1fijm1R7xxa5ngZp8vnbA.png&#34;
	width=&#34;860&#34;
	height=&#34;859&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1fijm1R7xxa5ngZp8vnbA_hu_99003d8ad86fd6ce.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1fijm1R7xxa5ngZp8vnbA_hu_b898c1ca80c06c49.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;100&#34;
		data-flex-basis=&#34;240px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I chose &lt;strong&gt;From scratch&lt;/strong&gt; for this blog post. Next, you’ll be asked if you want to create a Private, Public or Org-wide Team. I tested all 3 types and all of them created a new M365 Group with the same settings. The group is always assigned, not even the Org-wide Team is created as dynamic group. The email address is derived from the Team name too, without the option to customize it during the creation process. The most important thing to note here is that if you create a Team from Teams itself, the group will be hidden in Outlook clients by default.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1j8BsmyfTxNnOhJOlbeeuQ.png&#34;
	width=&#34;812&#34;
	height=&#34;659&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1j8BsmyfTxNnOhJOlbeeuQ_hu_5b36de55cb9cda01.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1j8BsmyfTxNnOhJOlbeeuQ_hu_d032329a71507e37.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;123&#34;
		data-flex-basis=&#34;295px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;comparison-chart&#34;&gt;Comparison Chart
&lt;/h4&gt;&lt;p&gt;I’ve created a table which tells you what settings/defaults are applied for Teams created in each location.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1f1t0FfEjhgy1Q3X2gSmeIw.png&#34;
	width=&#34;1719&#34;
	height=&#34;321&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1f1t0FfEjhgy1Q3X2gSmeIw_hu_8d54fb8340343be5.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1f1t0FfEjhgy1Q3X2gSmeIw_hu_f0b78a96ab378f8a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;535&#34;
		data-flex-basis=&#34;1285px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I think all the above except &lt;strong&gt;OwnerAddedAsMember&lt;/strong&gt; and &lt;strong&gt;OwnerIsPartOfTeamWhileNotAMember&lt;/strong&gt; should be self-explanatory.&lt;/p&gt;
&lt;p&gt;Every group has owners and members. Owners are typically also members, but members don’t necessarily have to be owners as well.&lt;/p&gt;
&lt;p&gt;If you add certain users only as an owner, they won’t be added to the group&amp;rsquo;s members unless you create the Team from Teams Admin Center or from the Teams Client. (OwnerAddedAsMember).&lt;/p&gt;
&lt;p&gt;However, even if they’re just owners, they can still see the Team in Teams (OwnerIsPartOfTeamWhileNotAMember).&lt;/p&gt;
&lt;p&gt;Example: Team Created in M365 Admin Center&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1sKnTcPvGMPXSOxzurQkzA.png&#34;
	width=&#34;1022&#34;
	height=&#34;454&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1sKnTcPvGMPXSOxzurQkzA_hu_b497cc8f0137eac9.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1sKnTcPvGMPXSOxzurQkzA_hu_c2e39299003812d0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;225&#34;
		data-flex-basis=&#34;540px&#34;
	
&gt;
&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Tc27AG8fYx7IyLNlH4Cmw.png&#34;
	width=&#34;1250&#34;
	height=&#34;453&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Tc27AG8fYx7IyLNlH4Cmw_hu_421a90570f04085.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Tc27AG8fYx7IyLNlH4Cmw_hu_928372f68d401d29.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;275&#34;
		data-flex-basis=&#34;662px&#34;
	
&gt;
&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1HjfYRrvTHStUi1kDVBSjdg.png&#34;
	width=&#34;1587&#34;
	height=&#34;479&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1HjfYRrvTHStUi1kDVBSjdg_hu_8e362a1994ffdb.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1HjfYRrvTHStUi1kDVBSjdg_hu_71f43ce4e8d3786b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;331&#34;
		data-flex-basis=&#34;795px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If we compare this Team to one created in Teams Admin Center, we can see that it looks exactly the same in Teams.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1NKi2Pdxdqd30yavHOg8GA.png&#34;
	width=&#34;1652&#34;
	height=&#34;511&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1NKi2Pdxdqd30yavHOg8GA_hu_65e6564eab1d5ea8.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1NKi2Pdxdqd30yavHOg8GA_hu_8f537e27d53f1f22.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;323&#34;
		data-flex-basis=&#34;775px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;However, in M365 Admin Center we can see that the user is both an owner and a member of the group.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1MvFKN9z4vrC6q1nILilHmQ.png&#34;
	width=&#34;1036&#34;
	height=&#34;639&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1MvFKN9z4vrC6q1nILilHmQ_hu_bf21a9b320035e1e.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1MvFKN9z4vrC6q1nILilHmQ_hu_9b25ba6a7e7131fe.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;162&#34;
		data-flex-basis=&#34;389px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Teams will display each user only once, under the highest privilege a user has while M365 Groups list owners and members separately, even if it’s the same user account.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Jw5pIMkgJDtaYwnPmGyQbQ.png&#34;
	width=&#34;1040&#34;
	height=&#34;377&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Jw5pIMkgJDtaYwnPmGyQbQ_hu_3b41e1d12149720f.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Jw5pIMkgJDtaYwnPmGyQbQ_hu_dff8ba05e16e4243.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;275&#34;
		data-flex-basis=&#34;662px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;voice-enabled-channelscaveat&#34;&gt;Voice Enabled Channels Caveat
&lt;/h4&gt;&lt;p&gt;For normal Teams usage, it shouldn’t be a problem if an owner is not also a member. However, there is one important thing to mention. &lt;strong&gt;If an owner is not also a member and the owner is part of a Team which is used for a Voice Enabled Channel in Teams, the owner won’t be added to the queue’s agent list, unless the owner is added explicitly as a member too.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I’ve linked a Team which I created from M365 Admin Center to this call queue. During the creation, I’ve only added 1 owner and no members.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1cCSpNYnw92CDChAB4vXdQ.png&#34;
	width=&#34;1377&#34;
	height=&#34;421&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1cCSpNYnw92CDChAB4vXdQ_hu_ce8e14ba2cd80d73.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1cCSpNYnw92CDChAB4vXdQ_hu_21cc38e1c546eca0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;327&#34;
		data-flex-basis=&#34;784px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;When we check the call agents of this queue, we can see that it says &lt;strong&gt;zero&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1WxLllnbtYMltwNBa8Ymb6Q.png&#34;
	width=&#34;1286&#34;
	height=&#34;250&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1WxLllnbtYMltwNBa8Ymb6Q_hu_f9cde674a4f4b2c2.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1WxLllnbtYMltwNBa8Ymb6Q_hu_39d3c7aad6c22dec.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;514&#34;
		data-flex-basis=&#34;1234px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;When I add the owner also as a member of the group in M365 Admin Center and save the queue again, we can see that it now has &lt;strong&gt;one&lt;/strong&gt; call agent.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1tko8IXwu7Fec7LztJ1UqQ.png&#34;
	width=&#34;1295&#34;
	height=&#34;258&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1tko8IXwu7Fec7LztJ1UqQ_hu_c0f92fc929495186.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1tko8IXwu7Fec7LztJ1UqQ_hu_a62c6f84733e0664.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;501&#34;
		data-flex-basis=&#34;1204px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;You can read more about Voice Enabled Channels and Call Queue Agent Lists &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/microsoft-teams-call-queue-agent-lists-and-how-to-force-sync-them-ef8092090df0&#34; &gt;here&lt;/a&gt; and &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/manage-microsoft-teams-call-queues-with-powershell-force-sync-9919e2939552&#34; &gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h4 id=&#34;where-to-create-newteams&#34;&gt;Where to Create New Teams?
&lt;/h4&gt;&lt;p&gt;So where is it best to create new Teams? Sadly, the answer is: It depends. The first question you should ask yourself is if the membership needs to be assigned or dynamic. If it should be dynamic, you must create it from Entra ID. Otherwise, there is no clear winner here. Each portal does it slightly different which creates unwanted and most likely also unnoticed differences in M365 Group settings. If you want to be consistent across all your Teams and Groups, I recommend defining one or multiple standards and then creating a PowerShell script which creates new Teams and Groups according to your needs.&lt;/p&gt;
&lt;h3 id=&#34;powershell-cheat-sheet-for-m365groups&#34;&gt;PowerShell Cheat-Sheet for M365 Groups
&lt;/h3&gt;&lt;p&gt;Since we’ve now learned that creating Groups or Teams from different Admin Centers can have different effects, I put together a little PowerShell cheat-sheet containing some handy one-lineres to help you quickly adjust M365 Group settings. Since these settings are applied to the M365 Group and not to the Team, they all require the Exchange Online PowerShell Module which can be installed using this code.&lt;/p&gt;
&lt;p&gt;# Install Module&lt;br&gt;
Install-Module -Name ExchangeOnlineManagement&lt;/p&gt;
&lt;p&gt;# Connect to Exchange Online&lt;br&gt;
Connect-ExchangeOnline&lt;/p&gt;
&lt;p&gt;To store the group object in &lt;code&gt;$group&lt;/code&gt; we simply need to query a group like this.&lt;/p&gt;
&lt;p&gt;# Get group properties&lt;br&gt;
$group = Get-UnifiedGroup -Identity &lt;a class=&#34;link&#34; href=&#34;mailto:TeamCreatedinTACPublic@mvplab.ch&#34; &gt;TeamCreatedinTACPublic@mvplab.ch&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;To disable the welcome email, which is sent to new group members, use this code.&lt;/p&gt;
&lt;p&gt;# Disable welcome message for new group members&lt;br&gt;
Set-UnifiedGroup -Identity $group.Identity -UnifiedGroupWelcomeMessageEnabled $false&lt;/p&gt;
&lt;p&gt;If a Team has been created in the Teams Client, you can use this code to unhide the group from Outlook.&lt;/p&gt;
&lt;p&gt;# Unhide group from Outlook clients&lt;br&gt;
Set-UnifiedGroup -Identity $group.Identity -HiddenFromExchangeClientsEnabled:$false&lt;/p&gt;
&lt;p&gt;To allow external email addresses to send emails to the group email address, use this code.&lt;/p&gt;
&lt;p&gt;# Enable let people outside this organization email this group&lt;br&gt;
Set-UnifiedGroup -Identity $group.Identity -RequireSenderAuthenticationEnabled:$false&lt;/p&gt;
&lt;p&gt;To change the privacy of a group use either &lt;strong&gt;Private&lt;/strong&gt; or &lt;strong&gt;Public&lt;/strong&gt; as a value for the &lt;code&gt;-AccessType&lt;/code&gt; parameter.&lt;/p&gt;
&lt;p&gt;# Change access type to private&lt;br&gt;
Set-UnifiedGroup -Identity $group.Identity -AccessType &amp;ldquo;Private&amp;rdquo;&lt;/p&gt;
&lt;p&gt;To keep owners and members in sync or rather to make sure that all owners are added as members too, you can use this code.&lt;/p&gt;
&lt;p&gt;# Add group owners to group members if not already there&lt;br&gt;
Connect-MgGraph&lt;/p&gt;
&lt;p&gt;$group = Get-MgGroup -GroupId &amp;ldquo;&lt;GUID&gt;&amp;rdquo;&lt;/p&gt;
&lt;p&gt;$groupOwners = Get-MgGroupOwner -All -GroupId $group.Id&lt;br&gt;
$groupMembers = Get-MgGroupMember -All -GroupId $group.Id&lt;/p&gt;
&lt;p&gt;foreach ($groupOwner in $groupOwners | Where-Object {$_.Id -notin $groupMembers.Id}) {&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;New-MgGroupMember -GroupId $group.Id -DirectoryObjectId $groupOwner.Id  
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;p&gt;Note: This uses the &lt;strong&gt;Microsoft.Graph.Groups&lt;/strong&gt; PowerShell module and not &lt;strong&gt;ExchangeOnlineManagement&lt;/strong&gt;.&lt;/p&gt;
&lt;h3 id=&#34;closing-words&#34;&gt;Closing Words
&lt;/h3&gt;&lt;p&gt;I hope that this article and the comparison chart help you to better understand why some groups might have different settings than others. I also recommend to always add all owners as explicit members too, whenever you assign owners to a group. Hopefully, the last code snippet will make things easier for you to accomplish this.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Translate Microsoft 365 License GUIDs to Product Names in PowerShell</title>
        <link>https://heusser.pro/p/translate-microsoft-365-license-guids-to-product-names-in-powershell-e8fa373ace16/</link>
        <pubDate>Fri, 02 Jun 2023 19:57:48 +0000</pubDate>
        
        <guid>https://heusser.pro/p/translate-microsoft-365-license-guids-to-product-names-in-powershell-e8fa373ace16/</guid>
        <description>&lt;p&gt;Working with Microsoft 365 and Azure AD licenses and understanding them can be quite the task for many system administrators. Did you know that the official &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/azure/active-directory/enterprise-users/licensing-service-plan-reference&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Microsoft Learn article&lt;/a&gt; lists more than &lt;strong&gt;3230&lt;/strong&gt; different SKU IDs and names as of June 1st 2023?&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/translate-microsoft-365-license-guids-to-product-names-in-powershell-e8fa373ace16/00pCCCvKg0Z8d8u1L.jpg&#34;
	width=&#34;1024&#34;
	height=&#34;1024&#34;
	srcset=&#34;https://heusser.pro/p/translate-microsoft-365-license-guids-to-product-names-in-powershell-e8fa373ace16/00pCCCvKg0Z8d8u1L_hu_c250dddf0912feb8.jpg 480w, https://heusser.pro/p/translate-microsoft-365-license-guids-to-product-names-in-powershell-e8fa373ace16/00pCCCvKg0Z8d8u1L_hu_d42a5c5efffb6537.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;100&#34;
		data-flex-basis=&#34;240px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The problem is that Graph or PowerShell Modules never return a product name that actually means something to an admin. The names you’ll see there are not the same ones we’re used to from the Azure or M365 Admin Portals.&lt;/p&gt;
&lt;p&gt;Let’s take a look at what the &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/graph/api/subscribedsku-list?view=graph-rest-1.0&amp;amp;tabs=http&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;strong&gt;subscribedSkus&lt;/strong&gt;&lt;/a&gt; Graph Endpoint returns. &lt;br&gt;
This is how we get a list of all SKUs a tenant is subscribed to.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$licenseSkus&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Header&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/subscribedSkus&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Obviously, most tenants have many different SKUs. For the sake of simplicity, I’ll just show the details of the last entry returned by Graph.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;PS C:\Temp\\GitHub\TeamsPhoneAutomation&amp;gt; $sku = $licenseSkus.value[-1]  
PS C:\Temp\\GitHub\TeamsPhoneAutomation&amp;gt; $sku  
  
  
accountName      : company  
accountId        : 4bffbf87-53a0-4fce-b58b-xxxxxxxxxxxx  
appliesTo        : User  
capabilityStatus : Enabled  
consumedUnits    : 7  
id               : 4bffbf87-53a0-4fce-b58b-xxxxxxxxxxxx_18181a46-0d4e-45cd-891e-60aabd171b4e  
skuId            : 18181a46-0d4e-45cd-891e-60aabd171b4e  
skuPartNumber    : STANDARDPACK  
subscriptionIds  : {3474312c-2333-47bc-9d87-da1cfcb75f85}  
prepaidUnits     : @{enabled=9; suspended=0; warning=0}  
servicePlans     : {@{servicePlanId=a82fbf69-b4d7-49f4-83a6-915b2cf354f4; servicePlanName=VIVAENGAGE_CORE; provisioningStatus=PendingProvisioning;   
                   appliesTo=User}, @{servicePlanId=199a5c09-e0ca-4e37-8f7c-b05d533e1ea2; servicePlanName=MICROSOFTBOOKINGS; provisioningStatus=Success;   
                   appliesTo=User}, @{servicePlanId=b76fb638-6ba6-402a-b9f9-83d28acb3d86; servicePlanName=VIVA_LEARNING_SEEDED; provisioningStatus=Success;   
                   appliesTo=User}, @{servicePlanId=db4d623d-b514-490b-b7ef-8885eee514de; servicePlanName=Nucleus; provisioningStatus=Success;   
                   appliesTo=Company}...}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The &lt;strong&gt;skuPartNumber&lt;/strong&gt; is what Microsoft calls &lt;strong&gt;String ID&lt;/strong&gt; on their learn article. As we all know, Microsoft is no stranger to changing or rebranding product names. I have never seen them change an skuPartNumber though. Even though we can count on that name staying the same, it most likely won’t mean much to most people. Now what the heck is a &lt;strong&gt;STANDARDPACK!?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;A quick search on the Microsoft Learn article will do the trick and give us the desired information. STANDARDPACK = Office 365 E1. &lt;br&gt;
But there’s a better way!&lt;/p&gt;
&lt;p&gt;What’s really nice is that Microsoft also provides a download link to a CSV file which contains all the SKUs, Ids and names. If it can be downloaded by using a browser, it can also be downloaded by PowerShell.&lt;/p&gt;
&lt;p&gt;All we need to do is &lt;code&gt;Invoke-RestMethod&lt;/code&gt; and use &lt;code&gt;| ConvertFrom-CSV&lt;/code&gt; to convert the retrieved content to a PowerShell object.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$translationTable&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://download.microsoft.com/download/e/3/e/e3e9faf2-f28b-490a-9ada-c6089a1fc5b0/Product%20names%20and%20service%20plan%20identifiers%20for%20licensing.csv&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ConvertFrom-Csv&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;The SKU information retrieved by graph is already in our &lt;code&gt;$sku&lt;/code&gt; variable. So, all that’s left to do is a simple one-liner to search the &lt;code&gt;$translationTable.GUID&lt;/code&gt; for a matching &lt;code&gt;$sku.skuId&lt;/code&gt; .&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$skuNamePretty&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$translationTable&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{$\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;GUID&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$sku&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skuId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Sort-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Product&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_Display&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_Name&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Unique&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Product&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_Display&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_Name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;This will translate the skuPartNumber to the familiar License name known from the admin portals.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;PS C:\Temp\GitHub\TeamsPhoneAutomation&amp;gt; $skuNamePretty  
Office 365 E1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I’ve put all the above code snippets together and created a little more sophisticated, yet still very basic script which will output a table with all the available license names. Please note that you’ll need an existing Azure AD App Registration/Service Principal which has at least the &lt;strong&gt;Organization.Read.All&lt;/strong&gt; Graph permission.&lt;/p&gt;
&lt;script src=&#34;https://gist.github.com/mozziemozz/174b665e5aa94cbd3c1421665032cbb0.js&#34;&gt;&lt;/script&gt;

&lt;p&gt;The output will look like this.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/translate-microsoft-365-license-guids-to-product-names-in-powershell-e8fa373ace16/1wQy6obQWLE2uVOhZjoPcw.png&#34;
	width=&#34;1014&#34;
	height=&#34;622&#34;
	srcset=&#34;https://heusser.pro/p/translate-microsoft-365-license-guids-to-product-names-in-powershell-e8fa373ace16/1wQy6obQWLE2uVOhZjoPcw_hu_3a1802f720b13e70.png 480w, https://heusser.pro/p/translate-microsoft-365-license-guids-to-product-names-in-powershell-e8fa373ace16/1wQy6obQWLE2uVOhZjoPcw_hu_cc430893832cc2a2.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;163&#34;
		data-flex-basis=&#34;391px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;As far as I understand, the download URL of the CSV should not be changed once a new version is uploaded. I verified this by viewing GitHubs &lt;a class=&#34;link&#34; href=&#34;https://github.com/MicrosoftDocs/azure-docs/commit/f75ae8190c08cffd5c73088b723226ece4176fc7&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;commit history for that article&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/translate-microsoft-365-license-guids-to-product-names-in-powershell-e8fa373ace16/1q9Oz2Udf4ttHNvk94SCEPQ.png&#34;
	width=&#34;1812&#34;
	height=&#34;799&#34;
	srcset=&#34;https://heusser.pro/p/translate-microsoft-365-license-guids-to-product-names-in-powershell-e8fa373ace16/1q9Oz2Udf4ttHNvk94SCEPQ_hu_6464ff59edccd92b.png 480w, https://heusser.pro/p/translate-microsoft-365-license-guids-to-product-names-in-powershell-e8fa373ace16/1q9Oz2Udf4ttHNvk94SCEPQ_hu_4c535eebbdf50cfe.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;226&#34;
		data-flex-basis=&#34;544px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;As you can see, even though the date in the note was updated, the URL stayed the same. That’s why it should be safe to assume that we won’t need to update that URL in any script where we download that list.&lt;/p&gt;
&lt;p&gt;If you’re wondering what my use case for this was… I was creating an Azure runbook which monitors remaining free licenses and sends alerts to a Teams channel in case any of the licenses fall below a certain threshold. Obviously, I wanted to mention the well-known license name and not the string ID returned by Graph on the messages sent to Teams. Thanks to the CSV file hosted by Microsoft my scripts can now always grab the latest data and use that to transalte any license GUID into something more recognizable.&lt;/p&gt;
&lt;p&gt;I hope that this helps you too create more robust and better scripts when you need to deal with licensing in MS Graph or PowerShell.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>How To Handle Password and 2FA Madness Like a Pro</title>
        <link>https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/</link>
        <pubDate>Sat, 26 Nov 2022 03:04:56 +0000</pubDate>
        
        <guid>https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/</guid>
        <description>&lt;p&gt;Every once in a while, I come across a random Twitter conversation where people share their struggles and frustrations about the current state of 2FA apps and migrating those codes to a new phone.&lt;/p&gt;
&lt;p&gt;This sparked a private discussion between &lt;a class=&#34;link&#34; href=&#34;https://twitter.com/AndresGorzelany&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Andrés Gorzelany&lt;/a&gt; and me where he asked me if I had written a blog post about this already. I hadn’t, so here we are.&lt;/p&gt;
&lt;p&gt;First, let’s cover some of the abbreviations which I’m going to use in this article.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2FA&lt;/strong&gt; = Second Factor Authentication &lt;br&gt;
&lt;em&gt;(Password is not enough, you need to either enter a one time code or verify a login in a mobile app)&lt;/em&gt;&lt;br&gt;
&lt;strong&gt;MFA&lt;/strong&gt; = Multi Factor Authentication &lt;br&gt;
&lt;em&gt;(Pretty much the same as 2FA, the term is primarily used by Microsoft)&lt;/em&gt;&lt;br&gt;
&lt;strong&gt;OTP&lt;/strong&gt; = One Time Password&lt;br&gt;
_(Usually, a 6 to 8 digit long code received by email or SMS which can only be used once)&lt;br&gt;
_&lt;strong&gt;TOTP&lt;/strong&gt; = Time Based One Time Password&lt;br&gt;
&lt;em&gt;(Usually, a 6 to 8 digit long code which gets generated (and hashed against the current time) by an app. Usually, every code is only valid for 30 seconds)&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;microsoft-authenticator&#34;&gt;Microsoft Authenticator
&lt;/h3&gt;&lt;p&gt;I’m sure that many IT Pros use &lt;a class=&#34;link&#34; href=&#34;https://apps.apple.com/us/app/microsoft-authenticator/id983156458&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Microsoft Authenticator&lt;/a&gt; for all or most of their 2FA codes because that’s what they first used, when MFA was initially required by the company they work for. As of drafting this article, the app currently sits on #7 in Productivity on Apple’s App Store, so I assume it’s quite popular.&lt;/p&gt;
&lt;h4 id=&#34;account-setup&#34;&gt;Account Setup
&lt;/h4&gt;&lt;p&gt;If you head over to &lt;a class=&#34;link&#34; href=&#34;https://mysignins.microsoft.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://mysignins.microsoft.com/&lt;/a&gt; you will be able to add or edit your MFA methods for a Microsoft work or school account.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1cklX2PhJurEPz0XDmzqvQw.png&#34;
	width=&#34;1542&#34;
	height=&#34;365&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1cklX2PhJurEPz0XDmzqvQw_hu_c912f0beade3a83a.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1cklX2PhJurEPz0XDmzqvQw_hu_e7eab10c00af119d.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;422&#34;
		data-flex-basis=&#34;1013px&#34;
	
&gt;
&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1gWZ6lvVge9MxPPIZ3jNag.png&#34;
	width=&#34;710&#34;
	height=&#34;312&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1gWZ6lvVge9MxPPIZ3jNag_hu_90cb0cac69db1375.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1gWZ6lvVge9MxPPIZ3jNag_hu_214a7b66c87e4e78.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;227&#34;
		data-flex-basis=&#34;546px&#34;
	
&gt;
&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1oTRkXMubTJO3zz66gTBdSg.png&#34;
	width=&#34;1068&#34;
	height=&#34;386&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1oTRkXMubTJO3zz66gTBdSg_hu_ee55f5485fc7f010.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1oTRkXMubTJO3zz66gTBdSg_hu_1cbe24750f3f20c7.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;276&#34;
		data-flex-basis=&#34;664px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If you click on &lt;em&gt;Next&lt;/em&gt;, your account will be added using the “Microsoft Authenticator” method. If you click on &lt;em&gt;I want to use a different authenticator app&lt;/em&gt; your account will be added as a “different authenticator app”.&lt;/p&gt;
&lt;p&gt;Let’s take a look at Microsoft Authenticator first.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1iwc5ewsVqKxfrJZpyGZNKQ.png&#34;
	width=&#34;1045&#34;
	height=&#34;645&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1iwc5ewsVqKxfrJZpyGZNKQ_hu_df45f1636e897bdb.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1iwc5ewsVqKxfrJZpyGZNKQ_hu_693f213f27c78655.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;162&#34;
		data-flex-basis=&#34;388px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If you just scan the QR code, you won’t notice any difference between the two options. The account will just be added.&lt;/p&gt;
&lt;p&gt;However, if you click on &lt;em&gt;Can’t scan image?&lt;/em&gt; More information will be revealed. Notice how there’s a code and an URL which also includes a code.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1MM5qGsmVCoTlFfz6hqw.png&#34;
	width=&#34;1014&#34;
	height=&#34;246&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1MM5qGsmVCoTlFfz6hqw_hu_3db4e04d70824238.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1MM5qGsmVCoTlFfz6hqw_hu_b100269f125f3102.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;412&#34;
		data-flex-basis=&#34;989px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;After adding the account, this sign in method will show as &lt;strong&gt;Microsoft Authenticator&lt;/strong&gt; under Security info.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1vUw5bgZWn5i3AHHS1cq2A.png&#34;
	width=&#34;1533&#34;
	height=&#34;355&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1vUw5bgZWn5i3AHHS1cq2A_hu_bdb22273eb3d41f4.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1vUw5bgZWn5i3AHHS1cq2A_hu_915eb3433e381a34.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;431&#34;
		data-flex-basis=&#34;1036px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If we do the same thing again but choose &lt;em&gt;different authenticator app&lt;/em&gt; this time, we can see that there’s just a &lt;strong&gt;Secret key&lt;/strong&gt; but no URL anymore.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1gxdJiEm3V5bY9UWSWMW9zw.png&#34;
	width=&#34;1001&#34;
	height=&#34;189&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1gxdJiEm3V5bY9UWSWMW9zw_hu_e321952177998b33.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1gxdJiEm3V5bY9UWSWMW9zw_hu_cf80ed74fa1ea454.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;529&#34;
		data-flex-basis=&#34;1271px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If we look at the sign in methods again, we can see that the second one is called &lt;strong&gt;Authenticator App&lt;/strong&gt; even though we also added it to the Microsoft Authenticator App.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1mG8IBsBGe6qAhWgPgyH5bA.png&#34;
	width=&#34;1524&#34;
	height=&#34;427&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1mG8IBsBGe6qAhWgPgyH5bA_hu_63a224da89493042.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1mG8IBsBGe6qAhWgPgyH5bA_hu_2945362e69d33465.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;356&#34;
		data-flex-basis=&#34;856px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;When we look at the mobile app itself, we can also see some differences between these two accounts. The App knows that the first one is a Microsoft work or school account. But it has absolutely no idea that the second one is in fact also a work or school account or even that it’s the same account.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1h5rb2kwBLtxLfgZjmxYTw.png&#34;
	width=&#34;750&#34;
	height=&#34;1334&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1h5rb2kwBLtxLfgZjmxYTw_hu_64ead55d9a8cd01c.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1h5rb2kwBLtxLfgZjmxYTw_hu_f739d82f21e31a4.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;56&#34;
		data-flex-basis=&#34;134px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;It’s even clearer on the details page of each account. And because both accounts were added using different secrets, they also generate different codes.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1UB42dCXf3Ct533AiYGOBQ.png&#34;
	width=&#34;1498&#34;
	height=&#34;1067&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1UB42dCXf3Ct533AiYGOBQ_hu_4c47dc3e9ad4a46b.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1UB42dCXf3Ct533AiYGOBQ_hu_5d0a7e17d43631f2.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;140&#34;
		data-flex-basis=&#34;336px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;backing-up-our-authenticator-app&#34;&gt;Backing up our Authenticator App
&lt;/h4&gt;&lt;p&gt;Switching phones has become increasingly complicated since 2FA has gotten so popular (where 2FA becoming a standard is a good thing).&lt;/p&gt;
&lt;p&gt;Backing up Microsoft Authenticator Data requires a personal Microsoft Account (outlook.com/live.com/hotmail.com).&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1loZR0pS5OVVtT78aPpRrDA.png&#34;
	width=&#34;750&#34;
	height=&#34;1334&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1loZR0pS5OVVtT78aPpRrDA_hu_30e3981d946f535a.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1loZR0pS5OVVtT78aPpRrDA_hu_b2161c20009af44c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;56&#34;
		data-flex-basis=&#34;134px&#34;
	
&gt;
&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1oI230pk3tWEcv7Qmi2fow.png&#34;
	width=&#34;1497&#34;
	height=&#34;795&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1oI230pk3tWEcv7Qmi2fow_hu_951c016827688b67.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1oI230pk3tWEcv7Qmi2fow_hu_7e51971658c8e7bf.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;188&#34;
		data-flex-basis=&#34;451px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;restoring-microsoft-authenticator&#34;&gt;&lt;strong&gt;Restoring Microsoft Authenticator&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;If the app is deleted or if you switch phones, you can restore from your backup.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1I4VPjVxbWbjEHstl1WeZg.png&#34;
	width=&#34;1489&#34;
	height=&#34;1332&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1I4VPjVxbWbjEHstl1WeZg_hu_e22adc21d797068d.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1I4VPjVxbWbjEHstl1WeZg_hu_603207f315fa6267.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;111&#34;
		data-flex-basis=&#34;268px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;And there it is: a big red warning appears for the work or school account we added using the Microsoft Authenticator method. The generic code was restored just fine.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/12xH4t91wnijwWl0r6Xfw.png&#34;
	width=&#34;750&#34;
	height=&#34;1334&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/12xH4t91wnijwWl0r6Xfw_hu_5c19ae5b182cc3f3.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/12xH4t91wnijwWl0r6Xfw_hu_3a0eba0a244dfcf7.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;56&#34;
		data-flex-basis=&#34;134px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;From what I could observe online, many people seemed annoyed (understandably) that there’s an action required for each work or school account which was added using the Microsoft Authenticator method.&lt;/p&gt;
&lt;p&gt;To be honest, I don’t know if there’s a specific QR code to recover the account. To me it seems more like that the backup only stores your email address and that you need to go through the setup again on a new device.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1ZHcT91WwAGsIFVT5foO31w.png&#34;
	width=&#34;750&#34;
	height=&#34;1334&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1ZHcT91WwAGsIFVT5foO31w_hu_7e6337985bdbef70.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1ZHcT91WwAGsIFVT5foO31w_hu_62df1dff04bab7c2.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;56&#34;
		data-flex-basis=&#34;134px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;To restore it, go back to the My-Sign-Ins page and add the Microsoft Authenticator App again.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/10O59nIbYIkqQvOtrLMoGvg.png&#34;
	width=&#34;1526&#34;
	height=&#34;501&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/10O59nIbYIkqQvOtrLMoGvg_hu_55fa3d3e664e96dc.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/10O59nIbYIkqQvOtrLMoGvg_hu_219ca82c3bbca220.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;304&#34;
		data-flex-basis=&#34;731px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The same is also possible from this website: &lt;a class=&#34;link&#34; href=&#34;https://aka.ms/mfasetup&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://aka.ms/mfasetup&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1baOzZjJDNtR5vt8cDPUnNA.png&#34;
	width=&#34;1404&#34;
	height=&#34;1270&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1baOzZjJDNtR5vt8cDPUnNA_hu_bdc7726a4fed7838.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1baOzZjJDNtR5vt8cDPUnNA_hu_788b962094b086fb.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;110&#34;
		data-flex-basis=&#34;265px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The &lt;em&gt;Restore&lt;/em&gt; button at the bottom of this page didn’t do anything for me. Since it’s a new device, you need to add it again.&lt;/p&gt;
&lt;p&gt;If you deleted the app on your current phone and restore the backup to the same device, the old registration will stop working. In this case, both Authenticator apps will have the same description in the portal. Delete the one which is sorted last in the list. If you got a new phone and don’t use your old phone anymore or if you’ve lost it, you can delete it from the sign-in methods.&lt;/p&gt;
&lt;p&gt;If MFA is enforced by your organization, and if you’re not currently excluded from MFA prompts like you maybe would be in an office building/network you may need to provide an alternative 2FA method like an OTP received by SMS or email if you’re not already logged in on your desktop. If you still have your old phone at hand, you can also use the Microsoft Authenticator from there to approve the sign in.&lt;/p&gt;
&lt;p&gt;This example just shows one work or school account for demonstration purposes. Just imagine that you work for dozens of companies as a consultant or freelancer… In this case, you would need to repeat these steps in all of their tenants in order to recover your accounts.&lt;/p&gt;
&lt;p&gt;Microsoft Authenticator only backs up 2FA codes for generic accounts and your personal Microsoft Account. All work or school accounts that were added using the Microsoft Authenticator method require that you go through the setup again. Basically, only the account name, tenant name and user principal name will be restored but not the trust relationship itself.&lt;/p&gt;
&lt;h4 id=&#34;2fa-codes-from-otherservices&#34;&gt;2FA Codes From Other Services
&lt;/h4&gt;&lt;p&gt;2FA is without doubt a great mechanism for securing your accounts and online identities. It should be used wherever possible. Without exceptions.&lt;/p&gt;
&lt;p&gt;Microsoft even advertises their Authenticator App as an App in which you can store all your 2FA codes on the App Store.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1nVlZbzfDSWyem4SdQhpqxQ.png&#34;
	width=&#34;1494&#34;
	height=&#34;757&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1nVlZbzfDSWyem4SdQhpqxQ_hu_8f185811a37a8432.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1nVlZbzfDSWyem4SdQhpqxQ_hu_6a5935cae9084765.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;197&#34;
		data-flex-basis=&#34;473px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If you’re going all-in on 2FA and want to potentially store hundreds of 2FA codes, you should seriously consider not using Microsoft Authenticator for that.&lt;/p&gt;
&lt;p&gt;Can you believe it? A statement like that from a Microsoft fan as big as me? The first thing you need to think about is that you will either need to read the code from the app and type it on your PC or you need to copy it from the app. Either way you need to find it in the app. Although Microsoft has recently added a search function to the app (which was long overdue to be honest) there’s still no option to create folders to better manage your accounts.&lt;/p&gt;
&lt;p&gt;The second thing you should consider is lock-in. Once you’ve added all your 2FA codes to Microsoft Authenticator, you can only restore them to another Microsoft Authenticator app. Unless you explicitly save the secret key to a safe place every time you add an account, you won’t be able to extract those secrets again after they’ve been added to Microsoft Authenticator. If you didn’t do that and you want to move them to another app, for example to &lt;a class=&#34;link&#34; href=&#34;https://apps.apple.com/us/app/google-authenticator/id388497605&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Google Authenticator&lt;/a&gt; or &lt;a class=&#34;link&#34; href=&#34;https://apps.apple.com/us/app/twilio-authy/id494168017&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Twilio Authy&lt;/a&gt;, you will need to log into each service and setup 2FA again for the new app. Much like we need to do if we want to move a Microsoft work or school account to a new device.&lt;/p&gt;
&lt;p&gt;On top of all that, finding and copying or typing 2FA codes is not a good user experience. Some services even force their users to use their specific authenticator app. In these cases, apps like these often support push notifications like Microsoft Authenticator does. While just tapping a button on the phone to verify a login is certainly a better experience than searching for a code and then typing it on your PC, having dozens of service-specific authenticator apps is not a viable solution either.&lt;/p&gt;
&lt;p&gt;On the plus side, it’s great that Microsoft Authenticator offers a backup capability. Google Authenticator for example still doesn’t support backups. It only supports exporting your data via a QR code to another Google Authenticator App. The problem with that is that your codes will be lost if you lose your device.&lt;/p&gt;
&lt;p&gt;Authy also offers backing up your 2FA codes. While Microsoft Authenticator requires a personal Microsoft Account to back up your data, Authy uses a separate password to protect your backup. But the lock-in problem remains. Since you can’t retrieve the secret keys from all these Authenticator Apps, your only option of migrating to another app is to go through the 2FA setup for each account again.&lt;/p&gt;
&lt;p&gt;I think not exposing the secret keys after an account has been added makes sense for most users since secret keys need to be handled with absolute caution. If a secret key gets into the wrong hands, a malicious actor could generate the same TOTPs as you without you even knowing.&lt;/p&gt;
&lt;p&gt;Here I’ve used the same secret/QR code to add an account to both Microsoft and Google Authenticator.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1ecWsxhP48aEhfo2vGa0VUg.png&#34;
	width=&#34;1494&#34;
	height=&#34;702&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1ecWsxhP48aEhfo2vGa0VUg_hu_fb97bcfb645fc1aa.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1ecWsxhP48aEhfo2vGa0VUg_hu_434e8a86308ed774.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;212&#34;
		data-flex-basis=&#34;510px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;upping-your-2fagame&#34;&gt;Upping Your 2FA Game
&lt;/h3&gt;&lt;p&gt;So far, we’ve established that using 2FA is a good thing. But we’ve also seen that it can come at the cost of convenience which might put a lot of users off from using it. Weighing security against convenience is an extremely hard decision. But I have found a way wich works well for me and I’m confident that it will work well for others too.&lt;/p&gt;
&lt;p&gt;I know Microsoft, 1Password and other industry leaders are all talking about getting rid of passwords entirely but in reality, we’re just not there yet.&lt;/p&gt;
&lt;p&gt;Another advantage of Microsoft Authenticator compared to other authenticator apps is that it now also offers password synchronization from Edge and auto-fill capabilities on mobile devices. While this is a good feature for many non tech savvy users, it’s still way worse than what a full-fledged password manager can offer. And by that, I mean &lt;a class=&#34;link&#34; href=&#34;https://bitwarden.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Bitwarden&lt;/a&gt;.&lt;/p&gt;
&lt;h4 id=&#34;bitwarden&#34;&gt;Bitwarden
&lt;/h4&gt;&lt;p&gt;Bitwarden differentiates itself quite a bit from competing services. First of all, it’s completely open source but still backed by a commercial company. While password managers like 1 Password, Dashlane or LastPass are all running on AWS Bitwarden runs on &lt;a class=&#34;link&#34; href=&#34;https://bitwarden.com/help/is-bitwarden-audited/#cloud-hosting&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Azure&lt;/a&gt;. But most importantly, Bitwarden allows self-hosting for those who wish to do so. This means that you can be in control of your own vault data but won’t miss out on any of the awesome features like access and sync from anywhere, awesome mobile apps or browser extensions including auto-fill or even Windows Hello and Touch/FaceID support.&lt;/p&gt;
&lt;p&gt;And then there’s the super fair &lt;a class=&#34;link&#34; href=&#34;https://bitwarden.com/pricing/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;pricing options&lt;/a&gt;. Unlike many other password managers, their free tier supports unlimited passwords and devices and will stay free forever. It even supports vault sharing with one other user. This is because Bitwarden simply believes that anybody should be able to store their passwords securely and freely.&lt;/p&gt;
&lt;p&gt;Their premium tier which also supports storing and generating 2FA codes only costs 10$ per year. By the way, I’m not sponsored by them in any way, but I’d gladly pay the 10$ per year even if the free version also included advanced 2FA features just to support their cause.&lt;/p&gt;
&lt;h4 id=&#34;putting-all-your-eggs-in-onebasket&#34;&gt;Putting All Your Eggs in One Basket
&lt;/h4&gt;&lt;p&gt;Let’s get to the technical part. Using a password manager means that you will be storing all your passwords in the same place. People often refer to this as putting all your eggs in one basket. It’s a risk for sure but remembering hundreds of complex passwords is definitely not an option. And using more or less the same password for each website isn’t either.&lt;/p&gt;
&lt;p&gt;I’ve had arguments about this where people claimed that there’s no real difference between using a master password to protect all your passwords or using the same password for each website. This not the case at all. Imagine if you use the same password for each website and one of those sites gets hacked and your password gets leaked on the internet. The chance of a password being compromised by a random website you signed up for is much higher than the chance of someone getting a hold of your master password.&lt;/p&gt;
&lt;p&gt;Besides, the master password is not the only thing needed to get into the vault of any sane person. You also need a 2FA code or a physical security key to access the vault. I think it was on Reddit where someone said that they call this &lt;strong&gt;“Staged 2FA”.&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;using-a-password-manager-as-an-authenticator-app&#34;&gt;Using a Password Manager as an Authenticator App
&lt;/h4&gt;&lt;p&gt;Maybe you think that I must be crazy for not only storing all my passwords but almost all of my 2FA codes in the same place as well. Bear with me and let me explain why I think that this is a good idea.&lt;/p&gt;
&lt;p&gt;The idea of a second factor is that you need an additional physical device which generates a one-time code. This applies if you for example want to log into a website on your PC and then use the TOTP which only your phone/app can generate. But nowadays so much more is done on mobile devices too. So, if I log in to outlook.com on my phone, I don’t technically have a second factor since I can approve the sign-in request on the same device. In fact, if you think about it, most people probably have an app for their password manager and Microsoft Authenticator or another authenticator app on their phone which both can be unlocked biometrically.&lt;/p&gt;
&lt;p&gt;If somebody wants to access your 2FA codes, they need access to your phone anyway. If they already have access to your phone, does it really matter if they get the 2FA codes from the Microsoft Authenticator App or from the password manager? Of course, this is a hypothetical worst-case scenario as physical violence or serious threats could be involved in order to get you to unlock your phone and apps with biometrics.&lt;/p&gt;
&lt;p&gt;The key difference between storing your 2FA codes in an authenticator app or in a password manager is that a hacker would always need physical access to your phone if they’re stored in an authenticator app. But even if an attacker would be able to get these codes, the passwords which are protected in the password manager are still needed.&lt;/p&gt;
&lt;p&gt;To get into the password manager, the uncrackable (at least until quantum computing becomes mainstream) master password is needed. Even if that had been obtained by somebody, physical access to my unlocked phone would still be needed. The way I see it, what really needs to be protected is the phone. Instead of only being a second factor it actually has become the weakest link since it often holds passwords and 2FA codes, regardless of if they’re accessible in different apps.&lt;/p&gt;
&lt;h4 id=&#34;security-concept&#34;&gt;Security Concept
&lt;/h4&gt;&lt;p&gt;My security concept consists of two main security elements as I call them. One of them is Bitwarden, the other one is my personal Microsoft Account. Well, basically there’s also a third one which is my Apple Id (which of course is 2FA enabled as well). I don’t store anything from my Microsoft Account in Bitwarden. This is absolutely crucial. Even if a hacker would somehow get temporarily into my vault, they would not be able to take full control over it since they can’t get the 2FA code for the Bitwarden login. To get to the 2FA code, somebody would need to manage to sign into an iPhone with my Apple Id, restore the backup of my Microsoft Authenticator App from iCloud and then log into my Microsoft Account where both the Apple Id and my Microsoft Account are 2FA enabled and neither of the codes are stored in Bitwarden. All account related settings must be done in the Bitwarden Web Vault for which 2FA is required. The 2FA code for Bitwarden is only stored in my Microsoft Authenticator App. In my Microsoft Account there’s no information regarding Bitwarden except for the 2FA code (without the secret key). This means I only need to remember two complex passwords where the master password of Bitwarden is extremely complex (50+ characters).&lt;/p&gt;
&lt;p&gt;I only enter my master password about once per month to make sure that I don’t forget it. (I do have a backup plan in case I should forget it.) All the other times, I just use biometric authentication on Windows and iOS. Not using or typing the master password reduces the risk of it being obtained by anybody.&lt;/p&gt;
&lt;p&gt;I trust that my devices are secure, therefore I only use biometric authentication and choose to stay logged in (only biometric auth required) until I explicitly sign out of my Bitwarden Vault. This on the other hand exposes my PC to the same risk as my smartphone. If somebody puts a gun to my head and asks me to unlock Bitwarden on my Phone or my PC, they’d get everything. I’m sure I’ll have bigger problems than that if that should ever happen.&lt;/p&gt;
&lt;p&gt;As long as we’re excluding attack scenarios where a malicious actor physically attacks us or forces us to unlock our devices and apps, it doesn’t really matter if you store passwords and 2FA codes in the same place. I mean if we’re talking that somebody is targeting you remotely. They can’t get into your vault by using your master password unless they also have access to your authenticator app on your phone, which does exactly what it should — being a second factor.&lt;/p&gt;
&lt;h4 id=&#34;convenience-of-having-2fa-codes-stored-in-bitwarden&#34;&gt;Convenience of Having 2FA Codes Stored in Bitwarden
&lt;/h4&gt;&lt;p&gt;Let’s talk about some positive stuff. There are lots of advantages from a convenience point of view by storing all your 2FA codes (except Microsoft Account, Bitwarden and iCloud 2FA) in your password manager.&lt;/p&gt;
&lt;p&gt;There’s no tedious searching for accounts/codes and no annoying typing of 6-digit codes each time you want to log into a website. Matching accounts will autmatically be detected by a websites base URL. All you have to do is to choose a matching account for any particular website and press Ctrl + V after the username and password have been auto-filled.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1bOQpqyUFe92Ujs56MwkIEQ.png&#34;
	width=&#34;1505&#34;
	height=&#34;576&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1bOQpqyUFe92Ujs56MwkIEQ_hu_f576f2e5aaf03c3.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1bOQpqyUFe92Ujs56MwkIEQ_hu_6ecfc026b3e73c42.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;261&#34;
		data-flex-basis=&#34;627px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I find that auto-fill with automatic copy/paste of the 2FA is actually even faster than approving a sign-in request on your phone. If you’re using a randomly generated password which is impossible to memorize, you need to use your password manager anyway. Thus, you might as well paste the 2FA code from the password manager as well. When you log into a website or an app on your PC, grabbing your mobile phone is only going to break your flow since you need to pick it up or even take it out of your pants. I for one always choose Bitwarden auto-fill over accepting sign-in requests on my phone.&lt;/p&gt;
&lt;h4 id=&#34;secret-key-management-in-bitwarden&#34;&gt;Secret Key Management in Bitwarden
&lt;/h4&gt;&lt;p&gt;If you wish, you can also just store a TOTP without an associated password.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1OAhirvPr9CBNblaE87Bfw.png&#34;
	width=&#34;636&#34;
	height=&#34;891&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1OAhirvPr9CBNblaE87Bfw_hu_5215e0b77d25fe6d.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1OAhirvPr9CBNblaE87Bfw_hu_aa368b049758fcae.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;71&#34;
		data-flex-basis=&#34;171px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;You can safely store secret keys and can always access them again if you want to move them to another app. There’s no need to sign into a website and setup 2FA again. You are your own master of keys.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1Xm0GomzXQCGkjICW8yKWoQ.png&#34;
	width=&#34;636&#34;
	height=&#34;891&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1Xm0GomzXQCGkjICW8yKWoQ_hu_5af555c11bbfcee4.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1Xm0GomzXQCGkjICW8yKWoQ_hu_7b0e0e5fca328aaa.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;71&#34;
		data-flex-basis=&#34;171px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If you’re the type of person who likes to organize stuff, you can create as many folders as you like and sort your credentials to fit your needs.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1OrrRoyMiBrT2xIjbee9g.png&#34;
	width=&#34;634&#34;
	height=&#34;891&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1OrrRoyMiBrT2xIjbee9g_hu_bc6c3b3383965460.png 480w, https://heusser.pro/p/how-to-handle-password-and-2fa-madness-like-a-pro-1647abaf96e6/1OrrRoyMiBrT2xIjbee9g_hu_6124829478e11b8b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;71&#34;
		data-flex-basis=&#34;170px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;multiple-bitwarden-vaults&#34;&gt;Multiple Bitwarden Vaults
&lt;/h4&gt;&lt;p&gt;If the idea of storing passwords and 2FA codes in the same place creeps you out, and you don’t mind manually copying or typing in 2FA codes, you could also consider creating a second Bitwarden Vault (account) with a different master password. With this approach you will lose a lot of convenience and ease of use but a dedicated password manager with support for 2FA codes still provides much more freedom and functionality than a classic authenticator app. But if we’re honest with each other you’re probably going to end up with both vaults synced to your phone anyway.&lt;/p&gt;
&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion
&lt;/h3&gt;&lt;p&gt;If you’re struggling with your password and 2FA management and finding your current usability questionable I recommend the following basic principles to make your life a little easier.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Use Microsoft Authenticator only for your personal Microsoft Account, for your main work or school account and for the 2FA code of your password manager. Keep it clean.&lt;/li&gt;
&lt;li&gt;Add all other 2FA codes to your password manager.&lt;/li&gt;
&lt;li&gt;Choose a super strong master password and type it only as often as necessary.&lt;/li&gt;
&lt;li&gt;Use biometric authentication whenever possible.&lt;/li&gt;
&lt;li&gt;Enable 2FA for your password manager.&lt;/li&gt;
&lt;li&gt;Use 2FA wherever possible without any exceptions.&lt;/li&gt;
&lt;li&gt;Make sure that you always have a backup plan in case you forget your master password, or you lose your phone.&lt;/li&gt;
&lt;li&gt;Never save your Microsoft Account password or 2FA code to your password manager.&lt;/li&gt;
&lt;li&gt;Use a different, strong, randomly generated password for each website.&lt;/li&gt;
&lt;li&gt;Follow me on Medium.&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        <item>
        <title>How To Handle Microsoft Graph Paging in PowerShell</title>
        <link>https://heusser.pro/p/how-to-handle-microsoft-graph-paging-in-powershell-354663d4b32a/</link>
        <pubDate>Tue, 11 Oct 2022 16:10:04 +0000</pubDate>
        
        <guid>https://heusser.pro/p/how-to-handle-microsoft-graph-paging-in-powershell-354663d4b32a/</guid>
        <description>&lt;p&gt;Even though Microsoft Graph has been around for some years now, I’m going out on a limb here and say that it’s still quite new to a lot of engineers. This article won’t cover basic topics like what Graph is or how to get started. It focuses on a rather specific topic with which I struggled with at first: &lt;strong&gt;pagination (also known as paging&lt;/strong&gt;).&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-microsoft-graph-paging-in-powershell-354663d4b32a/1Wt4AThn1lsDlW0eFYohd9g.jpeg&#34;
	width=&#34;2288&#34;
	height=&#34;2037&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-microsoft-graph-paging-in-powershell-354663d4b32a/1Wt4AThn1lsDlW0eFYohd9g_hu_d43f6fda6b77d574.jpeg 480w, https://heusser.pro/p/how-to-handle-microsoft-graph-paging-in-powershell-354663d4b32a/1Wt4AThn1lsDlW0eFYohd9g_hu_57b2731c92eefcb4.jpeg 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;112&#34;
		data-flex-basis=&#34;269px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;As the name suggests, we’re talking about multiple pages of results, if a response is too large for one request/response or if the page size is “hardcoded” by Microsoft. Microsoft also offers a &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/odata/client/pagination&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;dedicated article&lt;/a&gt; on Microsoft Learn about that.&lt;/p&gt;
&lt;p&gt;For example, if we want to query all the users in an Azure AD tenant and that tenant has 10&#39;000 users, it wouldn’t make sense to return all these objects in a single request.&lt;/p&gt;
&lt;p&gt;Let’s continue with the example of querying an organization’s Azure AD users. The official documentation, which also includes a note about the default page size can be found &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/graph/api/user-list?view=graph-rest-1.0&amp;amp;tabs=http#optional-query-parameters&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The default and maximum page sizes are 100 and 999 user objects respectively.&lt;/p&gt;
&lt;p&gt;This means that if we make a request like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$aadUsers2&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/users&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Header&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Graph will only return the first 100 users, even though we didn’t include any filter in the request URL.&lt;/p&gt;
&lt;p&gt;If there are less than 100 users, all users will be returned of course. We can see that this is the case because the variable &lt;code&gt;$aadUsers2&lt;/code&gt; does not contain an &lt;code&gt;@odata.nextLink&lt;/code&gt; property.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-microsoft-graph-paging-in-powershell-354663d4b32a/1BcaLfQ6GqY3RFXEIseFjGQ.png&#34;
	width=&#34;913&#34;
	height=&#34;148&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-microsoft-graph-paging-in-powershell-354663d4b32a/1BcaLfQ6GqY3RFXEIseFjGQ_hu_d3723f9d2ebd2122.png 480w, https://heusser.pro/p/how-to-handle-microsoft-graph-paging-in-powershell-354663d4b32a/1BcaLfQ6GqY3RFXEIseFjGQ_hu_c925f318d875435c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;616&#34;
		data-flex-basis=&#34;1480px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Because Microsoft Graph uses the OData (&lt;a class=&#34;link&#34; href=&#34;https://www.odata.org/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Open Data Protocol&lt;/a&gt;) for their REST API, we can also specify the page size by including the &lt;code&gt;$top&lt;/code&gt; filter. In fact, I need to use this to simulate and demonstrate paging because I don’t have more than 100 users in my test tenant.&lt;/p&gt;
&lt;p&gt;In this example, I’m using &lt;code&gt;?`$top=5&lt;/code&gt; to make Graph only return 5 objects per page. The ` before the $ sign is needed to escape the character.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$aadUsers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/users?\&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;top=5&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Header&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Here we can see that the result now includes an &lt;code&gt;@odata.nextLink&lt;/code&gt; property. If a Get request is made to this URL, we will receive the next 5 users.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-handle-microsoft-graph-paging-in-powershell-354663d4b32a/1fPtkKakBcKkyHil6QVY9w.png&#34;
	width=&#34;1057&#34;
	height=&#34;134&#34;
	srcset=&#34;https://heusser.pro/p/how-to-handle-microsoft-graph-paging-in-powershell-354663d4b32a/1fPtkKakBcKkyHil6QVY9w_hu_9ad7f6e88fcc2eec.png 480w, https://heusser.pro/p/how-to-handle-microsoft-graph-paging-in-powershell-354663d4b32a/1fPtkKakBcKkyHil6QVY9w_hu_50d056dc857f5a94.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;788&#34;
		data-flex-basis=&#34;1893px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;In a more realistic scenario, a tenant may have tens of thousands of Azure AD users though. So, setting the top filter to 999 is more realistic but still wouldn’t return all the users. But what if we really need to get all the users?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;How can we keep requesting the next page until we have received all the pages/objects?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I’ve come up with a very simple solution for this. We’ll just use a do-until loop in PowerShell which will keep requesting the next page via the URL returned by the &lt;code&gt;@odata.nextLink&lt;/code&gt; until there’s no &lt;code&gt;@odata.nextLink&lt;/code&gt; property anymore. Once it’s done, we’ll have all the users in the &lt;code&gt;$allPages&lt;/code&gt; variable. And finally, we set the initial variable &lt;code&gt;$aadUsers&lt;/code&gt; to the value of &lt;code&gt;$allPages&lt;/code&gt;.&lt;/p&gt;
&lt;script src=&#34;https://gist.github.com/mozziemozz/070c44a49274159f66c8b42fb3a2bbf1.js&#34;&gt;&lt;/script&gt;

&lt;p&gt;Please be aware that you will need to include your own Authorization Header before you are able to make any requests towards Microsoft Graph. A very comprehensive guide about that can be found &lt;a class=&#34;link&#34; href=&#34;https://adamtheautomator.com/powershell-graph-api/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt; for example.&lt;/p&gt;
&lt;p&gt;For most of these commands, like getting users, there are also PowerShell Modules and Cmdlets available. However, I like to use PowerShell web requests (&lt;code&gt;Invoke-RestMethod&lt;/code&gt; ) to reduce dependencies. This way, I don’t need to install any modules if I ever need to run this code from another system or a serverless Azure Function, for example.&lt;/p&gt;
&lt;p&gt;Let me know what you think. Do you think that’s useful, or have you found a better way to handle paging in Microsoft Graph?&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Everything You Ever Wanted to Know About Teams Resource Accounts</title>
        <link>https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/</link>
        <pubDate>Mon, 29 Aug 2022 19:45:51 +0000</pubDate>
        
        <guid>https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/</guid>
        <description>&lt;p&gt;Today we’re going to take a detailed look at Teams Resource Accounts.&lt;/p&gt;
&lt;p&gt;Resource Accounts are special Azure AD Objects (or Microsoft 365 User Accounts, if you will) which can only be created from Teams Admin Center or via Teams PowerShell. It’s not possible to create such an account in M365 Admin or Azure AD. What’s funny though is that they can only be deleted from M365 Admin or AAD but not from Teams Admin Center or Teams PowerShell.&lt;/p&gt;
&lt;h4 id=&#34;the-basics&#34;&gt;The Basics
&lt;/h4&gt;&lt;p&gt;Currently, there are two different types of so called first-party (Microsoft) Resource Accounts. Call Queues and Auto Attendants. These accounts are then associated with corresponding types of Voice App, which are again, Call Queues or Auto Attendants.&lt;/p&gt;
&lt;p&gt;Each Resource Account can only be associated with &lt;strong&gt;one&lt;/strong&gt; Voice App, but a Voice App can have multiple Resource Accounts associated. Just like with Teams users, each Resource Account can also only have &lt;strong&gt;one&lt;/strong&gt; phone number assigned. For example, you can have an Auto Attendant which has multiple Resource Accounts assigned, where each Resource Account has a phone number from a different country. This way you can have an Auto Attendant which serves customers across multiple countries, but each customer will be able to call a local number.&lt;/p&gt;
&lt;h4 id=&#34;how-to-create-a-resourceaccount&#34;&gt;How to Create a Resource Account
&lt;/h4&gt;&lt;p&gt;You can create new Resource Accounts from TAC. They are located under &lt;a class=&#34;link&#34; href=&#34;https://admin.teams.microsoft.com/company-wide-settings/resource-accounts&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Voice\Resource accounts&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are a few things to consider here. The first one is naming. If you have a complex call flow, chances are that you will have many Auto Attendants, Call Queues and Resource Accounts. I always use a prefix and suffix system.&lt;/p&gt;
&lt;p&gt;The Display Name is followed by the suffix “AA” or “CQ”. This way it will be easier to identify the correct Resource Account, when you associate it with a Voice App. The User Principal Name is led by the prefix “ra_aa_” or “ra_cq_” so that they can easily be filtered in AAD. Of course, this is only a suggestion, you’re free to name them however you want.&lt;/p&gt;
&lt;p&gt;Usually, I just use the *.onmicrosoft.com name of the Tenant as the domain suffix. External users won’t be able to interact with these kinds of accounts, so it doesn’t matter if you don’t use your default custom domain name.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1AWJTS0fgG35lia04bwh5w.png&#34;
	width=&#34;507&#34;
	height=&#34;614&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1AWJTS0fgG35lia04bwh5w_hu_72abebbc81982654.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1AWJTS0fgG35lia04bwh5w_hu_778cae4121beb826.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;82&#34;
		data-flex-basis=&#34;198px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Here are the &lt;a class=&#34;link&#34; href=&#34;https://docs.microsoft.com/en-us/powershell/module/skype/new-csonlineapplicationinstance?view=skype-ps&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;PowerShell equivalent commands&lt;/a&gt; to create Resoure Accounts.&lt;/p&gt;
&lt;p&gt;Auto Attendant:&lt;/p&gt;
&lt;p&gt;# App Id Auto Attendants: ce933385-9390-45d1-9512-c8d228074e07&lt;/p&gt;
&lt;p&gt;New-CsOnlineApplicationInstance -UserPrincipalName &amp;ldquo;ra_aa_example_ps@domain.com&amp;rdquo; -ApplicationId &amp;ldquo;ce933385-9390-45d1-9512-c8d228074e07&amp;rdquo; -DisplayName &amp;ldquo;Example PS AA&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Call Queues:&lt;/p&gt;
&lt;p&gt;# App Id Call Queues: 11cd3e2e-fccb-42ad-ad00-878b93575e07&lt;/p&gt;
&lt;p&gt;New-CsOnlineApplicationInstance -UserPrincipalName &amp;ldquo;ra_cq_example_ps@domain.com&amp;rdquo; -ApplicationId &amp;ldquo;11cd3e2e-fccb-42ad-ad00-878b93575e07&amp;rdquo; -DisplayName &amp;ldquo;Example PS CQ&amp;rdquo;&lt;/p&gt;
&lt;h4 id=&#34;searching-for-resourceaccounts&#34;&gt;Searching for Resource Accounts
&lt;/h4&gt;&lt;p&gt;If you want to return all Resource Accounts by PowerShell, the MicrosoftTeams Module 4.6.0 now supports a parameter to only return Resource Accounts: &lt;code&gt;Get-CsOnlineUser -AccountType ResourceAccount&lt;/code&gt; . If we didn’t include a prefix or a suffix, there’s currently no way to tell if the returned objects are Queues or Attendants.&lt;/p&gt;
&lt;p&gt;For that, we need to use&lt;code&gt;Get-CsOnlineApplicationInstance&lt;/code&gt; . This will return a list with some basic information like Display Name, UPN, Phone Number and Application Id.&lt;/p&gt;
&lt;h4 id=&#34;licensing-resourceaccounts&#34;&gt;Licensing Resource Accounts
&lt;/h4&gt;&lt;p&gt;A Resource Account must be licensed in the following cases:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If you want to assign a phone number to it&lt;/li&gt;
&lt;li&gt;If the Resource Accounts needs to be able to transfer calls to external numbers&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Update 29.01.2023&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Microsoft updated their documentation. From now on, &lt;strong&gt;every&lt;/strong&gt; Resource Account must be licensed, regardless of if a phone number is assigned or not. You can find more info &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/microsoftteams/manage-resource-accounts#assign-a-license&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;An easy way to ensure that every Teams Resource Account is licensed properly is to use a dynamic user Azure AD Group which automatically assigns the license. The easiest way to do so is to filter on the Department attribute.&lt;/p&gt;
&lt;p&gt;(user.department -eq &amp;ldquo;Microsoft Communication Application Instance&amp;rdquo;)&lt;/p&gt;
&lt;p&gt;If you need step-by-step instructions on how to create an Azure AD Group with a dynamic query, please consult &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739&#34; &gt;this&lt;/a&gt; article and just replace the query with the one above.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;/Update&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Update 06.02.2023&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Thanks to a reader &lt;a class=&#34;link&#34; href=&#34;https://medium.com/p/3c1dad7d67c&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;comment&lt;/a&gt;, it was brought to my attention, that group based licensing actually requires an Azure AD Premium P1 license, for any user which takes advantage of the feature. This is documented &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-licensing-whatis-azure-portal#licensing-requirements&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I don’t know if a resource account qualifies as “user” because they are resource account and sign-in blocked. If you want to be absolutely sure, I recommend that you have a P1 license for each resource account or that you contact your account manager at Microsoft and ask them about this.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;/Update&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Licensing can’t be done from TAC. We need to use AAD or M365 Admin. As we can see, the account “Example AA” has now been created in AAD.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1evT4xkagZq7LVOGeSDAn5w.png&#34;
	width=&#34;1759&#34;
	height=&#34;382&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1evT4xkagZq7LVOGeSDAn5w_hu_1cfcf1205a6d26ff.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1evT4xkagZq7LVOGeSDAn5w_hu_61e8e8ff6ed8af2f.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;460&#34;
		data-flex-basis=&#34;1105px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Because this is a special kind of account, it’s Sign-in blocked. This means that the account doesn’t support interactive sign-ins.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1juIc9FR7liYQzHJAbkhg.png&#34;
	width=&#34;854&#34;
	height=&#34;220&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1juIc9FR7liYQzHJAbkhg_hu_265aaf2a7578aa48.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1juIc9FR7liYQzHJAbkhg_hu_9df7e81643cdea8e.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;388&#34;
		data-flex-basis=&#34;931px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Another important info is that these accounts have “Microsoft Communication Application Instance” set as their department. Just leave this as it is and don’t change anything.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1LXbE3uikECfwcAvF4MvTkw.png&#34;
	width=&#34;819&#34;
	height=&#34;117&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1LXbE3uikECfwcAvF4MvTkw_hu_16956d3a632f79ac.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1LXbE3uikECfwcAvF4MvTkw_hu_694be2680a2ce643.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;700&#34;
		data-flex-basis=&#34;1680px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Based on my experience, it’s no problem to change its Display or User Principal Name though.&lt;/p&gt;
&lt;p&gt;If you want to assign a phone number to a Resource Account, you will need to assign a license to it. Microsoft has recently renamed the old license “Microsoft Teams Phone — Virtual User” to “Microsoft Teams Phone Resource Account”.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/17nSgscEOXkNkdAbl5pliw.png&#34;
	width=&#34;511&#34;
	height=&#34;87&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/17nSgscEOXkNkdAbl5pliw_hu_b439be7c6c6f5543.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/17nSgscEOXkNkdAbl5pliw_hu_72f8b876047e37ca.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;587&#34;
		data-flex-basis=&#34;1409px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;What’s really nice about these licenses, is that their free. &lt;a class=&#34;link&#34; href=&#34;https://docs.microsoft.com/en-us/microsoftteams/teams-add-on-licensing/virtual-user#resource-account-license-allocation&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;At least to some extent&lt;/a&gt;. If you have at least one Teams Phone license, you will get 25 Teams Phone Resource Account licenses for free. After that, you will get 1 Resource Account license for every 10 Teams Phone licenses. The “PowerShell Name” or rather the AccountSkuId of this license is still called “TenantName:PHONESYSTEM_VIRTUALUSER”. Unlike Teams Phone which needs a “base license” like a Business Premium or Enterprise E3, Resource Account licenses can be assigned as standalone licenses.&lt;/p&gt;
&lt;h4 id=&#34;how-to-assign-phone-numbers-to-resourceaccounts&#34;&gt;How to Assign Phone Numbers to Resource Accounts
&lt;/h4&gt;&lt;p&gt;Once you’ve assigned a license to a Resource Account you can either use TAC or PowerShell to assign a phone number to the account.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1vhe0ahawllXMWMWFpxQ.png&#34;
	width=&#34;498&#34;
	height=&#34;750&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1vhe0ahawllXMWMWFpxQ_hu_55e60d273539d31a.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1vhe0ahawllXMWMWFpxQ_hu_3a62d880cfb600d5.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;66&#34;
		data-flex-basis=&#34;159px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;For PowerShell, you can use the same command as you would with a normal user. You might stumble upon outdated articles which mention the following command.&lt;/p&gt;
&lt;p&gt;Set-CsOnlineApplicationInstance -Identity &amp;ldquo;ra_aa_example_ps@domain.com&amp;rdquo; -OnPremPhoneNumber +4144512xxxx&lt;/p&gt;
&lt;p&gt;The new one is the following:&lt;/p&gt;
&lt;p&gt;Set-CsPhoneNumberAssignment -Identity &amp;ldquo;ra_aa_example_ps@domain.com&amp;rdquo; -PhoneNumber +4144512xxxx -PhoneNumberType DirectRouting&lt;/p&gt;
&lt;p&gt;Even though the Resource Account now has a phone number assigned to it, the number won’t be active until the Resource Account is associated with a Voice App. We’ll get to that later.&lt;/p&gt;
&lt;h4 id=&#34;how-to-assign-a-voice-routing-policy-to-a-resourceaccount&#34;&gt;How to Assign a Voice Routing Policy to a Resource Account
&lt;/h4&gt;&lt;p&gt;If the Resource Account should be able to transfer calls to external PSTN numbers using Direct Routing, we will also need to assign a Voice Routing Policy to it. This can also be done from TAC. Select your Resource Account and click on Edit. Now choose your desired Voice Routing Policy and click Save.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1au4ToHQ2IwpJc3nIrDgPqQ.png&#34;
	width=&#34;511&#34;
	height=&#34;532&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1au4ToHQ2IwpJc3nIrDgPqQ_hu_ec906677b816c1bd.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1au4ToHQ2IwpJc3nIrDgPqQ_hu_b92c4944fce3040c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;96&#34;
		data-flex-basis=&#34;230px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Doing it with PowerShell is again, the same as if it was a normal user.&lt;/p&gt;
&lt;p&gt;Grant-CsOnlineVoiceRoutingPolicy -Identity &amp;ldquo;&lt;a class=&#34;link&#34; href=&#34;mailto:ra_aa_example_ps@domain.com&#34; &gt;ra_aa_example_ps@domain.com&lt;/a&gt;&amp;rdquo; -PolicyName &amp;ldquo;Test&amp;rdquo;&lt;/p&gt;
&lt;h4 id=&#34;how-to-change-the-type-of-a-resourceaccount&#34;&gt;How to Change the Type of a Resource Account
&lt;/h4&gt;&lt;p&gt;On that same “Edit resource account” window, it’s also possible to change the type of a Resource Account. This can also be done by PowerShell. Just use the &lt;a class=&#34;link&#34; href=&#34;https://docs.microsoft.com/en-us/powershell/module/skype/set-csonlineapplicationinstance?view=skype-ps&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Set-CsApplicationInstance&lt;/a&gt; cmdlet and include the &lt;code&gt;-Identity&lt;/code&gt; and &lt;code&gt;-ApplicationId&lt;/code&gt; parameters. Even though this should work in theory, I haven’t tested it myself since I recommend re-creating them, if ever needed. Also be careful when 3rd party resource accounts e.g. from Attendant Console or Contact Center vendors are in play. TAC only supports first party Application Ids and won’t allow you to save changes you made without choosing a Resource Account type. Use PowerShell if you need to assign an online voice routing policy to a 3rd party resource account.&lt;/p&gt;
&lt;h4 id=&#34;how-to-associate-a-resource-account-with-a-voiceapp&#34;&gt;How to Associate a Resource Account with a Voice App
&lt;/h4&gt;&lt;p&gt;In most cases, having one Resource Account per Queue or Attendant is enough. Let’s make a small detour and talk about naming again for a second. To avoid confusion, I always make sure that the Display Name for the Queue/Attendant and the Resource Account are the same. If a Voice App needs multiple resource accounts, I use numbering on the resource account names. It’s important to note that the Display Name of the Resource Account is the name which a recipient of a call which was transferred by an Attendant or a Queue will see on the Teams toast notification.&lt;/p&gt;
&lt;p&gt;Here we can see that this Call Queue is called “MS Test CQ” but the associated resource account is called “Team Green CQ”.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1RGhZfRUJ9Hj7L0u8ko1uYQ.png&#34;
	width=&#34;1766&#34;
	height=&#34;593&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1RGhZfRUJ9Hj7L0u8ko1uYQ_hu_161818e7054c5116.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1RGhZfRUJ9Hj7L0u8ko1uYQ_hu_b91405f38313aa7f.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;297&#34;
		data-flex-basis=&#34;714px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Since the toast will show the Display Name of the resource account, it will say that there’s a call for “Team Green CQ” and not “MS Test CQ”.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/16eE5gPpiQQQ7E0HWidOcrw.png&#34;
	width=&#34;452&#34;
	height=&#34;438&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/16eE5gPpiQQQ7E0HWidOcrw_hu_953c6827b03a4e0b.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/16eE5gPpiQQQ7E0HWidOcrw_hu_e58cdee714326b33.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;103&#34;
		data-flex-basis=&#34;247px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I talked about the importance of the AA/CQ suffix at the beginning of this post. Microsoft has improved TAC and now shows assigned phone numbers in the drop-down list, if we search for a Voice App redirection target.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1ROuuUDhMjYnjORsGLjOiLQ.png&#34;
	width=&#34;1380&#34;
	height=&#34;382&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1ROuuUDhMjYnjORsGLjOiLQ_hu_b2742172048d3ea0.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1ROuuUDhMjYnjORsGLjOiLQ_hu_decddffa0d40242b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;361&#34;
		data-flex-basis=&#34;867px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;But let’s assume that neither of these accounts had a phone number assigned and we didn’t use a suffix either. Good luck figuring out which one of these is the Auto Attendant and which one is the Call Queue.&lt;/p&gt;
&lt;h4 id=&#34;enterprise-voice&#34;&gt;Enterprise Voice
&lt;/h4&gt;&lt;p&gt;This is an interesting one. As far as I can tell, resource accounts which were created at least a few months ago, are still Enterprise Voice enabled, even if they don’t have a Teams Phone Resource Account License assigned.&lt;/p&gt;
&lt;p&gt;Here’s an example of such a relict. This resource account is Enterprise Voice enabled, despite not having a LineURI or a Feature Type. FeatureTypes is a relatively new property which is returned by &lt;code&gt;Get-CsOnlineUser&lt;/code&gt; .&lt;/p&gt;
&lt;p&gt;DisplayName            : Support Number Business Hours AA&lt;br&gt;
EnterpriseVoiceEnabled : True&lt;br&gt;
LineUri                :&lt;br&gt;
FeatureTypes           : {}&lt;/p&gt;
&lt;p&gt;For reference, here’s a screenshot of the M365 Admin Portal.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1PqykXYuUDlX2lTaW1z4Q.png&#34;
	width=&#34;1338&#34;
	height=&#34;200&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1PqykXYuUDlX2lTaW1z4Q_hu_11eb01dc8fc7bd82.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1PqykXYuUDlX2lTaW1z4Q_hu_c62eb3fa8d330779.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;669&#34;
		data-flex-basis=&#34;1605px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If we check “Support Number AA” (which does have a license) by PowerShell using the search query below, we can see that it includes “VoiceApp” under FeatureTypes.&lt;/p&gt;
&lt;p&gt;Get-CsOnlineUser -Identity &lt;a class=&#34;link&#34; href=&#34;mailto:ra_aa_support_number@mozzism.ch&#34; &gt;ra_aa_support_number@mozzism.ch&lt;/a&gt; | FL DisplayName, EnterpriseVoiceEnabled, LineURI, FeatureTypes&lt;/p&gt;
&lt;p&gt;Output:&lt;/p&gt;
&lt;p&gt;DisplayName            : Support Number AA&lt;br&gt;
EnterpriseVoiceEnabled : True&lt;br&gt;
LineUri                : tel:+4144xxxxxxx&lt;br&gt;
FeatureTypes           : {VoiceApp}&lt;/p&gt;
&lt;p&gt;If we check a normal Teams user account, we can see that they’ll have “PhoneSystem” and “Teams” included in their FeatureTypes.&lt;/p&gt;
&lt;p&gt;DisplayName            : Ben Kim&lt;br&gt;
EnterpriseVoiceEnabled : True&lt;br&gt;
FeatureTypes           : {PhoneSystem, Teams}&lt;/p&gt;
&lt;p&gt;But beware that a user can also include the Feature Type “PhoneSystem” without actually being Enterprise Voice enabled. (In this case the user has a Teams Phone License but is not configured for EV yet.)&lt;/p&gt;
&lt;p&gt;DisplayName            : Bill Stearn&lt;br&gt;
EnterpriseVoiceEnabled : False&lt;br&gt;
FeatureTypes           : {PhoneSystem, Teams}&lt;/p&gt;
&lt;p&gt;I wasn’t able to reproduce this scenario. When I created a new resource account and didn’t assign a license, it was always set to Enterprise Voice enabled False.&lt;/p&gt;
&lt;p&gt;DisplayName            : Example PS AA&lt;br&gt;
EnterpriseVoiceEnabled : False&lt;br&gt;
FeatureTypes           : {}&lt;/p&gt;
&lt;p&gt;Let’s see how this looks, after we’ve added a Microsoft Teams Phone Resource Account License to “Example PS AA”. After a few minutes, the Feature Type will be added, and EV will be set to True. I was spamming the Get-CsOnlineUser query so often, that I even managed to get an output right before and after the change.&lt;/p&gt;
&lt;p&gt;Here we can see that the Feature Type “VoiceApp” was added but Enterprise Voice was still disabled.&lt;/p&gt;
&lt;p&gt;DisplayName            : Example PS AA&lt;br&gt;
EnterpriseVoiceEnabled : False&lt;br&gt;
FeatureTypes           : {VoiceApp}&lt;/p&gt;
&lt;p&gt;Literally seconds later, I ran it again and now Enterprise Voice has been enabled.&lt;/p&gt;
&lt;p&gt;DisplayName            : Example PS AA&lt;br&gt;
EnterpriseVoiceEnabled : True&lt;br&gt;
FeatureTypes           : {VoiceApp}&lt;/p&gt;
&lt;p&gt;Assigning the license will automatically set Enterprise Voice enabled to True. This is different than with normal user accounts. They will stay False until we either assign them a number through TAC or use &lt;code&gt;Set-CsPhoneNumberAssignment -EnterpriseVoiceEnabled $true&lt;/code&gt; .&lt;/p&gt;
&lt;p&gt;If the license is removed from the resource account, EV will be disabled again.&lt;/p&gt;
&lt;h4 id=&#34;external-pstn-transfer-from-resourceaccounts&#34;&gt;External PSTN Transfer from Resource Accounts
&lt;/h4&gt;&lt;p&gt;The official documentation of the technical requirements which are needed for external PSTN transfers can be viewed &lt;a class=&#34;link&#34; href=&#34;https://docs.microsoft.com/en-us/microsoftteams/create-a-phone-system-auto-attendant?tabs=general-info#external-phone-number-transfers---technical-details&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;. I’m only covering Direct Routing Scenarios in this article.&lt;/p&gt;
&lt;p&gt;These requirements need to be met by all resource accounts which are associated with a Voice App. For example, if you have an Auto Attendant which has two resource accounts / numbers assigned and it forwards to an external number outside of business hours, both resource accounts will need to have a valid voice routing policy assigned. TAC won’t display a warning or an error message, even if none of the associated resource account have an online voice routing policy assigned. So, in other words: If a call is made to a Resource Account which doesn’t have a voice routing policy assigned, the call transfer will fail.&lt;/p&gt;
&lt;p&gt;What about nesting? Although I don’t think that this is officially documented, I have found that only the top-level resource account, which is the one with the number which is dialed, needs to be configured properly.&lt;/p&gt;
&lt;p&gt;Let’s take a look at the configuration of the resource accounts used in this scenario.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1GRf3ngbTvUo9hndInnZg.png&#34;
	width=&#34;545&#34;
	height=&#34;1376&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1GRf3ngbTvUo9hndInnZg_hu_1167bb4d3f81db22.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1GRf3ngbTvUo9hndInnZg_hu_a3601540d92d276b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;39&#34;
		data-flex-basis=&#34;95px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Obviously, the Call Queue “Test EV Enabled CQ” and not the “Test EV Enabled AA” does the PSTN transfer. But only the Auto Attendant is configured for outbound PSTN calling. The call transfer in this scenario works.&lt;/p&gt;
&lt;p&gt;DisplayName              : Test EV Enabled AA&lt;br&gt;
EnterpriseVoiceEnabled   : True&lt;br&gt;
FeatureTypes             : {VoiceApp}&lt;br&gt;
OnlineVoiceRoutingPolicy : FirstTrunk&lt;/p&gt;
&lt;p&gt;DisplayName              : Test EV Enabled CQ&lt;br&gt;
EnterpriseVoiceEnabled   : False&lt;br&gt;
FeatureTypes             : {}&lt;br&gt;
OnlineVoiceRoutingPolicy :&lt;/p&gt;
&lt;p&gt;In the PSTN and SMS (preview) usage report in TAC, we can see that it’s the initially called resource account, rather than the one associated with the call queue which does the outbound call. Outbound Direct Routing calls from Voice Apps are labelled as “dr_out_bot”.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1OeqBbcYeZ8ZTXWRwP1xyyA.png&#34;
	width=&#34;1594&#34;
	height=&#34;198&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1OeqBbcYeZ8ZTXWRwP1xyyA_hu_34157e7b07847860.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1OeqBbcYeZ8ZTXWRwP1xyyA_hu_4a3ee3552a1c52e6.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;805&#34;
		data-flex-basis=&#34;1932px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;To be absolutely sure, I created another configuration. This time the other way around. The top-level Auto Attendant does not have an online voice routing policy assigned, but the nested Call Queue does.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/14WDSbZwQEdURpq3c7BpcgQ.png&#34;
	width=&#34;364&#34;
	height=&#34;898&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/14WDSbZwQEdURpq3c7BpcgQ_hu_685157994fb1079c.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/14WDSbZwQEdURpq3c7BpcgQ_hu_b0a49701d136ecf4.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;40&#34;
		data-flex-basis=&#34;97px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;When I called the number of the Auto Attendant, the PSTN transfer of the Call Queue did not work, even though the Queue is configured for outbound calling. When I called the number of the Queue directly, forwarding to PSTN worked perfectly.&lt;/p&gt;
&lt;p&gt;P.S. If you’re wondering, how I created that flow chart and didn’t get the memo before, besides blogging, I’m also the creator of this &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/M365CallFlowVisualizer/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;PowerShell Tool&lt;/a&gt; which allows anybody to automatically render these cool diagrams for free.&lt;/p&gt;
&lt;h4 id=&#34;finding-auto-attendants-and-call-queues-inteams&#34;&gt;Finding Auto Attendants and Call Queues in Teams
&lt;/h4&gt;&lt;p&gt;If you can’t find all your Auto Attendants and Call Queues when you search for them in Teams, you should definitely take a look at &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/why-can-only-some-users-search-auto-attendants-and-call-queues-in-teams-940402164681&#34; &gt;this article&lt;/a&gt;.&lt;/p&gt;
&lt;h4 id=&#34;one-lastthing&#34;&gt;One Last Thing
&lt;/h4&gt;&lt;p&gt;Although it’s now possible to do most of the things, like assigning online voice routing policies or phone numbers in TAC, some things are still missing from TAC. For example, you won’t find your resource accounts under “Manage users”. You can, however, replace the Object Id of a user in the URL, with an Object Id of a Resource Account. This will allow you to view some data, like recent calls.&lt;/p&gt;
&lt;p&gt;If you’re too lazy to grab the Object Id, you can also click the Display Name of a Resource Account from the PSTN and SMS (preview) usage report.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1aUlQ20axCxy0nA86UlRjw.png&#34;
	width=&#34;1489&#34;
	height=&#34;128&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1aUlQ20axCxy0nA86UlRjw_hu_7da24d98d07da211.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1aUlQ20axCxy0nA86UlRjw_hu_e853f1906e00c209.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;1163&#34;
		data-flex-basis=&#34;2791px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;This will yield an error message that TAC can’t get the policies of this account. But you’ll still be able to see it’s call history under the “Meetings &amp;amp; calls” tab.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1gzkRCHSpGq5csQDU7FQuA.png&#34;
	width=&#34;2040&#34;
	height=&#34;634&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1gzkRCHSpGq5csQDU7FQuA_hu_38a203eac327fb17.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489/1gzkRCHSpGq5csQDU7FQuA_hu_f8727b72014cf227.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;321&#34;
		data-flex-basis=&#34;772px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I hope this article helps you better understand how Resource Accounts work in Teams Phone. Feel free to reach out if you have any questions left.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>How To Add a New Domain to M365 with MS Graph PowerShell</title>
        <link>https://heusser.pro/p/how-to-add-a-new-domain-to-m365-with-ms-graph-powershell-e6b41c02bfa3/</link>
        <pubDate>Thu, 21 Jul 2022 15:16:51 +0000</pubDate>
        
        <guid>https://heusser.pro/p/how-to-add-a-new-domain-to-m365-with-ms-graph-powershell-e6b41c02bfa3/</guid>
        <description>&lt;p&gt;As you might have &lt;a class=&#34;link&#34; href=&#34;https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/azure-ad-change-management-simplified/ba-p/2967456&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;heard&lt;/a&gt;, Microsoft will soon be deprecating the MSOnline PowerShell Module. Even though Microsoft is giving us a little bit more time (now after December 2022 instead of June 2022) it’s time to move on and start working with the new, Microsoft.Graph PowerShell Module. I’m already using it in my &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/automatically-render-microsoft-teams-call-flow-diagrams-607b89df4154&#34; &gt;Microsoft 365 Call Flow Visualizer&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Today, I updated a Direct Routing provisioning script which I wrote at work. This script does everything that’s needed to set up Direct Routing in a tenant.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Add the FQDN of the SBC as a new Domain to the customer tenant&lt;/li&gt;
&lt;li&gt;Add the TXT verification DNS record to our Azure DNS zone&lt;/li&gt;
&lt;li&gt;Verify/confirm the domain in the customer tenant&lt;/li&gt;
&lt;li&gt;Create a resource account to &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/microsoft-teams-activate-fqdn-of-online-pstn-gateway-without-license-85e9ee4ca4cc&#34; &gt;activate the domain&lt;/a&gt; without a license&lt;/li&gt;
&lt;li&gt;Add the gateway, PSTN usage, voice route and voice routing policy&lt;/li&gt;
&lt;li&gt;Remove the activation user/resource account&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;prepare-graph-powershell&#34;&gt;Prepare Graph PowerShell
&lt;/h4&gt;&lt;p&gt;Before you can use Microsoft.Graph PowerShell you need to install the Module.&lt;/p&gt;
&lt;p&gt;Install-Module Microsoft.Graph&lt;/p&gt;
&lt;p&gt;This will install all Graph Modules. It’s also possible to install only select modules (e.g. &lt;code&gt;Install-Module Microsoft.Graph.Users&lt;/code&gt;) but since many modules have dependencies (e.g. Authentication etc.) it’s easier to just install all Modules from the get-go.&lt;/p&gt;
&lt;p&gt;When you connect to Microsoft Graph PowerShell you need to provide the required scopes. For the Cmdlets shown in t his blog article you need at least the following:&lt;/p&gt;
&lt;p&gt;Connect-MgGraph -Scopes &amp;ldquo;User.ReadWrite.All&amp;rdquo;,&amp;ldquo;Domain.ReadWrite.All&amp;rdquo;&lt;/p&gt;
&lt;p&gt;If you connect to Graph PowerShell for the first time, you will need to grant consent for the defined scopes. I’ve also defined the scope “Group.ReadWrite.All”, that’s why it also requests access for Read and write all groups.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-add-a-new-domain-to-m365-with-ms-graph-powershell-e6b41c02bfa3/1SX5hicBOkwEmlZmJp8tBw.png&#34;
	width=&#34;541&#34;
	height=&#34;815&#34;
	srcset=&#34;https://heusser.pro/p/how-to-add-a-new-domain-to-m365-with-ms-graph-powershell-e6b41c02bfa3/1SX5hicBOkwEmlZmJp8tBw_hu_aea9d3267614274e.png 480w, https://heusser.pro/p/how-to-add-a-new-domain-to-m365-with-ms-graph-powershell-e6b41c02bfa3/1SX5hicBOkwEmlZmJp8tBw_hu_bbaaa8daba2d81ae.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;66&#34;
		data-flex-basis=&#34;159px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Here are the old MSOnline Cmdlets vs the new Microsoft.Graph Cmdlets for the relevant actions.&lt;/p&gt;
&lt;h4 id=&#34;add-thedomain&#34;&gt;Add the Domain
&lt;/h4&gt;&lt;p&gt;MSol&lt;/p&gt;
&lt;p&gt;New-MsolDomain -Name &amp;ldquo;sbc001.domain.com&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Mg&lt;/p&gt;
&lt;p&gt;New-MgDomain -BodyParameter @{Id=&amp;ldquo;sbc001domain.com&amp;rdquo;;IsDefault=&amp;ldquo;False&amp;rdquo;}&lt;/p&gt;
&lt;p&gt;&lt;code&gt;IsDefault&lt;/code&gt; is optional. The domain won’t be added as the new default domain, even if you don’t include this key in the hash table. You can still include it though, it might give you some sort of comfort.&lt;/p&gt;
&lt;h4 id=&#34;get-the-verification-text&#34;&gt;Get the Verification Text
&lt;/h4&gt;&lt;p&gt;This was the only one which was a bit tricky since the actual value is hidden in the “AdditionalProperties” property which won’t be shown in the output.&lt;/p&gt;
&lt;p&gt;Output:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/how-to-add-a-new-domain-to-m365-with-ms-graph-powershell-e6b41c02bfa3/14I3XovOid37okdOGNmCHYw.png&#34;
	width=&#34;1486&#34;
	height=&#34;113&#34;
	srcset=&#34;https://heusser.pro/p/how-to-add-a-new-domain-to-m365-with-ms-graph-powershell-e6b41c02bfa3/14I3XovOid37okdOGNmCHYw_hu_ce92c98eeae2d915.png 480w, https://heusser.pro/p/how-to-add-a-new-domain-to-m365-with-ms-graph-powershell-e6b41c02bfa3/14I3XovOid37okdOGNmCHYw_hu_2724767a5d9a2585.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;1315&#34;
		data-flex-basis=&#34;3156px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If we use &lt;code&gt;| Format-Lsit&lt;/code&gt; or &lt;code&gt;| Select-Object *&lt;/code&gt; we will see that there’s a property called “AdditionalProperties”.&lt;/p&gt;
&lt;p&gt;This code, however, will store the verification code in the &lt;code&gt;$MgVerificationCode&lt;/code&gt; variable.&lt;/p&gt;
&lt;p&gt;Mg&lt;/p&gt;
&lt;p&gt;$MgVerificationCode = (Get-MgDomainVerificationDnsRecord -DomainId &amp;ldquo;sbc001.domain.com&amp;rdquo; | Where-Object {$_.RecordType -eq &amp;ldquo;Txt&amp;rdquo;}).AdditionalProperties.text&lt;/p&gt;
&lt;p&gt;Msol&lt;/p&gt;
&lt;p&gt;With Msol, the code did not include the first “MS=” why I needed to add it to the variable before getting the value. This is not the case with Graph anymore.&lt;/p&gt;
&lt;p&gt;$MsolVerificationCode = &amp;ldquo;MS=&amp;quot;+ (Get-MsolDomainVerificationDNS -DomainName $FQDNs.Values.FQDN).Label.Split(&amp;rdquo;.&amp;quot;)[0]&lt;/p&gt;
&lt;h4 id=&#34;verify-thedomain&#34;&gt;Verify the Domain
&lt;/h4&gt;&lt;p&gt;If you use an Azure DNS zone you can now use Az.DNS to create a new TXT record which contains &lt;code&gt;$MgVerificationCode&lt;/code&gt; as the value.&lt;/p&gt;
&lt;p&gt;New-AzDnsRecordSet -Name &amp;ldquo;sbc001&amp;rdquo; -RecordType TXT -ResourceGroupName &amp;ldquo;ResourceGroupX&amp;rdquo; -TTL 3600 -ZoneName &amp;ldquo;domain.com&amp;rdquo; -DnsRecords (New-AzDnsRecordConfig -Value $MgVerificationCode)&lt;/p&gt;
&lt;p&gt;Once the record is created, we can confirm the domain. This usually works within seconds if you use Azure DNS.&lt;/p&gt;
&lt;p&gt;Mg&lt;/p&gt;
&lt;p&gt;Confirm-MgDomain -DomainId &amp;ldquo;sbc001.domain.com&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Msol&lt;/p&gt;
&lt;p&gt;Confirm-MsolDomain -DomainName &amp;ldquo;sbc001.domain.com&amp;rdquo;&lt;/p&gt;
&lt;h4 id=&#34;remvoe-theuser&#34;&gt;Remvoe the User
&lt;/h4&gt;&lt;p&gt;When everything is set up, the activation user can be removed again.&lt;/p&gt;
&lt;p&gt;Mg&lt;/p&gt;
&lt;p&gt;Remove-MgUser -UserId $UpnAA&lt;/p&gt;
&lt;p&gt;Msol&lt;/p&gt;
&lt;p&gt;Remove-MsolUser -UserPrincipalName $UpnAA -Force&lt;/p&gt;
&lt;p&gt;While we needed to specify the &lt;code&gt;-Force&lt;/code&gt; parameter with MSol, we don’t need to specify anything when using Microsoft Graph. If you wish to make the script interactive and have a user confirm the deletion when using &lt;code&gt;Remove-MgUser&lt;/code&gt;, you can use the &lt;code&gt;-Confirm&lt;/code&gt; parameter instead.&lt;/p&gt;
&lt;p&gt;That’s all for today. Don’t fear Microsoft.Graph and happy scripting everybody!&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Create a Dynamic Azure AD Group with all Teams Phone Standard Licensed Users</title>
        <link>https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/</link>
        <pubDate>Mon, 28 Mar 2022 15:01:16 +0000</pubDate>
        
        <guid>https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/</guid>
        <description>&lt;p&gt;When it comes to Azure AD and licensing, we usually use Azure AD Groups to assign certain licenses to group members. It’s an effective way to assign different licenses to different teams within your organization. For example, you could have a group which assigns a Microsoft 365 E5 license to all the IT-Staff.&lt;/p&gt;
&lt;p&gt;Is there a need to do the opposite? Add all users who have a specific service plan assigned to an Azure AD group? Although this scenario might not be as common as the first one, there’s certainly a use case for it.&lt;/p&gt;
&lt;p&gt;Think about a Teams call queue in a small to mid-sized firm which distributes incoming calls to, let’s say 5–10 call agents. If none of these agents are able to answer the call within a certain time, the call is then escalated to a second call queue which contains all the company’s Teams Phone Standard enabled users. A call queue can have up to &lt;a class=&#34;link&#34; href=&#34;https://docs.microsoft.com/en-us/microsoftteams/create-a-phone-system-call-queue#teams-channel&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;two hundred&lt;/a&gt; call agents, if they’re added via a Teams Channel or a group.&lt;/p&gt;
&lt;p&gt;Instead of adding all phone enabled users manually we can create an Azure AD group which uses a dynamic query to include all users which have the service plan “MCOEV” assigned.&lt;/p&gt;
&lt;h4 id=&#34;heres-how-to-doit&#34;&gt;Here’s how to do it
&lt;/h4&gt;&lt;p&gt;First, head over to &lt;a class=&#34;link&#34; href=&#34;https://portal.azure.com/#blade/Microsoft_AAD_IAM/GroupsManagementMenuBlade/AllGroups&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;portal.azure.com&lt;/a&gt; and go to Azure AD, Groups. Then click New group.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1gDIaXRlNKUOM1U71nGgEvg.png&#34;
	width=&#34;1422&#34;
	height=&#34;324&#34;
	srcset=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1gDIaXRlNKUOM1U71nGgEvg_hu_5a642efc89e530c0.png 480w, https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1gDIaXRlNKUOM1U71nGgEvg_hu_e8e3d030302e7448.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;438&#34;
		data-flex-basis=&#34;1053px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;You can choose between a Microsoft 365 Group or a Security Group. For the Membership type, choose Dynamic User and then Add dynamic query.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1myN3vL9tTOdiDlRKgoQdyQ.png&#34;
	width=&#34;1035&#34;
	height=&#34;892&#34;
	srcset=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1myN3vL9tTOdiDlRKgoQdyQ_hu_dd6949d0c2dbcfdc.png 480w, https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1myN3vL9tTOdiDlRKgoQdyQ_hu_490647f0bcb8f622.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;116&#34;
		data-flex-basis=&#34;278px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Click the Edit button on Rule syntax.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1y3zKCrheFFtZhMuefUHg.png&#34;
	width=&#34;1556&#34;
	height=&#34;677&#34;
	srcset=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1y3zKCrheFFtZhMuefUHg_hu_6a9e39acd6441e70.png 480w, https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1y3zKCrheFFtZhMuefUHg_hu_6212931c442bbe67.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;229&#34;
		data-flex-basis=&#34;551px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Now enter the following query and click OK.&lt;/p&gt;
&lt;p&gt;USER.ASSIGNEDPLANS -ANY (ASSIGNEDPLAN.SERVICEPLANID -EQ &amp;ldquo;4828c8ec-dc2e-4779-b502-87ac9ce28ab7&amp;rdquo; -AND ASSIGNEDPLAN.CAPABILITYSTATUS -EQ &amp;ldquo;ENABLED&amp;rdquo;)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1RWeLgN5BP5RFAkr7lS50Q.png&#34;
	width=&#34;1257&#34;
	height=&#34;447&#34;
	srcset=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1RWeLgN5BP5RFAkr7lS50Q_hu_3889ec287706e78f.png 480w, https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1RWeLgN5BP5RFAkr7lS50Q_hu_b8a6dc0381d2c9b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;281&#34;
		data-flex-basis=&#34;674px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The Id we are querying is the Id for the service plan “MCOEV” which can be seen &lt;a class=&#34;link&#34; href=&#34;https://docs.microsoft.com/en-us/azure/active-directory/enterprise-users/licensing-service-plan-reference&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;. Since we’re looking for the service plan Id, it doesn’t matter if the license is assigned to a user via the Teams Phone Standard add-on, E5 or even Common Area Phone SKU. With the second part of the query (-AND) we’re also making sure, that we’re only including users where the service plan is actually enabled.&lt;/p&gt;
&lt;p&gt;Click Save.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1HMIASp06A45oOvCFOU4i6g.png&#34;
	width=&#34;1549&#34;
	height=&#34;710&#34;
	srcset=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1HMIASp06A45oOvCFOU4i6g_hu_95d1fc5902636d06.png 480w, https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1HMIASp06A45oOvCFOU4i6g_hu_3aae5a093cb74e75.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;218&#34;
		data-flex-basis=&#34;523px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;And finally, click Create.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1LsdWbsig2hQJzrErXoUTw.png&#34;
	width=&#34;1026&#34;
	height=&#34;1166&#34;
	srcset=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1LsdWbsig2hQJzrErXoUTw_hu_48b738d6d3ba7e2d.png 480w, https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1LsdWbsig2hQJzrErXoUTw_hu_6ca3f34d0befa947.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;87&#34;
		data-flex-basis=&#34;211px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;It will take a while until all the members have been added. We can check if our rule works by clicking on Dynamic membership rules and navigating to Validate Rules (preview). Let’s add some users and check if they meet the criteria.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1MFwrIBncdH8pWcWrwXFLw.png&#34;
	width=&#34;1551&#34;
	height=&#34;872&#34;
	srcset=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1MFwrIBncdH8pWcWrwXFLw_hu_a61a956d305eeda6.png 480w, https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1MFwrIBncdH8pWcWrwXFLw_hu_690bb4a53c1e9f49.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;177&#34;
		data-flex-basis=&#34;426px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;By clicking View details we can examine the query and see exactly why a user will be included or not.&lt;/p&gt;
&lt;p&gt;Here’s an example of a user where the service plan is assigned and also enabled.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1mz1us2OGznfSo1FaVQG8qA.png&#34;
	width=&#34;1243&#34;
	height=&#34;467&#34;
	srcset=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1mz1us2OGznfSo1FaVQG8qA_hu_24e241d412bd0151.png 480w, https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1mz1us2OGznfSo1FaVQG8qA_hu_c0da40d7aa726ebb.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;266&#34;
		data-flex-basis=&#34;638px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The user Bill has a Teams Phone Standard License but won’t be added to the group because the service plan is disabled.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1xeKYbn5MmNhGywENqNvKdw.png&#34;
	width=&#34;1553&#34;
	height=&#34;364&#34;
	srcset=&#34;https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1xeKYbn5MmNhGywENqNvKdw_hu_f897fd1c468591e8.png 480w, https://heusser.pro/p/create-a-dynamic-azure-ad-group-with-all-teams-phone-standard-licensed-users-3a4194284739/1xeKYbn5MmNhGywENqNvKdw_hu_d7561235da6c2a7c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;426&#34;
		data-flex-basis=&#34;1023px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Now you can use this group to assign it to a call queue. Whenever you license newly created users for the service plan MCOEV, the agent list of the call queue will automatically be updated. From my experience it can take some time until the agent lists of call queues are updated if you’re using group or channel assignments. I will write another article on how to force an agent list sync for call queues which use group assignments. So stay tuned!&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
