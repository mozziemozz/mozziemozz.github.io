<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>SharePoint on HEUSSER.PRO</title>
        <link>https://heusser.pro/categories/sharepoint/</link>
        <description>Recent content in SharePoint on HEUSSER.PRO</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Sun, 23 Feb 2025 12:34:32 +0000</lastBuildDate><atom:link href="https://heusser.pro/categories/sharepoint/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>Update: Teams Shared Voicemail for Basic Call Flows (Fix Call Back Links)</title>
        <link>https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/</link>
        <pubDate>Sun, 23 Feb 2025 12:34:32 +0000</pubDate>
        
        <guid>https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/</guid>
        <description>&lt;img src="https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/cover.png" alt="Featured image of post Update: Teams Shared Voicemail for Basic Call Flows (Fix Call Back Links)" /&gt;&lt;p&gt;This is an update to my previous blog post &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju&#34; &gt;Teams Shared Voicemail for Basic Call Flows&lt;/a&gt; initially published on January 17, 2024. Microsoft recently made some changes to the way in which Teams voicemails are sent to inboxes. This change was announced in &lt;a class=&#34;link&#34; href=&#34;https://mc.merill.net/message/MC987329&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MC987329&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Previously, voicemails from unknown numbers were sent with the phone number as the sender. Now they&amp;rsquo;re sent from &lt;code&gt;noreply@skype.voicemail.microsoft.com&lt;/code&gt; which broke the deep links on call back buttons on the adaptive cards sent to Teams.&lt;/p&gt;
&lt;h2 id=&#34;flow-updates&#34;&gt;Flow Updates
&lt;/h2&gt;&lt;p&gt;I&amp;rsquo;ve updated my flow to address this change and include working deep links on the adaptive cards again. Prior to this change, all the information (From address and From name) could be accessed directly in the trigger outputs.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image.png&#34;
	width=&#34;2154&#34;
	height=&#34;865&#34;
	srcset=&#34;https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image_hu_40be5c0a35a32a0d.png 480w, https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image_hu_3125301d95bbe1dc.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Composing From Address or Number and Name in old Flow&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;249&#34;
		data-flex-basis=&#34;597px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Since the from address is now &lt;code&gt;noreply@skype.voicemail.microsoft.com&lt;/code&gt; the phone number needs to be extracted from the email body. To make this work, I&amp;rsquo;m initializing two more variables at the beginning of the flow and then check if the from address matches &lt;code&gt;noreply&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image-1.png&#34;
	width=&#34;2149&#34;
	height=&#34;648&#34;
	srcset=&#34;https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image-1_hu_7470b4526b3e7513.png 480w, https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image-1_hu_cfc3e62d5fa3d66d.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;New variables&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;331&#34;
		data-flex-basis=&#34;795px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image-2.png&#34;
	width=&#34;2149&#34;
	height=&#34;880&#34;
	srcset=&#34;https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image-2_hu_579b979fc14aa731.png 480w, https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image-2_hu_f5d2e6eae8a5633d.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;If email match noreply&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;244&#34;
		data-flex-basis=&#34;586px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If that&amp;rsquo;s the case, the phone number and the name will be extracted from the email body and stored in the new variables. If not (in case the voicemail was left by an internal user or a known contact), the values of the trigger outputs will be written to the new variables.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image-3.png&#34;
	width=&#34;2155&#34;
	height=&#34;1146&#34;
	srcset=&#34;https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image-3_hu_8b60a1fbda16788b.png 480w, https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image-3_hu_da3f428b3a7f9048.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Extract phone number and name from email body in new flow version&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;188&#34;
		data-flex-basis=&#34;451px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Finally, I had to replace the &lt;code&gt;Outputs&lt;/code&gt; of the original compose actions with the variables in all places (i.e. in the adaptive cards) where they were referenced.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image-4.png&#34;
	width=&#34;912&#34;
	height=&#34;947&#34;
	srcset=&#34;https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image-4_hu_86d91ab0f760984c.png 480w, https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image-4_hu_fa61671e46915f28.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Old flow&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;96&#34;
		data-flex-basis=&#34;231px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image-5.png&#34;
	width=&#34;913&#34;
	height=&#34;861&#34;
	srcset=&#34;https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image-5_hu_cab78c09f153cee3.png 480w, https://heusser.pro/p/update-teams-shared-voicemail-for-basic-call-flows-fix-call-back-links-l4gwdggabxl8/image-5_hu_5fb00462ecb0ea16.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;New flow&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;106&#34;
		data-flex-basis=&#34;254px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;download-updated-flow&#34;&gt;Download Updated Flow
&lt;/h2&gt;&lt;p&gt;You can download the updated version of the flow &lt;a class=&#34;link&#34; href=&#34;https://raw.githubusercontent.com/mozziemozz/TeamsPhoneAutomation/main/Scripts/PowerAutomate/Flows/TeamsSharedVoicemailBasicV3%28M365GroupInbox%29_GitHub.zip&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Microsoft Teams: Change Call Queue Opt In Status on Behalf of Other User</title>
        <link>https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/</link>
        <pubDate>Fri, 14 Jun 2024 16:48:53 +0000</pubDate>
        
        <guid>https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/</guid>
        <description>&lt;p&gt;&lt;strong&gt;Update 29.09.2024&lt;/strong&gt; This post features a proof of concept and was an experimental project leveraging not supported ways of achieving what was presented. It looks like Microsoft has made changes to the &lt;strong&gt;Send an HTTP request to SharePoint&lt;/strong&gt; and tightened the security around it. Some of the actions outlined in this blog post are no longer possible and now throw an &lt;strong&gt;Unauthorized&lt;/strong&gt; error. While it was nice to be able to do these things, I fully believe that Microsoft is doing the right thing by adding more security to their services. If you want to be able to opt in/out another user on their behalf, I recommend to use the now available &lt;strong&gt;Queues&lt;/strong&gt; app in Teams.&lt;/p&gt;
&lt;h2 id=&#34;history-lesson&#34;&gt;History Lesson
&lt;/h2&gt;&lt;p&gt;Up until now, it hasn&amp;rsquo;t been possible for a queue manager to opt in or opt out other agents on their behalf. Opting in or out of a queue was always an action that had to be done by agents themselves. This changes with the &lt;strong&gt;Queues&lt;/strong&gt; app which is currently still in private preview. If you&amp;rsquo;re reading this blog, I doubt that this is the first time that you&amp;rsquo;re hearing of this but nevertheless, I&amp;rsquo;m still going to add a couple of links to this blog post.&lt;/p&gt;
&lt;p&gt;You can read the official announcement of the Queues app &lt;a class=&#34;link&#34; href=&#34;https://techcommunity.microsoft.com/t5/microsoft-teams-blog/introducing-the-queues-app-enabling-customer-engagement-in/ba-p/4095971&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt; and you&amp;rsquo;ll find the official support article &lt;a class=&#34;link&#34; href=&#34;https://support.microsoft.com/en-us/office/use-the-queues-app-for-microsoft-teams-370ad83e-c2c1-4a9f-8a59-16c98be102e9&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;. On &lt;a class=&#34;link&#34; href=&#34;https://regale.cloud/Microsoft/viewer/2963/queues-app/index.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;this&lt;/a&gt; page you can see an interactive demo of the queues app.&lt;/p&gt;
&lt;p&gt;While this will finally make it possible to change the opt in status on someone else&amp;rsquo;s behalf, it comes at a price. The Queues app will be part of Teams Premium and thus increase your monthly license costs. At this point, I don&amp;rsquo;t think it&amp;rsquo;s confirmed if only a supervisor can have a Teams Premium license and still be able to change the opt in status of others, or if all the members of a queue will require a Teams Premium license. My best guess is that every member of the queue will require an additional license but please don&amp;rsquo;t take my word for it.&lt;/p&gt;
&lt;p&gt;Since this was one of the most requested features of Teams Phone customers, I already experimented with creating something that would allow somebody to change an agent&amp;rsquo;s opt in statuses remotely in the past. I blogged about this &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/opt-in-or-opt-out-teams-call-queue-agents-remotely-59fe6147f50d&#34; &gt;here&lt;/a&gt;. I don&amp;rsquo;t think that this method still works today but it did work at the time. However, this never made it past a proof of concept because it required the username, password and potentially an MFA secret for the user account for which the opt in status needed to be changed.&lt;/p&gt;
&lt;p&gt;Today, I&amp;rsquo;m presenting a different solution. It&amp;rsquo;s still very much a proof of concept and not very scalable but at least it doesn&amp;rsquo;t need user credentials anymore. But most importantly, it doesn&amp;rsquo;t need any additional licenses.&lt;/p&gt;
&lt;h2 id=&#34;inspiration-from-the-community&#34;&gt;Inspiration from the Community
&lt;/h2&gt;&lt;p&gt;I initially got the idea from fellow MVP &lt;a class=&#34;link&#34; href=&#34;https://www.loryanstrant.com/2023/06/05/automatically-change-your-microsoft-teams-working-location-with-home-assistant/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Loryan Strant&lt;/a&gt;. In this blog post, he explains how you can leverage the &lt;strong&gt;Send an HTTP request to SharePoint&lt;/strong&gt; in Power Automate to make web requests to other end points. In his case, he&amp;rsquo;s targeting the endpoint which is used to update a user&amp;rsquo;s work location. Unknowingly at that time, I worked on &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/automate-setting-work-location-in-teams-outlook-poc-deb7b05de08d&#34; &gt;my own way&lt;/a&gt; of programmatically setting my work location using PowerShell and AADInternals. I&amp;rsquo;ll soon be writing something new about this too but today&amp;rsquo;s issue is all about call queues and changing opt in statuses.&lt;/p&gt;
&lt;p&gt;My next step was to look at the browser dev tools in Edge to see if anything had changed in how the Teams web client handles an opt in change. I already used this method in my first proof of concept over two years ago and I learned how you can effectively use the browser dev tools to see what&amp;rsquo;s going on under the hood from Alexander Holmeset in &lt;a class=&#34;link&#34; href=&#34;https://alexholmeset.blog/2021/02/28/teams-network-planner-automated/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;this&lt;/a&gt; blog post. On that note I want to point out that I&amp;rsquo;ll forever be grateful for that post. Acquiring this skill has helped me achieve something so many times already!&lt;/p&gt;
&lt;p&gt;In V1 of this PoC the request used to update an agent&amp;rsquo;s opt in status looked like this and the call queue Id was referenced in the payload.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://api.interfaces.records.teams.microsoft.com/Teams.VoiceApps/cq-agents/{User Id}&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Body&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$payload&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Put&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Headers&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Today, this request looks like this and the call queue Id is now part of the URI:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://api.interfaces.records.teams.microsoft.com/Teams.DLX/optinsettings/callqueues/{Call Queue Id}/agents/{User Id}&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Body&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;{&amp;#34;optIn&amp;#34;: {true/false}&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Put&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Headers&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/json&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;I have no idea what &lt;strong&gt;DLX&lt;/strong&gt; stands for. The only thing I could find was &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/openspecs/office_protocols/ms-dlx/fa0e41cd-2b34-4081-b3cf-59ecdad7a5da&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;this&lt;/a&gt; reference.&lt;/p&gt;
&lt;p&gt;The challenge with these web requests is that you still need to provide a valid access token in the authorization header. In PowerShell, there&amp;rsquo;s no way around user credentials to obtain a token. This is different in Power Automate though.&lt;/p&gt;
&lt;h2 id=&#34;setting-up-the-prerequisites&#34;&gt;Setting up the Prerequisites
&lt;/h2&gt;&lt;p&gt;Before we build the Flow, we&amp;rsquo;ll need something to trigger it. The best and easiest thing I could think of was to create a SharePoint list and add it as a tab to the Teams channel that&amp;rsquo;s linked to the call queue. If you don&amp;rsquo;t already know how to do that, follow the steps below.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-1.png&#34;
	width=&#34;2108&#34;
	height=&#34;1191&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-1_hu_763bad1306e732c0.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-1_hu_ce8a67ed6527e6d.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Click the &amp;#43; to add a tab.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;424px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-2.png&#34;
	width=&#34;2108&#34;
	height=&#34;1191&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-2_hu_125eeccbef5e5279.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-2_hu_34f0998b7753546f.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Search for ‘Lists’ and click on it.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;424px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-3.png&#34;
	width=&#34;2108&#34;
	height=&#34;1191&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-3_hu_df774a1b8c9e92ec.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-3_hu_ab98990638826702.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Click Save.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;424px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-4.png&#34;
	width=&#34;2108&#34;
	height=&#34;1191&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-4_hu_4cb286772d89b4c7.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-4_hu_ae7d551129868a7a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Select Create a list.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;424px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-5.png&#34;
	width=&#34;2108&#34;
	height=&#34;1191&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-5_hu_614a7c26a408719f.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-5_hu_f1ee6a73bd8686e.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Click on Blank list.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;424px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-6.png&#34;
	width=&#34;2108&#34;
	height=&#34;1191&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-6_hu_3b77dd866f18a75a.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-6_hu_cc68201dc3af55d6.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Give your list a name and select a color and an icon. Then click create.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;424px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Now that the tab shows your list, we&amp;rsquo;ll need to add the columns. Start by clicking &lt;strong&gt;+ Add column&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-8.png&#34;
	width=&#34;2108&#34;
	height=&#34;1191&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-8_hu_1e4468a24bb032dd.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-8_hu_e284bf7ccd2c0230.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Select Person and click Next.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;424px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-7.png&#34;
	width=&#34;2108&#34;
	height=&#34;1191&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-7_hu_7ef5ad1f0a176dad.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-7_hu_2607eef89ad073f8.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Enter ‘Agent’ as column name and toggle Show profile photos to Yes.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;424px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-9.png&#34;
	width=&#34;2108&#34;
	height=&#34;1191&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-9_hu_e3e10171d06fbe17.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-9_hu_e944876ee0a48f19.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Add another column and choose Yes/No as type.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;424px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-10.png&#34;
	width=&#34;2108&#34;
	height=&#34;1191&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-10_hu_124a8db043c07947.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-10_hu_5594ac8f5c48030.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Name it ‘Opt In’ and click Save.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;424px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-11.png&#34;
	width=&#34;2108&#34;
	height=&#34;1191&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-11_hu_7f7898356c469be0.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-11_hu_d3815f09bdb2dfb.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Add another Yes/No column called ‘Updated by Power Automate’ and set the default value to No.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;424px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Next, hide the &lt;strong&gt;Title&lt;/strong&gt; column from the view. We don&amp;rsquo;t need it.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-12.png&#34;
	width=&#34;2108&#34;
	height=&#34;1191&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-12_hu_84251706f79dc0c9.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-12_hu_4d6af6dc197c6d46.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Click on the column, then select Column settings, Show/hide columns.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;424px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-13.png&#34;
	width=&#34;2108&#34;
	height=&#34;1191&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-13_hu_1f2ce508e48559ad.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-13_hu_740b876607f059d7.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Uncheck Title and click Apply.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;424px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Now select &lt;strong&gt;Edit in grid view&lt;/strong&gt; and add your call queue agents to the list.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-14.png&#34;
	width=&#34;2108&#34;
	height=&#34;1191&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-14_hu_426e8c933604526.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-14_hu_678d6cb004eb2bd5.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Add all call queue agents to the Agent column.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;176&#34;
		data-flex-basis=&#34;424px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Once you&amp;rsquo;re done, click &lt;strong&gt;Exit grid view&lt;/strong&gt; to save the list. It should look something like this:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-18.png&#34;
	width=&#34;2108&#34;
	height=&#34;1216&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-18_hu_d457242dc34800d5.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-18_hu_43af90f6b183424.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Tip: You can reorder tabs by dragging. I’ve put my List tab next to the Calls tab.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;173&#34;
		data-flex-basis=&#34;416px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;the-power-of-power-automate&#34;&gt;The Power of Power Automate
&lt;/h2&gt;&lt;p&gt;In Power Automate, Flows are able to leverage connections for which Power Automate will automatically obtain a token for the user that&amp;rsquo;s running the Flow. While you can&amp;rsquo;t view the token, you can certainly use it to make web requests. The principle is quite simple. Each user needs to set up a Power Automate Flow which will update their opt in status when the Flow is triggered.&lt;/p&gt;
&lt;p&gt;The downside is that a Flow needs to be set up for each user and for each call queue where you want to leverage this custom solution. So, if a user is part of multiple queues, there also need to be multiple Flows per user. To be fair, I did say that this is a PoC at the beginning.&lt;/p&gt;
&lt;p&gt;The good thing about this is that I&amp;rsquo;ve built the Flow in a way, in which it will work for any user. A queue supervisor or an IT admin can just create Flow and then share it with all the agents. Each of the agents can then access the Flow using their own account and save a copy of the Flow to their own Flows. If they&amp;rsquo;ve never worked with Power Automate before, they might need help doing that but sharing and saving a copy is still the quickest way to set it all up.&lt;/p&gt;
&lt;h3 id=&#34;flow-for-each-agent&#34;&gt;Flow For Each Agent
&lt;/h3&gt;&lt;p&gt;Let&amp;rsquo;s look at the first Flow. I&amp;rsquo;ll call this the &lt;strong&gt;User-Flow&lt;/strong&gt; from now on.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image.png&#34;
	width=&#34;2064&#34;
	height=&#34;1823&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image_hu_4aca9d6c122e1f79.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image_hu_f5906340bd5d3fa1.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;This is the Power Automate Flow in all it’s glory.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;113&#34;
		data-flex-basis=&#34;271px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The Flow will trigger any time the SharePoint list which is now a tab in Teams is updated.&lt;/p&gt;
&lt;h4 id=&#34;import-the-flow-package&#34;&gt;Import the Flow Package
&lt;/h4&gt;&lt;p&gt;Start by downloading the Flow from &lt;a class=&#34;link&#34; href=&#34;#download-flow-packages&#34; &gt;here&lt;/a&gt; and then import it in Power Automate with a user that is part of the call queue, for which you want to add the functionality.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-21.png&#34;
	width=&#34;876&#34;
	height=&#34;242&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-21_hu_3b7de55b599cf749.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-21_hu_24cefe900990c434.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Click on Import Package (Legacy).&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;361&#34;
		data-flex-basis=&#34;868px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-22.png&#34;
	width=&#34;2233&#34;
	height=&#34;431&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-22_hu_27ac99c260aa551a.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-22_hu_664837d80fefbed9.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Next, select and upload the Zip file.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;518&#34;
		data-flex-basis=&#34;1243px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-23.png&#34;
	width=&#34;1847&#34;
	height=&#34;1147&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-23_hu_d08c18c70536136c.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-23_hu_fdc2496f6bf6ce48.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Click the first Wrench Icon to update the name of the Flow.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;161&#34;
		data-flex-basis=&#34;386px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-24.png&#34;
	width=&#34;1895&#34;
	height=&#34;1326&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-24_hu_e80da065e04a8a8.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-24_hu_82d41f487b9d4ccc.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Click the Wrench Icon for both connections and choose an existing connection or set up a new one.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;142&#34;
		data-flex-basis=&#34;342px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-25.png&#34;
	width=&#34;1856&#34;
	height=&#34;1326&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-25_hu_a45ba4f7b1a63a3b.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-25_hu_8bbe9b7603cad842.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Finally, click Import.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;139&#34;
		data-flex-basis=&#34;335px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;After successfully importing the Flow, it will be disabled at first. Navigate to &lt;strong&gt;My flows&lt;/strong&gt; and click on the imported Flow to enable it.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-26.png&#34;
	width=&#34;1439&#34;
	height=&#34;515&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-26_hu_408378babf9ac085.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-26_hu_c15b1bc333f303ff.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Click Trun on&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;279&#34;
		data-flex-basis=&#34;670px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Then, click &lt;strong&gt;Edit&lt;/strong&gt;. Now you need to update the trigger and select the correct Team/Site and List for the trigger. This will be the SharePoint site of the Team in which you created the list tab.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-15.png&#34;
	width=&#34;933&#34;
	height=&#34;330&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-15_hu_8d4da9d08e3a4ab6.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-15_hu_4694cb13c9cc3013.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Set the Flow trigger to your Site and List.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;282&#34;
		data-flex-basis=&#34;678px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;In the third step &lt;strong&gt;Initialize CallQueueId&lt;/strong&gt; fill in the Id of your call queue. The easiest way to obtain the Id is to edit the queue in Teams Admin Center and copy the Id from the URL.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-16.png&#34;
	width=&#34;937&#34;
	height=&#34;298&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-16_hu_c585637524f351e3.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-16_hu_a76c81a1b6609569.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Set the call queue Id&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;314&#34;
		data-flex-basis=&#34;754px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;These are the only two things you need to adjust. Because the Flow uses the action &lt;strong&gt;Get my profile (V2)&lt;/strong&gt; you don&amp;rsquo;t need to set anything that&amp;rsquo;s user specific. That action will always get the details of the user that is running the Flow.&lt;/p&gt;
&lt;h4 id=&#34;share-the-flow-with-all-the-other-agents&#34;&gt;Share the Flow with all the other Agents
&lt;/h4&gt;&lt;p&gt;Now that you have the Flow imported to your account, share it with all agents of the call queue.&lt;/p&gt;
&lt;p&gt;Go back to &lt;strong&gt;My flows&lt;/strong&gt; and select the Flow again to share it with your team.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-27.png&#34;
	width=&#34;1440&#34;
	height=&#34;422&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-27_hu_586ea062b4215b68.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-27_hu_ca0fbe7ed24a004e.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;From there, click Share.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;341&#34;
		data-flex-basis=&#34;818px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-28.png&#34;
	width=&#34;1716&#34;
	height=&#34;470&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-28_hu_f23f91783b719686.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-28_hu_d31bd19c823dc4eb.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Search for another call queue agent and select them from the drop-down menu.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;365&#34;
		data-flex-basis=&#34;876px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-29.png&#34;
	width=&#34;1039&#34;
	height=&#34;734&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-29_hu_8ed9050a690eb506.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-29_hu_c31db2ea6ded8104.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Confirm by clicking Ok.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;141&#34;
		data-flex-basis=&#34;339px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Now ask the user you shared the Flow with to sing in to &lt;a class=&#34;link&#34; href=&#34;https://make.powerautomate.com&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Power Automate&lt;/a&gt; and navigate to &lt;strong&gt;My flows&lt;/strong&gt; and switch to the &lt;strong&gt;Shared with me&lt;/strong&gt; tab.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-30.png&#34;
	width=&#34;1403&#34;
	height=&#34;955&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-30_hu_2a07896dfbb0fc3d.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-30_hu_8ed2f0e76eb181eb.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Instruct them to click the three dots and select Save as.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;146&#34;
		data-flex-basis=&#34;352px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-31.png&#34;
	width=&#34;1030&#34;
	height=&#34;472&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-31_hu_5cd1ba5dd912abb9.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-31_hu_dbfcc3c28ecb29ba.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Instruct them to create the connections by clicking Continue.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;218&#34;
		data-flex-basis=&#34;523px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-32.png&#34;
	width=&#34;1038&#34;
	height=&#34;420&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-32_hu_bf04447320b9d52a.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-32_hu_24b7e18963320438.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;They can rename the Flow before saving.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;247&#34;
		data-flex-basis=&#34;593px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-33.png&#34;
	width=&#34;1057&#34;
	height=&#34;947&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-33_hu_e7168c50945fa66c.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-33_hu_5de16586c7e6c50b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Finally, they’ll need to go to My flows again and turn on the copied Flow using the menu behind the three dots.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;111&#34;
		data-flex-basis=&#34;267px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Repeat these steps for all the other call queue agents. Each agent needs to have this Flow in their own Power Automate environment since the Flow will need to run with their credentials to be able to change their opt in status.&lt;/p&gt;
&lt;h3 id=&#34;flow-to-keep-the-list-in-sync&#34;&gt;Flow to keep the List in Sync
&lt;/h3&gt;&lt;p&gt;Obviously the agents will still be able to change their opt in status on their own using their Teams clients. In that case, we want to keep the SharePoint list updated as well and reflect changes to opt in status made outside of the list. For this, I&amp;rsquo;ve created another Flow. I&amp;rsquo;ll call that one the &lt;strong&gt;Sync-Flow&lt;/strong&gt;. This Flow will update the list for all agents and it will need to be created only once. In my Lab, I&amp;rsquo;ve configured this Flow with a recurring trigger every 15 minutes.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-17.png&#34;
	width=&#34;1428&#34;
	height=&#34;1835&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-17_hu_e8f80b80c0f62e88.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-17_hu_ba5466081c459b2.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Flow to update the List if CQ Agents opt in/out via Teams clients.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;77&#34;
		data-flex-basis=&#34;186px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;This Flow will send an HTTP Get request via the &lt;strong&gt;Send an HTTP request to SharePoint&lt;/strong&gt; to the call queue endpoint used to read and write the opt in states of agents. This is basically the same as what I&amp;rsquo;m using to update the opt in states but this time, I&amp;rsquo;m only reading from it. The JSON response will include a list of each agent&amp;rsquo;s Object Id and their current opt in state. Then it uses the &lt;strong&gt;Get user profile (V2)&lt;/strong&gt; action to find the email address of the current user by Object Id. This is needed so that the Flow can query the list item of each agent.&lt;/p&gt;
&lt;p&gt;Once the Flow knows both values, the actual opt in state and what&amp;rsquo;s currently stored in the list, it will compare the values. If they&amp;rsquo;re the same, nothing happens. If they&amp;rsquo;re not the same, the Flow will update the SharePoint list with the actual value.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-19.png&#34;
	width=&#34;2108&#34;
	height=&#34;1216&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-19_hu_f92b2030c82ceed3.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-19_hu_afcc35e23a8b9c40.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;The List tab after it’s been updated by Power Automate.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;173&#34;
		data-flex-basis=&#34;416px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If an opt in status was updated by Power Automate, it will also set the value in &lt;strong&gt;Updated by Power Automate&lt;/strong&gt; to &lt;code&gt;True&lt;/code&gt; (Checkmark). By doing it like this, we can avoid an infinite trigger loop on the User-Flows. Since they use &lt;strong&gt;When an item is created or modified&lt;/strong&gt; as their trigger, they would be triggered any time the List is updated. That will include updates made by the recurring Sync-Flow.&lt;/p&gt;
&lt;p&gt;Since we definitely don&amp;rsquo;t want that, I&amp;rsquo;ve added a trigger condition to the User-Flows. A trigger condition is an expression, which must evaluate to &lt;code&gt;True&lt;/code&gt; for the Flow to be triggered.&lt;/p&gt;
&lt;p&gt;This expression will check if the &lt;strong&gt;Updated by Power Automate&lt;/strong&gt; checkbox is not checked. So, whenever the list is updated by the Sync-Flow, the user Flows won&amp;rsquo;t be triggered.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;@equals(triggerOutputs()?[&amp;#39;body/UpdatedByPowerAutomate&amp;#39;], false)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-20.png&#34;
	width=&#34;917&#34;
	height=&#34;1395&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-20_hu_c507a8b7b58ddf83.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-20_hu_249ba26a2a550cdc.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;The trigger condition will prevent infinite trigger loops.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;65&#34;
		data-flex-basis=&#34;157px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s important to note that when you or somebody else wants to change the opt in status of an agent again from the list, the &lt;strong&gt;Updated by Power Automate&lt;/strong&gt; checkbox must be unchecked again. Otherwise the User-Flows won&amp;rsquo;t run and the opt in status won&amp;rsquo;t be changed.&lt;/p&gt;
&lt;h4 id=&#34;import-the-flow-package-1&#34;&gt;Import the Flow Package
&lt;/h4&gt;&lt;p&gt;You can download this Flow from &lt;a class=&#34;link&#34; href=&#34;#download-flow-packages&#34; &gt;here&lt;/a&gt;. Use the same process to import the Flow package as you already did with the User-Flow and don&amp;rsquo;t forget to turn it as well on once you&amp;rsquo;re done. In this Flow, you will need to do the following adjustments.&lt;/p&gt;
&lt;p&gt;Replace the value of the &lt;strong&gt;CallQueueId&lt;/strong&gt; variable with your call queue Id.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-35.png&#34;
	width=&#34;923&#34;
	height=&#34;410&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-35_hu_ee5cfbae98c25340.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-35_hu_222bb534c8265752.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Set the CallQueueId variable.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;225&#34;
		data-flex-basis=&#34;540px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Then expand all the action boxes and select your &lt;strong&gt;Site Address&lt;/strong&gt; and &lt;strong&gt;List Name&lt;/strong&gt; in the action &lt;strong&gt;Get items&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-36.png&#34;
	width=&#34;939&#34;
	height=&#34;446&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-36_hu_b583d297032db823.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-36_hu_421dab11de7df7cf.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Replace Site Address and List Name.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;210&#34;
		data-flex-basis=&#34;505px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Finally, do the same for the &lt;strong&gt;Update item&lt;/strong&gt; action inside the &lt;strong&gt;If yes&lt;/strong&gt; condition.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-37.png&#34;
	width=&#34;969&#34;
	height=&#34;717&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-37_hu_3b2bf93755b3c569.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-37_hu_d690148f27dd27ea.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Replace Site Address and List Name.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;135&#34;
		data-flex-basis=&#34;324px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;That&amp;rsquo;s it for the set up part. Let&amp;rsquo;s take a look at the user experience!&lt;/p&gt;
&lt;h2 id=&#34;user-experience&#34;&gt;User Experience
&lt;/h2&gt;&lt;p&gt;Here you can see how it works. Anyone that has access to the list, can simply edit the list and change the opt in status of another colleague.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/TeamsCQOptIn.gif&#34;
	width=&#34;1195&#34;
	height=&#34;672&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/TeamsCQOptIn_hu_f736fa3a24af3e80.gif 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/TeamsCQOptIn_hu_7e965ff2b75bee6.gif 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Note: The Flow was in test mode to speed up the demo. In real life, it will usually take a few minutes to change an opt in status.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;177&#34;
		data-flex-basis=&#34;426px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Bonus tip: If you switch to the new designer in Power Automate you can change how often it checks for updated list items in the trigger configuration.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-34.png&#34;
	width=&#34;1488&#34;
	height=&#34;1090&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-34_hu_8401168aed3180ff.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/image-34_hu_85953db063fcd0d8.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;The default polling interval is 5 minutes.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;136&#34;
		data-flex-basis=&#34;327px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;additional-benefits&#34;&gt;Additional Benefits
&lt;/h2&gt;&lt;p&gt;As you may know, the &lt;strong&gt;Calls&lt;/strong&gt; tab in channels is not supported on the Teams mobile app. The call queue agents and their opt in status can only be viewed in the Teams desktop or web client. At this point I want to clarify again, that mobile clients can still receive calls from a call queue, even when the call queue is linked to a voice enabled channel. It&amp;rsquo;s only the view/tab that&amp;rsquo;s not supported on Teams mobile apps.&lt;/p&gt;
&lt;p&gt;But since this solution uses a SharePoint list, it will actually give you the ability to view and change the opt in status of other agents from a mobile device too. This can be done by either opening the list tab in Teams mobile or by accessing the list directly in the Lists mobile app.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/20240619_184713000_iOS.png&#34;
	width=&#34;1125&#34;
	height=&#34;2436&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/20240619_184713000_iOS_hu_a073311d5d98549f.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/20240619_184713000_iOS_hu_a605fa63a0bc13d4.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;List tab in Teams mobile.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;46&#34;
		data-flex-basis=&#34;110px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/20240619_185305000_iOS.png&#34;
	width=&#34;1125&#34;
	height=&#34;2436&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/20240619_185305000_iOS_hu_9b077990a18128c2.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/20240619_185305000_iOS_hu_976efe11209dcabc.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Editing a list item in Teams mobile.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;46&#34;
		data-flex-basis=&#34;110px&#34;
	
&gt; &lt;img src=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/20240619_185536000_iOS.png&#34;
	width=&#34;1125&#34;
	height=&#34;2436&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/20240619_185536000_iOS_hu_4c78dee4407e037f.png 480w, https://heusser.pro/p/microsoft-teams-change-call-queue-opt-in-status-on-behalf-of-other-user-without-teams-premium-ztd1ry6tt6ml/20240619_185536000_iOS_hu_ca698d77c737eeeb.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Toggle switches in Lists app.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;46&#34;
		data-flex-basis=&#34;110px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The list app will even give you toggle switches which not only looks better but is also easier to edit compared to the experience within the Teams mobile app.&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;Summary
&lt;/h2&gt;&lt;p&gt;While Teams Premium provides a lot of benefits over the Standard license, the additional $10 per user per month can make quite the difference in your monthly license cost. I fully understand the price tag since Teams Premium also includes AI generated notes which use a lot of computing resources and thus cost Microsoft more money to run their services in the backend.&lt;/p&gt;
&lt;p&gt;However, if you&amp;rsquo;re only looking for a way to opt in/out other call queue agents on their behalf and don&amp;rsquo;t want to spend another $10 PUPM, I think this solution can be a suitable workaround. Especially for small companies which don&amp;rsquo;t have a lot of call queues with a lot of agents. Of course there is some work to be done by admins and the end users (agents) but it should be manageable for small teams. And let&amp;rsquo;s not forget the fact this will even allow you to change the opt in status for other agents on mobile platforms too!&lt;/p&gt;
&lt;h3 id=&#34;download-flow-packages&#34;&gt;Download Flow Packages
&lt;/h3&gt;&lt;p&gt;You can download both Flow packages for free from &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation/blob/main/Scripts/PowerAutomate/Flows/UpdateCallQueueOptInStatus_20240614215253.zip&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt; and &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation/blob/main/Scripts/PowerAutomate/Flows/SyncOptInStatustoList_20240614215356.zip&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;. If you like what I&amp;rsquo;ve presented in this blog post and if it will save you the money you would have otherwise spent on Teams Premium licenses, you can still choose to support me by &lt;a class=&#34;link&#34; href=&#34;https://buymeacoffee.com/martin.heusser&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;buying me a coffee&lt;/a&gt; or by sponsoring me on &lt;a class=&#34;link&#34; href=&#34;https://github.com/sponsors/mozziemozz?frequency=one-time&amp;amp;sponsor=mozziemozz&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;GitHub&lt;/a&gt;.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Microsoft Forms Data Recovery: Going Down The Rabbit Hole</title>
        <link>https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/</link>
        <pubDate>Sat, 18 May 2024 09:07:35 +0000</pubDate>
        
        <guid>https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/</guid>
        <description>&lt;img src="https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/cover.png" alt="Featured image of post Microsoft Forms Data Recovery: Going Down The Rabbit Hole" /&gt;&lt;h2 id=&#34;intro&#34;&gt;Intro
&lt;/h2&gt;&lt;p&gt;Let me start by saying, that hopefully you&amp;rsquo;ll never need to go down this rabbit hole. But if you&amp;rsquo;re like me, you may be interested in the content anyway.&lt;/p&gt;
&lt;p&gt;A couple of weeks ago, I worked on a support request from a user who needed to recover some accidentally deleted responses of a Microsoft Form. The first place I was looking for answers was the Forms recycle bin. This however will only include your deleted forms but unfortunately it doesn&amp;rsquo;t contain deleted responses of active forms.&lt;/p&gt;
&lt;p&gt; &lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/6131e543-e1b1-4f9f-871e-70d0aaddd728.png&#34;
	width=&#34;780&#34;
	height=&#34;811&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/6131e543-e1b1-4f9f-871e-70d0aaddd728_hu_ffca4a01f32614d0.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/6131e543-e1b1-4f9f-871e-70d0aaddd728_hu_655e0a51bc1ff1f4.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;The good thing is that the restore process will also bring back the responses.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;96&#34;
		data-flex-basis=&#34;230px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;how-would-you-even-know-if-responses-of-a-form-got-deleted&#34;&gt;How would you even know if responses of a form got deleted?
&lt;/h3&gt;&lt;p&gt;I have a test form with 3 responses. On first sight, there&amp;rsquo;s no indication that some of the responses were actually deleted.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/02421d0f-c2c9-42b9-b187-f0a1e50f7819.png&#34;
	width=&#34;1294&#34;
	height=&#34;499&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/02421d0f-c2c9-42b9-b187-f0a1e50f7819_hu_71b8e0f6f5e851e9.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/02421d0f-c2c9-42b9-b187-f0a1e50f7819_hu_1fab24e292c8ca1c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Forms will only display responses which haven’t been deleted.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;259&#34;
		data-flex-basis=&#34;622px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;But once I click on &lt;strong&gt;View results&lt;/strong&gt; I can see that the number of the first respondent that is shown is actually &lt;strong&gt;2&lt;/strong&gt; and not &lt;strong&gt;1&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/d15a45af-ed02-4433-ada2-7161d03c788b.png&#34;
	width=&#34;1197&#34;
	height=&#34;321&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/d15a45af-ed02-4433-ada2-7161d03c788b_hu_ace5700abbfcc1ee.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/d15a45af-ed02-4433-ada2-7161d03c788b_hu_6b4ccdffa7916594.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;This is how you know if a form has deleted responses.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;372&#34;
		data-flex-basis=&#34;894px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The response IDs will also be visible if you download a copy of the responses as an Excel file.&lt;/p&gt;
&lt;h4 id=&#34;how-can-responses-be-deleted&#34;&gt;How can responses be deleted?
&lt;/h4&gt;&lt;p&gt;In most cases, responses are deleted unintentionally by accident. Responses can be deleted from the &lt;strong&gt;View results&lt;/strong&gt; menu in &lt;strong&gt;Responses&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/image.png&#34;
	width=&#34;1301&#34;
	height=&#34;431&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/image_hu_528bf2ae5450f31d.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/image_hu_47396ba6676caee1.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Click the three dots ()…) and then Delete response to delete a specific response.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;301&#34;
		data-flex-basis=&#34;724px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;There will be a warning that the response will be permanently deleted.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/image-1.png&#34;
	width=&#34;1113&#34;
	height=&#34;217&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/image-1_hu_6beb944b71fbdd8f.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/image-1_hu_40c714ca383c0426.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Spoiler alert: That’s not 100% true…&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;512&#34;
		data-flex-basis=&#34;1230px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;sync-responses-to-excel&#34;&gt;Sync Responses to Excel
&lt;/h2&gt;&lt;p&gt;At the time I had to recover the responses for the user, the option to sync responses to Excel wasn&amp;rsquo;t available yet, as this feature was only introduced recently in the fashion of a public preview. Even if it was already available, it would have only saved me all of the trouble and investigation work, if the user had clicked it before the responses were deleted.&lt;/p&gt;
&lt;p&gt;From your form&amp;rsquo;s responses, you can either download a copy of a static Excel file or you can &lt;strong&gt;Open results in Excel&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/a2fa3d9a-6e0c-4355-a1ee-68bf78ff01fd.png&#34;
	width=&#34;1306&#34;
	height=&#34;418&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/a2fa3d9a-6e0c-4355-a1ee-68bf78ff01fd_hu_9e3691265939a97d.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/a2fa3d9a-6e0c-4355-a1ee-68bf78ff01fd_hu_14b64b60b0a1f5fa.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Previously, Forms only allowed us to download a static copy of the current data.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;312&#34;
		data-flex-basis=&#34;749px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Downloading a copy will only include the current responses but obviously not add any new responses. To view new responses in Excel, you had to download a new copy after more respondents filled out your form.&lt;/p&gt;
&lt;p&gt;A common workaround was to create a Power Automate flow to automatically save all responses to either an Excel file or a SharePoint list. With the most recent update to Forms, that&amp;rsquo;s not necessary anymore. At least not for basic scenarios.&lt;/p&gt;
&lt;p&gt;Opening the results in Excel will automatically create an Excel file in your OneDrive which is then also automatically updated every time somebody submits a new response to your form.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/6f819493-d240-406c-8ff8-cde512e4e4fe.png&#34;
	width=&#34;1048&#34;
	height=&#34;534&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/6f819493-d240-406c-8ff8-cde512e4e4fe_hu_97aa9319bc9fd307.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/6f819493-d240-406c-8ff8-cde512e4e4fe_hu_f19419442b3cffaa.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Each user will only see this message once.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;196&#34;
		data-flex-basis=&#34;471px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/f9384969-369e-426f-94c0-6911733b95f8.png&#34;
	width=&#34;765&#34;
	height=&#34;490&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/f9384969-369e-426f-94c0-6911733b95f8_hu_fd4bf0f88b6b7822.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/f9384969-369e-426f-94c0-6911733b95f8_hu_10f5bef6c784d2b8.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;A new tab will open with the newly created Excel sheet.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;156&#34;
		data-flex-basis=&#34;374px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/705e56cb-a2ba-41cc-a7ab-81629ec2fb4d.png&#34;
	width=&#34;1310&#34;
	height=&#34;259&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/705e56cb-a2ba-41cc-a7ab-81629ec2fb4d_hu_a95d51340473ace.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/705e56cb-a2ba-41cc-a7ab-81629ec2fb4d_hu_8ea1f29fa5a4f5cd.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;The Excel file will include all responses and also show a hint that this workbook is synced with Forms.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;505&#34;
		data-flex-basis=&#34;1213px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/d79564be-c589-465c-b5a5-bb58e0226328.png&#34;
	width=&#34;1292&#34;
	height=&#34;367&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/d79564be-c589-465c-b5a5-bb58e0226328_hu_be37936c6fcc1cea.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/d79564be-c589-465c-b5a5-bb58e0226328_hu_e348a4c703d4a0e5.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;After setting up the sync, the form will show the linked Excel file instead of the button Open results in Excel.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;352&#34;
		data-flex-basis=&#34;844px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Based on my testing, only newly added responses will be synced to the Excel file. If you delete a response from Forms, it will stay in Excel, which is not necessarily a bad thing. But even if deleted responses would be removed from the Excel as well, we could still get the data back through OneDrive&amp;rsquo;s version history.&lt;/p&gt;
&lt;p&gt;Therefore, I advise every form creator to start syncing the responses to Excel Online immediately after the form has been created. This will ensure that no response data can get lost.&lt;/p&gt;
&lt;p&gt;Now let&amp;rsquo;s look at your options in case you or a user didn&amp;rsquo;t sync or download a static copy of the responses before they were deleted.&lt;/p&gt;
&lt;h2 id=&#34;where-are-form-responses-stored&#34;&gt;Where are Form responses stored?
&lt;/h2&gt;&lt;p&gt;You might think that they&amp;rsquo;re stored in OneDrive or SharePoint but that&amp;rsquo;s not the case. Form responses are stored in the Exchange Online Mailbox of the user who created the form. I was only able to find all of this information because of &lt;a class=&#34;link&#34; href=&#34;https://www.linkedin.com/feed/update/urn:li:activity:7173720646349123584?utm_source=share&amp;amp;utm_medium=member_desktop&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;this&lt;/a&gt; LinkedIn post by Andrew Chomik. The post includes another link which leads &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/purview/ediscovery-what-is-stored-in-a-mailbox&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This is what it says in the Microsoft Learn article:&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Forms and responses to a form are stored in files that are attached to email messages and stored in a hidden folder in the mailbox of the user who created the form.
Forms created before April 2020 are stored as a PDF file. Forms created after 2020 are stored as a JSON file. Responses to a form are stored in a CSV file.
When you export content from Forms in a PST file, this data is located in the &lt;strong&gt;ApplicationDataRoot&lt;/strong&gt; folder in a subfolder named with the following globally unique identified (GUID): &lt;strong&gt;c9a559d2-7aab-4f13-a6ed-e7e9c52aec87&lt;/strong&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&#34;how-do-we-access-the-forms-data-stored-in-exchange-online&#34;&gt;How do we access the forms data stored in Exchange Online?
&lt;/h2&gt;&lt;p&gt;At first I tried to get the data by using Exchange Online PowerShell but that turned into a dead end rather quickly. Since this all happened a couple of weeks ago, I don&amp;rsquo;t remember exactly how I discovered the tool &lt;a class=&#34;link&#34; href=&#34;https://github.com/microsoft/mfcmapi&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;MFCMAPI&lt;/a&gt; but somehow I found this and it helped me solve my issue.&lt;/p&gt;
&lt;p&gt;This tool only works if Outlook is installed on the same system you&amp;rsquo;re running it from. Furthermore, the user who created the form for which you want to restore responses needs to be signed into Outlook (Classic). Outlook doesn&amp;rsquo;t need to be running for MFCMAPI to work though.&lt;/p&gt;
&lt;p&gt;If you don&amp;rsquo;t want to perform this task on an end user&amp;rsquo;s machine, you can grant yourself temporary full access to the user&amp;rsquo;s mailbox so that you can use MFCMAPI on your own machine.&lt;/p&gt;
&lt;h3 id=&#34;use-mfcmapi-to-export-form-responses&#34;&gt;Use MFCMAPI to export form responses
&lt;/h3&gt;&lt;p&gt;To be able to see the forms data in a mailbox, you need to enable two options in MFCMAPI first. Click on &lt;strong&gt;Tools&lt;/strong&gt; and then &lt;strong&gt;Options&lt;/strong&gt; to open the settings.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/image-2.png&#34;
	width=&#34;1048&#34;
	height=&#34;828&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/image-2_hu_6798d4d18537b6fd.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/image-2_hu_6ec6b39c574463da.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Open MFCMAPI settings&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;126&#34;
		data-flex-basis=&#34;303px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Scroll down and make sure that &lt;strong&gt;Use the MDB_ONLINE flag when calling OpenMsgStore&lt;/strong&gt; and &lt;strong&gt;Use the MAPI_NO_CACHE flag when calling OpenEntry&lt;/strong&gt; are both enabled.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/c9d5cc19-b03a-40b8-b12e-bd513b424228.png&#34;
	width=&#34;718&#34;
	height=&#34;547&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/c9d5cc19-b03a-40b8-b12e-bd513b424228_hu_f7a757a267e7f1a4.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/c9d5cc19-b03a-40b8-b12e-bd513b424228_hu_5240a54afdc0a5ce.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Without these options enabled you won’t see forms data.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;131&#34;
		data-flex-basis=&#34;315px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;You can find more info on how to use MFCMAPI &lt;a class=&#34;link&#34; href=&#34;https://office365concepts.com/how-to-use-mfcmapi/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Next, click on &lt;strong&gt;Session&lt;/strong&gt; and then &lt;strong&gt;Logon&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/ac9717fa-b74e-4eed-962d-15444d1c7f98.png&#34;
	width=&#34;1048&#34;
	height=&#34;828&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/ac9717fa-b74e-4eed-962d-15444d1c7f98_hu_b6eac50eed218bd9.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/ac9717fa-b74e-4eed-962d-15444d1c7f98_hu_b7be868f86f99f8d.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;MFCMAPI Session Logon&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;126&#34;
		data-flex-basis=&#34;303px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Select the correct Outlook profile.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/da558d8c-f98e-4848-b797-58d231378757.png&#34;
	width=&#34;429&#34;
	height=&#34;163&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/da558d8c-f98e-4848-b797-58d231378757_hu_82ec9f1066abb562.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/da558d8c-f98e-4848-b797-58d231378757_hu_cca9b343d6421eeb.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Select the correct Outlook profile&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;263&#34;
		data-flex-basis=&#34;631px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;In my case, I&amp;rsquo;m signed into Outlook using the account called &lt;strong&gt;Olivia&lt;/strong&gt; but the Forms data is actually stored in &lt;strong&gt;Emma Dupont&amp;rsquo;s&lt;/strong&gt;* mailbox. Olivia has full access to Emma&amp;rsquo;s Mailbox and can thus use MFCMAPI on her machine.&lt;/p&gt;
&lt;p&gt;Double click the mailbox to open it. This will open a new window.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/6f156165-0434-4e0d-a017-be82ebff2865.png&#34;
	width=&#34;1048&#34;
	height=&#34;828&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/6f156165-0434-4e0d-a017-be82ebff2865_hu_460d4ba3906466b9.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/6f156165-0434-4e0d-a017-be82ebff2865_hu_f62d772b89a90d3e.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Open mailbox in MFCMAPI&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;126&#34;
		data-flex-basis=&#34;303px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Expand the &lt;strong&gt;Root Container&lt;/strong&gt; and then expand &lt;strong&gt;ApplicationDataRoot&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/44e07eba-187f-4217-9c99-ec3ab9fadcc3.png&#34;
	width=&#34;1048&#34;
	height=&#34;828&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/44e07eba-187f-4217-9c99-ec3ab9fadcc3_hu_e8def961dd8bae48.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/44e07eba-187f-4217-9c99-ec3ab9fadcc3_hu_8ce5b361cca9d3aa.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Find the ApplicationDataRoot folder&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;126&#34;
		data-flex-basis=&#34;303px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Look for the folder &lt;strong&gt;c9a559d2-7aab-4f13-a6ed-e7e9c52aec87&lt;/strong&gt; and expand it as well. In there, you will see the IDs of the user&amp;rsquo;s Forms. Identify the Form Id by comparing it to the one shown in the URL on &lt;strong&gt;forms.office.com&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/78f1a696-68a3-4018-9e92-371667941783.png&#34;
	width=&#34;1866&#34;
	height=&#34;821&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/78f1a696-68a3-4018-9e92-371667941783_hu_d263961979a052c9.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/78f1a696-68a3-4018-9e92-371667941783_hu_73e2ef71dc1d2c24.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Find the correct form Id&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;227&#34;
		data-flex-basis=&#34;545px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Once you&amp;rsquo;ve identified the correct form, double click the Id to open it in a new window.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/8b7a81f5-af28-4a27-bfff-cd91debfd604.png&#34;
	width=&#34;2023&#34;
	height=&#34;891&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/8b7a81f5-af28-4a27-bfff-cd91debfd604_hu_c18093c3bbacc45a.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/8b7a81f5-af28-4a27-bfff-cd91debfd604_hu_bffb879958c62e2b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;This will display all data linked to the selected form.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;227&#34;
		data-flex-basis=&#34;544px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Remember that in the beginning of this blog post I mentioned, that the first response which is available in Forms had the Id 2? The other two responses which are available in Forms are 3 and 5. This means that 1 and 4 are missing from Forms because they were deleted.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s see if we can find them in MFCMAPI&amp;hellip;&lt;/p&gt;
&lt;h3 id=&#34;export-deleted-form-responses&#34;&gt;Export deleted form responses
&lt;/h3&gt;&lt;p&gt;In the bottom half of MFCMAPI, sort the &lt;strong&gt;Name&lt;/strong&gt; column ascending and look for the name &lt;strong&gt;0x3662001F&lt;/strong&gt; and select it. Then click on any of the items in the top half of the window. Now you can use the arrow keys to cycle through all items. For all items which store a form response, the value in 0x3662001F will hold a number, which corresponds to the response Id. In this case, I&amp;rsquo;ve found the response &lt;strong&gt;4&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/5019dd67-b8a2-4770-9561-5ba6b284dd16.png&#34;
	width=&#34;2023&#34;
	height=&#34;891&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/5019dd67-b8a2-4770-9561-5ba6b284dd16_hu_d6c56927c3d35c39.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/5019dd67-b8a2-4770-9561-5ba6b284dd16_hu_511bcf8aba7582d8.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Identify the deleted form response&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;227&#34;
		data-flex-basis=&#34;544px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;To export the response data, select the entry in the upper half of the window and right-click to select &lt;strong&gt;Attachments&lt;/strong&gt;, &lt;strong&gt;Save all attachments&amp;hellip;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/2efe93ab-b990-4e1b-89a9-fdc83d5f7284.png&#34;
	width=&#34;2023&#34;
	height=&#34;891&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/2efe93ab-b990-4e1b-89a9-fdc83d5f7284_hu_1dfc1524f0599c1e.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/2efe93ab-b990-4e1b-89a9-fdc83d5f7284_hu_b9c2c7577bdb6501.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Save the attachment&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;227&#34;
		data-flex-basis=&#34;544px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/e374301a-3a5d-484e-bf0d-6ece8d0b30c9.png&#34;
	width=&#34;1419&#34;
	height=&#34;864&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/e374301a-3a5d-484e-bf0d-6ece8d0b30c9_hu_db7bf5b13cfd9472.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/e374301a-3a5d-484e-bf0d-6ece8d0b30c9_hu_80eb839a52ba8138.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Save the CSV file to your PC in a folder of your choice.&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;164&#34;
		data-flex-basis=&#34;394px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Now you can open and view the response in Excel.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/31b52ebd-43d7-4f10-9755-2dc40a8872ba.png&#34;
	width=&#34;1606&#34;
	height=&#34;98&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/31b52ebd-43d7-4f10-9755-2dc40a8872ba_hu_f2b9ec5dbacbf9de.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/31b52ebd-43d7-4f10-9755-2dc40a8872ba_hu_22f5d6104182f75d.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Forms response recovered through MFCMAPI in Excel&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;1638&#34;
		data-flex-basis=&#34;3933px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Repeat these steps for all the deleted response Ids that you need to recover.&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;Summary
&lt;/h2&gt;&lt;p&gt;It&amp;rsquo;s noteworthy that you can also create a support request at Microsoft if you really need to recover deleted responses of Forms. The experience I had with that approach wasn&amp;rsquo;t the greatest. It took me weeks of emailing back and forth with the support engineer until they were finally able to restore the data. I also had to provide a UTC timestamp for the point in time as well as a written and signed consent letter to confirm that Microsoft is allowed to perform the restore. The fact that the restore was performed by a backend engineer and the support engineer only acted as a middleman didn&amp;rsquo;t help either.&lt;/p&gt;
&lt;p&gt;If you go down that route, it also means that all responses that were submitted after the restore point will be lost. If you want to keep all the responses, you&amp;rsquo;&amp;rsquo;ll have to wait for Microsoft to perform the restore, download a copy of the restored data and then ask them to restore the form a second time to the most recent version before the initial restore was performed.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;m not a 100% certain anymore but I believe that they can only perform a restore if the data was deleted less than 30 days ago.&lt;/p&gt;
&lt;p&gt;The response I recovered through MFCMAPI in this blog post was submitted/received/deleted on March 25th, 2024. So, even though the response was deleted almost 2 months ago, it&amp;rsquo;s still available in mailbox. I also spot-checked some mailboxes of other users and they all seemed to contain all the data of all forms ever created by these users. Because of this, I&amp;rsquo;m fairly confident that all Forms related data is stored in a user&amp;rsquo;s mailbox forever.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/image-4.png&#34;
	width=&#34;2016&#34;
	height=&#34;164&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/image-4_hu_c8040b8ff81617b3.png 480w, https://heusser.pro/p/microsoft-forms-data-recovery-going-down-the-rabbit-hole-dgohztjppz49/image-4_hu_170a9b29b33c36f7.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Timestamp of the deleted/recovered response&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;1229&#34;
		data-flex-basis=&#34;2950px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Because the process to get Microsoft to restore the Forms data took so long, I started my own investigation in parallel and actually managed to restore the data myself before Microsoft was able to complete the restore. That being said, if you need to restore a lot of deleted responses it will be a lot of additional work to export all the responses one by one from MFCMAPI and then merge all the recovered CSV files with the rest of your responses again. If Microsoft performs the restore, you can simply download a copy of the restored data from Forms again.&lt;/p&gt;
&lt;p&gt;In case of data loss in Forms, taking a look through MFCMAPI is a great way of quickly recovering the data yourself. Especially if you only need to restore a handful of responses. I only recommend to contact Microsoft support in a last resort type of scenario.&lt;/p&gt;
&lt;p&gt;To avoid a situation like this, I recommend to make users aware of the new &amp;ldquo;Sync results to Excel&amp;rdquo; feature and train them to always start syncing any new form right after it has been created. After all, this feature is a huge improvement to Forms as it&amp;rsquo;s not necessary to create your own Power Automate flow to achieve a similar result anymore.&lt;/p&gt;
&lt;p&gt;If this blog post has made your day because you were able to recover some precious Forms data, please consider supporting my work by making a donation on my &lt;a class=&#34;link&#34; href=&#34;https://github.com/sponsors/mozziemozz?frequency=one-time&amp;amp;sponsor=mozziemozz&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;GitHub Sponsors Profile&lt;/a&gt;.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>PowerShell Script Example: Upload Small Files to SharePoint via Microsoft Graph</title>
        <link>https://heusser.pro/p/powershell-script-example-upload-small-files-via-microsoft-graph-z45tbunyoa85/</link>
        <pubDate>Sat, 13 Apr 2024 11:25:07 +0000</pubDate>
        
        <guid>https://heusser.pro/p/powershell-script-example-upload-small-files-via-microsoft-graph-z45tbunyoa85/</guid>
        <description>&lt;h2 id=&#34;lacking-documentation&#34;&gt;Lacking Documentation
&lt;/h2&gt;&lt;p&gt;I recently wanted to upload a couple of files to SharePoint Online using Microsoft Graph. It took me a while to figure it out so I thought that sharing my working script examples will probably help other people accomplish this task faster.&lt;/p&gt;
&lt;p&gt;The documentation for uploading files with Microsoft Graph can be found &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/graph/api/driveitem-put-content?view=graph-rest-1.0&amp;amp;tabs=http&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;. The problem is that Microsoft Learn only lists an example for a web request and doesn&amp;rsquo;t really include any examples as to what the &lt;strong&gt;Body&lt;/strong&gt; of the request needs to contain.&lt;/p&gt;
&lt;h3 id=&#34;example-as-of-2024-04-13&#34;&gt;Example as of 2024-04-13
&lt;/h3&gt;&lt;p&gt;This is all we get today:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-http&#34; data-lang=&#34;http&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;PUT https://graph.microsoft.com/v1.0/me/drive/root:/FolderA/FileB.txt:/content
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;Content-Type: text/plain
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;The contents of the file goes here.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;While there is an example of how to update an existing file using &lt;code&gt;Set-MgDriveItemContent&lt;/code&gt; it doesn&amp;rsquo;t mention how to construct the &lt;code&gt;$params&lt;/code&gt; either:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-PowerShell&#34; data-lang=&#34;PowerShell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Import-Module&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Graph&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Files&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$params&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;The&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;contents&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;goes&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;here&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Set-MgDriveItemContent&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-DriveId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$driveId&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-DriveItemId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$driveItemId&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-BodyParameter&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$params&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;script-examples&#34;&gt;Script Examples
&lt;/h2&gt;&lt;p&gt;Through trial and error, I discovered two different ways of uploading files to SharePoint Online through Microsoft Graph. One uses a simple web request using &lt;code&gt;Invoke-RestMethod&lt;/code&gt; and app authentication and the other one uses the &lt;code&gt;Invoke-GraphRequest&lt;/code&gt; Cmdlet from the &lt;code&gt;Microsoft.Graph.Authentication&lt;/code&gt; module. The second one uses delegated permissions.&lt;/p&gt;
&lt;p&gt;As it&amp;rsquo;s often the case with Graph operations, you first need to know some specific Ids before you can make your request. In this case, we need to know the Id of the &lt;strong&gt;drive&lt;/strong&gt; in SharePoint. The DriveId is the Id of the Document Library. However, to get the DriveId, we also need to know the Id of the SharePoint Site. Therefore we must first find the SiteId, and then the DriveId. Unfortunately, the examples on the Graph documentation always assume that we already know these Ids so we need to get this data on our own&amp;hellip;&lt;/p&gt;
&lt;h3 id=&#34;example-using-delegated-auth-and-invoke-graphrequest&#34;&gt;Example Using Delegated Auth and Invoke-GraphRequest
&lt;/h3&gt;&lt;p&gt;Let&amp;rsquo;s look at the script using the Graph PowerShell module first. The first thing you want to do is to replace &lt;code&gt;$siteName&lt;/code&gt; with the name of your destination site. When you run the script, you&amp;rsquo;ll be prompted to sign into Microsoft Graph. Make sure that you&amp;rsquo;ve previously configured and consented the delegated permissions &lt;code&gt;Sites.Read.All&lt;/code&gt; and &lt;code&gt;Files.ReadWrite.All&lt;/code&gt; to the &lt;strong&gt;Microsoft Graph Command Line Tools&lt;/strong&gt; Enterprise Application or that you&amp;rsquo;re using your own App which has at least these two permissions configured.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$siteName&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Azure Automation&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Connect-MgGraph&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Site&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$site&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-MgSite&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Search&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$siteName&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$siteId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$site&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;id&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Drives&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$drives&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-MgSiteDrive&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-SiteId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$siteId&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-All&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$drive&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$drives&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Documents&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-or&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Dokumente&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# SharePoint Drive Id (Document Library)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$driveId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$drive&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;id&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# File to upload&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$filePath&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;C:\Temp\Test.txt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$fileProperties&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-ChildItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$filePath&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Read the file content as a byte array&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$fileContent&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;System.IO.File&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadAllBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$filePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Destination file name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$destinationName&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$fileProperties&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BaseName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-Date&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Format&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;yyyy-MM-dd HH-mm-ss&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$fileProperties&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Extension&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Upload the file to SharePoint&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-GraphRequest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PUT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/drives/&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$driveId&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/root:/Test/&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$destinationName&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;`:/content&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Body&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$fileContent&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/octet-stream&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Header&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;This will upload files up to 250 MB to SharePoint Online. If you rather want to use application authentication and not have any dependencies on installed Graph modules, you can do the same using HTTP requests.&lt;/p&gt;
&lt;h3 id=&#34;example-using-app-auth-and-invoke-restmethod&#34;&gt;Example Using App Auth and Invoke-RestMethod
&lt;/h3&gt;&lt;p&gt;The required permissions stay the same as for the first example. However, in this case they need to be application permissions. This script uses an external function to acquire a token which is then used to perform the web requests to the Graph API. The easiest way is to just clone the entire &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;repository&lt;/a&gt;. This will keep the relative paths working. Alternatively, you can download the function from &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation/blob/main/Functions/Connect-MgGraphHTTP.ps1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt; and either copy it into the script or adjust the relative path. At this point, I&amp;rsquo;d like to thank Alex Asplund again for providing this awesome function to acquire a token for Microsoft Graph. I use &lt;a class=&#34;link&#34; href=&#34;https://adamtheautomator.com/powershell-graph-api&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;his function&lt;/a&gt; in quite a lot in my scripts.&lt;/p&gt;
&lt;p&gt;Before you run the script, fill in your own data for &lt;code&gt;$TenantId&lt;/code&gt;, &lt;code&gt;$AppId&lt;/code&gt;, &lt;code&gt;$AppSecret&lt;/code&gt; and &lt;code&gt;$SiteName&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$TenantId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$AppId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$AppSecret&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$SiteName&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Azure Automation&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Functions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Connect-MgGraphHTTP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Connect-MgGraphHTTP&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-TenantId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$TenantId&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-AppId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$AppId&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-AppSecret&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$AppSecret&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Site&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$site&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Header&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/sites?search=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$siteName&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$siteId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$site&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;id&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Drives&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$drives&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Get&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Header&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/sites/&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$siteId&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/drives&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# SharePoint Drive Id (Document Library)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$driveId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$drives&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Documents&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-or&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Dokumente&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Id&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# File to upload&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$filePath&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;C:\Temp\Test.txt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$fileProperties&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-ChildItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$filePath&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Read the file content as a byte array&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$fileContent&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;System.IO.File&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadAllBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$filePath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Destination file name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$destinationName&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$fileProperties&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BaseName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-Date&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Format&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;yyyy-MM-dd HH-mm-ss&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$fileProperties&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Extension&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Upload the file to SharePoint&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-RestMethod&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PUT&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;https://graph.microsoft.com/v1.0/drives/&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$driveId&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;/root:/Test/&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$destinationName&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;`:/content&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Body&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$fileContent&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ContentType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;application/octet-stream&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Headers&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Header&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;This code will give you the exact same result as the first script does but it will only use out-of-the-box PowerShell commands and doesn&amp;rsquo;t have any dependencies on PowerShell modules.&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;Summary
&lt;/h2&gt;&lt;p&gt;I hope you like these two examples on how to upload small files to SharePoint Online using Microsoft Graph. I think this can be a really powerful tool, especially when you pair it with your own Entra ID App Registration/Enterprise Application. When you create your own app to connect to Microsoft Graph, you can limit the use of it to a specific subset of users, such as IT staff and the app is only allowed to read all sites and read/write all files the signed in user has access to.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;m thinking of scenarios where IT runs a diagnostic script or any other script that collects information on a users device and then uploads the log files/collected data directly to the specified SharePoint Site.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Teams Shared Voicemail for Basic Call Flows</title>
        <link>https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/</link>
        <pubDate>Wed, 17 Jan 2024 19:59:21 +0000</pubDate>
        
        <guid>https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/</guid>
        <description>&lt;img src="https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/cover.png" alt="Featured image of post Teams Shared Voicemail for Basic Call Flows" /&gt;&lt;p&gt;Not too long ago I wrote &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc&#34; &gt;this&lt;/a&gt; blog post about the ultimate Teams shared voicemail solution. This solution assumed a full blown call flow with on-call coverage and an advanced notification mechanism. Today I&amp;rsquo;m going to show you a simplified but yet optimized version of my Power Automate Flow. While the previous solution works without any issues, it&amp;rsquo;s not really scalable. If you have a lot of queues, you probably don&amp;rsquo;t want to create a dedicated shared mailbox for every queue that needs shared voicemail access via Teams and Adaptive Cards. That just adds unnecessary management overhead to your Teams phone environment.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;ve got some good news for you. I found a way to do it all without the need of shared mailbox. The flow is now directly triggered by a new email to the Microsoft 365 Group instead of a new email to the shared mailbox. Furthermore, all other mail related actions in the flow have been updated to use the &lt;strong&gt;Office 365 Groups Mail&lt;/strong&gt; connector as well.&lt;/p&gt;
&lt;h2 id=&#34;call-flow-diagram&#34;&gt;Call Flow Diagram
&lt;/h2&gt;&lt;p&gt;Let&amp;rsquo;s look at the scenario first. This time around, it&amp;rsquo;s a very simple call flow which consists of an auto attendant, a call queue and a Microsoft 365 Group as shared voicemail target.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/PS_Test_EV_Enabled_AA_CallFlow.png&#34;
	width=&#34;7840&#34;
	height=&#34;7820&#34;
	srcset=&#34;https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/PS_Test_EV_Enabled_AA_CallFlow_hu_260817bfe9a7390c.png 480w, https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/PS_Test_EV_Enabled_AA_CallFlow_hu_615eefe02aa2a20a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;100&#34;
		data-flex-basis=&#34;240px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;flow-trigger&#34;&gt;Flow Trigger
&lt;/h2&gt;&lt;p&gt;The flow is now triggered by &lt;strong&gt;When a new email arrives to a group&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/Screenshot-2024-46-17-21-46-39.png&#34;
	width=&#34;920&#34;
	height=&#34;172&#34;
	srcset=&#34;https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/Screenshot-2024-46-17-21-46-39_hu_e960f18bdafca6b5.png 480w, https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/Screenshot-2024-46-17-21-46-39_hu_7c0e4795983a9ba4.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;534&#34;
		data-flex-basis=&#34;1283px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;flow-actions&#34;&gt;Flow Actions
&lt;/h2&gt;&lt;p&gt;Using the Office 365 Groups Mail connector is not as straight forward as retrieving an email from a shared mailbox or a normal user mailbox. There are conversations, threads and thread posts. Everything must be queried in the correct order to receive all the data that&amp;rsquo;s needed.&lt;/p&gt;
&lt;p&gt;This is how it&amp;rsquo;s done.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/Screenshot-2024-47-17-21-47-39.png&#34;
	width=&#34;1104&#34;
	height=&#34;1365&#34;
	srcset=&#34;https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/Screenshot-2024-47-17-21-47-39_hu_2cf1d40bdfce727.png 480w, https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/Screenshot-2024-47-17-21-47-39_hu_20c493535ae8346f.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;80&#34;
		data-flex-basis=&#34;194px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Because this call flow doesn&amp;rsquo;t have an on-call option, the flow uses way less actions. However, there&amp;rsquo;s still a parallel branch needed. Once the Adaptive Card has been posted to the Teams channel, the flow waits for a reply so the &lt;code&gt;messageId&lt;/code&gt; of the message containing the Adaptive card is still unknown to the flow. That&amp;rsquo;s where the parallel branch comes into play. It will get the &lt;code&gt;messageId&lt;/code&gt; and then the &lt;code&gt;userId&lt;/code&gt; of each Team member. Finally, the flow will send a Teams activity feed notification for the new Adaptive Card to each Team member. By using the flow to send the notifications we don&amp;rsquo;t need to worry about users not enabling notifications for all new channel posts. They&amp;rsquo;ll have no excuse if they ever forget to call somebody back.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/flow-notification-2024-59-17-21-59-53.png&#34;
	width=&#34;1944&#34;
	height=&#34;1585&#34;
	srcset=&#34;https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/flow-notification-2024-59-17-21-59-53_hu_c7ba3ead60d40c9e.png 480w, https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/flow-notification-2024-59-17-21-59-53_hu_dda079d38fd74060.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;122&#34;
		data-flex-basis=&#34;294px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;result-in-teams&#34;&gt;Result in Teams
&lt;/h2&gt;&lt;p&gt;This is how the notification looks like for end users in Teams. In case the audio player on the card is not working for whatever reason, I&amp;rsquo;ve also included an additional button called &lt;strong&gt;Open MP3&lt;/strong&gt; which will open the audio file in Microsoft Stream when it&amp;rsquo;s clicked.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/teams-voicemail-notification-2024-34-17-23-34-17.png&#34;
	width=&#34;2241&#34;
	height=&#34;932&#34;
	srcset=&#34;https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/teams-voicemail-notification-2024-34-17-23-34-17_hu_b33b2e3438113f62.png 480w, https://heusser.pro/p/teams-shared-voicemail-for-basic-call-flows-1qru2qqlx0ju/teams-voicemail-notification-2024-34-17-23-34-17_hu_58b7cfe370057bde.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;240&#34;
		data-flex-basis=&#34;577px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;final-notes&#34;&gt;Final Notes
&lt;/h2&gt;&lt;p&gt;If you have an on-call option in your call flow but you still want to take advantage of the simplified trigger without the shared mailbox, you can just import both flows into your Power Automate Environment and build a new flow from scratch which combines the best of both worlds. The Microsoft Edge split screen feature and Power Automate&amp;rsquo;s copy/paste feature are a great help for that.&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;Summary
&lt;/h2&gt;&lt;p&gt;The initial scenario which included the on-call notification mechanism was designed for a very specific use case. This iteration of my Teams Shared Voicemail solution should fit a lot more customer scenarios. It&amp;rsquo;s easier to understand and implement and also has less moving parts. Feel free to download the basic version of my flow from &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation/raw/main/Scripts/PowerAutomate/Flows/TeamsSharedVoicemailBasicV3%28M365GroupInbox%29_GitHub.zip&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt; and give it a try. Just make sure to replace anything that&amp;rsquo;s specific to my lab tenant with your actual values.&lt;/p&gt;
&lt;p&gt;If you need help importing the flow, please read this section in the &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/#the-flow&#34; &gt;initial article&lt;/a&gt; first.&lt;/p&gt;
&lt;p&gt;If this blog provides additional value to you or your company, I want you to know that you can always show your support by donating on my &lt;a class=&#34;link&#34; href=&#34;https://github.com/sponsors/mozziemozz?frequency=one-time&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;GitHub Sponsors&lt;/a&gt; profile.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>The Ultimate Teams Shared Voicemail Solution</title>
        <link>https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/</link>
        <pubDate>Wed, 06 Dec 2023 20:59:21 +0000</pubDate>
        
        <guid>https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/</guid>
        <description>&lt;p&gt;In June last year I wrote about &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4&#34; &gt;handling Teams shared voicemail more efficiently&lt;/a&gt;. Although the principle is the same today, a couple of things have changed which has allowed me to build a much more elegant version of this Power Automate flow.&lt;/p&gt;
&lt;p&gt;About a year ago, I also &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/microsoft-teams-shared-voicemail-now-supports-distribution-lists-and-mail-enabled-security-groups-cc6453f88f1&#34; &gt;wrote&lt;/a&gt; about shared voicemail now supporting not just Microsoft 365 groups but also distribution lists and mail enabled security groups. While it’s great to have more options, that doesn’t solve the issue at its core.&lt;/p&gt;
&lt;p&gt;My main complaint about shared voicemail in Teams is that it’s hard to keep an overview over which voicemails have already been processed (as in the person who left the message has been called back). You either train people to regularly check their Microsoft 365 group inboxes or you enable &lt;a class=&#34;link&#34; href=&#34;https://support.microsoft.com/en-us/office/follow-a-group-in-outlook-e147fc19-f548-4cd2-834f-80c6235b7c36#:~:text=Follow%20a%20group%3A%201%20In%20Outlook%20for%20Windows%2C,list%2C%20select%20Not%20following%20%3E%20Follow%20in%20Inbox.&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;follow in inbox&lt;/a&gt; for all the group&amp;rsquo;s members. Follow in inbox will make sure that no voicemail/email gets lost, but it also means that more communication is required within a team to make sure that the caller is not called back multiple times or not at all (because everybody believes that someone else will call back). My Power Automate Flow solves this issue by delivering the voicemails directly into a Teams channel.&lt;/p&gt;
&lt;h4 id=&#34;call-flowdiagram&#34;&gt;Call Flow Diagram
&lt;/h4&gt;&lt;p&gt;This is the example scenario. A relatively simple call flow with an auto attendant which routes calls to a call queue during business hours and redirects to a second auto attendant after hours. The second auto attendant offers callers a choice to either leave a message or get connected to the on-call service.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1RMziOV2rbncLrbdFMbnAzw.png&#34;
	width=&#34;7840&#34;
	height=&#34;5630&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1RMziOV2rbncLrbdFMbnAzw_hu_8f20dfd6747f1d83.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1RMziOV2rbncLrbdFMbnAzw_hu_ec119919f185c28f.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;139&#34;
		data-flex-basis=&#34;334px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I purposely used a dedicated auto attendant for the after-hours so it can be re-used if the call flow is extended in the future. You can see that the after-hours call flow of the main auto attendant (PS Test EV Enabled AA) only plays the greeting &lt;em&gt;Welcome to heusser.pro. You’re calling us outside of our business hours&lt;/em&gt;. And &lt;strong&gt;PS Test EV Enabled On Call AA&lt;/strong&gt; does the actual after-hours routing. By splitting the greeting, I could also use the IVR of the second auto attendant for another call queue or for holidays configured on the main auto attendant. This way, I won’t have to build a new/the same IVR per holiday call handling which saves time and reduces management effort.&lt;/p&gt;
&lt;p&gt;The second reason I built it like this is that the name of the auto attendant includes the keyword &lt;strong&gt;On Call&lt;/strong&gt;. Because the on-call call queue uses the same naming convention. This means that the email containing the voicemail includes the name of the voice app in which the call was sent to voicemail, which makes it easy to determine if a voicemail was left during business hours or during on-call/after hours.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1DFC8bAkYRUtHZJIpF21w.png&#34;
	width=&#34;2033&#34;
	height=&#34;543&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1DFC8bAkYRUtHZJIpF21w_hu_4f269ca5ccda894a.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1DFC8bAkYRUtHZJIpF21w_hu_b5549786c88c9422.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;374&#34;
		data-flex-basis=&#34;898px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;shared-voicemail&#34;&gt;Shared Voicemail
&lt;/h4&gt;&lt;p&gt;As you can see in the diagram, in every case where a call cannot be answered, it goes to the same shared voicemail group. This Microsoft 365 group is the same group that’s linked to the Team which also hosts the two voice enabled channels which are linked to the call queues.&lt;/p&gt;
&lt;p&gt;Instead of relying on people either checking the group mailbox for new voicemail messages or subscribing to the group mailbox, we’re going to build a Power Automate flow to deliver voicemail messages directly into a Teams channel.&lt;/p&gt;
&lt;p&gt;The first thing we need to do is to create or define a shared mailbox so we can subscribe it to new messages of the M365 group. The flow will only process emails which have attachments, and the attachments name must end with &lt;code&gt;.mp3&lt;/code&gt; . But I still strongly recommend to create a dedicated shared mailbox which will only receive emails from the M365 group. To keep things clean, I would also deter from sending any kind of other emails to the M365 group. If you also use a dedicated Team for your call queues, that shouldn’t be an issue.&lt;/p&gt;
&lt;p&gt;Once the shared mailbox is created, we need to give the user which will own the Flow full access to it.&lt;/p&gt;
&lt;p&gt;You will need the PowerShell module &lt;code&gt;ExchangeOnlineManagement&lt;/code&gt; and need to run &lt;code&gt;Connect-ExchangeOnline&lt;/code&gt; before you can run these commands.&lt;/p&gt;
&lt;h3 id=&#34;create-shared-mailbox&#34;&gt;Create shared mailbox
&lt;/h3&gt;&lt;p&gt;New-Mailbox -Shared -Name &amp;ldquo;PS Test EV Enabled SharedVoicemail&amp;rdquo; -DisplayName &amp;ldquo;PS Test EV Enabled SharedVoicemail&amp;rdquo; -Alias &amp;ldquo;PSTestEVEnabledSharedVoicemail&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Start-Sleep -Seconds 30&lt;/p&gt;
&lt;h4 id=&#34;grant-full-mailbox-access-to-the-flow-owner&#34;&gt;Grant full mailbox access to the flow owner
&lt;/h4&gt;&lt;p&gt;Add-MailboxPermission -Identity &amp;ldquo;PSTestEVEnabledSharedVoicemail&amp;rdquo; -User &amp;ldquo;&lt;a class=&#34;link&#34; href=&#34;mailto:mozzie@mozzism.ch&#34; &gt;mozzie@mozzism.ch&lt;/a&gt;&amp;rdquo; -AccessRights FullAccess -InheritanceType All&lt;/p&gt;
&lt;h4 id=&#34;subscribing-the-shared-mailbox-to-the-m365-groupinbox&#34;&gt;Subscribing the Shared Mailbox to the M365 Group Inbox
&lt;/h4&gt;&lt;p&gt;Next, we add the newly created shared mailbox as a member of the group and then also subscribe it to the group’s inbox.&lt;/p&gt;
&lt;h4 id=&#34;add-the-shared-mailbox-as-a-member-to-the-m365-group&#34;&gt;Add the shared mailbox as a member to the M365 group
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Add-UnifiedGroupLinks&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Identity&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$groupId&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-LinkType&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Members&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Links&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;PSTestEVEnabledSharedVoicemail&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id=&#34;subscribe-the-shared-mailbox-to-the-m365-groups-emails-enable-follow-in-inbox&#34;&gt;Subscribe the shared mailbox to the M365 group&amp;rsquo;s emails (enable follow in inbox)
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Add-UnifiedGroupLinks&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Identity&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$groupId&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-LinkType&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Subscribers&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Links&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;PSTestEVEnabledSharedVoicemail&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;We can verify that the shared mailbox is indeed subscribed by using this code. (I have no idea why it says &lt;code&gt;UserMailbox&lt;/code&gt; though…)&lt;/p&gt;
&lt;p&gt;PS V:\GitHub\TeamsPhoneAutomation&amp;gt; Get-UnifiedGroupLinks -Identity $groupId -LinkType Subscribers&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Name                               RecipientType  
----                               -------------  
PS Test EV Enabled SharedVoicemail UserMailbox
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The idea here is that only the shared mailbox gets new voicemails in its mailbox. None of the users should get the voicemails in their personal inbox because they receive them in Teams. This allows for much better and efficient collaboration.&lt;/p&gt;
&lt;h3 id=&#34;the-result&#34;&gt;The Result
&lt;/h3&gt;&lt;p&gt;This is the Team I created for this call flow. Channels 1 and 2 are linked to the queues which receive calls. 3 and 4 are the ones which receive the voicemails. As explained earlier in this article, the flow can easily determine at which stage in the call flow (during business hours or on-call/after hours) a voicemail was left. That’s why we have two separate voicemail channels.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1ERgB32HAsCptqOqTdj0BGw.png&#34;
	width=&#34;1054&#34;
	height=&#34;489&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1ERgB32HAsCptqOqTdj0BGw_hu_2c87107b1a734ab8.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1ERgB32HAsCptqOqTdj0BGw_hu_abe867a345c229d2.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;215&#34;
		data-flex-basis=&#34;517px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;voicemail-during-businesshours&#34;&gt;Voicemail During Business Hours
&lt;/h4&gt;&lt;p&gt;Adaptive Cards in Teams now support &lt;a class=&#34;link&#34; href=&#34;https://adaptivecards.io/explorer/Media.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;media&lt;/a&gt;. This means that we can now embed an audio file which is stored on SharePoint directly on an adaptive card and we’ll get a neat little Stream powered media player inside Teams.&lt;/p&gt;
&lt;p&gt;The card will include the number or the email address of the user who left the voicemail.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1N07rBJWK18W1euy4cQzG6g.png&#34;
	width=&#34;1382&#34;
	height=&#34;763&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1N07rBJWK18W1euy4cQzG6g_hu_9d324ee456607556.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1N07rBJWK18W1euy4cQzG6g_hu_cb786e0a7b08ea15.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;
&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1fonLxu3PBkT7HhWfqp6jQ.png&#34;
	width=&#34;1384&#34;
	height=&#34;760&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1fonLxu3PBkT7HhWfqp6jQ_hu_df0b9be26b1b3310.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1fonLxu3PBkT7HhWfqp6jQ_hu_4feb3c8217f1ba70.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;182&#34;
		data-flex-basis=&#34;437px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;After members of the channel have listened to a voicemail, they can call the person who left a voicemail back directly from the channel.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1e9z0eSHELDBRHsHUBQeObA.png&#34;
	width=&#34;885&#34;
	height=&#34;232&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1e9z0eSHELDBRHsHUBQeObA_hu_ececa6da711a1655.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1e9z0eSHELDBRHsHUBQeObA_hu_39c5d48ac1d9d47c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;381&#34;
		data-flex-basis=&#34;915px&#34;
	
&gt;
&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1RUyvz8rZnRkIvd09QDxug.png&#34;
	width=&#34;882&#34;
	height=&#34;230&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1RUyvz8rZnRkIvd09QDxug_hu_a6b8543956033421.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1RUyvz8rZnRkIvd09QDxug_hu_72345325d415829b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;383&#34;
		data-flex-basis=&#34;920px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;updated-adaptivecards&#34;&gt;Updated Adaptive Cards
&lt;/h4&gt;&lt;p&gt;Once a team member has called back, a card can be marked as completed. This will update the card so that all other team members can see that there’s no action left to take. It’s even possible to see who has marked a card as completed.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/19JfyMJstjSP28RABrpIVQ.png&#34;
	width=&#34;1384&#34;
	height=&#34;481&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/19JfyMJstjSP28RABrpIVQ_hu_49a699708462405f.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/19JfyMJstjSP28RABrpIVQ_hu_9d38a50bef3184fb.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;287&#34;
		data-flex-basis=&#34;690px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Completed cards don’t show the media player anymore. However, the &lt;strong&gt;Voicemail Details&lt;/strong&gt; button will reveal the original card including the audio file again. This is helpful in case somebody needs to listen to a message again or the &lt;strong&gt;Call Completed&lt;/strong&gt; button was clicked by accident.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1ACYALybGWJoArNe8UambPA.png&#34;
	width=&#34;1379&#34;
	height=&#34;1003&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1ACYALybGWJoArNe8UambPA_hu_f545d5486ad946ba.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1ACYALybGWJoArNe8UambPA_hu_e67878864d57c0c0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;137&#34;
		data-flex-basis=&#34;329px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Users don’t really need to worry about this, but technically, the files get uploaded to the channel’s folder in the Teams’ SharePoint site.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1Z4LN9USbrAkCKJ13EzaKA.png&#34;
	width=&#34;1468&#34;
	height=&#34;422&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1Z4LN9USbrAkCKJ13EzaKA_hu_3194ffe0c91e66d.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1Z4LN9USbrAkCKJ13EzaKA_hu_3869f30fe3592f9e.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;347&#34;
		data-flex-basis=&#34;834px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Completed cards also feature a &lt;strong&gt;Show Metrics&lt;/strong&gt; button which will tell you when a voicemail was received, when it was completed and how many hours and minutes it took until it was marked as completed. Based on that, it will display a different emoji.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/133dz2lFitMlRusIK8k3G1Q.png&#34;
	width=&#34;1385&#34;
	height=&#34;539&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/133dz2lFitMlRusIK8k3G1Q_hu_1751dc284ba1d809.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/133dz2lFitMlRusIK8k3G1Q_hu_2de9e647c863a89e.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;256&#34;
		data-flex-basis=&#34;616px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Less or equal 1 hour = 😊&lt;br&gt;
Less or equal 2 hours = 😐&lt;br&gt;
More than 2 hours = 😞&lt;/p&gt;
&lt;h4 id=&#34;voicemail-during-after-hours-oncall&#34;&gt;Voicemail During After Hours (On Call)
&lt;/h4&gt;&lt;p&gt;Voicemails which were left outside business hours will go into the &lt;strong&gt;Voicemail On Call&lt;/strong&gt; channel. When a voicemail is left during on-call hours, it means that the people who are on-call missed a call and should call back as soon as possible. Thus, we want to have an appropriate alerting system in place.&lt;/p&gt;
&lt;p&gt;I’m using a shift which is linked to my Call Queue Team which defines which user is on call on which days.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1vfGE9YXP2x2YJx0yBEig.png&#34;
	width=&#34;2149&#34;
	height=&#34;961&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1vfGE9YXP2x2YJx0yBEig_hu_629788c01542017f.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1vfGE9YXP2x2YJx0yBEig_hu_219cba109726bf0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;223&#34;
		data-flex-basis=&#34;536px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The great thing about using Shifts is that this will automatically create a Tag with the Shift name in the Team which is linked to the shift and update the members of the Tag dynamically. In other words, the tag always includes only the users which have a currently active shift assigned.&lt;/p&gt;
&lt;p&gt;When a new voicemail is received in the On Call channel, all members of the On Call Shift Tag will get notified about new voicemails every 15 minutes for 4 hours if a card is not completed sooner. As soon as card is completed, the notifications stop.&lt;/p&gt;
&lt;p&gt;In case of an on-call voicemail the flow will take at least 15 minutes to complete, even if the card was marked as completed sooner. This is because there’s a delay action which waits for 15 minutes before it checks again if the card has been completed.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1IBU2Pc9lwN7E0D5TMxb1iw.png&#34;
	width=&#34;1554&#34;
	height=&#34;740&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1IBU2Pc9lwN7E0D5TMxb1iw_hu_aa64a69e905122bb.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1IBU2Pc9lwN7E0D5TMxb1iw_hu_57d982876e3bc0bc.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;210&#34;
		data-flex-basis=&#34;504px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Because the flow is still waiting on the card to be completed in the on-call scenario, there’s no way to get the message Id of the adaptive card that was sent to the channel from a subsequent step in the flow. Instead, the flow needs to retrieve the latest message which was sent to the channel in a parallel branch.&lt;/p&gt;
&lt;p&gt;Because of that, I strongly recommend turning on channel moderation and prohibit members from posting new messages to the &lt;strong&gt;On Call Voicemail&lt;/strong&gt; channel. This way, we can make sure that the newest message in the channel is always the adaptive card which was sent by the flow and not something posted by a user.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1vHUTKmRHNbKSXstHFfjQhQ.png&#34;
	width=&#34;1025&#34;
	height=&#34;1195&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1vHUTKmRHNbKSXstHFfjQhQ_hu_ed8e1b08e26e972f.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1vHUTKmRHNbKSXstHFfjQhQ_hu_6915680e687aeebb.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;85&#34;
		data-flex-basis=&#34;205px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Channel members should only be allowed to reply to messages so that they can e.g. mention a team member who should carry out a call back action.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1jbbDZa4DBMfNtFmRN7qw.png&#34;
	width=&#34;1388&#34;
	height=&#34;846&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1jbbDZa4DBMfNtFmRN7qw_hu_8f2fda2d7d5e8615.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1jbbDZa4DBMfNtFmRN7qw_hu_fdcc56d5cfd2dace.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;164&#34;
		data-flex-basis=&#34;393px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I changed the delay action from 15 minutes to 15 seconds for demonstration purposes. Here you can see three Teams activity feed notifications which link directly to the channel message containing the voicemail. Using a Teams activity feed notification instead of a channel message reply has two main advantages. It doesn’t clutter the channel feed and members don’t need to specifically enable notifications for all channel messages to get the alerts.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1H4mIfIX2E8FpbkR1aqUX0A.png&#34;
	width=&#34;2284&#34;
	height=&#34;961&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1H4mIfIX2E8FpbkR1aqUX0A_hu_78eb2723b933f471.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1H4mIfIX2E8FpbkR1aqUX0A_hu_bb545286fbe90dde.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;237&#34;
		data-flex-basis=&#34;570px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;the-flow&#34;&gt;The Flow
&lt;/h3&gt;&lt;p&gt;The flow has become quite large and Power Automate keeps reminding me that it contains too many actions to use the new AI-powered designer. 🙃&lt;/p&gt;
&lt;p&gt;To make it easier for you, I exported the flow and made it available for download &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation/blob/main/Scripts/PowerAutomate/Flows/TeamsSharedVoicemailv2.4_GitHub.zip&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;. To import it, go to &lt;a class=&#34;link&#34; href=&#34;https://make.powerautomate.com&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://make.powerautomate.com&lt;/a&gt; and select &lt;strong&gt;Import&lt;/strong&gt; and then &lt;strong&gt;Import Package (Legacy)&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Select an existing or set up a new connection for each of the resources listed before you click &lt;strong&gt;Import.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1PjOBPj93JF5mUnRj9jX6g.png&#34;
	width=&#34;2095&#34;
	height=&#34;1392&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1PjOBPj93JF5mUnRj9jX6g_hu_225c36404e438c1b.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1PjOBPj93JF5mUnRj9jX6g_hu_f5b553056da9b909.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;361px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Unfortunately, you still need to expand every action and check if you need to modify/update the values. To make it easier for you, I added a note to all the actions which need to be updated. Here are some examples.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/13a2N43Dn0FSyhwhumCryDw.png&#34;
	width=&#34;915&#34;
	height=&#34;351&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/13a2N43Dn0FSyhwhumCryDw_hu_743e7f965189621d.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/13a2N43Dn0FSyhwhumCryDw_hu_411f7983b045b97c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;260&#34;
		data-flex-basis=&#34;625px&#34;
	
&gt;
&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1xugazCEKqoQ8ujjNlToClQ.png&#34;
	width=&#34;1933&#34;
	height=&#34;907&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1xugazCEKqoQ8ujjNlToClQ_hu_743b5d0b1a64f03.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1xugazCEKqoQ8ujjNlToClQ_hu_6591f6409bf09161.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;213&#34;
		data-flex-basis=&#34;511px&#34;
	
&gt;
&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1UbT09eRnOVQ5C8w3jb8Lw.png&#34;
	width=&#34;913&#34;
	height=&#34;349&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1UbT09eRnOVQ5C8w3jb8Lw_hu_f42b60474443fa0d.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1UbT09eRnOVQ5C8w3jb8Lw_hu_83f2757fea081d92.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;261&#34;
		data-flex-basis=&#34;627px&#34;
	
&gt;
&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1uFe7nY71LGjXHUfElaa1KQ.png&#34;
	width=&#34;914&#34;
	height=&#34;1033&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1uFe7nY71LGjXHUfElaa1KQ_hu_665132cb22bf0eab.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1uFe7nY71LGjXHUfElaa1KQ_hu_972c3ea6e84eb429.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;88&#34;
		data-flex-basis=&#34;212px&#34;
	
&gt;
&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1NU84CkNj9stAoCGxHSGUw.png&#34;
	width=&#34;916&#34;
	height=&#34;218&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1NU84CkNj9stAoCGxHSGUw_hu_68cffa45d72fe459.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1NU84CkNj9stAoCGxHSGUw_hu_1cabe4a793d65c59.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;420&#34;
		data-flex-basis=&#34;1008px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;You get the gist. At least you won’t have to create all the actions manually.&lt;/p&gt;
&lt;h3 id=&#34;summary&#34;&gt;Summary
&lt;/h3&gt;&lt;p&gt;Even though it took me days to finally get this right, I had so much fun building this. Besides that, I also learned a lot of new stuff about Power Automate. In fact, this was the very first parallel branch I ever built. It’s awesome that Adaptive Card in Teams now support media. I think this is a really great example of how powerful Adaptive Cards can be. They not only look beautiful, but they also provide a fantastic user experience since users will be able to interact with them directly in Teams.&lt;/p&gt;
&lt;p&gt;I’d be lying if I said that I wasn’t a little proud of the flow and process I built. The only thing I’m still missing with this solution is to be able to create Teams deep links which also specify which outbound caller id should be used when a call back link is clicked. Wouldn’t it just be great if we could say that users should always use the queue’s/attendant’s phone number when they call somebody back from a voicemail card?&lt;/p&gt;
&lt;p&gt;What’s funny is that the Teams mobile apps actually prompt users which have multiple calling line identities assigned to select an identity before the call is made.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1rI1ZJKlVVJ1J6E0PPhrg.png&#34;
	width=&#34;1125&#34;
	height=&#34;2436&#34;
	srcset=&#34;https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1rI1ZJKlVVJ1J6E0PPhrg_hu_2bb9d93d996b8ad1.png 480w, https://heusser.pro/p/the-ultimate-teams-shared-voicemail-solution-5dd2ce57facc/1rI1ZJKlVVJ1J6E0PPhrg_hu_8fc425194d8f16f7.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;46&#34;
		data-flex-basis=&#34;110px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;As you can tell, I’m pretty excited about all of this. I hope you like it too and that you can implement it for your users or customers as well.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Teams Phone Number Management List Part 3</title>
        <link>https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/</link>
        <pubDate>Thu, 16 Nov 2023 10:30:16 +0000</pubDate>
        
        <guid>https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/</guid>
        <description>&lt;p&gt;I think it’s safe to say by now that this project has been a success. I’ve received lots of positive feedback about this from the community.&lt;/p&gt;
&lt;p&gt;That didn’t stop me from going even further and adding more features to this project though.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1VrXnQeg6wj3KJYetSCXQ.png&#34;
	width=&#34;1080&#34;
	height=&#34;1080&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1VrXnQeg6wj3KJYetSCXQ_hu_e1d6baea0fece90e.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1VrXnQeg6wj3KJYetSCXQ_hu_5322f738578521d.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;100&#34;
		data-flex-basis=&#34;240px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;new-features-and-improvements&#34;&gt;New Features and Improvements
&lt;/h3&gt;&lt;h4 id=&#34;localized--formatted-phonenumbers&#34;&gt;Localized / Formatted Phone Numbers
&lt;/h4&gt;&lt;p&gt;As you may know by now, I consider myself a data driven guy. What I really dig about Teams phone is the fact that every number is a full E.164 number in every case. This kind of absoluteness provides great safety because each number is unique. Just as with user principal names or GUIDs, there’s no funny business going on.&lt;/p&gt;
&lt;p&gt;That safety comes at the cost of readability though. If you’ve seen &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/prettify-and-sync-teams-phone-numbers-to-azure-ad-e973755f83d5&#34; &gt;this&lt;/a&gt; article before, then you already know that I came up with a solution to format phone numbers in their local format using Python.&lt;/p&gt;
&lt;p&gt;The runbook logic powering the list can now also leverage Python to store the formatted phone number in an additional column. This way you always have both, the E.164 number and a prettified version of it readily available.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1eH5p9VVDZ9zlnSfb0G9A.png&#34;
	width=&#34;999&#34;
	height=&#34;488&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1eH5p9VVDZ9zlnSfb0G9A_hu_7022d15e6eeaa66.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1eH5p9VVDZ9zlnSfb0G9A_hu_f4668b82a68aff8d.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;204&#34;
		data-flex-basis=&#34;491px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;For US numbers or numbers from other countries such as Japan or Israel which typically use hyphens, you might have noticed that I’m removing the hyphens, even though they’re included after a number has been formatted using the phonenumbers library. I do this so that every number in the list contains only digits and a plus sign. Also, it’s how Teams Admin Center displays the numbers.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1eq5k3nw1Nd6nFTUTjoxFQ.png&#34;
	width=&#34;1670&#34;
	height=&#34;123&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1eq5k3nw1Nd6nFTUTjoxFQ_hu_bc50ccfd5441646d.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1eq5k3nw1Nd6nFTUTjoxFQ_hu_c7113618fa5125fc.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;1357&#34;
		data-flex-basis=&#34;3258px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;write-back-teams-phone-number-to-entraid&#34;&gt;Write back Teams Phone Number to Entra ID
&lt;/h4&gt;&lt;p&gt;When you view a user’s profile card in Teams, Outlook or anywhere else in Microsoft 365, it doesn’t display the phone number which is actually configured as &lt;strong&gt;LineURI&lt;/strong&gt; in Teams. Instead, the information is taken from Entra ID. I’ve created a variable inside the runbook which controls if the &lt;strong&gt;BusinessPhones&lt;/strong&gt; property of Entra ID users should be set to the assigned &lt;strong&gt;LineUri&lt;/strong&gt; in Teams. I’ll explain how to turn this &lt;strong&gt;on&lt;/strong&gt; or &lt;strong&gt;off&lt;/strong&gt; later in this article.&lt;/p&gt;
&lt;p&gt;With the current permissions/scopes assigned to the Entra ID App registration, this only works for users which don’t have any administrator roles assigned in Entra ID. If a user has an admin role, you’ll get an error.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1raGaYRAkmtuYw6eis0Y9A.png&#34;
	width=&#34;1677&#34;
	height=&#34;150&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1raGaYRAkmtuYw6eis0Y9A_hu_89f4a19b579804a0.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1raGaYRAkmtuYw6eis0Y9A_hu_8a85757495e0ae5a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;1118&#34;
		data-flex-basis=&#34;2683px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;previous-usercolumn&#34;&gt;Previous User Column
&lt;/h4&gt;&lt;p&gt;I’ve added a new column which shows the UPN of the previous user/owner of a number after it has been removed. This is achieved by an update I made to the Power Automate Flow. Note that the flow will now also retain the value of the &lt;strong&gt;Comment&lt;/strong&gt; column.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1BEWqNsDCKrY0BOBbMc9tkg.png&#34;
	width=&#34;1455&#34;
	height=&#34;255&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1BEWqNsDCKrY0BOBbMc9tkg_hu_9420fcbe4ade5972.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1BEWqNsDCKrY0BOBbMc9tkg_hu_5cfca7fa890d7c20.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;570&#34;
		data-flex-basis=&#34;1369px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The reason for this column is that you have a better overview over who has previously used a number. I’m sure you don’t want to assign the previous CEO’s number to a new intern.&lt;/p&gt;
&lt;h4 id=&#34;unassigned-routingrules&#34;&gt;Unassigned Routing Rules
&lt;/h4&gt;&lt;p&gt;When people leave, we sometimes want to forward their unassigned number to another person in the company or to the main number. This is done by routing rules. But do we typically remember or even know that such rules have been created in the past…? Now we do!&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1mazY1aTB8fOWSqHcKsnSrA.png&#34;
	width=&#34;2160&#34;
	height=&#34;518&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1mazY1aTB8fOWSqHcKsnSrA_hu_b4080f47867d04a3.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1mazY1aTB8fOWSqHcKsnSrA_hu_95ed7411c80aaf45.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;416&#34;
		data-flex-basis=&#34;1000px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Every number is checked against all routing rules a tenant has configured and if there are any matches, they’re reflected on the list. The name of the matching rule gets stored in the &lt;strong&gt;User Name&lt;/strong&gt; column. (Because this column isn’t used for the flow trigger condition.)&lt;/p&gt;
&lt;p&gt;This even works if a number is reserved. In this case, the status will be changed to &lt;strong&gt;Reserved (Routing Rule)&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1nLAAAS1BoTH5RfGGN788Q.png&#34;
	width=&#34;1767&#34;
	height=&#34;615&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1nLAAAS1BoTH5RfGGN788Q_hu_47c0c548165f9e87.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1nLAAAS1BoTH5RfGGN788Q_hu_2585d3cded3f7066.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;287&#34;
		data-flex-basis=&#34;689px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;improved-number-assignment-capabilities&#34;&gt;Improved Number Assignment Capabilities
&lt;/h4&gt;&lt;p&gt;I’ve also made some improvements to assigning numbers. If a number has a status of &lt;strong&gt;Reserved (Routing Rule)&lt;/strong&gt; or &lt;strong&gt;Assignment Error&lt;/strong&gt;, the script will try to assign the number as well. In the case of an assignment error, the script will try to assign the number again with each new job. This is helpful in scenarios where e.g. a license hasn’t been assigned yet.&lt;/p&gt;
&lt;p&gt;Furthermore, you can now also reserve a number and enter the user’s UPN in the &lt;strong&gt;User Principal Name&lt;/strong&gt; column. This is great if the account does not exist yet (so you can’t fill in the &lt;strong&gt;User Profile&lt;/strong&gt;) but you already know the UPN of a soon to be created user. All of these changes make it easier for you to plan ahead and have the runbook take care of everything automatically, once a user has been created and licensed.&lt;/p&gt;
&lt;h4 id=&#34;operator-column&#34;&gt;Operator Column
&lt;/h4&gt;&lt;p&gt;Last but not least, the list now also displays the name of the &lt;strong&gt;Operator&lt;/strong&gt;. This works for all types, including &lt;strong&gt;Direct Routing&lt;/strong&gt;. You will have to manually list the operator name for each Direct Routing number in your source CSV though.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1uGIXZRh99eE0prMLPkLnA.png&#34;
	width=&#34;1874&#34;
	height=&#34;612&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1uGIXZRh99eE0prMLPkLnA_hu_16931b902547c67.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1uGIXZRh99eE0prMLPkLnA_hu_ca26602676017de3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;306&#34;
		data-flex-basis=&#34;734px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;updating-all-the-components&#34;&gt;Updating All the Components
&lt;/h3&gt;&lt;p&gt;I will most likely update the deployment script at some point to deploy everything from scratch including all the updates. If I can find enough time, I may also create an update script to update an existing deployment.&lt;/p&gt;
&lt;p&gt;But today, I’ll show you how to implement all the changes manually in an existing deployment which consists of an Azure automation account, a list, a flow and your local source files.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;To do these steps, you should have followed and deployed everything as described in&lt;/strong&gt; &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf&#34; &gt;&lt;strong&gt;this&lt;/strong&gt;&lt;/a&gt; &lt;strong&gt;article and implemented all the updates described in&lt;/strong&gt; &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a&#34; &gt;&lt;strong&gt;this&lt;/strong&gt;&lt;/a&gt; &lt;strong&gt;article.&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;add-newcolumns&#34;&gt;Add New Columns
&lt;/h4&gt;&lt;p&gt;Add the following columns to the SharePoint list. All columns must be of type &lt;strong&gt;text&lt;/strong&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Comment&lt;/li&gt;
&lt;li&gt;Previous User&lt;/li&gt;
&lt;li&gt;Operator&lt;/li&gt;
&lt;li&gt;Phone Number&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;add-the-phonenumbers-python-package-to-the-automation-account&#34;&gt;Add the phonenumbers Python Package to the Automation Account
&lt;/h4&gt;&lt;p&gt;Go to &lt;a class=&#34;link&#34; href=&#34;https://pypi.org/project/phonenumbers/#files&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;this&lt;/a&gt; website and download the built distribution (*.whl) file to your PC. Then go to your automation account in Azure Portal and upload the file under &lt;strong&gt;Python packages&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1g7hFFDAp9c6HwdMFUIimw.png&#34;
	width=&#34;1298&#34;
	height=&#34;655&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1g7hFFDAp9c6HwdMFUIimw_hu_da60db5a0d3062c8.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1g7hFFDAp9c6HwdMFUIimw_hu_90f9106826f60567.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;198&#34;
		data-flex-basis=&#34;475px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;add-automation-variables-to-automation-account&#34;&gt;Add Automation Variables to Automation Account
&lt;/h4&gt;&lt;p&gt;Add the following variables to your automation account. Since you’ll need to enter a value, just type a dot (“.”). Leave the integer value at 0.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;TeamsPhoneNumberOverview_AllCsOnlineNumbers (String)&lt;/li&gt;
&lt;li&gt;TeamsPhoneNumberOverview_PrettyNumbers (String)&lt;/li&gt;
&lt;li&gt;TeamsPhoneNumberOverview_TotalNumberCount (Integer)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1A6uNqGeSwBjpEuMGTuhw.png&#34;
	width=&#34;1524&#34;
	height=&#34;842&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1A6uNqGeSwBjpEuMGTuhw_hu_50edc387662a538b.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1A6uNqGeSwBjpEuMGTuhw_hu_7f11e91cb8c7947b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;180&#34;
		data-flex-basis=&#34;434px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;add-operator-info-to-your-direct-routingnumbers&#34;&gt;Add Operator info to your Direct Routing Numbers
&lt;/h4&gt;&lt;p&gt;If you have direct routing numbers, you’ll need to update your source list. The old structure only had one column called &lt;strong&gt;PhoneNumber&lt;/strong&gt;. Now there’s &lt;strong&gt;PhoneNumber&lt;/strong&gt; and &lt;strong&gt;Operator&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;PhoneNumber;Operator&lt;br&gt;
4144520xxxx;Test Provider 1&lt;br&gt;
4144512xxxx;Test Provider 2&lt;br&gt;
4144512xxxx;Test Provider 3&lt;/p&gt;
&lt;p&gt;Place your updated CSV in &lt;code&gt;.\Resources\DirectRoutingNumbers-V2.csv&lt;/code&gt; and then run &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation/blob/main/Setup/UpdateDirectRoutingNumbers-V2.ps1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;this&lt;/a&gt; script to update your automation variable in Azure.&lt;/p&gt;
&lt;p&gt;Alternatively, you can also run the below code and paste the content into your &lt;code&gt;TeamsPhoneNumberOverview_DirectRoutingNumbers&lt;/code&gt; automation variable.&lt;/p&gt;
&lt;p&gt;&amp;ldquo;&amp;rsquo;&amp;rdquo; + (Import-Csv -Path .\Resources\DirectRoutingNumbers-V2.csv -Delimiter &amp;ldquo;;&amp;rdquo; | ConvertTo-Json | Out-String) + &amp;ldquo;&amp;rsquo;&amp;rdquo; | Set-Clipboard&lt;/p&gt;
&lt;h4 id=&#34;create-a-pythonrunbook&#34;&gt;Create a Python Runbook
&lt;/h4&gt;&lt;p&gt;Go to your runbooks in your automation account and click &lt;strong&gt;Create a runbook&lt;/strong&gt;. Name it &lt;code&gt;Format-TeamsPhoneNumbers&lt;/code&gt; and choose &lt;strong&gt;Python&lt;/strong&gt; as runbook type and &lt;strong&gt;3.10 (preview)&lt;/strong&gt; as runtime version.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1rgIq7gWJ29Wa9rBctif0A.png&#34;
	width=&#34;1226&#34;
	height=&#34;590&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1rgIq7gWJ29Wa9rBctif0A_hu_6d39c1ba538bfa2.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1rgIq7gWJ29Wa9rBctif0A_hu_1adbd065aeddfe1b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;207&#34;
		data-flex-basis=&#34;498px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Grab &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation/blob/main/Functions/Format-TeamsPhoneNumbers.py&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;this&lt;/a&gt; code and paste it into the Azure portal. Save and publish the runbook.&lt;/p&gt;
&lt;h4 id=&#34;setup-a-managed-identity-and-permissions&#34;&gt;Setup a Managed Identity and Permissions
&lt;/h4&gt;&lt;p&gt;Every time the main runbook runs, it will check if the total number count is still the same by comparing the current count to the count of the previous job which is stored in the &lt;strong&gt;TeamsPhoneNumberOverview_TotalNumberCount&lt;/strong&gt; variable. If the count of numbers is different compared to the previous job, the main runbook will start the python runbook. The python runbook will use the phonenumbers library to format all your phone numbers to their localized format.&lt;/p&gt;
&lt;p&gt;However, we must first allow the runbook to start another runbook job using a managed identity. In the automation account, go to &lt;strong&gt;Identity&lt;/strong&gt; and flip the toggle switch for &lt;strong&gt;System assigned&lt;/strong&gt; (managed identity) to &lt;strong&gt;On&lt;/strong&gt;. Then click &lt;strong&gt;Save&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1EDBRytpBpi8HYFN2kwiLdA.png&#34;
	width=&#34;2113&#34;
	height=&#34;500&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1EDBRytpBpi8HYFN2kwiLdA_hu_d7e0811a4bd90c1b.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1EDBRytpBpi8HYFN2kwiLdA_hu_c36238ca86dbb4ce.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;422&#34;
		data-flex-basis=&#34;1014px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Click &lt;strong&gt;Azure role assignments&lt;/strong&gt; and then &lt;strong&gt;Add role assignment (Preview)&lt;/strong&gt;. Set the scope to &lt;strong&gt;Resource group&lt;/strong&gt;, select your subscription and resource group and choose &lt;strong&gt;Automation Operator&lt;/strong&gt; as role.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1gnhE04XQSUDcagh8wASow.png&#34;
	width=&#34;1256&#34;
	height=&#34;504&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1gnhE04XQSUDcagh8wASow_hu_4dea5d254f3b494f.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1gnhE04XQSUDcagh8wASow_hu_596ddc1f1398854.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;249&#34;
		data-flex-basis=&#34;598px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Click &lt;strong&gt;Save&lt;/strong&gt;.&lt;/p&gt;
&lt;h4 id=&#34;update-the-mainrunbook&#34;&gt;Update the Main Runbook
&lt;/h4&gt;&lt;p&gt;Replace the code in the &lt;strong&gt;TeamsPhoneOverview&lt;/strong&gt; runbook with &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation/blob/main/Scripts/TeamsPhoneNumberOverview%20-V2.ps1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;this&lt;/a&gt; code. &lt;strong&gt;Make sure to change the&lt;/strong&gt; &lt;code&gt;**$localTestMode**&lt;/code&gt; &lt;strong&gt;variable to&lt;/strong&gt; &lt;code&gt;**$false**&lt;/code&gt; &lt;strong&gt;before you save and publish the runbook. Also update the names of your automation account and resource group on lines 95–97.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1Szx2vDwh4929HXR4DPp4MA.png&#34;
	width=&#34;522&#34;
	height=&#34;79&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1Szx2vDwh4929HXR4DPp4MA_hu_1f096338280888cb.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1Szx2vDwh4929HXR4DPp4MA_hu_3d29e348e84512f4.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;660&#34;
		data-flex-basis=&#34;1585px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If you don’t want to write back user’s &lt;strong&gt;LineURIs&lt;/strong&gt; to Entra ID &lt;strong&gt;BusinessPhones&lt;/strong&gt;, change &lt;code&gt;syncTeamsPhoneNumbersToEntraIdBusinessPhones&lt;/code&gt; to &lt;code&gt;$false&lt;/code&gt; on line 6.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1MFWbPjRVqUjXwHAw5HdDZg.png&#34;
	width=&#34;415&#34;
	height=&#34;20&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1MFWbPjRVqUjXwHAw5HdDZg_hu_864f8be38dfd4cf1.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1MFWbPjRVqUjXwHAw5HdDZg_hu_b92fbcc2dcdcdffd.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;2075&#34;
		data-flex-basis=&#34;4980px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;update-theflow&#34;&gt;Update the Flow
&lt;/h4&gt;&lt;p&gt;Finally, go to your flow and make the last small changes. In here, add the values for the new columns that we created. If you need a refresher, this is the part where the flow deletes numbers which were unassigned because there’s no way to remove the user profile. We then recreate the list entry with all the information &lt;strong&gt;except&lt;/strong&gt; the &lt;strong&gt;User Profile Claims&lt;/strong&gt;. Because the user profile stays, we can use the &lt;strong&gt;User Profile Email&lt;/strong&gt; and write it to the &lt;strong&gt;Previous User&lt;/strong&gt; column. Comments in the comment field will also be added again, once a deleted entry has been recreated.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1BvLOlUfRBHAr1IFNxm7tYg.png&#34;
	width=&#34;929&#34;
	height=&#34;1374&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1BvLOlUfRBHAr1IFNxm7tYg_hu_9f1ae3b393ae527b.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-3-e083a320004d/1BvLOlUfRBHAr1IFNxm7tYg_hu_8dfa75a1b319817b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;67&#34;
		data-flex-basis=&#34;162px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;update-the-flow-trigger-condition&#34;&gt;Update the Flow Trigger Condition
&lt;/h4&gt;&lt;p&gt;The current trigger condition checks if a user’s email address is equal to the user principal name. As much as I want this to always be the case, the reality is sometimes different. Some readers have reported that their Flow gets stuck in an infinite trigger loop because of that.&lt;/p&gt;
&lt;p&gt;I’ve slightly tweaked the trigger condition, so it doesn’t compare the email address to the UPN anymore. Instead, the UPN is extracted from the user profile using a split operation and then compared to the UPN from the list column. Here’s the &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation/blob/main/Resources/FlowTriggerConditionRobustUpn.txt&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;updated trigger condition&lt;/a&gt;. Make sure to update it on your flow as well as it will be more robust than the old one.&lt;/p&gt;
&lt;p&gt;@or(&lt;br&gt;
and(&lt;br&gt;
not(equals(triggerOutputs()?[&amp;lsquo;body/User_x0020_Principal_x0020_Name&amp;rsquo;], &amp;lsquo;Unassigned&amp;rsquo;)),&lt;br&gt;
not(contains(triggerBody(), &amp;lsquo;UserProfile&amp;rsquo;))&lt;br&gt;
),&lt;br&gt;
not(equals(toLower(triggerOutputs()?[&amp;lsquo;body/User_x0020_Principal_x0020_Name&amp;rsquo;]), split(toLower(triggerOutputs()?[&amp;lsquo;body/UserProfile&amp;rsquo;][&amp;lsquo;Claims&amp;rsquo;]),&amp;rsquo;|&amp;rsquo;)[2])),&lt;br&gt;
and(&lt;br&gt;
contains(triggerBody(), &amp;lsquo;UserProfile&amp;rsquo;),&lt;br&gt;
not(equals(triggerOutputs()?[&amp;lsquo;body/User_x0020_Principal_x0020_Name&amp;rsquo;], &amp;lsquo;Unassigned&amp;rsquo;)),&lt;br&gt;
not(contains(triggerBody(), &amp;lsquo;TeamsAdminCenter&amp;rsquo;))&lt;br&gt;
)&lt;br&gt;
)&lt;/p&gt;
&lt;p&gt;That’s all. If you’ve followed all the steps, you should now be able to make use of all the new features I created. Like I said, I’ll try to find some time and create a new deployment script which deploys the version 2 from scratch. I hope you enjoy the list as much as I do.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Everything You Ever Wanted to Know About Creating Teams and Microsoft 365 Groups</title>
        <link>https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/</link>
        <pubDate>Mon, 07 Aug 2023 13:10:37 +0000</pubDate>
        
        <guid>https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/</guid>
        <description>&lt;p&gt;Did you know that you can create new Microsoft 365 Group in &lt;strong&gt;six&lt;/strong&gt; and a new Microsoft Teams Team in &lt;strong&gt;four&lt;/strong&gt; different places? And I’m not even counting PowerShell…&lt;/p&gt;
&lt;p&gt;Today, I’m going to show you the differences in default settings when a Group/Team is created from a different place and what impact it could have.&lt;/p&gt;
&lt;p&gt;Let’s start with all the different admin portals and clients a Microsoft 365 Group can be created in.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Entra ID Admin Center&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;M365 Admin Center&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Exchange Admin Center&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Teams Admin Center&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;SharePoint Admin Center&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Teams Client&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The bold ones are the ones where we can also create a Team alongside the Group.&lt;/p&gt;
&lt;p&gt;As we all know, every Team includes a “surrounding” Microsoft 365 Group to manage access to the Team. &lt;strong&gt;You can have a Microsoft 365 Group without a Team, but you can’t have a Team without an associated Microsoft 365 Group.&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;entra-id-admincenter&#34;&gt;Entra ID Admin Center
&lt;/h4&gt;&lt;p&gt;If you create a new M365 Group in Entra ID, you won’t have the option to add a Team to the group during the creation process. The only reason why you’d want to use Entra ID to add an M365 Group with a Team is if you want to use a dynamic group. Entra ID is the only GUI where you can create dynamic M365 Groups. Also, you can’t configure the group’s visibility upon creation of the group. It has to be manually changed in M365 Admin Center after the group has been created in Entra ID.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Ks0QQyarwoK0HLpIQYw.png&#34;
	width=&#34;1036&#34;
	height=&#34;1091&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Ks0QQyarwoK0HLpIQYw_hu_d962ad55756d05b3.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Ks0QQyarwoK0HLpIQYw_hu_b2fb96e287c964.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;94&#34;
		data-flex-basis=&#34;227px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;m365-admincenter&#34;&gt;M365 Admin Center
&lt;/h4&gt;&lt;p&gt;If you create the M365 Group from the M365 Admin Center, the group’s visibility will default to &lt;strong&gt;PUBLIC,&lt;/strong&gt; and you’ll need to provide the group’s email address manually. The checkbox for &lt;strong&gt;Create a team for this group&lt;/strong&gt; is enabled by default.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1OLo4fcAatonsKKHC8fCIA.png&#34;
	width=&#34;1134&#34;
	height=&#34;909&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1OLo4fcAatonsKKHC8fCIA_hu_8cc38413ff5be589.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1OLo4fcAatonsKKHC8fCIA_hu_ce119eda9ca6a18b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;124&#34;
		data-flex-basis=&#34;299px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;exchange-admincenter&#34;&gt;Exchange Admin Center
&lt;/h4&gt;&lt;p&gt;Creating the group from the Exchange Online Admin Center does essentially the same thing as creating it from the M365 Admin Center. The only difference is that you’ll be able to create a &lt;strong&gt;Dynamic distribution&lt;/strong&gt; group from Exchange. This option is not available in M365 Admin. However, M365 Admin Center allows you to create &lt;strong&gt;Security&lt;/strong&gt; groups while the Exchange Admin Center won’t.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1yv8Aumuzx6q5H4zhrbRkqg.png&#34;
	width=&#34;1139&#34;
	height=&#34;836&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1yv8Aumuzx6q5H4zhrbRkqg_hu_64f748114f4e8014.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1yv8Aumuzx6q5H4zhrbRkqg_hu_383489b8075d91e2.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;136&#34;
		data-flex-basis=&#34;326px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;teams-admincenter&#34;&gt;Teams Admin Center
&lt;/h4&gt;&lt;p&gt;In Teams Admin Center, the default visibility/privacy is set to &lt;strong&gt;Private&lt;/strong&gt;. Like in Entra ID, the email address of the M365 Group is also created for you with no option to change it during the creation process.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1FZlDNoVcf0Axd57QQFeyw.png&#34;
	width=&#34;523&#34;
	height=&#34;697&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1FZlDNoVcf0Axd57QQFeyw_hu_95e84aa1697be1ae.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1FZlDNoVcf0Axd57QQFeyw_hu_d940cc467cba6615.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;75&#34;
		data-flex-basis=&#34;180px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;sharepoint-admincenter&#34;&gt;SharePoint Admin Center
&lt;/h4&gt;&lt;p&gt;When you create a new Team Site in SharePoint Admin Center, a new Microsoft 365 Group is created as well. The group’s email address is set automatically and the default option for the visibility is private. In this case, you can adjust the group’s email address, if you want to.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1IfhZCo2ZFn01uwgpBqepw.png&#34;
	width=&#34;1331&#34;
	height=&#34;1486&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1IfhZCo2ZFn01uwgpBqepw_hu_5372a793fb4474f7.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1IfhZCo2ZFn01uwgpBqepw_hu_d167427cb6fae478.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;89&#34;
		data-flex-basis=&#34;214px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Creating the group from SharePoint Admin Center does not create a Team automatically. A Team can be added to the group in the Microsoft 365 Admin Center after the Team Site has been created.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1kE1YtLVIL7lk8iKSDJWngg.png&#34;
	width=&#34;1334&#34;
	height=&#34;459&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1kE1YtLVIL7lk8iKSDJWngg_hu_a70cc96bdef490c5.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1kE1YtLVIL7lk8iKSDJWngg_hu_b20dbe5a9804d62b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;290&#34;
		data-flex-basis=&#34;697px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;teams-client&#34;&gt;Teams Client
&lt;/h4&gt;&lt;p&gt;In Teams Client, things look a little bit different. First, you need to decide whether you want to start from scratch or from another group or team. There are also some basic templates available.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1fijm1R7xxa5ngZp8vnbA.png&#34;
	width=&#34;860&#34;
	height=&#34;859&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1fijm1R7xxa5ngZp8vnbA_hu_99003d8ad86fd6ce.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1fijm1R7xxa5ngZp8vnbA_hu_b898c1ca80c06c49.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;100&#34;
		data-flex-basis=&#34;240px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I chose &lt;strong&gt;From scratch&lt;/strong&gt; for this blog post. Next, you’ll be asked if you want to create a Private, Public or Org-wide Team. I tested all 3 types and all of them created a new M365 Group with the same settings. The group is always assigned, not even the Org-wide Team is created as dynamic group. The email address is derived from the Team name too, without the option to customize it during the creation process. The most important thing to note here is that if you create a Team from Teams itself, the group will be hidden in Outlook clients by default.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1j8BsmyfTxNnOhJOlbeeuQ.png&#34;
	width=&#34;812&#34;
	height=&#34;659&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1j8BsmyfTxNnOhJOlbeeuQ_hu_5b36de55cb9cda01.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1j8BsmyfTxNnOhJOlbeeuQ_hu_d032329a71507e37.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;123&#34;
		data-flex-basis=&#34;295px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;comparison-chart&#34;&gt;Comparison Chart
&lt;/h4&gt;&lt;p&gt;I’ve created a table which tells you what settings/defaults are applied for Teams created in each location.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1f1t0FfEjhgy1Q3X2gSmeIw.png&#34;
	width=&#34;1719&#34;
	height=&#34;321&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1f1t0FfEjhgy1Q3X2gSmeIw_hu_8d54fb8340343be5.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1f1t0FfEjhgy1Q3X2gSmeIw_hu_f0b78a96ab378f8a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;535&#34;
		data-flex-basis=&#34;1285px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I think all the above except &lt;strong&gt;OwnerAddedAsMember&lt;/strong&gt; and &lt;strong&gt;OwnerIsPartOfTeamWhileNotAMember&lt;/strong&gt; should be self-explanatory.&lt;/p&gt;
&lt;p&gt;Every group has owners and members. Owners are typically also members, but members don’t necessarily have to be owners as well.&lt;/p&gt;
&lt;p&gt;If you add certain users only as an owner, they won’t be added to the group&amp;rsquo;s members unless you create the Team from Teams Admin Center or from the Teams Client. (OwnerAddedAsMember).&lt;/p&gt;
&lt;p&gt;However, even if they’re just owners, they can still see the Team in Teams (OwnerIsPartOfTeamWhileNotAMember).&lt;/p&gt;
&lt;p&gt;Example: Team Created in M365 Admin Center&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1sKnTcPvGMPXSOxzurQkzA.png&#34;
	width=&#34;1022&#34;
	height=&#34;454&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1sKnTcPvGMPXSOxzurQkzA_hu_b497cc8f0137eac9.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1sKnTcPvGMPXSOxzurQkzA_hu_c2e39299003812d0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;225&#34;
		data-flex-basis=&#34;540px&#34;
	
&gt;
&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Tc27AG8fYx7IyLNlH4Cmw.png&#34;
	width=&#34;1250&#34;
	height=&#34;453&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Tc27AG8fYx7IyLNlH4Cmw_hu_421a90570f04085.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Tc27AG8fYx7IyLNlH4Cmw_hu_928372f68d401d29.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;275&#34;
		data-flex-basis=&#34;662px&#34;
	
&gt;
&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1HjfYRrvTHStUi1kDVBSjdg.png&#34;
	width=&#34;1587&#34;
	height=&#34;479&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1HjfYRrvTHStUi1kDVBSjdg_hu_8e362a1994ffdb.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1HjfYRrvTHStUi1kDVBSjdg_hu_71f43ce4e8d3786b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;331&#34;
		data-flex-basis=&#34;795px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If we compare this Team to one created in Teams Admin Center, we can see that it looks exactly the same in Teams.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1NKi2Pdxdqd30yavHOg8GA.png&#34;
	width=&#34;1652&#34;
	height=&#34;511&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1NKi2Pdxdqd30yavHOg8GA_hu_65e6564eab1d5ea8.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1NKi2Pdxdqd30yavHOg8GA_hu_8f537e27d53f1f22.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;323&#34;
		data-flex-basis=&#34;775px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;However, in M365 Admin Center we can see that the user is both an owner and a member of the group.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1MvFKN9z4vrC6q1nILilHmQ.png&#34;
	width=&#34;1036&#34;
	height=&#34;639&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1MvFKN9z4vrC6q1nILilHmQ_hu_bf21a9b320035e1e.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1MvFKN9z4vrC6q1nILilHmQ_hu_9b25ba6a7e7131fe.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;162&#34;
		data-flex-basis=&#34;389px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Teams will display each user only once, under the highest privilege a user has while M365 Groups list owners and members separately, even if it’s the same user account.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Jw5pIMkgJDtaYwnPmGyQbQ.png&#34;
	width=&#34;1040&#34;
	height=&#34;377&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Jw5pIMkgJDtaYwnPmGyQbQ_hu_3b41e1d12149720f.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1Jw5pIMkgJDtaYwnPmGyQbQ_hu_dff8ba05e16e4243.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;275&#34;
		data-flex-basis=&#34;662px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;voice-enabled-channelscaveat&#34;&gt;Voice Enabled Channels Caveat
&lt;/h4&gt;&lt;p&gt;For normal Teams usage, it shouldn’t be a problem if an owner is not also a member. However, there is one important thing to mention. &lt;strong&gt;If an owner is not also a member and the owner is part of a Team which is used for a Voice Enabled Channel in Teams, the owner won’t be added to the queue’s agent list, unless the owner is added explicitly as a member too.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I’ve linked a Team which I created from M365 Admin Center to this call queue. During the creation, I’ve only added 1 owner and no members.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1cCSpNYnw92CDChAB4vXdQ.png&#34;
	width=&#34;1377&#34;
	height=&#34;421&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1cCSpNYnw92CDChAB4vXdQ_hu_ce8e14ba2cd80d73.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1cCSpNYnw92CDChAB4vXdQ_hu_21cc38e1c546eca0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;327&#34;
		data-flex-basis=&#34;784px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;When we check the call agents of this queue, we can see that it says &lt;strong&gt;zero&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1WxLllnbtYMltwNBa8Ymb6Q.png&#34;
	width=&#34;1286&#34;
	height=&#34;250&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1WxLllnbtYMltwNBa8Ymb6Q_hu_f9cde674a4f4b2c2.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1WxLllnbtYMltwNBa8Ymb6Q_hu_39d3c7aad6c22dec.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;514&#34;
		data-flex-basis=&#34;1234px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;When I add the owner also as a member of the group in M365 Admin Center and save the queue again, we can see that it now has &lt;strong&gt;one&lt;/strong&gt; call agent.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1tko8IXwu7Fec7LztJ1UqQ.png&#34;
	width=&#34;1295&#34;
	height=&#34;258&#34;
	srcset=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1tko8IXwu7Fec7LztJ1UqQ_hu_c0f92fc929495186.png 480w, https://heusser.pro/p/everything-you-ever-wanted-to-know-about-creating-teams-and-microsoft-365-groups-cc069d920d43/1tko8IXwu7Fec7LztJ1UqQ_hu_a62c6f84733e0664.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;501&#34;
		data-flex-basis=&#34;1204px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;You can read more about Voice Enabled Channels and Call Queue Agent Lists &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/microsoft-teams-call-queue-agent-lists-and-how-to-force-sync-them-ef8092090df0&#34; &gt;here&lt;/a&gt; and &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/manage-microsoft-teams-call-queues-with-powershell-force-sync-9919e2939552&#34; &gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h4 id=&#34;where-to-create-newteams&#34;&gt;Where to Create New Teams?
&lt;/h4&gt;&lt;p&gt;So where is it best to create new Teams? Sadly, the answer is: It depends. The first question you should ask yourself is if the membership needs to be assigned or dynamic. If it should be dynamic, you must create it from Entra ID. Otherwise, there is no clear winner here. Each portal does it slightly different which creates unwanted and most likely also unnoticed differences in M365 Group settings. If you want to be consistent across all your Teams and Groups, I recommend defining one or multiple standards and then creating a PowerShell script which creates new Teams and Groups according to your needs.&lt;/p&gt;
&lt;h3 id=&#34;powershell-cheat-sheet-for-m365groups&#34;&gt;PowerShell Cheat-Sheet for M365 Groups
&lt;/h3&gt;&lt;p&gt;Since we’ve now learned that creating Groups or Teams from different Admin Centers can have different effects, I put together a little PowerShell cheat-sheet containing some handy one-lineres to help you quickly adjust M365 Group settings. Since these settings are applied to the M365 Group and not to the Team, they all require the Exchange Online PowerShell Module which can be installed using this code.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;45
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;46
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Install Module  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Install-Module&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ExchangeOnlineManagement&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Connect to Exchange Online  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Connect-ExchangeOnline&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;To&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;store&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;group &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;object&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;`$&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;`&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;we&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;simply&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;need&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;group &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;like&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Get group properties  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$group&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-UnifiedGroup&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Identity&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TeamCreatedinTACPublic&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@mvplab&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;To&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;disable&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;welcome&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;which&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sent&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;group &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;members&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;use&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;this&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Disable welcome message for new group members  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Set-UnifiedGroup&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Identity&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Identity&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-UnifiedGroupWelcomeMessageEnabled&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;If&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Team&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;has&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;been&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;created&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Teams&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;you&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;can&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;use&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;this&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;code&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;unhide&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;group &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Outlook&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Unhide group from Outlook clients  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Set-UnifiedGroup&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Identity&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Identity&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-HiddenFromExchangeClientsEnabled:&lt;/span&gt;&lt;span class=&#34;vm&#34;&gt;$false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;To&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;allow&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;external&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;email&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addresses&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;send&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;emails&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;group &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;address&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;use&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;this&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Enable let people outside this organization email this group  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Set-UnifiedGroup&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Identity&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Identity&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-RequireSenderAuthenticationEnabled:&lt;/span&gt;&lt;span class=&#34;vm&#34;&gt;$false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;To&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;change&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;privacy&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;group &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;use&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;either&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;**&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Private&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;**&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;or&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;**&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Public&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;**&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;`-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AccessType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;`&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;parameter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Change access type to private  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Set-UnifiedGroup&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Identity&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Identity&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-AccessType&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Private&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;To&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keep&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;owners&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;members&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sync&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;or&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rather&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;make&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sure&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;that&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;all&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;owners&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;are&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;added&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;members&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;too&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;you&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;can&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;use&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;this&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Add group owners to group members if not already there  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Connect-MgGraph&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$group&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-MgGroup&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-GroupId&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;lt;GUID&amp;gt;&amp;#34;&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$groupOwners&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-MgGroupOwner&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-All&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-GroupId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Id&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$groupMembers&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-MgGroupMember&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-All&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-GroupId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Id&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;foreach&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$groupOwner&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$groupOwners&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Where-Object&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{$\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Id&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-notin&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$groupMembers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;New-MgGroupMember&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-GroupId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Id&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-DirectoryObjectId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$groupOwner&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Id&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Note: This uses the &lt;strong&gt;Microsoft.Graph.Groups&lt;/strong&gt; PowerShell module and not &lt;strong&gt;ExchangeOnlineManagement&lt;/strong&gt;.&lt;/p&gt;
&lt;h3 id=&#34;closing-words&#34;&gt;Closing Words
&lt;/h3&gt;&lt;p&gt;I hope that this article and the comparison chart help you to better understand why some groups might have different settings than others. I also recommend to always add all owners as explicit members too, whenever you assign owners to a group. Hopefully, the last code snippet will make things easier for you to accomplish this.&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Teams Phone Number Management List Part 2</title>
        <link>https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/</link>
        <pubDate>Sat, 08 Apr 2023 16:02:49 +0000</pubDate>
        
        <guid>https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/</guid>
        <description>&lt;p&gt;This article builds on the following article.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf&#34; &gt;Teams Phone Number Management on a Budget | by martin heusser | Mar, 2023 | Medium&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Please make sure you read that one first.&lt;/p&gt;
&lt;p&gt;After I built the list initially, I quickly realized that there’s still room for improvement. Especially a feature to assign and unassign phone numbers through the list would be incredibly handy. This would allow us to delegate this task to users without Teams Admin Center access.&lt;/p&gt;
&lt;p&gt;The &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;repository&lt;/a&gt; has been updated and already includes the code required for number assignment. If you’ve already deployed it, just delete the resource group in Azure and re-deploy. Of course, you can also replace the existing files with the new scripts and variables by hand if you know what you’re doing. But since there’s a deployment script available, I recommend deleting and re-deploying.&lt;/p&gt;
&lt;p&gt;Let’s check out the new features first and go over the manual changes required later.&lt;/p&gt;
&lt;h3 id=&#34;new-features&#34;&gt;New Features
&lt;/h3&gt;&lt;h4 id=&#34;country&#34;&gt;Country
&lt;/h4&gt;&lt;p&gt;All Calling Plan and Operator Connect phone numbers already include a country attribute. Therefore, I decided to use the property which is already known to Teams. The &lt;strong&gt;Country&lt;/strong&gt; column now includes the two-digit ISO code instead of the country’s full name.&lt;/p&gt;
&lt;p&gt;For consistency, the &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation/blob/main/Resources/CountryLookupTable.json&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;CountryLookupTable.json&lt;/a&gt; has been updated to include the ISO codes as well. Please see the &lt;strong&gt;Changes in V2&lt;/strong&gt; section of this article if the Country does not always match your direct routing numbers.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1fXx1TOgZFuZVhjx1eDjUQ.png&#34;
	width=&#34;2262&#34;
	height=&#34;504&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1fXx1TOgZFuZVhjx1eDjUQ_hu_7987eedd010e75ba.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1fXx1TOgZFuZVhjx1eDjUQ_hu_39879f56bf6aa2ea.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;448&#34;
		data-flex-basis=&#34;1077px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;city&#34;&gt;City
&lt;/h4&gt;&lt;p&gt;The purpose of this list is to make the management of phone numbers easier. The more information you have, the better you can filter. That’s why I added a &lt;strong&gt;City&lt;/strong&gt; column as well.&lt;/p&gt;
&lt;h4 id=&#34;number-reservation&#34;&gt;Number Reservation
&lt;/h4&gt;&lt;p&gt;The &lt;strong&gt;Status&lt;/strong&gt; column is now a drop-down list. Setting a number to &lt;strong&gt;Reserved&lt;/strong&gt; won’t do anything yet, except letting other people which use the list know that this number should not be assigned to any user or resource account.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1hCvnQlLcivK4l6aqVptQ.png&#34;
	width=&#34;1804&#34;
	height=&#34;266&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1hCvnQlLcivK4l6aqVptQ_hu_17ad2a280247b488.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1hCvnQlLcivK4l6aqVptQ_hu_7080d2278fa93b72.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;678&#34;
		data-flex-basis=&#34;1627px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Because this is a SharePoint list, we can add a comment on that entry.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/19B3gsc94JUVpwVXhbEiLw.png&#34;
	width=&#34;1186&#34;
	height=&#34;498&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/19B3gsc94JUVpwVXhbEiLw_hu_53b9080a00ad6d40.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/19B3gsc94JUVpwVXhbEiLw_hu_35151cf7ecbbf80.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;238&#34;
		data-flex-basis=&#34;571px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The runbook will not make any changes or updates to that entry until the number is assigned or the Status is changed by hand again.&lt;/p&gt;
&lt;h4 id=&#34;assign-anumber&#34;&gt;Assign a Number
&lt;/h4&gt;&lt;p&gt;To assign a number, simply set a number to &lt;strong&gt;Reserved&lt;/strong&gt; and choose a &lt;strong&gt;User Profile&lt;/strong&gt; from the people picker.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1QNTzy43yr2pBe9Ow3xAWA.png&#34;
	width=&#34;1067&#34;
	height=&#34;246&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1QNTzy43yr2pBe9Ow3xAWA_hu_b766eb874636bac3.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1QNTzy43yr2pBe9Ow3xAWA_hu_cbac88d374b7be2e.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;433&#34;
		data-flex-basis=&#34;1040px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The list will then look like this. There’s a &lt;strong&gt;User Profile&lt;/strong&gt; linked but the &lt;strong&gt;User Principal Name&lt;/strong&gt; is still unassigned.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1xrSnRsutiS2xUJ6y4U6Lw.png&#34;
	width=&#34;1581&#34;
	height=&#34;266&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1xrSnRsutiS2xUJ6y4U6Lw_hu_eee5a65fe39f16fb.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1xrSnRsutiS2xUJ6y4U6Lw_hu_fc9bb1858e5ff133.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;594&#34;
		data-flex-basis=&#34;1426px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The next time the runbook runs, it will try to assign the number. If the assignment fails for any reason, the Staus will change to &lt;strong&gt;Assignment Error&lt;/strong&gt; but the linked User Profile will be retained.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1z8KikMnOal4Oa2WxTYQ73A.png&#34;
	width=&#34;1586&#34;
	height=&#34;260&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1z8KikMnOal4Oa2WxTYQ73A_hu_d6d92f5a90c5df3b.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1z8KikMnOal4Oa2WxTYQ73A_hu_58f872185e3750c2.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;610&#34;
		data-flex-basis=&#34;1464px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Currently, the list only reflects a generic error. The runbook output, however, does include more information.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/11OI1hJz1RuwkoEm43rU0Q.png&#34;
	width=&#34;809&#34;
	height=&#34;107&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/11OI1hJz1RuwkoEm43rU0Q_hu_ec2466f19ebf88ce.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/11OI1hJz1RuwkoEm43rU0Q_hu_e1ed31cbe8a879a1.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;756&#34;
		data-flex-basis=&#34;1814px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The script will even assign a voice routing policy for direct routing numbers if you specify one in the CountryLookupTable.json file. I will show you how to do that at the end of this article.&lt;/p&gt;
&lt;p&gt;If you really want to be on top of your game, you can also create a rule to notify you of failed assignments.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/151zUCwelWtbrDgbnzkfNQ.png&#34;
	width=&#34;2300&#34;
	height=&#34;1259&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/151zUCwelWtbrDgbnzkfNQ_hu_74fba7abba987dfa.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/151zUCwelWtbrDgbnzkfNQ_hu_5840c872664539b1.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;182&#34;
		data-flex-basis=&#34;438px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;unassign-anumber&#34;&gt;Unassign a Number
&lt;/h4&gt;&lt;p&gt;To unassign a number, simply change the Status to &lt;strong&gt;Remove Pending&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1o5Nh9gEBN07IBhByFt8Few.png&#34;
	width=&#34;1582&#34;
	height=&#34;267&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1o5Nh9gEBN07IBhByFt8Few_hu_eea8772a560afc0c.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1o5Nh9gEBN07IBhByFt8Few_hu_98397c55cc2126d0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;592&#34;
		data-flex-basis=&#34;1422px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The number will then be removed from the user, the next time the runbook is running.&lt;/p&gt;
&lt;h4 id=&#34;performance-improvements&#34;&gt;Performance Improvements
&lt;/h4&gt;&lt;p&gt;I’ve also made some changes which will improve the performance of the script dramatically. I discovered a couple of redundant Graph requests which have now been reduced to the minimum required.&lt;/p&gt;
&lt;h3 id=&#34;changes-inv2&#34;&gt;Changes in V2
&lt;/h3&gt;&lt;h4 id=&#34;changes-to-thelist&#34;&gt;Changes to the List
&lt;/h4&gt;&lt;p&gt;Edit the &lt;strong&gt;Status&lt;/strong&gt; column of your list.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1P2a8Jd5iHaAPfAvS6IglA.png&#34;
	width=&#34;1424&#34;
	height=&#34;518&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1P2a8Jd5iHaAPfAvS6IglA_hu_f2c97fe8e728aade.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1P2a8Jd5iHaAPfAvS6IglA_hu_41b851539e45c8db.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;274&#34;
		data-flex-basis=&#34;659px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Change the &lt;strong&gt;Type&lt;/strong&gt; from &lt;strong&gt;Single line of Text&lt;/strong&gt; to &lt;strong&gt;Choice&lt;/strong&gt; and add the following choices.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1scOs84KlwMBYFhiCNnG3Q.png&#34;
	width=&#34;484&#34;
	height=&#34;836&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1scOs84KlwMBYFhiCNnG3Q_hu_fe698f43eac36da.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1scOs84KlwMBYFhiCNnG3Q_hu_3d857631019ff1fd.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;57&#34;
		data-flex-basis=&#34;138px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Save the changes to the &lt;strong&gt;Status&lt;/strong&gt; column.&lt;/p&gt;
&lt;p&gt;Now add a new &lt;strong&gt;Text&lt;/strong&gt; column.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1cjsXM6TTXhTYVAZGMag.png&#34;
	width=&#34;837&#34;
	height=&#34;636&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1cjsXM6TTXhTYVAZGMag_hu_26dd21e9f5f39347.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1cjsXM6TTXhTYVAZGMag_hu_a40be6c259a7cc94.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;131&#34;
		data-flex-basis=&#34;315px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Name it &lt;strong&gt;City&lt;/strong&gt; and choose Type &lt;strong&gt;Single line of text.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1QXZyFo02BJglprnd8cS4og.png&#34;
	width=&#34;479&#34;
	height=&#34;689&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1QXZyFo02BJglprnd8cS4og_hu_d3b5bf52ce169617.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1QXZyFo02BJglprnd8cS4og_hu_63d83db3a0c206fc.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;69&#34;
		data-flex-basis=&#34;166px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;changes-to-theflow&#34;&gt;Changes to the Flow
&lt;/h3&gt;&lt;h4 id=&#34;update-trigger-condition&#34;&gt;Update Trigger Condition
&lt;/h4&gt;&lt;p&gt;In your flow’s trigger condition, delete the existing condition and paste the following expression.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Update 08.08.2023&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Thanks to a community member of my Teams Phone Admin &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/discord.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Discord Server&lt;/a&gt; I was made aware that the trigger condition can fail if the UPN and the email address case did not match. Below is the corrected trigger condition which includes a &lt;code&gt;toLower()&lt;/code&gt; expression as well.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;/Update&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;@or(&lt;br&gt;
and(&lt;br&gt;
not(equals(triggerOutputs()?[&amp;lsquo;body/User_x0020_Principal_x0020_Name&amp;rsquo;], &amp;lsquo;Unassigned&amp;rsquo;)),&lt;br&gt;
not(contains(triggerBody(), &amp;lsquo;UserProfile&amp;rsquo;))&lt;br&gt;
),&lt;br&gt;
not(equals(toLower(triggerOutputs()?[&amp;lsquo;body/User_x0020_Principal_x0020_Name&amp;rsquo;]), toLower(triggerOutputs()?[&amp;lsquo;body/UserProfile&amp;rsquo;][&amp;lsquo;Email&amp;rsquo;]))),&lt;br&gt;
and(&lt;br&gt;
contains(triggerBody(), &amp;lsquo;UserProfile&amp;rsquo;),&lt;br&gt;
not(equals(triggerOutputs()?[&amp;lsquo;body/User_x0020_Principal_x0020_Name&amp;rsquo;], &amp;lsquo;Unassigned&amp;rsquo;)),&lt;br&gt;
not(contains(triggerBody(), &amp;lsquo;TeamsAdminCenter&amp;rsquo;))&lt;br&gt;
)&lt;br&gt;
)&lt;/p&gt;
&lt;p&gt;The expression is now also included in the &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation/blob/main/Resources/FlowTriggerCondition.txt&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;repository&lt;/a&gt; for better readability. The line breaks will be automatically removed once you paste it in Power Automate.&lt;/p&gt;
&lt;p&gt;This will also trigger the flow, when a &lt;strong&gt;User Profile&lt;/strong&gt; was added manually through the list (not by the flow) which is what happens when a list user wants to assign a number to a new Teams User.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/15XzTMBRpRFoAN8QWg0wg.png&#34;
	width=&#34;1658&#34;
	height=&#34;257&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/15XzTMBRpRFoAN8QWg0wg_hu_384d0a12921df924.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/15XzTMBRpRFoAN8QWg0wg_hu_3d57b7770865b63b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;645&#34;
		data-flex-basis=&#34;1548px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;add-another-condition&#34;&gt;Add Another Condition
&lt;/h4&gt;&lt;p&gt;I don’t know why it didn’t occur to me initially but instead of using the runbook to recreate items which have been deleted by the flow, we can just use the flow to do that as well. The reason why we need to delete and re-create is because setting the User Profile to &lt;strong&gt;null&lt;/strong&gt; did not work in Power Automate.&lt;/p&gt;
&lt;p&gt;In the first &lt;strong&gt;If yes&lt;/strong&gt; action, we have to add another condition which checks if the &lt;strong&gt;Status Value&lt;/strong&gt; is equal to &lt;strong&gt;Unassigned.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/11borC4Preqwfg27E0VYQA.png&#34;
	width=&#34;926&#34;
	height=&#34;296&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/11borC4Preqwfg27E0VYQA_hu_65f998cf443c64ea.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/11borC4Preqwfg27E0VYQA_hu_b6c6ac53f28c38d1.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;312&#34;
		data-flex-basis=&#34;750px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The existing &lt;strong&gt;Delete&lt;/strong&gt; &lt;strong&gt;item&lt;/strong&gt; action has to be copied to the clipboard, deleted, and then pasted inside the &lt;strong&gt;If yes&lt;/strong&gt; action of the second condition again.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1b0l089aKSKjnKzGhs2WLw.png&#34;
	width=&#34;1241&#34;
	height=&#34;125&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1b0l089aKSKjnKzGhs2WLw_hu_274f51ddd3211577.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1b0l089aKSKjnKzGhs2WLw_hu_fb6ee3d9480c04f2.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;992&#34;
		data-flex-basis=&#34;2382px&#34;
	
&gt;
&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/151IVw0NFOPlwJIyS5Z6A.png&#34;
	width=&#34;918&#34;
	height=&#34;326&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/151IVw0NFOPlwJIyS5Z6A_hu_ff7972a07f008623.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/151IVw0NFOPlwJIyS5Z6A_hu_8b82c47929ff006f.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;281&#34;
		data-flex-basis=&#34;675px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;add-create-itemaction&#34;&gt;Add Create Item Action
&lt;/h4&gt;&lt;p&gt;In the second &lt;strong&gt;If yes&lt;/strong&gt; action, add a &lt;strong&gt;Create item&lt;/strong&gt; action after &lt;strong&gt;Delete&lt;/strong&gt; item with the following dynamic values.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1KEG3uPMLbf8mXKkAHXCBw.png&#34;
	width=&#34;964&#34;
	height=&#34;1421&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1KEG3uPMLbf8mXKkAHXCBw_hu_bb46b78655951724.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1KEG3uPMLbf8mXKkAHXCBw_hu_b52e61bf02ad26f4.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;67&#34;
		data-flex-basis=&#34;162px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Here’s a new screenshot of the complete flow with collapsed boxes.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1xF9V8IvU5ZFciYjH1fsqYg.png&#34;
	width=&#34;3158&#34;
	height=&#34;1242&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1xF9V8IvU5ZFciYjH1fsqYg_hu_e9dc00e1cbd2fb04.png 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/1xF9V8IvU5ZFciYjH1fsqYg_hu_1bc6b290d5e57cc4.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;254&#34;
		data-flex-basis=&#34;610px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;changes-to-the-countrylookuptablejson&#34;&gt;Changes to the CountryLookupTable.json
&lt;/h3&gt;&lt;h4 id=&#34;add-more-preciseprefixes&#34;&gt;Add More Precise Prefixes
&lt;/h4&gt;&lt;p&gt;There are some countries which use the same phone prefix. If multiple matches are found, the function always uses the last match which might be wrong in many cases. To solve this, just edit the Json file yourself.&lt;/p&gt;
&lt;p&gt;For example, if you have Australian &lt;strong&gt;+61&lt;/strong&gt; numbers, but don’t have any numbers from Christmas Island or Cocos Islands (which also start with +61), just delete these entries from the Json.&lt;/p&gt;
&lt;p&gt;In case you have e.g. numbers from Canada and USA, which both start with &lt;strong&gt;+1,&lt;/strong&gt; you can also extend the prefix to include all digits which are common in all your number ranges from left to right.&lt;/p&gt;
&lt;p&gt;Original Entry&lt;/p&gt;
&lt;p&gt;{&lt;br&gt;
&amp;ldquo;Prefix&amp;rdquo;: &amp;ldquo;+1&amp;rdquo;,&lt;br&gt;
&amp;ldquo;CountryName&amp;rdquo;: &amp;ldquo;United States&amp;rdquo;,&lt;br&gt;
&amp;ldquo;Country&amp;rdquo;: &amp;ldquo;US&amp;rdquo;&lt;br&gt;
}&lt;/p&gt;
&lt;p&gt;Possible Entry Change&lt;/p&gt;
&lt;p&gt;{&lt;br&gt;
&amp;ldquo;Prefix&amp;rdquo;: &amp;ldquo;+1206&amp;rdquo;,&lt;br&gt;
&amp;ldquo;CountryName&amp;rdquo;: &amp;ldquo;United States&amp;rdquo;,&lt;br&gt;
&amp;ldquo;Country&amp;rdquo;: &amp;ldquo;US&amp;rdquo;&lt;br&gt;
}&lt;/p&gt;
&lt;p&gt;This example assumes that you have Canadian direct routing numbers starting with &lt;strong&gt;+1&lt;/strong&gt; and have US direct routing numbers which all start with &lt;strong&gt;+1206&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;If you have more prefixes from the same country in your number ranges, just add more entries with different prefixes but with the same country.&lt;/p&gt;
&lt;p&gt;{&lt;br&gt;
&amp;ldquo;Prefix&amp;rdquo;: &amp;ldquo;+1206&amp;rdquo;,&lt;br&gt;
&amp;ldquo;CountryName&amp;rdquo;: &amp;ldquo;United States&amp;rdquo;,&lt;br&gt;
&amp;ldquo;Country&amp;rdquo;: &amp;ldquo;US&amp;rdquo;&lt;br&gt;
},&lt;br&gt;
{&lt;br&gt;
&amp;ldquo;Prefix&amp;rdquo;: &amp;ldquo;+1323&amp;rdquo;,&lt;br&gt;
&amp;ldquo;CountryName&amp;rdquo;: &amp;ldquo;United States&amp;rdquo;,&lt;br&gt;
&amp;ldquo;Country&amp;rdquo;: &amp;ldquo;US&amp;rdquo;&lt;br&gt;
}&lt;/p&gt;
&lt;h4 id=&#34;add-voice-routing-policynames&#34;&gt;Add Voice Routing Policy Names
&lt;/h4&gt;&lt;p&gt;If you want to use the list for assignment of direct routing numbers, you’ll have to add the name of your voice routing policy for each country to the &lt;strong&gt;CountryLookupTable.json&lt;/strong&gt; file.&lt;/p&gt;
&lt;p&gt;{&lt;br&gt;
&amp;ldquo;Prefix&amp;rdquo;: &amp;ldquo;+41&amp;rdquo;,&lt;br&gt;
&amp;ldquo;CountryName&amp;rdquo;: &amp;ldquo;Switzerland&amp;rdquo;,&lt;br&gt;
&amp;ldquo;Country&amp;rdquo;: &amp;ldquo;CH&amp;rdquo;,&lt;br&gt;
&amp;ldquo;VoiceRoutingPolicy&amp;rdquo;: &amp;ldquo;Switzerland&amp;rdquo;&lt;br&gt;
}&lt;/p&gt;
&lt;p&gt;Currently, this solution only supports one voice routing policy per country entry in the CountryLookupTable.json file.&lt;/p&gt;
&lt;p&gt;If you have different voice routing policies for various locations within the same country, you’ll have to try to find a way to match them via their prefixes and add multiple entries in the Json.&lt;/p&gt;
&lt;p&gt;{&lt;br&gt;
&amp;ldquo;Prefix&amp;rdquo;: &amp;ldquo;+4144&amp;rdquo;,&lt;br&gt;
&amp;ldquo;CountryName&amp;rdquo;: &amp;ldquo;Switzerland&amp;rdquo;,&lt;br&gt;
&amp;ldquo;Country&amp;rdquo;: &amp;ldquo;CH&amp;rdquo;,&lt;br&gt;
&amp;ldquo;VoiceRoutingPolicy&amp;rdquo;: &amp;ldquo;Switzerland-Zurich&amp;rdquo;&lt;br&gt;
},&lt;br&gt;
{&lt;br&gt;
&amp;ldquo;Prefix&amp;rdquo;: &amp;ldquo;+4131&amp;rdquo;,&lt;br&gt;
&amp;ldquo;CountryName&amp;rdquo;: &amp;ldquo;Switzerland&amp;rdquo;,&lt;br&gt;
&amp;ldquo;Country&amp;rdquo;: &amp;ldquo;CH&amp;rdquo;,&lt;br&gt;
&amp;ldquo;VoiceRoutingPolicy&amp;rdquo;: &amp;ldquo;Switzerland-Bern&amp;rdquo;&lt;br&gt;
}&lt;/p&gt;
&lt;h4 id=&#34;changes-to-teamsphonenumberoverviewps1&#34;&gt;Changes to TeamsPhoneNumberOverview.ps1
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;Update 11.04.2023&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Sorry, I totally forgot to mention that you’ll also need to specify the name of the SharePoint User Information List in your language.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;# Set your language or add it to the switch statement&lt;br&gt;
# To find the name of your user information list, go to:&lt;br&gt;
# https://&lt;your domain&gt;.sharepoint.com/sites/&lt;your site name&gt;/_catalogs/users/simple.aspx&lt;br&gt;
$spoLanguage = &amp;ldquo;German&amp;rdquo;&lt;/p&gt;
&lt;p&gt;switch ($spoLanguage) {&lt;br&gt;
German {&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;    $localizedUserInformationList = &amp;quot;Benutzerinformationsliste&amp;quot;  

}  
English {  

    $localizedUserInformationList = &amp;quot;User Information List&amp;quot;  

}  
Default {  

    $localizedUserInformationList = &amp;quot;User Information List&amp;quot;  

}  
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;p&gt;I hope that you like the &lt;strong&gt;V2&lt;/strong&gt; upgrade of my budget number management list.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/0i9hHsRnLxMO42ePg.jpg&#34;
	width=&#34;1024&#34;
	height=&#34;1024&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/0i9hHsRnLxMO42ePg_hu_f0669dd6d37c9d5d.jpg 480w, https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a/0i9hHsRnLxMO42ePg_hu_38f1d0482eaa6fbe.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;100&#34;
		data-flex-basis=&#34;240px&#34;
	
&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Teams Phone Number Management on a Budget</title>
        <link>https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/</link>
        <pubDate>Thu, 23 Mar 2023 13:05:11 +0000</pubDate>
        
        <guid>https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/</guid>
        <description>&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/0TNGGsjES22NTIbT.jpg&#34;
	width=&#34;1024&#34;
	height=&#34;1024&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/0TNGGsjES22NTIbT_hu_c6fd37b5c1ffc22.jpg 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/0TNGGsjES22NTIbT_hu_29351c288b401357.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;100&#34;
		data-flex-basis=&#34;240px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Update 08.04.2023&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I’ve updated this solution to V2 which includes the capability to assign, unassign and reserve phone numbers along with other improvements.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Please read &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/teams-phone-number-management-list-part-2-b5385e348a3a&#34; &gt;this article&lt;/a&gt; when you have finished reading this one.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;/Update&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Every Teams Voice Admin that has deployed Direct Routing knows the struggle. There’s no way to manage Direct Routing numbers in Teams Admin Center. This makes it hard for us to get a clear overview of which numbers are still unassigned/free or even to see all the numbers we have.&lt;/p&gt;
&lt;p&gt;Obviously, there’s a solution for anything. We can use PowerShell to export numbers and create our own lists in Excel or whatever. The challenge with that is to keep the list up to date, error free and make it centrally available for all people who need to work with it.&lt;/p&gt;
&lt;p&gt;There are also lots of vendors which offer Teams phone number management platforms. Here are some of them:&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://callroute.com/features/number-management/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Number Management for Microsoft Teams (callroute.com)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.codesoftware.net/clobba-rm/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Clobba Range Manager — DID Number Management — Code Software&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.pure-ip.com/number-connect&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Number Connect (pure-ip.com)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://teamsboss.com/app/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;TeamsBoss&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;They all have powerful features — which come with a price. But what if we don’t need a full-fledged management solution and just want a simple overview which is dynamically updated?&lt;/p&gt;
&lt;p&gt;That’s exactly what I’ve been building in my spare time over the last few weeks.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1bJzySshLFfuKEkIhfsSCQ.png&#34;
	width=&#34;2789&#34;
	height=&#34;1101&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1bJzySshLFfuKEkIhfsSCQ_hu_231c96e2be9ae68c.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1bJzySshLFfuKEkIhfsSCQ_hu_477efd58af7f58ce.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;253&#34;
		data-flex-basis=&#34;607px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The final product is a SharePoint list which gets automatically updated by an Azure Automation Runbook every hour.&lt;/p&gt;
&lt;p&gt;This time around, I tried to automate everything I could. This means less work for you if you want to deploy it yourself. But before we get into the technical details of it, let’s look at the list.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TL;DR&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;If you don’t care about the details and want to deploy straight away, you can grab the code from &lt;a class=&#34;link&#34; href=&#34;http://mozziemozz/TeamsPhoneAutomation:%20Automation%20Scripts%20for%20Microsoft%20Teams%20Phone%20%28github.com%29&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&#34;the-list&#34;&gt;The List
&lt;/h3&gt;&lt;h4 id=&#34;the-columns&#34;&gt;The Columns
&lt;/h4&gt;&lt;p&gt;The list can be viewed in SharePoint Online, Microsoft Lists or directly in Teams through Lists. It consists of the following columns.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Title&lt;/strong&gt; = Phone Number&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Phone Extension&lt;/strong&gt; = Extension if there is one configured&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Status&lt;/strong&gt; = Assigned/Unassigned&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Number Type&lt;/strong&gt; = Direct Routing / Calling Plan / Operator Connect&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;User Name&lt;/strong&gt; = Display Name of assigned account&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;User Principal Name&lt;/strong&gt; = UPN of assigned account&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Account Type&lt;/strong&gt; = User Account / Resource Account / Conference Bridge&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Country&lt;/strong&gt; = The country a number belongs to&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;UserId&lt;/strong&gt; = Object Id from Azure AD&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;User Profile&lt;/strong&gt; = Profile Card&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Teams Admin Center&lt;/strong&gt; = Link to manage the user in TAC&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This should cover most of the relevant information somebody might want to know about their phone numbers.&lt;/p&gt;
&lt;h4 id=&#34;filtering&#34;&gt;Filtering
&lt;/h4&gt;&lt;p&gt;Having all that information available allows us to easily filter numbers which meet certain criteria. In this example, I filtered the list for all unassigned numbers from the UK.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/14bBmRV7urUrZc22NiWUVDA.png&#34;
	width=&#34;2100&#34;
	height=&#34;272&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/14bBmRV7urUrZc22NiWUVDA_hu_2110504dc1ae7c21.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/14bBmRV7urUrZc22NiWUVDA_hu_3d44a68a14fabb6f.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;772&#34;
		data-flex-basis=&#34;1852px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Because this number is unassigned and it could be assigned to a &lt;strong&gt;Resource Account&lt;/strong&gt; or a &lt;strong&gt;Conference Bridge&lt;/strong&gt;, both types are included in the list.&lt;/p&gt;
&lt;p&gt;If we compare that to an assigned service number, we can see that the &lt;strong&gt;Account Type&lt;/strong&gt; is shown as &lt;strong&gt;Resource Account&lt;/strong&gt; because the number is assigned to one.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1wZdcr9ASB2hnmRdFT5w.png&#34;
	width=&#34;2086&#34;
	height=&#34;269&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1wZdcr9ASB2hnmRdFT5w_hu_7a557cd109c4fffd.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1wZdcr9ASB2hnmRdFT5w_hu_1a65d2ef0b0682b0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;775&#34;
		data-flex-basis=&#34;1861px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The most common thing which people probably want to see at glance is which &lt;strong&gt;direct routing&lt;/strong&gt; numbers are unassigned from a specific country. This can also be achieved very easily.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1IUJX8fpDC3xi4wpcd5kfg.png&#34;
	width=&#34;2280&#34;
	height=&#34;520&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1IUJX8fpDC3xi4wpcd5kfg_hu_4ff2dcb2fb36f9f3.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1IUJX8fpDC3xi4wpcd5kfg_hu_a3bf0e3c7030bbe1.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;438&#34;
		data-flex-basis=&#34;1052px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I learned a lot during the development of this project, and I now want to share that with you. Let’s take a look at how the SharePoint list was built and how it automatically updates itself with the help of &lt;strong&gt;Azure Automation&lt;/strong&gt;.&lt;/p&gt;
&lt;h3 id=&#34;deployment&#34;&gt;Deployment
&lt;/h3&gt;&lt;p&gt;There are very few manual tasks required to get this set up. I built a deployment script which will create all the required resources in Azure for you.&lt;/p&gt;
&lt;h4 id=&#34;clone-the-githubrepo&#34;&gt;Clone The GitHub Repo
&lt;/h4&gt;&lt;p&gt;Start by cloning or downloading the GitHub Repo.&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;mozziemozz/TeamsPhoneAutomation: Automation Scripts for Microsoft Teams Phone (github.com)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;If you’ve never worked with GitHub before, I highly recommend trying it instead of just downloading the repository as a zip file. All you need to do is &lt;a class=&#34;link&#34; href=&#34;https://github.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;sign up&lt;/a&gt; for an account, install the &lt;a class=&#34;link&#34; href=&#34;https://desktop.github.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;desktop client&lt;/a&gt; and clone the repo.&lt;/p&gt;
&lt;p&gt;Once you have signed into GitHub Desktop, just head over to the &lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;repository URL&lt;/a&gt; and open it in GitHub Desktop.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1Id3QSS2WJGsTfGqGPJ55Q.png&#34;
	width=&#34;1390&#34;
	height=&#34;588&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1Id3QSS2WJGsTfGqGPJ55Q_hu_ba81dfa996dc53d6.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1Id3QSS2WJGsTfGqGPJ55Q_hu_ce5b19c4dfc3afec.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;236&#34;
		data-flex-basis=&#34;567px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Then choose your local folder and click on clone. Make sure to select a folder which isn’t synchronized to any kind of cloud Storage like OneDrive. The constant syncing of files would impair your performance dramatically.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1tqEoryFHlOYEPKCBQaED6Q.png&#34;
	width=&#34;736&#34;
	height=&#34;446&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1tqEoryFHlOYEPKCBQaED6Q_hu_36d447bccadaffc3.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1tqEoryFHlOYEPKCBQaED6Q_hu_ca1c736a4e47ba53.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;165&#34;
		data-flex-basis=&#34;396px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The repo contains the following files and folders.&lt;/p&gt;
&lt;p&gt;C:\TEMP\GITHUB\TEAMSPHONEAUTOMATION&lt;br&gt;
│   .gitignore&lt;br&gt;
│   Deploy.ps1&lt;br&gt;
│   README.md&lt;br&gt;
│&lt;br&gt;
├───Functions&lt;br&gt;
│       Connect-MgGraphHTTP.ps1&lt;br&gt;
│       Connect-MsTeamsServicePrincipal.ps1&lt;br&gt;
│       Get-CountryFromPrefix.ps1&lt;br&gt;
│       Get-CsOnlineNumbers.ps1&lt;br&gt;
│&lt;br&gt;
├───Resources&lt;br&gt;
│       CountryLookupTable.json&lt;br&gt;
│       CreateList.json&lt;br&gt;
│       DirectRoutingNumbers.csv&lt;br&gt;
│       Environment.json&lt;br&gt;
│&lt;br&gt;
├───Scripts&lt;br&gt;
│       TeamsPhoneNumberOverview.ps1&lt;br&gt;
│&lt;br&gt;
└───Setup&lt;br&gt;
Setup.ps1&lt;br&gt;
UpdateDirectRoutingNumbers.ps1&lt;/p&gt;
&lt;h4 id=&#34;environmentjson&#34;&gt;Environment.json
&lt;/h4&gt;&lt;p&gt;Before we do anything, we need to define a few things and names. In &lt;code&gt;.\Resources&lt;/code&gt; open the &lt;code&gt;Environment.json&lt;/code&gt; file and fill in your own information.&lt;/p&gt;
&lt;p&gt;{&lt;br&gt;
&amp;ldquo;TenantId&amp;rdquo;: &amp;ldquo;4bffbf87-53a0-4fce-b58b-xxxxxxxxxxxx&amp;rdquo;,&lt;br&gt;
&amp;ldquo;GroupId&amp;rdquo;: &amp;ldquo;aff7d27f-878d-422c-83bd-xxxxxxxxxxxx&amp;rdquo;,&lt;br&gt;
&amp;ldquo;MSListName&amp;rdquo;: &amp;ldquo;Teams Phone Number Overview Demo&amp;rdquo;,&lt;br&gt;
&amp;ldquo;ResourceGroupName&amp;rdquo;: &amp;ldquo;mzz-rmg-001&amp;rdquo;,&lt;br&gt;
&amp;ldquo;AutomationAccountName&amp;rdquo;: &amp;ldquo;mzz-automation-account-001&amp;rdquo;,&lt;br&gt;
&amp;ldquo;AzLocation&amp;rdquo;: &amp;ldquo;West Europe&amp;rdquo;&lt;br&gt;
}&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TenantId&lt;/strong&gt; is your Tenant Id.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;GroupId&lt;/strong&gt; is the Object Id of the Microsoft Teams Team which hosts the SharePoint site where the list should be created.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MSListName&lt;/strong&gt; will be the name of your List in SharePoint.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ResourceGroupName&lt;/strong&gt; will be the name of the resource group which is created in Azure.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;AutomationAccountName&lt;/strong&gt; will be the name of the automation account which is created within the new resource group.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;AzLocation&lt;/strong&gt; is the Azure region where you want to deploy the resources.&lt;/p&gt;
&lt;p&gt;You can find a list of all available regions and their names &lt;a class=&#34;link&#34; href=&#34;https://azure.microsoft.com/en-us/explore/global-infrastructure/geographies/#geographies&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Make sure you save the file once you’ve filled in all the information.&lt;/p&gt;
&lt;h4 id=&#34;directroutingnumberscsv&#34;&gt;DirectRoutingNumbers.csv
&lt;/h4&gt;&lt;p&gt;Next, we need a list which contains all your direct routing numbers. This file can only contain one column called &lt;strong&gt;PhoneNumber&lt;/strong&gt;. All the numbers must be in &lt;strong&gt;E.164&lt;/strong&gt; format but without the leading &lt;code&gt;+&lt;/code&gt; . The plus sign will be added by the script later. It just makes things easier in Excel if we don’t need to bother about the plus.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1nnwTg3pq3UCddPisob7HqA.png&#34;
	width=&#34;1461&#34;
	height=&#34;969&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1nnwTg3pq3UCddPisob7HqA_hu_93be95d2178a90ba.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1nnwTg3pq3UCddPisob7HqA_hu_a2b8f8df5136a28a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;150&#34;
		data-flex-basis=&#34;361px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;That’s it for the preparation.&lt;/p&gt;
&lt;h4 id=&#34;deployps1&#34;&gt;Deploy.ps1
&lt;/h4&gt;&lt;p&gt;Disclaimer: The script has been tested on a vanilla Windows 11 virtual machine where &lt;strong&gt;Windows Terminal&lt;/strong&gt; is configured as default console host and sessions start in the parent process directory. No PowerShell modules were installed before the script was first executed on this system.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;You will need an account with Global Administrator rights to successfully run this script. You also need local admin rights and need to make sure that running scripts is allowed on your machine.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In an elevated terminal, run the following code and close the terminal session once you have done so.&lt;/p&gt;
&lt;p&gt;Set-ExecutionPolicy Bypass&lt;/p&gt;
&lt;p&gt;To start the deployment, you need to run the &lt;code&gt;Deploy.ps1&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1WKugBxPGMHPFT71q8WUN1g.png&#34;
	width=&#34;618&#34;
	height=&#34;582&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1WKugBxPGMHPFT71q8WUN1g_hu_3857949ff8d0a6d7.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1WKugBxPGMHPFT71q8WUN1g_hu_d9a7c092679f0087.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;106&#34;
		data-flex-basis=&#34;254px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;This will just call the &lt;code&gt;.\Setup\Setup.ps1&lt;/code&gt; script which is the real deal.&lt;/p&gt;
&lt;h4 id=&#34;setupps1&#34;&gt;Setup.ps1
&lt;/h4&gt;&lt;p&gt;After all the module and components checks have been completed or the missing components have been installed, you will be prompted to sign into the &lt;a class=&#34;link&#34; href=&#34;https://pnp.github.io/cli-microsoft365/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;strong&gt;M365 CLI&lt;/strong&gt;&lt;/a&gt;&lt;strong&gt;.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1ZuLzxPnboF940mSkOnUFqA.png&#34;
	width=&#34;2430&#34;
	height=&#34;1392&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1ZuLzxPnboF940mSkOnUFqA_hu_d324a6bf7b2995f5.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1ZuLzxPnboF940mSkOnUFqA_hu_5fa45eb41453e037.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;174&#34;
		data-flex-basis=&#34;418px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Let me explain what’s going on in the script. Our end goal is to have a SharePoint list. Since we need a script to automatically update the list anyway, we might as well just create the list through PowerShell and Microsoft Graph instead of creating it manually.&lt;/p&gt;
&lt;p&gt;To provision all this stuff, we need a couple of &lt;strong&gt;Az.*&lt;/strong&gt; PowerShell modules. We also need &lt;strong&gt;Node.JS&lt;/strong&gt; so we can install the &lt;strong&gt;CLI for Microsoft 365&lt;/strong&gt; through &lt;strong&gt;NPM&lt;/strong&gt; (Node Package Manager). If you miss any of the components on your machine, they will automatically be installed, if you can provide local admin rights.&lt;/p&gt;
&lt;h4 id=&#34;azure-ad-app-registration--service-principal&#34;&gt;Azure AD App Registration &amp;amp; Service Principal
&lt;/h4&gt;&lt;p&gt;The M365 CLI will create a new Azure AD App Registration and a Service Principal. It will also assign the Microsoft Graph permission scopes we need to create and modify SharePoint lists and manage Microsoft Teams to the Service Principal.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1PKYwJDYOIAvgJi8us8uUMQ.png&#34;
	width=&#34;1928&#34;
	height=&#34;1395&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1PKYwJDYOIAvgJi8us8uUMQ_hu_a5f70cca8aacd39a.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1PKYwJDYOIAvgJi8us8uUMQ_hu_9637ae38be7cd0e.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;138&#34;
		data-flex-basis=&#34;331px&#34;
	
&gt;
&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1EvALgsWAXkRfjYM5WjZMGQ.png&#34;
	width=&#34;2616&#34;
	height=&#34;1297&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1EvALgsWAXkRfjYM5WjZMGQ_hu_b111f7b97325c4f9.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1EvALgsWAXkRfjYM5WjZMGQ_hu_42f74ca18f69e5ca.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;201&#34;
		data-flex-basis=&#34;484px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Both the App Registration and the Service Principal will use the name of the Automation Account. This way it’s easy to know where the assigned permissions are used within Azure.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1BFgrZUU3EnaOZDB1SutpQ.png&#34;
	width=&#34;1303&#34;
	height=&#34;115&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1BFgrZUU3EnaOZDB1SutpQ_hu_9d3563b73e82fade.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1BFgrZUU3EnaOZDB1SutpQ_hu_10971712106d607a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;1133&#34;
		data-flex-basis=&#34;2719px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The script also creates a new client secret for the App Registration.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1a2XyZpLjkpZ0HOfLCL32PA.png&#34;
	width=&#34;1950&#34;
	height=&#34;778&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1a2XyZpLjkpZ0HOfLCL32PA_hu_f0e3c354b8cdd719.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1a2XyZpLjkpZ0HOfLCL32PA_hu_ea8218146b7a5cb8.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;250&#34;
		data-flex-basis=&#34;601px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Remember, a client secret can only be viewed once, after it has been created in the portal. Because we used the CLI to create it, we can’t view it in the portal anymore. The secret is received by the script and saved in an encrypted state though. You’ll also be prompted if you want to view it in case you want to copy and store it in a safe place.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1zitK266ZKs6EST13zGeKCA.png&#34;
	width=&#34;2207&#34;
	height=&#34;120&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1zitK266ZKs6EST13zGeKCA_hu_89c391ed06643dd3.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1zitK266ZKs6EST13zGeKCA_hu_5f15aaa392cee6cf.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;1839&#34;
		data-flex-basis=&#34;4414px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;You don’t have to do this if you don’t want to. You can always decrypt it again, as long as you&amp;rsquo;re using the same machine and user account which encrypted it. The secret is saved to &lt;code&gt;.\.local\AppSecret.txt&lt;/code&gt; .&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1tWTZ8tk39JcYjIvwgY5xeA.png&#34;
	width=&#34;1891&#34;
	height=&#34;825&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1tWTZ8tk39JcYjIvwgY5xeA_hu_d67c07e54af6d7bf.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1tWTZ8tk39JcYjIvwgY5xeA_hu_92cebef4ba0c4f12.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;229&#34;
		data-flex-basis=&#34;550px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If you want to manually decrypt it later, you can use the following code.&lt;/p&gt;
&lt;p&gt;$AppSecret = [Runtime.InteropServices.Marshal]::PtrToStringAuto([Runtime.InteropServices.Marshal]::SecureStringToBSTR((Get-Content -Path .\.local\AppSecret.txt | ConvertTo-SecureString))) | Out-String&lt;/p&gt;
&lt;p&gt;Again, you don’t have to if you don’t want to. The script will be able to decrypt the secret and upload it to the Azure Automation Account once it’s needed.&lt;/p&gt;
&lt;p&gt;Once the permissions have been assigned to the Service Principal, the script uses the same Service Principal to connect to Microsoft Graph and assign the &lt;strong&gt;Skype for Business Administrator&lt;/strong&gt; role to itself.&lt;/p&gt;
&lt;p&gt;This is possible because the M365 CLI previously assigned the scope &lt;strong&gt;RoleManagement.ReadWrite.Directory&lt;/strong&gt; to the Service Principal.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1dprD8JGRDPs2yAJnvlPlwQ.png&#34;
	width=&#34;1927&#34;
	height=&#34;594&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1dprD8JGRDPs2yAJnvlPlwQ_hu_592ef12e7633983.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1dprD8JGRDPs2yAJnvlPlwQ_hu_387a035ee51841cd.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;324&#34;
		data-flex-basis=&#34;778px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The role is needed for the SP to be able to manage Microsoft Teams via PowerShell. I learned this from Christian Frohn’s excellent &lt;a class=&#34;link&#34; href=&#34;https://www.christianfrohn.dk/2022/11/13/connect-to-microsoft-teams-powershell-using-azure-app-reg-service-principal/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;blog article&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In case you’re wondering why no &lt;strong&gt;Microsoft.Graph&lt;/strong&gt; modules are required; this is because I chose to work with PowerShell native &lt;code&gt;Invoke-RestMethod&lt;/code&gt; commands instead of the &lt;code&gt;*Mg*&lt;/code&gt; Cmdlets.&lt;/p&gt;
&lt;h4 id=&#34;provisioning-the-azure-resources&#34;&gt;Provisioning the Azure Resources
&lt;/h4&gt;&lt;p&gt;The previous steps complete rather fast. The next steps are going to take a bit longer. First you need to sign in with an Account which has the appropriate permissions to create Azure resources within your subscription.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1pOaJ1YELOvcHWdcLOuFeGQ.png&#34;
	width=&#34;855&#34;
	height=&#34;1173&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1pOaJ1YELOvcHWdcLOuFeGQ_hu_656b2f14217c3971.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1pOaJ1YELOvcHWdcLOuFeGQ_hu_d1633900ebee858f.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;72&#34;
		data-flex-basis=&#34;174px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I guess it would have been possible to also assign some RBAC roles to the Service Principal which would allow us to use it to sign into Azure as well. Since the script is run locally on demand, I see no problem with using a normal user account for this part. It actually gives us time to review the created App Registration and Service Principal before the script starts to deploy any resources to Azure. Furthermore, we don’t need to worry about being aware of yet another Service Principal which has permissions to deploy or remove Azure Resources.&lt;/p&gt;
&lt;p&gt;The script will create a Resource Group with the name and location defined in &lt;strong&gt;Environment.json.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1ZZGYVP7g2uj2hi3O08RlzA.png&#34;
	width=&#34;1536&#34;
	height=&#34;469&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1ZZGYVP7g2uj2hi3O08RlzA_hu_cc9819622a028c5c.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1ZZGYVP7g2uj2hi3O08RlzA_hu_d0a421792d944e25.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;327&#34;
		data-flex-basis=&#34;786px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;It will also create a new Automation Account within the Resource Group, also in the same region.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1RvDl30FW8xOAHs3EUA3Q.png&#34;
	width=&#34;1508&#34;
	height=&#34;889&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1RvDl30FW8xOAHs3EUA3Q_hu_51ccdc4ed37c97fa.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1RvDl30FW8xOAHs3EUA3Q_hu_539d4ddfd309dc04.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;169&#34;
		data-flex-basis=&#34;407px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;automation-account&#34;&gt;Automation Account
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;Modules&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;MicrosoftTeams&lt;/strong&gt; Module is not added to Automation Accounts by default. Thus, the script needs to add it. This usually takes a couple of Minutes.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1RnQgpNQ3dOLfk0aDigurUQ.png&#34;
	width=&#34;1032&#34;
	height=&#34;427&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1RnQgpNQ3dOLfk0aDigurUQ_hu_7d7c61a03f3a16e4.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1RnQgpNQ3dOLfk0aDigurUQ_hu_91177aacfe9cd132.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;241&#34;
		data-flex-basis=&#34;580px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Once the module has finished importing, the script will continue.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1msSR1JykOc4mieC9hExE2g.png&#34;
	width=&#34;1922&#34;
	height=&#34;409&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1msSR1JykOc4mieC9hExE2g_hu_ab7e8314b060bc67.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1msSR1JykOc4mieC9hExE2g_hu_81ed07256b4f7475.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;469&#34;
		data-flex-basis=&#34;1127px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Variables&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The main script which will create/update our SharePoint List needs access to all the data we initially defined in &lt;strong&gt;Environment.josn&lt;/strong&gt;. This information is stored in &lt;strong&gt;Automation Variables&lt;/strong&gt; which can be accessed through Azure Runbooks.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1DBUuoXrqsTiu4XcayfA.png&#34;
	width=&#34;2456&#34;
	height=&#34;692&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1DBUuoXrqsTiu4XcayfA_hu_cd935a30445c9f6e.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1DBUuoXrqsTiu4XcayfA_hu_63b9f76fdab62d2e.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;354&#34;
		data-flex-basis=&#34;851px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The client secret is stored as an encrypted variable and cannot be viewed or edited. Its content can only be accessed by using the internal Cmdlet &lt;code&gt;Get-AutomationVariable&lt;/code&gt; .&lt;/p&gt;
&lt;p&gt;We can also see that we have a variable called &lt;strong&gt;TeamsPhoneNumberOverview_DirectRoutingNumbers.&lt;/strong&gt; This variable stores all Direct Routing numbers in &lt;strong&gt;Json&lt;/strong&gt; format. Because I ran into some issues with storing the Json content as a string, I needed to get creative and enclose it in single quotes: &lt;code&gt;&#39;{&amp;quot;Json&amp;quot;: &amp;quot;Example&amp;quot;}&#39;&lt;/code&gt; . These get removed when the variable is imported through the Runbook so that the Json can be converted to a PowerShell object.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TeamsPhoneNumberOverview_CountryLookupTable&lt;/strong&gt; contains a list with all countries and prefixes to determine the country of Direct Routing Numbers. To be consistent, this is also applied to Calling Plan and Operator Connect numbers, even though this information would be available through &lt;code&gt;Get-CsPhoneNumberAssignment&lt;/code&gt; .&lt;/p&gt;
&lt;p&gt;If you would like to learn more about these internal Cmdlets for Automation Variables or Azure Runbooks in general, I recommend this &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/fix-utf-8-encoding-when-calling-azure-child-runbooks-inline-78644e6af242&#34; &gt;article&lt;/a&gt; of mine.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Runbooks&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;We also have a couple of Runbooks which were deployed by the &lt;strong&gt;Setup.ps1&lt;/strong&gt; script. The main script logic sits in &lt;strong&gt;TeamsPhoneNumberOverview&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1cqbLWUjMSR1NhjCXqoCIg.png&#34;
	width=&#34;1901&#34;
	height=&#34;609&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1cqbLWUjMSR1NhjCXqoCIg_hu_d81eb0ebdc6165dc.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1cqbLWUjMSR1NhjCXqoCIg_hu_8bb6c09d03afc8cc.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;312&#34;
		data-flex-basis=&#34;749px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;To make the solution more modular some functions, like &lt;strong&gt;Connect-MgGraphHTTP&lt;/strong&gt; or &lt;strong&gt;Connect-MsTeamsServicePrincipal&lt;/strong&gt; are stored in separate Runbooks. This makes it easier to reuse them and means less work if we want to extend the Automation Account with other scripts.&lt;/p&gt;
&lt;p&gt;For example, if you have another Runbook in the same Automation Account which needs to connect to MicrosoftTeams PowerShell as well, you can just use the following code.&lt;/p&gt;
&lt;p&gt;. .\Connect-MsTeamsServicePrincipal.ps1&lt;/p&gt;
&lt;p&gt;$TenantId = Get-AutomationVariable -Name &amp;ldquo;TeamsPhoneNumberOverview_TenantId&amp;rdquo;&lt;br&gt;
$AppId = Get-AutomationVariable -Name &amp;ldquo;TeamsPhoneNumberOverview_AppId&amp;rdquo;&lt;br&gt;
$AppSecret = Get-AutomationVariable -Name &amp;ldquo;TeamsPhoneNumberOverview_AppSecret&amp;rdquo;&lt;/p&gt;
&lt;p&gt;. Connect-MsTeamsServicePrincipal -TenantId $TenantId -AppId $AppId -AppSecret $AppSecret&lt;/p&gt;
&lt;p&gt;And if you ever need to adjust something in the login function, you only need to change it in one script (Connect-MsTeamsServicePrincipal) and not in all your Runbooks.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Script Logic&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The code for the main script logic can be found here.&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation/blob/main/Scripts/TeamsPhoneNumberOverview.ps1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;TeamsPhoneAutomation/TeamsPhoneNumberOverview.ps1 at main · mozziemozz/TeamsPhoneAutomation (github.com)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I asked ChatGPT to explain what the script does. The result is astonishing.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This PowerShell script is designed to gather information about Microsoft Teams users who have phone numbers assigned to them, and store this information in a SharePoint list.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;The script starts by importing four external functions, which are used later in the script. It then sets some variables by retrieving values from Azure Automation variables. These variables include the name of the SharePoint list where the data will be stored, as well as the credentials needed to connect to the Microsoft Teams and Graph APIs.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Next, the script imports Direct Routing numbers and adds a leading plus sign to all of them. It also retrieves a list of existing SharePoint lists for a specific group ID, and checks if the desired SharePoint list already exists. If it does, the script retrieves its ID. If not, a new SharePoint list is created and its ID is retrieved.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;The script then retrieves information about all Teams users who have a phone number assigned to them. For each user, the script determines if they are a user or resource account, and then extracts details about their phone number, such as the phone number itself, any extension, and the country associated with the number. The script also checks if the phone number is a Direct Routing number or a CsOnline number. Finally, it creates an object containing all of this information for each user, and adds this object to an array.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Once all of the user information has been gathered, the script writes it to the SharePoint list. Each object in the array is written to a new row in the list.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The only thing I would have added is to mention that the script only adds new entries to the list, only updates changed entries with the new values and removes entries from the list which no longer exist.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Schedules&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The setup script has also created a recurring schedule which runs every hour. The schedule is automatically linked to the &lt;strong&gt;TeamsPhoneNumberOverview&lt;/strong&gt; Runbook by the script. This will result in the SharePoint list being updated once an hour.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1Iemob3BqBPX6OWWHvggsQ.png&#34;
	width=&#34;2217&#34;
	height=&#34;1137&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1Iemob3BqBPX6OWWHvggsQ_hu_a89080f523f91e17.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1Iemob3BqBPX6OWWHvggsQ_hu_82d9977c70ebe959.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;194&#34;
		data-flex-basis=&#34;467px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;That’s it. These are all the resources and components we need to create and update the SharePoint List.&lt;/p&gt;
&lt;h4 id=&#34;running-therunbook&#34;&gt;Running the Runbook
&lt;/h4&gt;&lt;p&gt;The Runbook schedule is configured in UTC. The first start time needs to be at least 5 minutes after the schedule’s creation time. To be sure, I set the schedule to run at the next full hour + 2 hours. In case this does not work for you in your local time zone, please let me know.&lt;/p&gt;
&lt;p&gt;This means that the SharePoint List won’t be created straight away. If you want to manually run the Runbook before the first scheduled start, just click on &lt;strong&gt;Start.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1qROsEUEs8dXdkq8CwSOaxQ.png&#34;
	width=&#34;1597&#34;
	height=&#34;193&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1qROsEUEs8dXdkq8CwSOaxQ_hu_30461f537b0de432.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1qROsEUEs8dXdkq8CwSOaxQ_hu_be9dfc7547ca006b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;827&#34;
		data-flex-basis=&#34;1985px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The job will just take a couple of minutes to complete.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1mp22izPK5jCc85FUtfZAkQ.png&#34;
	width=&#34;1120&#34;
	height=&#34;188&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1mp22izPK5jCc85FUtfZAkQ_hu_298e803a602c3ad8.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1mp22izPK5jCc85FUtfZAkQ_hu_417753c9bf6b164c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;595&#34;
		data-flex-basis=&#34;1429px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;You should then see the newly created List in SharePoint or Microsoft Lists.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1ER7l4q30cUIBaDndrjJfIQ.png&#34;
	width=&#34;2846&#34;
	height=&#34;1476&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1ER7l4q30cUIBaDndrjJfIQ_hu_82e1468fb2f35257.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1ER7l4q30cUIBaDndrjJfIQ_hu_7e82544d89b706f7.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;192&#34;
		data-flex-basis=&#34;462px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;finishing-touches&#34;&gt;Finishing Touches
&lt;/h3&gt;&lt;p&gt;Unfortunately, the Graph API has some limitations in terms of what types of fields can be added or updated in a list. I wanted to perfect my solution by also having a User Profile column and a link to Teams Admin Center for all assigned user numbers. These types can only be added manually.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Important:&lt;/strong&gt; For this and the next part, it’s extremely important to follow my instructions very carefully. If the column names don’t match up with the Flow it will not work.&lt;/p&gt;
&lt;h4 id=&#34;add-two-additional-columns&#34;&gt;Add Two Additional Columns
&lt;/h4&gt;&lt;p&gt;Click on &lt;strong&gt;+ Add column&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1KBxfdw50SMnsnhVzMCx5A.png&#34;
	width=&#34;831&#34;
	height=&#34;634&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1KBxfdw50SMnsnhVzMCx5A_hu_2be62200ecc6985d.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1KBxfdw50SMnsnhVzMCx5A_hu_dc090fd4aad9601a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;131&#34;
		data-flex-basis=&#34;314px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Name the column &lt;strong&gt;User Profile&lt;/strong&gt; and toggle &lt;strong&gt;Show profile photos&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1nYyOkp3UFJxGdomb1w4bDg.png&#34;
	width=&#34;477&#34;
	height=&#34;678&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1nYyOkp3UFJxGdomb1w4bDg_hu_c0fd6e6208ab6ace.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1nYyOkp3UFJxGdomb1w4bDg_hu_18309ecfb161f25.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;70&#34;
		data-flex-basis=&#34;168px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Repeat the steps and choose &lt;strong&gt;Hyperlink&lt;/strong&gt; this time.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1zQUl6GTYbNQymUbAQ9IU1g.png&#34;
	width=&#34;835&#34;
	height=&#34;634&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1zQUl6GTYbNQymUbAQ9IU1g_hu_94bd5f690d2d31ca.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1zQUl6GTYbNQymUbAQ9IU1g_hu_5caa26b8eb757bb1.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;131&#34;
		data-flex-basis=&#34;316px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Name this column &lt;strong&gt;Teams Admin Center.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Now let’s create the final part of our Number Overview Solution: A Power Automate Flow.&lt;/p&gt;
&lt;h4 id=&#34;create-theflow&#34;&gt;&lt;strong&gt;Create The Flow&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;Head over to &lt;a class=&#34;link&#34; href=&#34;https://make.powerautomate.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Microsoft Power Automate&lt;/a&gt; and create a new &lt;strong&gt;Automated Cloud Flow&lt;/strong&gt;. Name your flow and select &lt;strong&gt;When an item is created or modified&lt;/strong&gt; (SharePoint) as the trigger.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1eMzuzJ4sgXqtppTIWtTLbw.png&#34;
	width=&#34;1334&#34;
	height=&#34;841&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1eMzuzJ4sgXqtppTIWtTLbw_hu_5d68934f4dbba0c3.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1eMzuzJ4sgXqtppTIWtTLbw_hu_ec82539f2a1bb36a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;158&#34;
		data-flex-basis=&#34;380px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Select the Site/Team where your list has been created from the drop-down menu in &lt;strong&gt;Site Address.&lt;/strong&gt; Then choose your list from the drop-down.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1ruBvckSCFoyJbi3abfZbCQ.png&#34;
	width=&#34;929&#34;
	height=&#34;320&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1ruBvckSCFoyJbi3abfZbCQ_hu_4da5f0b01ac17af6.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1ruBvckSCFoyJbi3abfZbCQ_hu_74f47b9c05e3b20c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;290&#34;
		data-flex-basis=&#34;696px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Next, click on the three dots and select &lt;strong&gt;Settings.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1Kq7ExjGCW7nsIjO5gPMw.png&#34;
	width=&#34;1347&#34;
	height=&#34;742&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1Kq7ExjGCW7nsIjO5gPMw_hu_ca0eff5024be05a2.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1Kq7ExjGCW7nsIjO5gPMw_hu_1c7748595836c798.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;181&#34;
		data-flex-basis=&#34;435px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Add a &lt;strong&gt;Trigger Condition&lt;/strong&gt; and add the following code exactly as it is.&lt;/p&gt;
&lt;p&gt;@or(and(not(equals(triggerOutputs()?[&amp;lsquo;body/User_x0020_Principal_x0020_Name&amp;rsquo;], &amp;lsquo;Unassigned&amp;rsquo;)),not(contains(triggerBody(), &amp;lsquo;UserProfile&amp;rsquo;))),not(equals(triggerOutputs()?[&amp;lsquo;body/User_x0020_Principal_x0020_Name&amp;rsquo;],triggerOutputs()?[&amp;lsquo;body/UserProfile&amp;rsquo;][&amp;lsquo;Email&amp;rsquo;])))&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1mC9t4BUoxiJfqTSIonWsA.png&#34;
	width=&#34;920&#34;
	height=&#34;1358&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1mC9t4BUoxiJfqTSIonWsA_hu_4c06dfb6e979b45f.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1mC9t4BUoxiJfqTSIonWsA_hu_fa3d2e5badabf1c6.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;67&#34;
		data-flex-basis=&#34;162px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;This is the most crucial step. Without a trigger condition, we would create an infinite trigger loop since we use &lt;strong&gt;When an item is created or modified&lt;/strong&gt; as trigger and our final action will be &lt;strong&gt;Update item&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Add a &lt;strong&gt;Condition&lt;/strong&gt; where it checks if the &lt;strong&gt;User Principal Name&lt;/strong&gt; is equal to &lt;strong&gt;Unassigned.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1ynIuEDsOPU7mh4mGx7VQw.png&#34;
	width=&#34;945&#34;
	height=&#34;331&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1ynIuEDsOPU7mh4mGx7VQw_hu_d39a7bc9bf35e38d.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1ynIuEDsOPU7mh4mGx7VQw_hu_f318cf3a6611faa1.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;285&#34;
		data-flex-basis=&#34;685px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If the condition is &lt;strong&gt;True&lt;/strong&gt; or in other words, if the value of the &lt;strong&gt;User Principal Name&lt;/strong&gt; field is unassigned, we want to delete the list item.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1t4gRY6Gv6nOZqhgCQ9IF7w.png&#34;
	width=&#34;970&#34;
	height=&#34;609&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1t4gRY6Gv6nOZqhgCQ9IF7w_hu_74b99cbb77fbe98f.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1t4gRY6Gv6nOZqhgCQ9IF7w_hu_36f3a1dc78099f22.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;159&#34;
		data-flex-basis=&#34;382px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Keep in mind that the flow is only triggered if our trigger condition is met. It took me quite some time and a lot of binging to figure out a working trigger condition for this scenario. (Yes, I really found the answer on Bing without any googling!).&lt;/p&gt;
&lt;p&gt;The condition consists of an &lt;strong&gt;and&lt;/strong&gt; operator and an &lt;strong&gt;or&lt;/strong&gt; operator. In English, it checks for the following:&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;User Principal Name&lt;/strong&gt; is not &lt;strong&gt;Unassigned&lt;/strong&gt; and the &lt;strong&gt;User Profile&lt;/strong&gt; is empty.&lt;/p&gt;
&lt;p&gt;This means that the flow will trigger if the number is assigned to a user, but the &lt;strong&gt;User Profile&lt;/strong&gt; is not populated yet.&lt;/p&gt;
&lt;p&gt;or&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;User Principal Name&lt;/strong&gt; is not the same as the &lt;strong&gt;User Profile.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The flow also triggers if the &lt;strong&gt;User Profile&lt;/strong&gt; is already populated but it doesn’t match the &lt;strong&gt;User Principal Name&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;I didn’t find a way to delete the &lt;strong&gt;User Profile&lt;/strong&gt; if any given number changes from &lt;strong&gt;Assigned&lt;/strong&gt; to &lt;strong&gt;Unassigned.&lt;/strong&gt; Unfortunately, setting the filed to &lt;code&gt;null&lt;/code&gt; via the flow did not work. Because of that we just delete the list item using &lt;strong&gt;Delete item&lt;/strong&gt;. The number will be added back to the list with its up to date information as soon as the Runbook runs again.&lt;/p&gt;
&lt;p&gt;In the &lt;strong&gt;If no&lt;/strong&gt; action of the condition, we need to add another condition. This time, we want to check if the &lt;strong&gt;Account Type&lt;/strong&gt; is equal to &lt;strong&gt;User Account&lt;/strong&gt;. We only want to include a link to Teams Admin Center if it’s a user account.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1KSugJSu7Fc1kD6QiBAKPg.png&#34;
	width=&#34;1966&#34;
	height=&#34;413&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1KSugJSu7Fc1kD6QiBAKPg_hu_e476a433ba0f8d1e.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1KSugJSu7Fc1kD6QiBAKPg_hu_fd6bdbef5f7541d2.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;476&#34;
		data-flex-basis=&#34;1142px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;In this condition, we only configure actions if it’s &lt;strong&gt;True&lt;/strong&gt;. First, we update the list item. Select your &lt;strong&gt;Site Address&lt;/strong&gt; and &lt;strong&gt;List Name&lt;/strong&gt; again. Then fill in the &lt;strong&gt;ID&lt;/strong&gt; and &lt;strong&gt;Title&lt;/strong&gt; from dynamic content. And finally, in &lt;strong&gt;User Profile Claims&lt;/strong&gt; select &lt;strong&gt;Enter custom value&lt;/strong&gt; and choose &lt;strong&gt;User Principal Name&lt;/strong&gt; from dynamic content. Leave all the other fields blank.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1THXkqvbzDa3lKzVmDmqHww.png&#34;
	width=&#34;967&#34;
	height=&#34;1245&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1THXkqvbzDa3lKzVmDmqHww_hu_774367a7f43c4fb0.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1THXkqvbzDa3lKzVmDmqHww_hu_feb4ed790a01116c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;77&#34;
		data-flex-basis=&#34;186px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Add another action and choose &lt;strong&gt;Send an HTTP request to SharePoint&lt;/strong&gt;. The &lt;strong&gt;Update item&lt;/strong&gt; action only supports hyperlinks without a description so it would show the entire URL instead of a friendly name in the list. Although it’s more complicated, we can add a hyperlink with a friendly name using &lt;strong&gt;Send an HTTP request to SharePoint&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Fill in your &lt;strong&gt;Site Address&lt;/strong&gt; again and set the &lt;strong&gt;Method&lt;/strong&gt; to &lt;strong&gt;POST.&lt;/strong&gt; The &lt;strong&gt;Uri&lt;/strong&gt; must look like this:&lt;/p&gt;
&lt;p&gt;_api/web/lists/GetByTitle(&amp;lsquo;Teams Phone Number Overview Demo 10&amp;rsquo;)/items(@{triggerOutputs()?[&amp;lsquo;body/ID&amp;rsquo;]})&lt;/p&gt;
&lt;p&gt;Make sure to adjust the list name in case your list is named differently. Spaces inside the single quotes are supported in this field.&lt;/p&gt;
&lt;p&gt;Click the little icon next to the &lt;strong&gt;Headers&lt;/strong&gt; field to engage &lt;strong&gt;Switch Headers to text mode&lt;/strong&gt; and paste the following Json:&lt;/p&gt;
&lt;p&gt;{&lt;br&gt;
&amp;ldquo;Content-Type&amp;rdquo;: &amp;ldquo;application/json;odata=verbose&amp;rdquo;,&lt;br&gt;
&amp;ldquo;X-HTTP-Method&amp;rdquo;: &amp;ldquo;MERGE&amp;rdquo;,&lt;br&gt;
&amp;ldquo;IF-MATCH&amp;rdquo;: &amp;ldquo;*&amp;rdquo;&lt;br&gt;
}&lt;/p&gt;
&lt;p&gt;Then paste the following Json content in the &lt;strong&gt;Body&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;{&lt;br&gt;
&amp;ldquo;__metadata&amp;rdquo;: {&lt;br&gt;
&amp;ldquo;type&amp;rdquo;: &amp;ldquo;SP.Data.Teams_x0020_Phone_x0020_Number_x0020_Demo_x0020_10ListItem&amp;rdquo;&lt;br&gt;
},&lt;br&gt;
&amp;ldquo;TeamsAdminCenter&amp;rdquo;: {&lt;br&gt;
&amp;ldquo;Description&amp;rdquo;: &amp;ldquo;Teams Admin Center&amp;rdquo;,&lt;br&gt;
&amp;ldquo;Url&amp;rdquo;: &amp;ldquo;&lt;a class=&#34;link&#34; href=&#34;https://admin.teams.microsoft.com/users/@%7btriggerOutputs%28%29&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://admin.teams.microsoft.com/users/@{triggerOutputs()&lt;/a&gt;?[&amp;lsquo;body/UserId&amp;rsquo;]}/account&amp;rdquo;&lt;br&gt;
}&lt;br&gt;
}&lt;/p&gt;
&lt;p&gt;Again, make sure to adjust the list name to your own. There is no space or any other character between the end of the list name and &lt;code&gt;ListItem&lt;/code&gt; . All spaces in the list name must be replaced by &lt;code&gt;_x0020_&lt;/code&gt; .&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1cfiipG861HDIM3jYlRBIVA.png&#34;
	width=&#34;964&#34;
	height=&#34;1381&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1cfiipG861HDIM3jYlRBIVA_hu_ee6448debccf2de8.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1cfiipG861HDIM3jYlRBIVA_hu_4a95096f07331ad2.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;69&#34;
		data-flex-basis=&#34;167px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If you look at the trigger condition again, you might have noticed that the field names like &lt;strong&gt;User Principal Name&lt;/strong&gt; are all written like this: &lt;strong&gt;User_x0020_Principal_x0020_Name.&lt;/strong&gt; I noticed that all columns which contain spaces and have been created via the Graph API are named this way. &lt;strong&gt;Teams Admin Center&lt;/strong&gt; on the other hand has been created manually via SharePoint Online. This column&amp;rsquo;s reference name is now &lt;strong&gt;TeamsAdminCenter&lt;/strong&gt; as you can see in the screenshot above.&lt;/p&gt;
&lt;p&gt;That’s it, we finished building our flow. For reference, here’s the complete layout of the flow without expanded actions.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/131pEBoBjwrnmLnXAWpI1fw.png&#34;
	width=&#34;3004&#34;
	height=&#34;1558&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/131pEBoBjwrnmLnXAWpI1fw_hu_628e3e9f0038b731.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/131pEBoBjwrnmLnXAWpI1fw_hu_8c232f68be2f5294.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;192&#34;
		data-flex-basis=&#34;462px&#34;
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;force-sync-thelist&#34;&gt;Force Sync the List
&lt;/h3&gt;&lt;p&gt;The only problem now is that it won’t be triggered unless the &lt;strong&gt;User Principal Name&lt;/strong&gt; field changes on any of the list entries. The easiest way to get these fields populated is to just delete all list entries of assigned user numbers and re-run the Runbook.&lt;/p&gt;
&lt;p&gt;Filter the list by &lt;strong&gt;Assigned&lt;/strong&gt; numbers and Account Type: &lt;strong&gt;User Account&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1oy8uFABozWsg4AIlK3vuaA.png&#34;
	width=&#34;2748&#34;
	height=&#34;410&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1oy8uFABozWsg4AIlK3vuaA_hu_164cad1b81ac35.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1oy8uFABozWsg4AIlK3vuaA_hu_76a14c0f2ca543ce.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;670&#34;
		data-flex-basis=&#34;1608px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Then delete all the entries and wait for the action to complete.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1MlCWdIO1Y8DSyWObydkRFw.png&#34;
	width=&#34;955&#34;
	height=&#34;530&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1MlCWdIO1Y8DSyWObydkRFw_hu_92ea612c6b8ee6c5.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1MlCWdIO1Y8DSyWObydkRFw_hu_8ddddc888b6cbbcd.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;180&#34;
		data-flex-basis=&#34;432px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Now start the Runbook again or wait for the next scheduled job. Once the job has completed, wait another few minutes for the flow to be triggered.&lt;/p&gt;
&lt;p&gt;In the flow’s run history, you should then be able to see a couple of successful flow runs. One for each assigned user number which was previously deleted from the list.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1f5SBjLNb00UmmWwtZCQ.png&#34;
	width=&#34;1604&#34;
	height=&#34;360&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1f5SBjLNb00UmmWwtZCQ_hu_18347b99fb048ca8.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1f5SBjLNb00UmmWwtZCQ_hu_81d5f5d23948e80b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;445&#34;
		data-flex-basis=&#34;1069px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;In the details of the flow run, we can see that both the item was updated, and that the HTTP request was made to SharePoint.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1Gf3bQf6h3rT6dZtQNarGw.png&#34;
	width=&#34;2995&#34;
	height=&#34;1322&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1Gf3bQf6h3rT6dZtQNarGw_hu_22b20a70985d8af.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1Gf3bQf6h3rT6dZtQNarGw_hu_f6cf1ed18cf5c18f.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;226&#34;
		data-flex-basis=&#34;543px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;In our SharePoint List, we can now see that both the &lt;strong&gt;User Profile&lt;/strong&gt; and the link to &lt;strong&gt;Teams Admin Center&lt;/strong&gt; have been populated.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1cBT73cmZmnoEZNRofNOWaQ.png&#34;
	width=&#34;2750&#34;
	height=&#34;393&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1cBT73cmZmnoEZNRofNOWaQ_hu_fd94c5f4e9da41c4.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1cBT73cmZmnoEZNRofNOWaQ_hu_e98b0993faf5cc63.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;699&#34;
		data-flex-basis=&#34;1679px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;updating-the-direct-routing-numbers-inazure&#34;&gt;Updating the Direct Routing Numbers in Azure
&lt;/h4&gt;&lt;p&gt;Chances are that you’re going to have more/new Direct Routing numbers at some point. For that scenario, I created another script in &lt;code&gt;.\Setup\UpdateDirectRoutingNumbers.ps1&lt;/code&gt; . This script will compare the contents of the local &lt;strong&gt;DirectRoutingNumbers.csv&lt;/strong&gt; with what’s stored in the Azure Automation Variable. If the content is not the same, the script will &lt;strong&gt;overwrite&lt;/strong&gt; the content of the Automation Variable with your new local source list. This means that you will always need to include all your Direct Routing numbers in the local CSV file, not just new numbers. If you remove numbers from the local source, they will also be removed from the Automation Variable. Hopefully, you won’t have to do this too often.&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/mozziemozz/TeamsPhoneAutomation/blob/main/Setup/UpdateDirectRoutingNumbers.ps1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;TeamsPhoneAutomation/UpdateDirectRoutingNumbers.ps1 at main · mozziemozz/TeamsPhoneAutomation (github.com)&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;conclusion&#34;&gt;Conclusion
&lt;/h3&gt;&lt;p&gt;While this may be a read-only solution and it doesn’t have any management capabilities such as assigning or unassigning phone numbers, I still believe that there’s tremendous value in this. I think that this could be an interesting approach for smaller companies or non-profit organizations which might not have the cash to purchase an expensive number management solution. The costs for running a Runbook job every now and then should be fairly low. According to &lt;a class=&#34;link&#34; href=&#34;https://azure.microsoft.com/en-us/pricing/details/automation/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;this website&lt;/a&gt; 500 minutes of Job run time is free every month.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/109Skrvola5ZGSYdJONlA.png&#34;
	width=&#34;1952&#34;
	height=&#34;656&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/109Skrvola5ZGSYdJONlA_hu_e27289196e613dd3.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/109Skrvola5ZGSYdJONlA_hu_4dd92e0ddb1a0644.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;297&#34;
		data-flex-basis=&#34;714px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Of course, this depends on the amount of numbers you have. The more numbers you have, the longer it will take for a job to complete. If we assume that each job requires 5 minutes to run, that would be about $ 6.5 per month if the job runs every hour every day of a month.&lt;/p&gt;
&lt;p&gt;With this, we can finally have a complete, dynamically updated list of all our phone numbers and their state regarding their type. On top of that, we can make it accessible easily for all users or admins who need to work with this kind of information. For example, we could also add the list as a Tab in a Microsoft Teams Channel.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1pmmbdHeT9HfnoslqhEkrQ.png&#34;
	width=&#34;3454&#34;
	height=&#34;1117&#34;
	srcset=&#34;https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1pmmbdHeT9HfnoslqhEkrQ_hu_acb2017dc2527324.png 480w, https://heusser.pro/p/teams-phone-number-management-on-a-budget-e25d53f65caf/1pmmbdHeT9HfnoslqhEkrQ_hu_50d2d78ed683570b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;309&#34;
		data-flex-basis=&#34;742px&#34;
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;final-notes&#34;&gt;Final Notes
&lt;/h4&gt;&lt;p&gt;I invested a lot of time to perfect this project and I’m incredibly happy to be finally able to share it with the community and my readers on Medium. I tested both the deployment to Azure and the Runbook logic quite a few times so I’m fairly confident that this should work in other Tenants as well. Since I don’t have any Operator Connect numbers available, I couldn’t test that yet. If you are an Operator Connect customer and want to try this solution, feel free to let me know if it worked for you.&lt;/p&gt;
&lt;p&gt;I mainly tested populating and updating the list with about forty numbers of mixed types. I did make some quick tests (and adjustments) with a list of about 1000 Direct Routing numbers and that has worked well for me so far. If you manage a lot of phone numbers and want to try the solution yourself, I’m also happy if you can provide feedback on how it performs with even more numbers.&lt;/p&gt;
&lt;p&gt;As always, I hope you like what I’ve been up to!&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Microsoft Teams: Handle Shared Voicemail More Efficiently</title>
        <link>https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/</link>
        <pubDate>Sun, 05 Jun 2022 21:06:42 +0000</pubDate>
        
        <guid>https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/</guid>
        <description>&lt;p&gt;In this &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/everything-you-ever-wanted-to-know-about-microsoft-teams-phone-and-shared-voicemail-4df01cb28e24&#34; &gt;article&lt;/a&gt;, I did a pretty hefty run down of all things shared voicemail in Microsoft Teams. I also teased another article about creating a Power Automate Flow to deliver shared voicemails into a Teams channel instead of receiving them just by email. …which brings us to this article.&lt;/p&gt;
&lt;p&gt;The idea behind all that is, that shared voicemails get posted as an adaptive card in a Teams channel, rather than that a few individuals receive shared voicemails by email.&lt;/p&gt;
&lt;h4 id=&#34;preparations&#34;&gt;Preparations
&lt;/h4&gt;&lt;p&gt;First, we need to identify or create a Microsoft 365 Group which will be configured as shared voicemail target on an auto attendant or a call queue. Next, we’ll need to enable the follow in inbox feature for this group and add a shared mailbox of choice to this M365 Group. (If you need help with this, please check the linked article at the beginning of this story.)&lt;/p&gt;
&lt;h4 id=&#34;building-theflow&#34;&gt;Building the Flow
&lt;/h4&gt;&lt;p&gt;Then we can start building our flow. Choose “When a new email arrives in a shared mailbox (V2)” (Office 365 Outlook) as your trigger and select the mailbox and its folder. (If this shared mailbox also receives other messages, you might want to include a subject filter under advanced options.)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1TjJaftuwTADjGZhNQJHsEg.png&#34;
	width=&#34;919&#34;
	height=&#34;295&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1TjJaftuwTADjGZhNQJHsEg_hu_1bbc5ddff5c3c785.png 480w, https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1TjJaftuwTADjGZhNQJHsEg_hu_da12cc7ea4480c6e.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;311&#34;
		data-flex-basis=&#34;747px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Next, we’ll need to initialize some variables.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1Mo4Px5HSucy8Q7gniM9KVg.png&#34;
	width=&#34;912&#34;
	height=&#34;285&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1Mo4Px5HSucy8Q7gniM9KVg_hu_e91aeb8f69a33cea.png 480w, https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1Mo4Px5HSucy8Q7gniM9KVg_hu_52515add349b3c12.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;320&#34;
		data-flex-basis=&#34;768px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;The value of this variable is the phone number which left the voicemail. We can get the number by splitting the from address at the “@” character and selecting the first value of the splitted string. This is done with the following expression.&lt;/p&gt;
&lt;p&gt;split(triggerOutputs()?[&amp;lsquo;body/from&amp;rsquo;], &amp;lsquo;@&amp;rsquo;)[0]&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1N9QkMCcHSanum0L4lJkrA.png&#34;
	width=&#34;916&#34;
	height=&#34;283&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1N9QkMCcHSanum0L4lJkrA_hu_b09b3699b4186876.png 480w, https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1N9QkMCcHSanum0L4lJkrA_hu_b7081aeba721bbd4.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;323&#34;
		data-flex-basis=&#34;776px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;To avoid duplicate files, we will create a time stamp with this expression. (Adjust the name of the time zone to your own time zone. If you’re not sure how your time zone is called, just run “Get-TimeZone” in PowerShell and copy it’s Id.)&lt;/p&gt;
&lt;p&gt;convertTimeZone(utcNow(),&amp;lsquo;UTC&amp;rsquo;,&amp;lsquo;W. Europe Standard Time&amp;rsquo;, &amp;lsquo;yyyy-MM-dd HH:mm:ss&amp;rsquo;)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1wAZc48VRkLgFAsVeJyrQ.png&#34;
	width=&#34;915&#34;
	height=&#34;285&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1wAZc48VRkLgFAsVeJyrQ_hu_18502116db6c5ba8.png 480w, https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1wAZc48VRkLgFAsVeJyrQ_hu_2bf79537e9ac6503.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;321&#34;
		data-flex-basis=&#34;770px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;And in the end, we will convert the “+” sign into an URL friendly format with this expression.&lt;/p&gt;
&lt;p&gt;replace(variables(&amp;lsquo;FromNumber&amp;rsquo;), &amp;lsquo;+&amp;rsquo;, &amp;lsquo;%2b&amp;rsquo;)&lt;/p&gt;
&lt;p&gt;Now we have all the variables which we need. Choose “Get Attachment (V2)” (Outlook Office 365) as your next action. This will automatically add an “Apply to each” loop for this action. Let’s fill in the dynamic content of the trigger output such as “Message Id” and “Attachment Id”. To be sure that only voicemails are uploaded to SharePoint, I’ve added a condition which checks if the attachments filename ends with *.mp3.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/10Wa7BKJuUsYsSm3vdMTuw.png&#34;
	width=&#34;1973&#34;
	height=&#34;807&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/10Wa7BKJuUsYsSm3vdMTuw_hu_57af2001f222fc35.png 480w, https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/10Wa7BKJuUsYsSm3vdMTuw_hu_7113c9815f6bf100.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;244&#34;
		data-flex-basis=&#34;586px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;If it does, we’ll save the file to SharePoint. If it doesn’t, we won’t do any further processing and the flow ends there. Notice how we’ll use the previously initialized variables to construct a unique filename consisting of the received date and the caller’s number. Once the file has been saved, we’ll create a share link to later access the file.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1PtvopHOOHj77EW7S0wh1Q.png&#34;
	width=&#34;972&#34;
	height=&#34;962&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1PtvopHOOHj77EW7S0wh1Q_hu_56eca94b42dda14e.png 480w, https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1PtvopHOOHj77EW7S0wh1Q_hu_aa4b9b3c90ad7bc0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;101&#34;
		data-flex-basis=&#34;242px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;All that’s left to do now is to post an adaptive card to a channel and wait for a reply.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1L1N5uzLNZkz9j00cjuldLg.png&#34;
	width=&#34;832&#34;
	height=&#34;1790&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1L1N5uzLNZkz9j00cjuldLg_hu_baa83b2b2440fc90.png 480w, https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1L1N5uzLNZkz9j00cjuldLg_hu_befb4be6458b9d4a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;46&#34;
		data-flex-basis=&#34;111px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Paste the following JSON object into your flow and replace the variables with your own names if needed.&lt;/p&gt;
&lt;p&gt;{&lt;br&gt;
&amp;ldquo;$schema&amp;rdquo;: &amp;ldquo;&lt;a class=&#34;link&#34; href=&#34;http://adaptivecards.io/schemas/adaptive-card.json&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://adaptivecards.io/schemas/adaptive-card.json&lt;/a&gt;&amp;rdquo;,&lt;br&gt;
&amp;ldquo;type&amp;rdquo;: &amp;ldquo;AdaptiveCard&amp;rdquo;,&lt;br&gt;
&amp;ldquo;version&amp;rdquo;: &amp;ldquo;1.3&amp;rdquo;,&lt;br&gt;
&amp;ldquo;body&amp;rdquo;: [&lt;br&gt;
{&lt;br&gt;
&amp;ldquo;type&amp;rdquo;: &amp;ldquo;TextBlock&amp;rdquo;,&lt;br&gt;
&amp;ldquo;text&amp;rdquo;: &amp;ldquo;@{triggerOutputs()?[&amp;lsquo;body/subject&amp;rsquo;]}&amp;rdquo;,&lt;br&gt;
&amp;ldquo;size&amp;rdquo;: &amp;ldquo;Large&amp;rdquo;&lt;br&gt;
},&lt;br&gt;
{&lt;br&gt;
&amp;ldquo;type&amp;rdquo;: &amp;ldquo;TextBlock&amp;rdquo;,&lt;br&gt;
&amp;ldquo;text&amp;rdquo;: &amp;ldquo;New Voicemail from @{variables(&amp;lsquo;FromNumber&amp;rsquo;)}&amp;rdquo;&lt;br&gt;
},&lt;br&gt;
{&lt;br&gt;
&amp;ldquo;type&amp;rdquo;: &amp;ldquo;ActionSet&amp;rdquo;,&lt;br&gt;
&amp;ldquo;actions&amp;rdquo;: [&lt;br&gt;
{&lt;br&gt;
&amp;ldquo;type&amp;rdquo;: &amp;ldquo;Action.OpenUrl&amp;rdquo;,&lt;br&gt;
&amp;ldquo;title&amp;rdquo;: &amp;ldquo;Listen to Voicemail Message&amp;rdquo;,&lt;br&gt;
&amp;ldquo;url&amp;rdquo;: &amp;ldquo;@{outputs(&amp;lsquo;Create_sharing_link_for_a_file_or_folder&amp;rsquo;)?[&amp;lsquo;body/link/webUrl&amp;rsquo;]}&amp;rdquo;&lt;br&gt;
}&lt;br&gt;
]&lt;br&gt;
},&lt;br&gt;
{&lt;br&gt;
&amp;ldquo;type&amp;rdquo;: &amp;ldquo;ActionSet&amp;rdquo;,&lt;br&gt;
&amp;ldquo;actions&amp;rdquo;: [&lt;br&gt;
{&lt;br&gt;
&amp;ldquo;type&amp;rdquo;: &amp;ldquo;Action.OpenUrl&amp;rdquo;,&lt;br&gt;
&amp;ldquo;title&amp;rdquo;: &amp;ldquo;@{variables(&amp;lsquo;FromNumber&amp;rsquo;)} Call Back&amp;rdquo;,&lt;br&gt;
&amp;ldquo;url&amp;rdquo;: &amp;ldquo;&lt;a class=&#34;link&#34; href=&#34;https://teams.microsoft.com/l/call/0/0?users=4:@%7Bvariables%28%27CallBackNumber%27%29%7D&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://teams.microsoft.com/l/call/0/0?users=4:@{variables(&amp;lsquo;CallBackNumber&amp;rsquo;)}&lt;/a&gt;&amp;rdquo;&lt;br&gt;
},&lt;br&gt;
{&lt;br&gt;
&amp;ldquo;type&amp;rdquo;: &amp;ldquo;Action.Submit&amp;rdquo;,&lt;br&gt;
&amp;ldquo;title&amp;rdquo;: &amp;ldquo;Call Completed&amp;rdquo;,&lt;br&gt;
&amp;ldquo;style&amp;rdquo;: &amp;ldquo;positive&amp;rdquo;&lt;br&gt;
}&lt;br&gt;
]&lt;br&gt;
}&lt;br&gt;
]&lt;br&gt;
}&lt;/p&gt;
&lt;h3 id=&#34;the-result&#34;&gt;The Result
&lt;/h3&gt;&lt;p&gt;Let’s see how this looks from a user&amp;rsquo;s perspective. Whenever a new shared voicemail is received in the shared mailbox, the Flow will be triggered and sends an adaptive card into the channel.&lt;/p&gt;
&lt;p&gt;All Team members will know that a new voicemail has been received and they can listen to it by clicking the button.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1OSUU8Q1gnJGs2jVqNeag.png&#34;
	width=&#34;1233&#34;
	height=&#34;396&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1OSUU8Q1gnJGs2jVqNeag_hu_7cf68074c4dd0eb8.png 480w, https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1OSUU8Q1gnJGs2jVqNeag_hu_a3cc6a17d8e4864a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;311&#34;
		data-flex-basis=&#34;747px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;This will open the SharePoint link and the media can be played back in the browser.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1fLv1Wx2j4fnsIjFXgGimg.png&#34;
	width=&#34;1896&#34;
	height=&#34;1020&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1fLv1Wx2j4fnsIjFXgGimg_hu_d47db4d4a8dc86b4.png 480w, https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1fLv1Wx2j4fnsIjFXgGimg_hu_2332cf660b1f53a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;185&#34;
		data-flex-basis=&#34;446px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Unfortunately, playing back media on adaptive cards is not yet supported in Teams.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1hAWYMhyLYhbgz8eG7K5gg.png&#34;
	width=&#34;1240&#34;
	height=&#34;241&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1hAWYMhyLYhbgz8eG7K5gg_hu_5975dbe41e76d836.png 480w, https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1hAWYMhyLYhbgz8eG7K5gg_hu_431ee1e44e7515eb.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;514&#34;
		data-flex-basis=&#34;1234px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Because we’ve inserted a &lt;a class=&#34;link&#34; href=&#34;https://heusser.pro/p/creating-microsoft-teams-calling-deep-links-f7c9d62eacdd&#34; &gt;calling deep link&lt;/a&gt; on the adaptive card, users will also be able to initiate a call directly from the card.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1SkEKX8jDzDm0ToFqlAA.png&#34;
	width=&#34;889&#34;
	height=&#34;228&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1SkEKX8jDzDm0ToFqlAA_hu_ce0ed1ec4e44be68.png 480w, https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1SkEKX8jDzDm0ToFqlAA_hu_e109e76e9cb75a0b.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;389&#34;
		data-flex-basis=&#34;935px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;And finally, once the customer has been called back the adaptive card can be completed by clicking the “Call Completed” button. This will refresh the card and let all other channel members know, that there is no action needed from their side anymore. They will also be able to see, who completed the card.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1SBzl3BpHLvjijG1rcX5MA.png&#34;
	width=&#34;1228&#34;
	height=&#34;289&#34;
	srcset=&#34;https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1SBzl3BpHLvjijG1rcX5MA_hu_df33b29ff5c07b6f.png 480w, https://heusser.pro/p/microsoft-teams-handle-shared-voicemail-more-efficiently-746ddeae6ac4/1SBzl3BpHLvjijG1rcX5MA_hu_3cab282b95f1799c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;424&#34;
		data-flex-basis=&#34;1019px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;I really hope that media cards will soon be supported to provide an even better user experience in Teams.&lt;/p&gt;
&lt;p&gt;As always, I hope that you liked my article and that it helps you too, deliver a better user experience.&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
