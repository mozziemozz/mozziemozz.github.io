<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="The M365 Call Flow Visualizer focuses on retrieving configurations of Teams Auto Attendants and Call Queues which have already been built‚Ä¶">
<title>Bulk Deploy Microsoft Teams Call Flows with PowerShell in Minutes</title>

<link rel='canonical' href='https://heusser.pro/p/bulk-deploy-microsoft-teams-call-flows-with-powershell-in-minutes-1a78099fe94f/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="Bulk Deploy Microsoft Teams Call Flows with PowerShell in Minutes">
<meta property='og:description' content="The M365 Call Flow Visualizer focuses on retrieving configurations of Teams Auto Attendants and Call Queues which have already been built‚Ä¶">
<meta property='og:url' content='https://heusser.pro/p/bulk-deploy-microsoft-teams-call-flows-with-powershell-in-minutes-1a78099fe94f/'>
<meta property='og:site_name' content='HEUSSER.PRO'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2023-02-18T17:24:32&#43;00:00'/><meta property='article:modified_time' content='2023-02-18T17:24:32&#43;00:00'/>
<meta name="twitter:title" content="Bulk Deploy Microsoft Teams Call Flows with PowerShell in Minutes">
<meta name="twitter:description" content="The M365 Call Flow Visualizer focuses on retrieving configurations of Teams Auto Attendants and Call Queues which have already been built‚Ä¶">
    <link rel="shortcut icon" href="/favicon.png" />

    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "kozb6q2xjn");
    </script>    

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_fe2816fc44d850d2.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ü´°</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">HEUSSER.PRO</a></h1>
            <h2 class="site-description">Martin Heusser | M365 MVP</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/mozziemozz'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://x.com/@mozzeph'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about-me/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About Me</span>
            </a>
        </li>
        
        
        <li >
            <a href='/advertise/' >
                
                
                
                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-device-desktop-dollar"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M13 16h-9a1 1 0 0 1 -1 -1v-10a1 1 0 0 1 1 -1h16a1 1 0 0 1 1 1v5.5" /><path d="M7 20h6.5" /><path d="M9 16v4" /><path d="M21 15h-2.5a1.5 1.5 0 0 0 0 3h1a1.5 1.5 0 0 1 0 3h-2.5" /><path d="M19 21v1m0 -8v1" /></svg>
                
                <span>Advertise</span>
            </a>
        </li>
        
        
        <li >
            <a href='/support-me/' >
                
                
                
                    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-cup"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 11h14v-3h-14z" /><path d="M17.5 11l-1.5 10h-8l-1.5 -10" /><path d="M6 8v-1a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v1" /><path d="M15 5v-2" /></svg>
                
                <span>Support Me</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/imprint/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-info-circle" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" /><path d="M12 9h.01" /><path d="M11 12h1v4h1" /></svg>
                
                <span>Imprint</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li>
      <ol>
        <li>
          <ol>
            <li><a href="#some-notes-about-thisscript">Some Notes About This¬†Script</a></li>
            <li><a href="#how-does-itwork">How Does it¬†Work?</a></li>
            <li><a href="#the-script">The Script</a></li>
            <li><a href="#finishing-up">Finishing Up</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/auto-attendants/" >
                Auto Attendants
            </a>
        
            <a href="/categories/call-queues/" >
                Call Queues
            </a>
        
            <a href="/categories/powershell/" style="background-color: #141e2c; color: #fff;">
                PowerShell
            </a>
        
            <a href="/categories/resource-accounts/" >
                Resource Accounts
            </a>
        
            <a href="/categories/automation/" >
                Automation
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/bulk-deploy-microsoft-teams-call-flows-with-powershell-in-minutes-1a78099fe94f/">Bulk Deploy Microsoft Teams Call Flows with PowerShell in Minutes</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            The M365 Call Flow Visualizer focuses on retrieving configurations of Teams Auto Attendants and Call Queues which have already been built‚Ä¶
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Feb 18, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    8 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>The M365 Call Flow Visualizer focuses on retrieving configurations of Teams Auto Attendants and Call Queues which have already been built. And it does so by using PowerShell.</p>
<p>But what about the opposite? Can we use PowerShell to create a new call flow from scratch in just a few minutes as well?</p>
<p>In this article, I‚Äôm going to show you how you can create a basic, yet fully functional call flow with PowerShell. The only thing you‚Äôll need to do yourself in the end is to add users to the Team.</p>
<p><strong>What is Needed to Build a Call Flow?</strong></p>
<p>Before we get into the script, let‚Äôs look at what steps we need to take to build a call flow.</p>
<ol>
<li>Create resource accounts</li>
<li>License resource accounts (and set Usage Location)</li>
<li>Assign a phone number (and voice routing policy if it‚Äôs a Direct Routing number) to the resource accounts</li>
<li>Create a Microsoft 365 Group with a Team (For voice enabled channel and shared voicemail)</li>
<li>Configure M365 Group for Follow in Inbox and Show in Outlook</li>
<li>Create and configure the Call Queue</li>
<li>Assign the Resource Account to the Call Queue</li>
<li>Create the Auto Attendant and configure forwarding to the queue during business hours</li>
<li>Assign the Resource Account to the Auto Attendant</li>
</ol>
<p>These are quite a few steps to conclude but the hardest part about this is remembering the correct order of all the steps so you can do it as fast as possible. For example, if you forget to set the Usage Location to the same country as the phone number you want to assign, you will have to go back and wait for the change to be propagated.</p>
<p>Another example is that you should always start at the back of your call flow. You can‚Äôt fully configure a Call Queue if you don‚Äôt have the Team or the M365 Group for shared voicemail yet. And you can‚Äôt finish configuring your Auto Attendant if you haven‚Äôt built the queue before.</p>
<p>If you want to learn more about resource accounts or shared voicemail, I suggest the following articles of mine.</p>
<p><a class="link" href="/p/everything-you-ever-wanted-to-know-about-teams-resource-accounts-2ff9661fc489" >Everything You Ever Wanted to Know About Teams Resource Accounts | by martin heusser | Medium</a></p>
<p><a class="link" href="/p/everything-you-ever-wanted-to-know-about-microsoft-teams-phone-and-shared-voicemail-4df01cb28e24" >Everything you ever wanted to know about Microsoft Teams Phone and Shared Voicemail | by martin heusser | Medium</a></p>
<h4 id="some-notes-about-thisscript">Some Notes About This¬†Script
</h4><p>The script follows my personal best practices when building call flows and considers all the aforementioned examples of steppingstones for maximum efficiency.</p>
<p>This is not intended to build super complex call flows. Instead, it is just an example of how one can write a deployment script, which does everything from A-Z in an efficient order. It can, however, build multiple call flows in a row.</p>
<p>While it would be possible to make it even more efficient by, for example, creating and licensing all the resource accounts from the CSV entries first, then create all the Call Queues and at last all the Auto Attendants, I decided not to pursue this road for the sake of simplicity. Instead, the script will create each call flow after the other, which probably takes slightly longer to complete.</p>
<p>There are some steps where we need to wait for the previous steps to complete. For example, when a Resource Account is created, it usually takes a few seconds for the corresponding User Object in Teams to be created as well. Rest assured though; the script will handle all of that on its own. So don‚Äôt get spooked if you see some red error messages in PowerShell. These are just standard error messages, where the script tries to query a user which couldn‚Äôt be found yet.</p>
<p>Because we‚Äôre also querying a tenant‚Äôs domain names and modify licenses this script requires some additional scopes for Microsoft Graph. So be sure to have a Global Admin account ready to consent to these scopes.</p>
<p>Connect-MgGraph -Scopes &ldquo;User.ReadWrite.All&rdquo;, `<br>
&ldquo;Group.ReadWrite.All&rdquo;, `<br>
&ldquo;Domain.ReadWrite.All&rdquo;, `<br>
&ldquo;Organization.ReadWrite.All&rdquo;, `<br>
&ldquo;Directory.ReadWrite.All&rdquo;</p>
<p>To configure the Microsoft 365 Group the script requires the <strong>ExchangeOnlineManagement</strong> PowerShell Module in addition to MicrosoftTeams and Microsoft.Graph**.** If you don‚Äôt have it already, you can use the following command to install it.</p>
<p><code>Install-Module ExchangeOnlineManagement</code></p>
<h4 id="how-does-itwork">How Does it¬†Work?
</h4><p>In my <a class="link" href="https://github.com/mozziemozz/M365CallFlowVisualizer/tree/main/Deployment"  target="_blank" rel="noopener"
    >GitHub Repository</a>, you will find a sample file called ‚ÄúVoiceAppList.csv‚Äù. All you need to do is to fill in your information there. And run the script.</p>
<p><img src="/p/bulk-deploy-microsoft-teams-call-flows-with-powershell-in-minutes-1a78099fe94f/1l6dmaJHs10JUjUNsetrVnA.png"
	width="1734"
	height="957"
	srcset="/p/bulk-deploy-microsoft-teams-call-flows-with-powershell-in-minutes-1a78099fe94f/1l6dmaJHs10JUjUNsetrVnA_hu_730d5432800ea51e.png 480w, /p/bulk-deploy-microsoft-teams-call-flows-with-powershell-in-minutes-1a78099fe94f/1l6dmaJHs10JUjUNsetrVnA_hu_f4af86a310a36e69.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="181"
		data-flex-basis="434px"
	
></p>
<p>These are the details which can be passed from the CSV file to the script.</p>
<ul>
<li>DepartmentName<br>
This name of the queue or Team. It will be added to all elements in the call flow: Team, Channel, Resource Accounts, Auto Attendant, Call Queue. For example, if you set ‚ÄúMarketing‚Äù as your DepartmentName, your queue will be called ‚ÄúMarketing CQ‚Äù.</li>
<li>TopLevelNumber<br>
The number which is called by customers and assigned to the Auto Attendant. It must be an E.164 number. See <a class="link" href="https://learn.microsoft.com/en-us/powershell/module/teams/set-csphonenumberassignment?view=teams-ps#-phonenumber"  target="_blank" rel="noopener"
    >this</a> for more information.</li>
<li>NumberType<br>
This is required for the phone number assignment. Valid values: CallingPlan, OperatorConnect, DirectRouting, <code>$null</code>¬†. Leave the field empty in the CSV if you don‚Äôt want to assign a number just yet.</li>
<li>VoiceRoutingPolicyName<br>
This is only required if you want to assign a Direct Routing number. It‚Äôs only needed if the AA should be capable of external transfers later on. It‚Äôs only added as a precaution. You can read how to get the name of your voice routing policies <a class="link" href="https://learn.microsoft.com/en-us/powershell/module/skype/get-csonlinevoiceroutingpolicy?view=skype-ps"  target="_blank" rel="noopener"
    >here</a>.</li>
<li>UsageLocation<br>
This must be the same as the Phone Number if your‚Äôre using Calling Plans. E.g. ‚ÄúCH‚Äù or ‚ÄúGB‚Äù.</li>
<li>AgentAlertTime<br>
<a class="link" href="https://learn.microsoft.com/en-us/powershell/module/skype/set-cscallqueue?view=skype-ps#-agentalerttime"  target="_blank" rel="noopener"
    >Set-CsCallQueue (SkypeForBusiness) | Microsoft Learn</a></li>
<li>TimeoutThreshold<br>
<a class="link" href="https://learn.microsoft.com/en-us/powershell/module/skype/set-cscallqueue?view=skype-ps#-timeoutthreshold"  target="_blank" rel="noopener"
    >Set-CsCallQueue (SkypeForBusiness) | Microsoft Learn</a></li>
<li>PromptLanguage<br>
This is the language of the text to speech prompt. See <a class="link" href="https://learn.microsoft.com/fr-fr/powershell/module/skype/get-csautoattendantsupportedlanguage?view=skype-ps"  target="_blank" rel="noopener"
    >this</a> MS Learn article for more information. You will be prompted by <code>Out-GridView</code> if you specify an invalid language Id.</li>
<li>TimeoutSharedVoicemailPrompt<br>
<a class="link" href="https://learn.microsoft.com/en-us/powershell/module/skype/set-cscallqueue?view=skype-ps#-timeoutsharedvoicemailtexttospeechprompt"  target="_blank" rel="noopener"
    >Set-CsCallQueue (SkypeForBusiness) | Microsoft Learn</a></li>
<li>AfterHoursDisconnectPrompt<br>
<a class="link" href="https://learn.microsoft.com/en-us/powershell/module/skype/new-csautoattendantprompt?view=skype-ps#-texttospeechprompt"  target="_blank" rel="noopener"
    >New-CsAutoAttendantPrompt (SkypeForBusiness) | Microsoft Learn</a></li>
<li>TimeZone<br>
The time zone of the Auto Attendant. See <a class="link" href="https://learn.microsoft.com/en-us/powershell/module/skype/get-csautoattendantsupportedtimezone?view=skype-ps"  target="_blank" rel="noopener"
    >this</a> MS Learn article for more information. You will be prompted by <code>Out-GridView</code>if you specify an invalid time zone Id.</li>
<li>BusinessHoursStart1<br>
If none of the business hours fields are populated, the script won‚Äôt create an after hours call flow for the Auto Attendant. If only <strong>BusinessHoursStart1</strong> and <strong>BusinessHoursEnd1</strong> are populated, the AA will only have one time slot. If <strong>BusinessHoursStart2</strong> and <strong>BusinessHoursEnd2</strong> are populated as well, the AA will have two time slots, e.g. lunch break.<br>
E.g. <code>08:00</code></li>
<li>BusinessHoursEnd1<br>
E.g. <code>12:15</code></li>
<li>BusinessHoursStart2<br>
E.g. <code>13:30</code></li>
<li>BusinessHoursEnd2<br>
E.g. <code>17:45</code></li>
<li>DomainSuffix<br>
By default, the script will use your tenant‚Äôs default domain for resource account UPNs or MailNicknames. If you want to change that, you can specify and domain that‚Äôs available in your tenant as <code>-DomainSuffix</code>¬†. E.g. ‚Äúexample.onmicrosoft.com‚Äù.</li>
</ul>
<p>Running the script will deploy a simple call flow with an Auto Attendant, business hours and one Call Queue which uses a Voice Enabled Channel for each line in the CSV file. Outside of business hours, the Auto Attendants will play a message and disconnect the call.</p>
<p><img src="/p/bulk-deploy-microsoft-teams-call-flows-with-powershell-in-minutes-1a78099fe94f/1XEyqntZvtv72Qxuzf1aNw.png"
	width="1073"
	height="2737"
	srcset="/p/bulk-deploy-microsoft-teams-call-flows-with-powershell-in-minutes-1a78099fe94f/1XEyqntZvtv72Qxuzf1aNw_hu_391dca93c842c9da.png 480w, /p/bulk-deploy-microsoft-teams-call-flows-with-powershell-in-minutes-1a78099fe94f/1XEyqntZvtv72Qxuzf1aNw_hu_801189ef241996e8.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="39"
		data-flex-basis="94px"
	
></p>
<p>The Call Queues will time out after the amount of seconds which is defined in <code>-TimeoutThreshold</code> and then forward the call to shared voicemail once the greeting has been played back.</p>
<p>The script automatically creates a new Team and a Channel for the Queue as well. I prefer to use dedicated over existing Teams and Channels because not all team members of an existing team are potentially going to answer calls.</p>
<p><img src="/p/bulk-deploy-microsoft-teams-call-flows-with-powershell-in-minutes-1a78099fe94f/1XIhvE9DOsrXKapeR0L3zbA.png"
	width="982"
	height="398"
	srcset="/p/bulk-deploy-microsoft-teams-call-flows-with-powershell-in-minutes-1a78099fe94f/1XIhvE9DOsrXKapeR0L3zbA_hu_d9f379042a6a8fef.png 480w, /p/bulk-deploy-microsoft-teams-call-flows-with-powershell-in-minutes-1a78099fe94f/1XIhvE9DOsrXKapeR0L3zbA_hu_12bfad10f9e98e75.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="246"
		data-flex-basis="592px"
	
></p>
<p>When a new Team is created and the Microsoft 365 Group has not existed before, the group is by default hidden from Outlook Clients. Because we want the agents of the queue to have access to the group mailbox in Outlook, the script will automatically enable the Follow in Inbox feature and unhide the group from Outlook Clients.</p>
<p><img src="/p/bulk-deploy-microsoft-teams-call-flows-with-powershell-in-minutes-1a78099fe94f/1RQyp3fLFRTkxE2XWTu8Ng.png"
	width="900"
	height="671"
	srcset="/p/bulk-deploy-microsoft-teams-call-flows-with-powershell-in-minutes-1a78099fe94f/1RQyp3fLFRTkxE2XWTu8Ng_hu_3e4494ce28775449.png 480w, /p/bulk-deploy-microsoft-teams-call-flows-with-powershell-in-minutes-1a78099fe94f/1RQyp3fLFRTkxE2XWTu8Ng_hu_8243c24c6047d723.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="134"
		data-flex-basis="321px"
	
></p>
<p>Shared voicemail is another reason I like to use dedicated groups. With a new group, we can make sure that the only kind of emails received in this group&rsquo;s inbox are voicemails, and we can enable Follow in Inbox without any concern of potentially spamming dozens of other team members by sending all group emails to their personal inboxes.</p>
<h4 id="the-script">The Script
</h4><script src="https://gist.github.com/mozziemozz/8b4640590b85da1e1f296b9ef599ae9a.js"></script>

<h4 id="finishing-up">Finishing Up
</h4><p>While the call flow is technically already able to receive calls after it has been deployed by the script, you‚Äôll still need to add members to the queue. Otherwise, the calls will never be signaled to any agent.</p>
<p>Remember that only members of the Team who are also Enterprise Voice Enabled will be added to the queue‚Äôs agent list. If you don‚Äôt want to wait a few hours for the agent list to update after you have added the members, you might want to check out <a class="link" href="/p/microsoft-teams-call-queue-agent-lists-and-how-to-force-sync-them-ef8092090df0" >this</a> article. It explains how to force sync an agent list of Call Queues.</p>
<p>As mentioned before, this is a mere example of a very simple call flow. However, if most of your call flows only consist of an Auto Attendant forwarding calls to a Call Queue (Like it‚Äôs common in many small businesses), PowerShell can still be immensely helpful to lay the ground works.</p>
<p>Naturally, you can still go into TAC and adjust everything to your needs after the script has built your scaffolding. You just won‚Äôt have to bother adding resources accounts and associating them with your voice apps etc.</p>
<p>Creating Auto Attendants with PowerShell is quite a complex process compared to Call Queues or other Microsoft resources. If you want to adjust my script to your specific needs, a good place to start is the official documentation from Microsoft. As far as I can tell, they recently added updated example scripts which might be helpful.</p>
<p><a class="link" href="https://learn.microsoft.com/en-us/powershell/module/skype/new-csautoattendant?view=skype-ps"  target="_blank" rel="noopener"
    >New-CsAutoAttendant (SkypeForBusiness) | Microsoft Learn</a></p>
<p><a class="link" href="https://learn.microsoft.com/en-us/powershell/module/skype/set-csautoattendant?view=skype-ps"  target="_blank" rel="noopener"
    >Set-CsAutoAttendant (SkypeForBusiness) | Microsoft Learn</a></p>
<p>Now go ask ChatGPT to write you a script that does the same.</p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/teams-auto-attendant-and-call-queue-spring-cleaning-5e7e6d54b9ca/">
        
        

        <div class="article-details">
            <h2 class="article-title">Teams Auto Attendant and Call Queue Spring-Cleaning</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/get-missed-call-notifications-for-teams-call-queues-free-community-solution-cozo3bhojb7t/">
        
        
            <div class="article-image">
                <img src="/p/get-missed-call-notifications-for-teams-call-queues-free-community-solution-cozo3bhojb7t/cover.7304950aa6b85bd8562e89f20b457eab_hu_279a6c7452d3f0bf.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Get Missed Call Notifications for Teams Call Queues (Free Community Solution)"
                        data-key="/get-missed-call-notifications-for-teams-call-queues-(free-community-solution)-cozo3bhojb7t" 
                        data-hash="md5-cwSVCqa4W9hWLonyC0V&#43;qw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Get Missed Call Notifications for Teams Call Queues (Free Community Solution)</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/manage-microsoft-teams-call-queues-with-powershell-force-sync-9919e2939552/">
        
        

        <div class="article-details">
            <h2 class="article-title">Manage Microsoft Teams Call Queues with PowerShell (Force-Sync)</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/teams-auto-attendant-stuff-you-didnt-know-about-4888a20df0fb/">
        
        

        <div class="article-details">
            <h2 class="article-title">Teams Auto Attendant Stuff You Didn‚Äôt Know About</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/report-on-teams-call-queue-opt-in-status-and-assignment-paths-93f177976485/">
        
        

        <div class="article-details">
            <h2 class="article-title">Report on Teams Call Queue Opt In Status and Assignment Paths</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "heusser-pro" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2022 - 
        
        2025 HEUSSER.PRO
    </section>
    
    <section class="powerby">
        
            Hosted on GitHub Pages <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>

